import{r as A,j as U,c as T,R as Ee,a as ln}from"./index-5c090d89.js";import{u as $d,d as Bd}from"./index-19d4202d.js";function xt(){return xt=Object.assign?Object.assign.bind():function(r){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(r[n]=t[n])}return r},xt.apply(this,arguments)}function Fd(r,e,{checkForDefaultPrevented:t=!0}={}){return function(i){if(r==null||r(i),t===!1||!i.defaultPrevented)return e==null?void 0:e(i)}}function Ka(r){const e=A.useRef(r);return A.useEffect(()=>{e.current=r}),A.useMemo(()=>(...t)=>{var n;return(n=e.current)===null||n===void 0?void 0:n.call(e,...t)},[])}function Ud({prop:r,defaultProp:e,onChange:t=()=>{}}){const[n,i]=zd({defaultProp:e,onChange:t}),s=r!==void 0,o=s?r:n,a=Ka(t),c=A.useCallback(d=>{if(s){const u=typeof d=="function"?d(r):d;u!==r&&a(u)}else i(d)},[s,r,i,a]);return[o,c]}function zd({defaultProp:r,onChange:e}){const t=A.useState(r),[n]=t,i=A.useRef(n),s=Ka(e);return A.useEffect(()=>{i.current!==n&&(s(n),i.current=n)},[n,i,s]),t}function Vd(r,e){typeof r=="function"?r(e):r!=null&&(r.current=e)}function Jd(...r){return e=>r.forEach(t=>Vd(t,e))}const Ya=A.forwardRef((r,e)=>{const{children:t,...n}=r,i=A.Children.toArray(t),s=i.find(Gd);if(s){const o=s.props.children,a=i.map(c=>c===s?A.Children.count(o)>1?A.Children.only(null):A.isValidElement(o)?o.props.children:null:c);return A.createElement(Xi,xt({},n,{ref:e}),A.isValidElement(o)?A.cloneElement(o,void 0,a):null)}return A.createElement(Xi,xt({},n,{ref:e}),t)});Ya.displayName="Slot";const Xi=A.forwardRef((r,e)=>{const{children:t,...n}=r;return A.isValidElement(t)?A.cloneElement(t,{...Hd(n,t.props),ref:e?Jd(e,t.ref):t.ref}):A.Children.count(t)>1?A.Children.only(null):null});Xi.displayName="SlotClone";const qd=({children:r})=>A.createElement(A.Fragment,null,r);function Gd(r){return A.isValidElement(r)&&r.type===qd}function Hd(r,e){const t={...e};for(const n in e){const i=r[n],s=e[n];/^on[A-Z]/.test(n)?i&&s?t[n]=(...a)=>{s(...a),i(...a)}:i&&(t[n]=i):n==="style"?t[n]={...i,...s}:n==="className"&&(t[n]=[i,s].filter(Boolean).join(" "))}return{...r,...t}}const Wd=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","span","svg","ul"],Kd=Wd.reduce((r,e)=>{const t=A.forwardRef((n,i)=>{const{asChild:s,...o}=n,a=s?Ya:e;return A.useEffect(()=>{window[Symbol.for("radix-ui")]=!0},[]),A.createElement(a,xt({},o,{ref:i}))});return t.displayName=`Primitive.${e}`,{...r,[e]:t}},{}),Yd=A.forwardRef((r,e)=>{const{pressed:t,defaultPressed:n=!1,onPressedChange:i,...s}=r,[o=!1,a]=Ud({prop:t,onChange:i,defaultProp:n});return A.createElement(Kd.button,xt({type:"button","aria-pressed":o,"data-state":o?"on":"off","data-disabled":r.disabled?"":void 0},s,{ref:e,onClick:Fd(r.onClick,()=>{r.disabled||a(!o)})}))}),Vn=Yd,Qd=({vc:r,loaderData:e})=>U.jsxs("div",{"data-joined":r.state.joinedLobby,className:"group",children:[U.jsx("div",{className:"absolute inset-0 hidden items-center justify-center group-data-[joined=false]:flex",children:"Loading..."}),U.jsxs("div",{className:"flex gap-4 p-4 group-data-[joined=false]:opacity-25 group-data-[joined=false]:transition-opacity group-data-[joined=false]:duration-200 group-data-[joined=false]:delay-200 group-data-[joined=false]:pointer-events-none",children:[U.jsxs("div",{className:"flex flex-1 flex-col gap-4",children:[U.jsx("div",{children:U.jsx("div",{className:"w-full aspect-video rounded-lg bg-black overflow-hidden",children:U.jsx("video",{className:"h-full w-full object-cover",ref:r.videoRefPreview,autoPlay:!0,muted:!0})})}),U.jsxs("div",{className:"flex gap-4 justify-center",children:[U.jsx(Vn,{"aria-label":"Toggle video",className:`
            data-[state=on]:bg-blue-500 data-[state=on]:text-white text-gray-300 bg-gray-500  text-base shadow-[0_0px_1px_hsla(0,0%,0%,0.2),0_1px_2px_hsla(0,0%,0%,0.2)] leading-normal m-0 px-3 py-2 rounded-lg border-[none] hover:shadow-[0_0px_1px_hsla(0,0%,0%,0.6),0_1px_2px_hsla(0,0%,0%,0.2)] active:shadow-[0_0px_1px_hsla(0,0%,0%,0.4)] active:translate-y-px`,onPressedChange:t=>{t?r.fetchVideoStream():r.stopVideoStream()},children:"Share Video"}),U.jsx(Vn,{"aria-label":"Toggle audio",className:`
            data-[state=on]:bg-blue-500 data-[state=on]:text-white text-gray-300 bg-gray-500  text-base shadow-[0_0px_1px_hsla(0,0%,0%,0.2),0_1px_2px_hsla(0,0%,0%,0.2)] leading-normal m-0 px-3 py-2 rounded-lg border-[none] hover:shadow-[0_0px_1px_hsla(0,0%,0%,0.6),0_1px_2px_hsla(0,0%,0%,0.2)] active:shadow-[0_0px_1px_hsla(0,0%,0%,0.4)] active:translate-y-[1px]`,onPressedChange:t=>{t?r.fetchAudioStream():r.stopAudioStream()},children:"Share Audio"})]})]}),U.jsxs("div",{className:"flex gap-4 flex-col w-[240px]",children:[U.jsxs("div",{className:"flex gap-2 items-center rounded-lg border max-w-full p-2 border-dashed",children:[U.jsx("img",{className:"w-8 h-8 rounded-full",src:e.photoUrl,alt:""}),U.jsx("p",{children:e.name})]}),U.jsx("button",{className:`
          bg-blue-500 text-white text-base shadow-[0_0px_1px_hsla(0,0%,0%,0.2),0_1px_2px_hsla(0,0%,0%,0.2)] leading-normal m-0 px-3 py-2 rounded-lg w-full border-[none] hover:shadow-[0_0px_1px_hsla(0,0%,0%,0.6),0_1px_2px_hsla(0,0%,0%,0.2)] active:shadow-[0_0px_1px_hsla(0,0%,0%,0.4)] active:translate-y-[1px]`,onClick:()=>r.joinRoom(),children:"Join Meeting"})]})]})]}),Xd=({vc:r})=>U.jsx("div",{children:"UploadRecord"});/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */var M=function(){return M=Object.assign||function(e){for(var t,n=1,i=arguments.length;n<i;n++){t=arguments[n];for(var s in t)Object.prototype.hasOwnProperty.call(t,s)&&(e[s]=t[s])}return e},M.apply(this,arguments)};function Ss(r,e){var t={};for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&e.indexOf(n)<0&&(t[n]=r[n]);if(r!=null&&typeof Object.getOwnPropertySymbols=="function")for(var i=0,n=Object.getOwnPropertySymbols(r);i<n.length;i++)e.indexOf(n[i])<0&&Object.prototype.propertyIsEnumerable.call(r,n[i])&&(t[n[i]]=r[n[i]]);return t}function ie(r){var e=typeof Symbol=="function"&&Symbol.iterator,t=e&&r[e],n=0;if(t)return t.call(r);if(r&&typeof r.length=="number")return{next:function(){return r&&n>=r.length&&(r=void 0),{value:r&&r[n++],done:!r}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function de(r,e){var t=typeof Symbol=="function"&&r[Symbol.iterator];if(!t)return r;var n=t.call(r),i,s=[],o;try{for(;(e===void 0||e-- >0)&&!(i=n.next()).done;)s.push(i.value)}catch(a){o={error:a}}finally{try{i&&!i.done&&(t=n.return)&&t.call(n)}finally{if(o)throw o.error}}return s}function _e(r,e,t){if(t||arguments.length===2)for(var n=0,i=e.length,s;n<i;n++)(s||!(n in e))&&(s||(s=Array.prototype.slice.call(e,0,n)),s[n]=e[n]);return r.concat(s||Array.prototype.slice.call(e))}var ge;(function(r){r.Start="xstate.start",r.Stop="xstate.stop",r.Raise="xstate.raise",r.Send="xstate.send",r.Cancel="xstate.cancel",r.NullEvent="",r.Assign="xstate.assign",r.After="xstate.after",r.DoneState="done.state",r.DoneInvoke="done.invoke",r.Log="xstate.log",r.Init="xstate.init",r.Invoke="xstate.invoke",r.ErrorExecution="error.execution",r.ErrorCommunication="error.communication",r.ErrorPlatform="error.platform",r.ErrorCustom="xstate.error",r.Update="xstate.update",r.Pure="xstate.pure",r.Choose="xstate.choose"})(ge||(ge={}));var fr;(function(r){r.Parent="#_parent",r.Internal="#_internal"})(fr||(fr={}));var Zi=ge.Start,Rs=ge.Stop,Hr=ge.Raise,ei=ge.Send,Qa=ge.Cancel,Zd=ge.NullEvent,Cs=ge.Assign;ge.After;ge.DoneState;var Xa=ge.Log,el=ge.Init,es=ge.Invoke;ge.ErrorExecution;var _o=ge.ErrorPlatform,tl=ge.ErrorCustom,Za=ge.Update,rl=ge.Choose,nl=ge.Pure,ec=".",wo={},ts="xstate.guard",il="",un;function Es(r,e,t){t===void 0&&(t=ec);var n=Ur(r,t),i=Ur(e,t);return fe(i)?fe(n)?i===n:!1:fe(n)?n in i:Object.keys(n).every(function(s){return s in i?Es(n[s],i[s]):!1})}function tc(r){try{return fe(r)||typeof r=="number"?"".concat(r):r.type}catch{throw new Error("Events must be strings or objects with a string event.type property.")}}function rs(r,e){try{return vr(r)?r:r.toString().split(e)}catch{throw new Error("'".concat(r,"' is not a valid state path."))}}function sl(r){return typeof r=="object"&&"value"in r&&"context"in r&&"event"in r&&"_event"in r}function Ur(r,e){if(sl(r))return r.value;if(vr(r))return Jn(r);if(typeof r!="string")return r;var t=rs(r,e);return Jn(t)}function Jn(r){if(r.length===1)return r[0];for(var e={},t=e,n=0;n<r.length-1;n++)n===r.length-2?t[r[n]]=r[n+1]:(t[r[n]]={},t=t[r[n]]);return e}function Nr(r,e){for(var t={},n=Object.keys(r),i=0;i<n.length;i++){var s=n[i];t[s]=e(r[s],s,r,i)}return t}function bo(r,e,t){var n,i,s={};try{for(var o=ie(Object.keys(r)),a=o.next();!a.done;a=o.next()){var c=a.value,d=r[c];t(d)&&(s[c]=e(d,c,r))}}catch(l){n={error:l}}finally{try{a&&!a.done&&(i=o.return)&&i.call(o)}finally{if(n)throw n.error}}return s}var ol=function(r){return function(e){var t,n,i=e;try{for(var s=ie(r),o=s.next();!o.done;o=s.next()){var a=o.value;i=i[a]}}catch(c){t={error:c}}finally{try{o&&!o.done&&(n=s.return)&&n.call(s)}finally{if(t)throw t.error}}return i}};function al(r,e){return function(t){var n,i,s=t;try{for(var o=ie(r),a=o.next();!a.done;a=o.next()){var c=a.value;s=s[e][c]}}catch(d){n={error:d}}finally{try{a&&!a.done&&(i=o.return)&&i.call(o)}finally{if(n)throw n.error}}return s}}function Ln(r){if(!r)return[[]];if(fe(r))return[[r]];var e=be(Object.keys(r).map(function(t){var n=r[t];return typeof n!="string"&&(!n||!Object.keys(n).length)?[[t]]:Ln(r[t]).map(function(i){return[t].concat(i)})}));return e}function be(r){var e;return(e=[]).concat.apply(e,_e([],de(r),!1))}function rc(r){return vr(r)?r:[r]}function Ge(r){return r===void 0?[]:rc(r)}function qn(r,e,t){var n,i;if(le(r))return r(e,t.data);var s={};try{for(var o=ie(Object.keys(r)),a=o.next();!a.done;a=o.next()){var c=a.value,d=r[c];le(d)?s[c]=d(e,t.data):s[c]=d}}catch(l){n={error:l}}finally{try{a&&!a.done&&(i=o.return)&&i.call(o)}finally{if(n)throw n.error}}return s}function cl(r){return/^(done|error)\./.test(r)}function So(r){return!!(r instanceof Promise||r!==null&&(le(r)||typeof r=="object")&&le(r.then))}function dl(r){return r!==null&&typeof r=="object"&&"transition"in r&&typeof r.transition=="function"}function ll(r,e){var t,n,i=de([[],[]],2),s=i[0],o=i[1];try{for(var a=ie(r),c=a.next();!c.done;c=a.next()){var d=c.value;e(d)?s.push(d):o.push(d)}}catch(l){t={error:l}}finally{try{c&&!c.done&&(n=a.return)&&n.call(a)}finally{if(t)throw t.error}}return[s,o]}function nc(r,e){return Nr(r.states,function(t,n){if(t){var i=(fe(e)?void 0:e[n])||(t?t.current:void 0);if(i)return{current:i,states:nc(t,i)}}})}function ul(r,e){return{current:e,states:nc(r,e)}}function Ro(r,e,t,n){var i=r&&t.reduce(function(s,o){var a,c,d=o.assignment,l={state:n,action:o,_event:e},u={};if(le(d))u=d(s,e.data,l);else try{for(var p=ie(Object.keys(d)),h=p.next();!h.done;h=p.next()){var f=h.value,m=d[f];u[f]=le(m)?m(s,e.data,l):m}}catch(g){a={error:g}}finally{try{h&&!h.done&&(c=p.return)&&c.call(p)}finally{if(a)throw a.error}}return Object.assign({},s,u)},r);return i}var pl=function(){};function vr(r){return Array.isArray(r)}function le(r){return typeof r=="function"}function fe(r){return typeof r=="string"}function ic(r,e){if(r)return fe(r)?{type:ts,name:r,predicate:e?e[r]:void 0}:le(r)?{type:ts,name:r.name,predicate:r}:r}function fl(r){try{return"subscribe"in r&&le(r.subscribe)}catch{return!1}}var Et=function(){return typeof Symbol=="function"&&Symbol.observable||"@@observable"}();un={},un[Et]=function(){return this},un[Symbol.observable]=function(){return this};function hr(r){return!!r&&"__xstatenode"in r}function hl(r){return!!r&&typeof r.send=="function"}function ti(r,e){return fe(r)||typeof r=="number"?M({type:r},e):r}function $e(r,e){if(!fe(r)&&"$$type"in r&&r.$$type==="scxml")return r;var t=ti(r);return M({name:t.type,data:t,$$type:"scxml",type:"external"},e)}function Ft(r,e){var t=rc(e).map(function(n){return typeof n>"u"||typeof n=="string"||hr(n)?{target:n,event:r}:M(M({},n),{event:r})});return t}function ml(r){if(!(r===void 0||r===il))return Ge(r)}function sc(r,e,t,n,i){var s=r.options.guards,o={state:i,cond:e,_event:n};if(e.type===ts)return((s==null?void 0:s[e.name])||e.predicate)(t,n.data,o);var a=s==null?void 0:s[e.type];if(!a)throw new Error("Guard '".concat(e.type,"' is not implemented on machine '").concat(r.id,"'."));return a(t,n.data,o)}function oc(r){return typeof r=="string"?{type:r}:r}function In(r,e,t){var n=function(){},i=typeof r=="object",s=i?r:null;return{next:((i?r.next:r)||n).bind(s),error:((i?r.error:e)||n).bind(s),complete:((i?r.complete:t)||n).bind(s)}}function pn(r,e){return"".concat(r,":invocation[").concat(e,"]")}function ns(r){return(r.type===Hr||r.type===ei&&r.to===fr.Internal)&&typeof r.delay!="number"}var ur=$e({type:el});function is(r,e){return e&&e[r]||void 0}function Vr(r,e){var t;if(fe(r)||typeof r=="number"){var n=is(r,e);le(n)?t={type:r,exec:n}:n?t=n:t={type:r,exec:void 0}}else if(le(r))t={type:r.name||r.toString(),exec:r};else{var n=is(r.type,e);if(le(n))t=M(M({},r),{exec:n});else if(n){var i=n.type||r.type;t=M(M(M({},n),r),{type:i})}else t=r}return t}var Tt=function(r,e){if(!r)return[];var t=vr(r)?r:[r];return t.map(function(n){return Vr(n,e)})};function Ts(r){var e=Vr(r);return M(M({id:fe(r)?r:e.id},e),{type:e.type})}function ac(r,e){return{type:Hr,event:typeof r=="function"?r:ti(r),delay:e?e.delay:void 0,id:e==null?void 0:e.id}}function gl(r,e,t,n){var i={_event:t},s=$e(le(r.event)?r.event(e,t.data,i):r.event),o;if(fe(r.delay)){var a=n&&n[r.delay];o=le(a)?a(e,t.data,i):a}else o=le(r.delay)?r.delay(e,t.data,i):r.delay;return M(M({},r),{type:Hr,_event:s,delay:o})}function vl(r,e){return{to:e?e.to:void 0,type:ei,event:le(r)?r:ti(r),delay:e?e.delay:void 0,id:e&&e.id!==void 0?e.id:le(r)?r.name:tc(r)}}function yl(r,e,t,n){var i={_event:t},s=$e(le(r.event)?r.event(e,t.data,i):r.event),o;if(fe(r.delay)){var a=n&&n[r.delay];o=le(a)?a(e,t.data,i):a}else o=le(r.delay)?r.delay(e,t.data,i):r.delay;var c=le(r.to)?r.to(e,t.data,i):r.to;return M(M({},r),{to:c,_event:s,event:s.data,delay:o})}var _l=function(r,e,t){return M(M({},r),{value:fe(r.expr)?r.expr:r.expr(e,t.data,{_event:t})})},wl=function(r){return{type:Qa,sendId:r}};function bl(r){var e=Ts(r);return{type:ge.Start,activity:e,exec:void 0}}function Sl(r){var e=le(r)?r:Ts(r);return{type:ge.Stop,activity:e,exec:void 0}}function Rl(r,e,t){var n=le(r.activity)?r.activity(e,t.data):r.activity,i=typeof n=="string"?{id:n}:n,s={type:ge.Stop,activity:i};return s}var Cl=function(r){return{type:Cs,assignment:r}};function El(r,e){var t=e?"#".concat(e):"";return"".concat(ge.After,"(").concat(r,")").concat(t)}function fn(r,e){var t="".concat(ge.DoneState,".").concat(r),n={type:t,data:e};return n.toString=function(){return t},n}function kn(r,e){var t="".concat(ge.DoneInvoke,".").concat(r),n={type:t,data:e};return n.toString=function(){return t},n}function Ar(r,e){var t="".concat(ge.ErrorPlatform,".").concat(r),n={type:t,data:e};return n.toString=function(){return t},n}var Tl=function(r){var e,t,n=[];try{for(var i=ie(r),s=i.next();!s.done;s=i.next())for(var o=s.value,a=0;a<o.actions.length;){if(o.actions[a].type===Cs){n.push(o.actions[a]),o.actions.splice(a,1);continue}a++}}catch(c){e={error:c}}finally{try{s&&!s.done&&(t=i.return)&&t.call(i)}finally{if(e)throw e.error}}return n};function Gn(r,e,t,n,i,s,o){o===void 0&&(o=!1);var a=o?[]:Tl(i),c=a.length?Ro(t,n,a,e):t,d=o?[t]:void 0,l=[];function u(f,m){var g;switch(m.type){case Hr:{var w=gl(m,c,n,r.options.delays);return s&&typeof w.delay=="number"&&s(w,c,n),w}case ei:var C=yl(m,c,n,r.options.delays);return s&&C.to!==fr.Internal&&(f==="entry"?l.push(C):s(C,c,n)),C;case Xa:{var b=_l(m,c,n);return s==null||s(b,c,n),b}case rl:{var P=m,N=(g=P.conds.find(function(R){var I=ic(R.cond,r.options.guards);return!I||sc(r,I,c,n,s?void 0:e)}))===null||g===void 0?void 0:g.actions;if(!N)return[];var $=de(Gn(r,e,c,n,[{type:f,actions:Tt(Ge(N),r.options.actions)}],s,o),2),B=$[0],F=$[1];return c=F,d==null||d.push(c),B}case nl:{var N=m.get(c,n.data);if(!N)return[];var S=de(Gn(r,e,c,n,[{type:f,actions:Tt(Ge(N),r.options.actions)}],s,o),2),k=S[0],D=S[1];return c=D,d==null||d.push(c),k}case Rs:{var b=Rl(m,c,n);return s==null||s(b,t,n),b}case Cs:{c=Ro(c,n,[m],s?void 0:e),d==null||d.push(c);break}default:var v=Vr(m,r.options.actions),y=v.exec;if(s)s(v,c,n);else if(y&&d){var _=d.length-1,E=M(M({},v),{exec:function(R){for(var I=[],O=1;O<arguments.length;O++)I[O-1]=arguments[O];y.apply(void 0,_e([d[_]],de(I),!1))}});v=E}return v}}function p(f){var m,g,w=[];try{for(var C=ie(f.actions),b=C.next();!b.done;b=C.next()){var P=b.value,N=u(f.type,P);N&&(w=w.concat(N))}}catch($){m={error:$}}finally{try{b&&!b.done&&(g=C.return)&&g.call(C)}finally{if(m)throw m.error}}return l.forEach(function($){s($,c,n)}),l.length=0,w}var h=be(i.map(p));return[h,c]}var Co=[],cr=function(r,e){Co.push(r);var t=e(r);return Co.pop(),t};function cc(r){var e;return e={id:r,send:function(){},subscribe:function(){return{unsubscribe:function(){}}},getSnapshot:function(){},toJSON:function(){return{id:r}}},e[Et]=function(){return this},e}function Pl(r,e,t,n){var i,s=oc(r.src),o=(i=e==null?void 0:e.options.services)===null||i===void 0?void 0:i[s.type],a=r.data?qn(r.data,t,n):void 0,c=o?dc(o,r.id,a):cc(r.id);return c.meta=r,c}function dc(r,e,t){var n=cc(e);if(n.deferred=!0,hr(r)){var i=n.state=cr(void 0,function(){return(t?r.withContext(t):r).initialState});n.getSnapshot=function(){return i}}return n}function Dl(r){try{return typeof r.send=="function"}catch{return!1}}function xl(r){return Dl(r)&&"id"in r}function Ol(r){var e;return M((e={subscribe:function(){return{unsubscribe:function(){}}},id:"anonymous",getSnapshot:function(){}},e[Et]=function(){return this},e),r)}var Hn=function(r){return r.type==="atomic"||r.type==="final"};function lc(r){return Object.keys(r.states).map(function(e){return r.states[e]})}function Jr(r){return lc(r).filter(function(e){return e.type!=="history"})}function uc(r){var e=[r];return Hn(r)?e:e.concat(be(Jr(r).map(uc)))}function jr(r,e){var t,n,i,s,o,a,c,d,l=new Set(r),u=ss(l),p=new Set(e);try{for(var h=ie(p),f=h.next();!f.done;f=h.next())for(var m=f.value,g=m.parent;g&&!p.has(g);)p.add(g),g=g.parent}catch(S){t={error:S}}finally{try{f&&!f.done&&(n=h.return)&&n.call(h)}finally{if(t)throw t.error}}var w=ss(p);try{for(var C=ie(p),b=C.next();!b.done;b=C.next()){var m=b.value;if(m.type==="compound"&&(!w.get(m)||!w.get(m).length))u.get(m)?u.get(m).forEach(function(k){return p.add(k)}):m.initialStateNodes.forEach(function(k){return p.add(k)});else if(m.type==="parallel")try{for(var P=(o=void 0,ie(Jr(m))),N=P.next();!N.done;N=P.next()){var $=N.value;p.has($)||(p.add($),u.get($)?u.get($).forEach(function(k){return p.add(k)}):$.initialStateNodes.forEach(function(k){return p.add(k)}))}}catch(k){o={error:k}}finally{try{N&&!N.done&&(a=P.return)&&a.call(P)}finally{if(o)throw o.error}}}}catch(S){i={error:S}}finally{try{b&&!b.done&&(s=C.return)&&s.call(C)}finally{if(i)throw i.error}}try{for(var B=ie(p),F=B.next();!F.done;F=B.next())for(var m=F.value,g=m.parent;g&&!p.has(g);)p.add(g),g=g.parent}catch(S){c={error:S}}finally{try{F&&!F.done&&(d=B.return)&&d.call(B)}finally{if(c)throw c.error}}return p}function pc(r,e){var t=e.get(r);if(!t)return{};if(r.type==="compound"){var n=t[0];if(n){if(Hn(n))return n.key}else return{}}var i={};return t.forEach(function(s){i[s.key]=pc(s,e)}),i}function ss(r){var e,t,n=new Map;try{for(var i=ie(r),s=i.next();!s.done;s=i.next()){var o=s.value;n.has(o)||n.set(o,[]),o.parent&&(n.has(o.parent)||n.set(o.parent,[]),n.get(o.parent).push(o))}}catch(a){e={error:a}}finally{try{s&&!s.done&&(t=i.return)&&t.call(i)}finally{if(e)throw e.error}}return n}function Ll(r,e){var t=jr([r],e);return pc(r,ss(t))}function $r(r,e){return Array.isArray(r)?r.some(function(t){return t===e}):r instanceof Set?r.has(e):!1}function Il(r){return _e([],de(new Set(be(_e([],de(r.map(function(e){return e.ownEvents})),!1)))),!1)}function Mn(r,e){return e.type==="compound"?Jr(e).some(function(t){return t.type==="final"&&$r(r,t)}):e.type==="parallel"?Jr(e).every(function(t){return Mn(r,t)}):!1}function kl(r){return r===void 0&&(r=[]),r.reduce(function(e,t){return t.meta!==void 0&&(e[t.id]=t.meta),e},{})}function Eo(r){return new Set(be(r.map(function(e){return e.tags})))}function fc(r,e){if(r===e)return!0;if(r===void 0||e===void 0)return!1;if(fe(r)||fe(e))return r===e;var t=Object.keys(r),n=Object.keys(e);return t.length===n.length&&t.every(function(i){return fc(r[i],e[i])})}function Ml(r){return typeof r!="object"||r===null?!1:"value"in r&&"_event"in r}function Nl(r,e){var t=r.exec,n=M(M({},r),{exec:t!==void 0?function(){return t(e.context,e.event,{action:r,state:e,_event:e._event})}:void 0});return n}var ot=function(){function r(e){var t=this,n;this.actions=[],this.activities=wo,this.meta={},this.events=[],this.value=e.value,this.context=e.context,this._event=e._event,this._sessionid=e._sessionid,this.event=this._event.data,this.historyValue=e.historyValue,this.history=e.history,this.actions=e.actions||[],this.activities=e.activities||wo,this.meta=kl(e.configuration),this.events=e.events||[],this.matches=this.matches.bind(this),this.toStrings=this.toStrings.bind(this),this.configuration=e.configuration,this.transitions=e.transitions,this.children=e.children,this.done=!!e.done,this.tags=(n=Array.isArray(e.tags)?new Set(e.tags):e.tags)!==null&&n!==void 0?n:new Set,this.machine=e.machine,Object.defineProperty(this,"nextEvents",{get:function(){return Il(t.configuration)}})}return r.from=function(e,t){if(e instanceof r)return e.context!==t?new r({value:e.value,context:t,_event:e._event,_sessionid:null,historyValue:e.historyValue,history:e.history,actions:[],activities:e.activities,meta:{},events:[],configuration:[],transitions:[],children:{}}):e;var n=ur;return new r({value:e,context:t,_event:n,_sessionid:null,historyValue:void 0,history:void 0,actions:[],activities:void 0,meta:void 0,events:[],configuration:[],transitions:[],children:{}})},r.create=function(e){return new r(e)},r.inert=function(e,t){if(e instanceof r){if(!e.actions.length)return e;var n=ur;return new r({value:e.value,context:t,_event:n,_sessionid:null,historyValue:e.historyValue,history:e.history,activities:e.activities,configuration:e.configuration,transitions:[],children:{}})}return r.from(e,t)},r.prototype.toStrings=function(e,t){var n=this;if(e===void 0&&(e=this.value),t===void 0&&(t="."),fe(e))return[e];var i=Object.keys(e);return i.concat.apply(i,_e([],de(i.map(function(s){return n.toStrings(e[s],t).map(function(o){return s+t+o})})),!1))},r.prototype.toJSON=function(){var e=this;e.configuration,e.transitions;var t=e.tags;e.machine;var n=Ss(e,["configuration","transitions","tags","machine"]);return M(M({},n),{tags:Array.from(t)})},r.prototype.matches=function(e){return Es(e,this.value)},r.prototype.hasTag=function(e){return this.tags.has(e)},r.prototype.can=function(e){var t;pl(!!this.machine);var n=(t=this.machine)===null||t===void 0?void 0:t.getTransitionData(this,e);return!!(n!=null&&n.transitions.length)&&n.transitions.some(function(i){return i.target!==void 0||i.actions.length})},r}(),Al={deferEvents:!1},To=function(){function r(e){this.processingEvent=!1,this.queue=[],this.initialized=!1,this.options=M(M({},Al),e)}return r.prototype.initialize=function(e){if(this.initialized=!0,e){if(!this.options.deferEvents){this.schedule(e);return}this.process(e)}this.flushEvents()},r.prototype.schedule=function(e){if(!this.initialized||this.processingEvent){this.queue.push(e);return}if(this.queue.length!==0)throw new Error("Event queue should be empty when it is not processing events");this.process(e),this.flushEvents()},r.prototype.clear=function(){this.queue=[]},r.prototype.flushEvents=function(){for(var e=this.queue.shift();e;)this.process(e),e=this.queue.shift()},r.prototype.process=function(e){this.processingEvent=!0;try{e()}catch(t){throw this.clear(),t}finally{this.processingEvent=!1}},r}(),xi=new Map,jl=0,Tr={bookId:function(){return"x:".concat(jl++)},register:function(r,e){return xi.set(r,e),r},get:function(r){return xi.get(r)},free:function(r){xi.delete(r)}};function Ps(){if(typeof globalThis<"u")return globalThis;if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global}function $l(){var r=Ps();if(r&&"__xstate__"in r)return r.__xstate__}function Bl(r){if(Ps()){var e=$l();e&&e.register(r)}}function Fl(r,e){e===void 0&&(e={});var t=r.initialState,n=new Set,i=[],s=!1,o=function(){if(!s){for(s=!0;i.length>0;){var d=i.shift();t=r.transition(t,d,c),n.forEach(function(l){return l.next(t)})}s=!1}},a=Ol({id:e.id,send:function(d){i.push(d),o()},getSnapshot:function(){return t},subscribe:function(d,l,u){var p=In(d,l,u);return n.add(p),p.next(t),{unsubscribe:function(){n.delete(p)}}}}),c={parent:e.parent,self:a,id:e.id||"anonymous",observers:n};return t=r.start?r.start(c):t,a}var Ul={sync:!1,autoForward:!1},je;(function(r){r[r.NotStarted=0]="NotStarted",r[r.Running=1]="Running",r[r.Stopped=2]="Stopped"})(je||(je={}));var zl=function(){function r(e,t){t===void 0&&(t=r.defaultOptions);var n=this;this.machine=e,this.delayedEventsMap={},this.listeners=new Set,this.contextListeners=new Set,this.stopListeners=new Set,this.doneListeners=new Set,this.eventListeners=new Set,this.sendListeners=new Set,this.initialized=!1,this.status=je.NotStarted,this.children=new Map,this.forwardTo=new Set,this._outgoingQueue=[],this.init=this.start,this.send=function(l,u){if(vr(l))return n.batch(l),n.state;var p=$e(ti(l,u));if(n.status===je.Stopped)return n.state;if(n.status!==je.Running&&!n.options.deferEvents)throw new Error('Event "'.concat(p.name,'" was sent to uninitialized service "').concat(n.machine.id,`". Make sure .start() is called for this service, or set { deferEvents: true } in the service options.
Event: `).concat(JSON.stringify(p.data)));return n.scheduler.schedule(function(){n.forward(p);var h=n._nextState(p);n.update(h,p)}),n._state},this.sendTo=function(l,u,p){var h=n.parent&&(u===fr.Parent||n.parent.id===u),f=h?n.parent:fe(u)?u===fr.Internal?n:n.children.get(u)||Tr.get(u):hl(u)?u:void 0;if(!f){if(!h)throw new Error("Unable to send event to child '".concat(u,"' from service '").concat(n.id,"'."));return}if("machine"in f){if(n.status!==je.Stopped||n.parent!==f||n.state.done){var m=M(M({},l),{name:l.name===tl?"".concat(Ar(n.id)):l.name,origin:n.sessionId});!p&&n.machine.config.predictableActionArguments?n._outgoingQueue.push([f,m]):f.send(m)}}else!p&&n.machine.config.predictableActionArguments?n._outgoingQueue.push([f,l.data]):f.send(l.data)},this._exec=function(l,u,p,h){h===void 0&&(h=n.machine.options.actions);var f=l.exec||is(l.type,h),m=le(f)?f:f?f.exec:l.exec;if(m)try{return m(u,p.data,n.machine.config.predictableActionArguments?{action:l,_event:p}:{action:l,state:n.state,_event:p})}catch(_){throw n.parent&&n.parent.send({type:"xstate.error",data:_}),_}switch(l.type){case Hr:{var g=l;n.defer(g);break}case ei:var w=l;if(typeof w.delay=="number"){n.defer(w);return}else w.to?n.sendTo(w._event,w.to,p===ur):n.send(w._event);break;case Qa:n.cancel(l.sendId);break;case Zi:{if(n.status!==je.Running)return;var C=l.activity;if(!n.machine.config.predictableActionArguments&&!n.state.activities[C.id||C.type])break;if(C.type===ge.Invoke){var b=oc(C.src),P=n.machine.options.services?n.machine.options.services[b.type]:void 0,N=C.id,$=C.data,B="autoForward"in C?C.autoForward:!!C.forward;if(!P)return;var F=$?qn($,u,p):void 0;if(typeof P=="string")return;var S=le(P)?P(u,p.data,{data:F,src:b,meta:C.meta}):P;if(!S)return;var k=void 0;hr(S)&&(S=F?S.withContext(F):S,k={autoForward:B}),n.spawn(S,N,k)}else n.spawnActivity(C);break}case Rs:{n.stopChild(l.activity.id);break}case Xa:var D=l,v=D.label,y=D.value;v?n.logger(v,y):n.logger(y);break}};var i=M(M({},r.defaultOptions),t),s=i.clock,o=i.logger,a=i.parent,c=i.id,d=c!==void 0?c:e.id;this.id=d,this.logger=o,this.clock=s,this.parent=a,this.options=i,this.scheduler=new To({deferEvents:this.options.deferEvents}),this.sessionId=Tr.bookId()}return Object.defineProperty(r.prototype,"initialState",{get:function(){var e=this;return this._initialState?this._initialState:cr(this,function(){return e._initialState=e.machine.initialState,e._initialState})},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"state",{get:function(){return this._state},enumerable:!1,configurable:!0}),r.prototype.execute=function(e,t){var n,i;try{for(var s=ie(e.actions),o=s.next();!o.done;o=s.next()){var a=o.value;this.exec(a,e,t)}}catch(c){n={error:c}}finally{try{o&&!o.done&&(i=s.return)&&i.call(s)}finally{if(n)throw n.error}}},r.prototype.update=function(e,t){var n,i,s,o,a,c,d,l,u=this;if(e._sessionid=this.sessionId,this._state=e,(!this.machine.config.predictableActionArguments||t===ur)&&this.options.execute)this.execute(this.state);else for(var p=void 0;p=this._outgoingQueue.shift();)p[0].send(p[1]);if(this.children.forEach(function(S){u.state.children[S.id]=S}),this.devTools&&this.devTools.send(t.data,e),e.event)try{for(var h=ie(this.eventListeners),f=h.next();!f.done;f=h.next()){var m=f.value;m(e.event)}}catch(S){n={error:S}}finally{try{f&&!f.done&&(i=h.return)&&i.call(h)}finally{if(n)throw n.error}}try{for(var g=ie(this.listeners),w=g.next();!w.done;w=g.next()){var m=w.value;m(e,e.event)}}catch(S){s={error:S}}finally{try{w&&!w.done&&(o=g.return)&&o.call(g)}finally{if(s)throw s.error}}try{for(var C=ie(this.contextListeners),b=C.next();!b.done;b=C.next()){var P=b.value;P(this.state.context,this.state.history?this.state.history.context:void 0)}}catch(S){a={error:S}}finally{try{b&&!b.done&&(c=C.return)&&c.call(C)}finally{if(a)throw a.error}}if(this.state.done){var N=e.configuration.find(function(S){return S.type==="final"&&S.parent===u.machine}),$=N&&N.doneData?qn(N.doneData,e.context,t):void 0;this._doneEvent=kn(this.id,$);try{for(var B=ie(this.doneListeners),F=B.next();!F.done;F=B.next()){var m=F.value;m(this._doneEvent)}}catch(S){d={error:S}}finally{try{F&&!F.done&&(l=B.return)&&l.call(B)}finally{if(d)throw d.error}}this._stop(),this._stopChildren(),Tr.free(this.sessionId)}},r.prototype.onTransition=function(e){return this.listeners.add(e),this.status===je.Running&&e(this.state,this.state.event),this},r.prototype.subscribe=function(e,t,n){var i=this,s=In(e,t,n);this.listeners.add(s.next),this.status!==je.NotStarted&&s.next(this.state);var o=function(){i.doneListeners.delete(o),i.stopListeners.delete(o),s.complete()};return this.status===je.Stopped?s.complete():(this.onDone(o),this.onStop(o)),{unsubscribe:function(){i.listeners.delete(s.next),i.doneListeners.delete(o),i.stopListeners.delete(o)}}},r.prototype.onEvent=function(e){return this.eventListeners.add(e),this},r.prototype.onSend=function(e){return this.sendListeners.add(e),this},r.prototype.onChange=function(e){return this.contextListeners.add(e),this},r.prototype.onStop=function(e){return this.stopListeners.add(e),this},r.prototype.onDone=function(e){return this.status===je.Stopped&&this._doneEvent?e(this._doneEvent):this.doneListeners.add(e),this},r.prototype.off=function(e){return this.listeners.delete(e),this.eventListeners.delete(e),this.sendListeners.delete(e),this.stopListeners.delete(e),this.doneListeners.delete(e),this.contextListeners.delete(e),this},r.prototype.start=function(e){var t=this;if(this.status===je.Running)return this;this.machine._init(),Tr.register(this.sessionId,this),this.initialized=!0,this.status=je.Running;var n=e===void 0?this.initialState:cr(this,function(){return Ml(e)?t.machine.resolveState(e):t.machine.resolveState(ot.from(e,t.machine.context))});return this.options.devTools&&this.attachDev(),this.scheduler.initialize(function(){t.update(n,ur)}),this},r.prototype._stopChildren=function(){this.children.forEach(function(e){le(e.stop)&&e.stop()}),this.children.clear()},r.prototype._stop=function(){var e,t,n,i,s,o,a,c,d,l;try{for(var u=ie(this.listeners),p=u.next();!p.done;p=u.next()){var h=p.value;this.listeners.delete(h)}}catch(B){e={error:B}}finally{try{p&&!p.done&&(t=u.return)&&t.call(u)}finally{if(e)throw e.error}}try{for(var f=ie(this.stopListeners),m=f.next();!m.done;m=f.next()){var h=m.value;h(),this.stopListeners.delete(h)}}catch(B){n={error:B}}finally{try{m&&!m.done&&(i=f.return)&&i.call(f)}finally{if(n)throw n.error}}try{for(var g=ie(this.contextListeners),w=g.next();!w.done;w=g.next()){var h=w.value;this.contextListeners.delete(h)}}catch(B){s={error:B}}finally{try{w&&!w.done&&(o=g.return)&&o.call(g)}finally{if(s)throw s.error}}try{for(var C=ie(this.doneListeners),b=C.next();!b.done;b=C.next()){var h=b.value;this.doneListeners.delete(h)}}catch(B){a={error:B}}finally{try{b&&!b.done&&(c=C.return)&&c.call(C)}finally{if(a)throw a.error}}if(!this.initialized)return this;this.initialized=!1,this.status=je.Stopped,this._initialState=void 0;try{for(var P=ie(Object.keys(this.delayedEventsMap)),N=P.next();!N.done;N=P.next()){var $=N.value;this.clock.clearTimeout(this.delayedEventsMap[$])}}catch(B){d={error:B}}finally{try{N&&!N.done&&(l=P.return)&&l.call(P)}finally{if(d)throw d.error}}this.scheduler.clear(),this.scheduler=new To({deferEvents:this.options.deferEvents})},r.prototype.stop=function(){var e=this,t=this.scheduler;return this._stop(),t.schedule(function(){var n=$e({type:"xstate.stop"}),i=cr(e,function(){var s=be(_e([],de(e.state.configuration),!1).sort(function(l,u){return u.order-l.order}).map(function(l){return Tt(l.onExit,e.machine.options.actions)})),o=de(Gn(e.machine,e.state,e.state.context,n,[{type:"exit",actions:s}],e.machine.config.predictableActionArguments?e._exec:void 0,e.machine.config.predictableActionArguments||e.machine.config.preserveActionOrder),2),a=o[0],c=o[1],d=new ot({value:e.state.value,context:c,_event:n,_sessionid:e.sessionId,historyValue:void 0,history:e.state,actions:a.filter(function(l){return!ns(l)}),activities:{},events:[],configuration:[],transitions:[],children:{},done:e.state.done,tags:e.state.tags,machine:e.machine});return d.changed=!0,d});e.update(i,n),e._stopChildren(),Tr.free(e.sessionId)}),this},r.prototype.batch=function(e){var t=this;if(!(this.status===je.NotStarted&&this.options.deferEvents)){if(this.status!==je.Running)throw new Error("".concat(e.length,' event(s) were sent to uninitialized service "').concat(this.machine.id,'". Make sure .start() is called for this service, or set { deferEvents: true } in the service options.'))}if(e.length){var n=!!this.machine.config.predictableActionArguments&&this._exec;this.scheduler.schedule(function(){var i,s,o=t.state,a=!1,c=[],d=function(h){var f=$e(h);t.forward(f),o=cr(t,function(){return t.machine.transition(o,f,void 0,n||void 0)}),c.push.apply(c,_e([],de(t.machine.config.predictableActionArguments?o.actions:o.actions.map(function(m){return Nl(m,o)})),!1)),a=a||!!o.changed};try{for(var l=ie(e),u=l.next();!u.done;u=l.next()){var p=u.value;d(p)}}catch(h){i={error:h}}finally{try{u&&!u.done&&(s=l.return)&&s.call(l)}finally{if(i)throw i.error}}o.changed=a,o.actions=c,t.update(o,$e(e[e.length-1]))})}},r.prototype.sender=function(e){return this.send.bind(this,e)},r.prototype._nextState=function(e,t){var n=this;t===void 0&&(t=!!this.machine.config.predictableActionArguments&&this._exec);var i=$e(e);if(i.name.indexOf(_o)===0&&!this.state.nextEvents.some(function(o){return o.indexOf(_o)===0}))throw i.data.data;var s=cr(this,function(){return n.machine.transition(n.state,i,void 0,t||void 0)});return s},r.prototype.nextState=function(e){return this._nextState(e,!1)},r.prototype.forward=function(e){var t,n;try{for(var i=ie(this.forwardTo),s=i.next();!s.done;s=i.next()){var o=s.value,a=this.children.get(o);if(!a)throw new Error("Unable to forward event '".concat(e,"' from interpreter '").concat(this.id,"' to nonexistant child '").concat(o,"'."));a.send(e)}}catch(c){t={error:c}}finally{try{s&&!s.done&&(n=i.return)&&n.call(i)}finally{if(t)throw t.error}}},r.prototype.defer=function(e){var t=this,n=this.clock.setTimeout(function(){"to"in e&&e.to?t.sendTo(e._event,e.to,!0):t.send(e._event)},e.delay);e.id&&(this.delayedEventsMap[e.id]=n)},r.prototype.cancel=function(e){this.clock.clearTimeout(this.delayedEventsMap[e]),delete this.delayedEventsMap[e]},r.prototype.exec=function(e,t,n){n===void 0&&(n=this.machine.options.actions),this._exec(e,t.context,t._event,n)},r.prototype.removeChild=function(e){var t;this.children.delete(e),this.forwardTo.delete(e),(t=this.state)===null||t===void 0||delete t.children[e]},r.prototype.stopChild=function(e){var t=this.children.get(e);t&&(this.removeChild(e),le(t.stop)&&t.stop())},r.prototype.spawn=function(e,t,n){if(this.status!==je.Running)return dc(e,t);if(So(e))return this.spawnPromise(Promise.resolve(e),t);if(le(e))return this.spawnCallback(e,t);if(xl(e))return this.spawnActor(e,t);if(fl(e))return this.spawnObservable(e,t);if(hr(e))return this.spawnMachine(e,M(M({},n),{id:t}));if(dl(e))return this.spawnBehavior(e,t);throw new Error('Unable to spawn entity "'.concat(t,'" of type "').concat(typeof e,'".'))},r.prototype.spawnMachine=function(e,t){var n=this;t===void 0&&(t={});var i=new r(e,M(M({},this.options),{parent:this,id:t.id||e.id})),s=M(M({},Ul),t);s.sync&&i.onTransition(function(a){n.send(Za,{state:a,id:i.id})});var o=i;return this.children.set(i.id,o),s.autoForward&&this.forwardTo.add(i.id),i.onDone(function(a){n.removeChild(i.id),n.send($e(a,{origin:i.id}))}).start(),o},r.prototype.spawnBehavior=function(e,t){var n=Fl(e,{id:t,parent:this});return this.children.set(t,n),n},r.prototype.spawnPromise=function(e,t){var n,i=this,s=!1,o;e.then(function(c){s||(o=c,i.removeChild(t),i.send($e(kn(t,c),{origin:t})))},function(c){if(!s){i.removeChild(t);var d=Ar(t,c);try{i.send($e(d,{origin:t}))}catch{i.devTools&&i.devTools.send(d,i.state),i.machine.strict&&i.stop()}}});var a=(n={id:t,send:function(){},subscribe:function(c,d,l){var u=In(c,d,l),p=!1;return e.then(function(h){p||(u.next(h),!p&&u.complete())},function(h){p||u.error(h)}),{unsubscribe:function(){return p=!0}}},stop:function(){s=!0},toJSON:function(){return{id:t}},getSnapshot:function(){return o}},n[Et]=function(){return this},n);return this.children.set(t,a),a},r.prototype.spawnCallback=function(e,t){var n,i=this,s=!1,o=new Set,a=new Set,c,d=function(p){c=p,a.forEach(function(h){return h(p)}),!s&&i.send($e(p,{origin:t}))},l;try{l=e(d,function(p){o.add(p)})}catch(p){this.send(Ar(t,p))}if(So(l))return this.spawnPromise(l,t);var u=(n={id:t,send:function(p){return o.forEach(function(h){return h(p)})},subscribe:function(p){var h=In(p);return a.add(h.next),{unsubscribe:function(){a.delete(h.next)}}},stop:function(){s=!0,le(l)&&l()},toJSON:function(){return{id:t}},getSnapshot:function(){return c}},n[Et]=function(){return this},n);return this.children.set(t,u),u},r.prototype.spawnObservable=function(e,t){var n,i=this,s,o=e.subscribe(function(c){s=c,i.send($e(c,{origin:t}))},function(c){i.removeChild(t),i.send($e(Ar(t,c),{origin:t}))},function(){i.removeChild(t),i.send($e(kn(t),{origin:t}))}),a=(n={id:t,send:function(){},subscribe:function(c,d,l){return e.subscribe(c,d,l)},stop:function(){return o.unsubscribe()},getSnapshot:function(){return s},toJSON:function(){return{id:t}}},n[Et]=function(){return this},n);return this.children.set(t,a),a},r.prototype.spawnActor=function(e,t){return this.children.set(t,e),e},r.prototype.spawnActivity=function(e){var t=this.machine.options&&this.machine.options.activities?this.machine.options.activities[e.type]:void 0;if(t){var n=t(this.state.context,e);this.spawnEffect(e.id,n)}},r.prototype.spawnEffect=function(e,t){var n;this.children.set(e,(n={id:e,send:function(){},subscribe:function(){return{unsubscribe:function(){}}},stop:t||void 0,getSnapshot:function(){},toJSON:function(){return{id:e}}},n[Et]=function(){return this},n))},r.prototype.attachDev=function(){var e=Ps();if(this.options.devTools&&e){if(e.__REDUX_DEVTOOLS_EXTENSION__){var t=typeof this.options.devTools=="object"?this.options.devTools:void 0;this.devTools=e.__REDUX_DEVTOOLS_EXTENSION__.connect(M(M({name:this.id,autoPause:!0,stateSanitizer:function(n){return{value:n.value,context:n.context,actions:n.actions}}},t),{features:M({jump:!1,skip:!1},t?t.features:void 0)}),this.machine),this.devTools.init(this.state)}Bl(this)}},r.prototype.toJSON=function(){return{id:this.id}},r.prototype[Et]=function(){return this},r.prototype.getSnapshot=function(){return this.status===je.NotStarted?this.initialState:this._state},r.defaultOptions={execute:!0,deferEvents:!0,clock:{setTimeout:function(e,t){return setTimeout(e,t)},clearTimeout:function(e){return clearTimeout(e)}},logger:console.log.bind(console),devTools:!1},r.interpret=Ds,r}();function Ds(r,e){var t=new zl(r,e);return t}function Vl(r){if(typeof r=="string"){var e={type:r};return e.toString=function(){return r},e}return r}function hn(r){return M(M({type:es},r),{toJSON:function(){r.onDone,r.onError;var e=Ss(r,["onDone","onError"]);return M(M({},e),{type:es,src:Vl(r.src)})}})}var mn="",os="#",Oi="*",Ut={},zt=function(r){return r[0]===os},Jl=function(){return{actions:{},guards:{},services:{},activities:{},delays:{}}},ql=function(){function r(e,t,n,i){n===void 0&&(n="context"in e?e.context:void 0);var s=this,o;this.config=e,this._context=n,this.order=-1,this.__xstatenode=!0,this.__cache={events:void 0,relativeValue:new Map,initialStateValue:void 0,initialState:void 0,on:void 0,transitions:void 0,candidates:{},delayedTransitions:void 0},this.idMap={},this.tags=[],this.options=Object.assign(Jl(),t),this.parent=i==null?void 0:i.parent,this.key=this.config.key||(i==null?void 0:i.key)||this.config.id||"(machine)",this.machine=this.parent?this.parent.machine:this,this.path=this.parent?this.parent.path.concat(this.key):[],this.delimiter=this.config.delimiter||(this.parent?this.parent.delimiter:ec),this.id=this.config.id||_e([this.machine.key],de(this.path),!1).join(this.delimiter),this.version=this.parent?this.parent.version:this.config.version,this.type=this.config.type||(this.config.parallel?"parallel":this.config.states&&Object.keys(this.config.states).length?"compound":this.config.history?"history":"atomic"),this.schema=this.parent?this.machine.schema:(o=this.config.schema)!==null&&o!==void 0?o:{},this.description=this.config.description,this.initial=this.config.initial,this.states=this.config.states?Nr(this.config.states,function(d,l){var u,p=new r(d,{},void 0,{parent:s,key:l});return Object.assign(s.idMap,M((u={},u[p.id]=p,u),p.idMap)),p}):Ut;var a=0;function c(d){var l,u;d.order=a++;try{for(var p=ie(lc(d)),h=p.next();!h.done;h=p.next()){var f=h.value;c(f)}}catch(m){l={error:m}}finally{try{h&&!h.done&&(u=p.return)&&u.call(p)}finally{if(l)throw l.error}}}c(this),this.history=this.config.history===!0?"shallow":this.config.history||!1,this._transient=!!this.config.always||(this.config.on?Array.isArray(this.config.on)?this.config.on.some(function(d){var l=d.event;return l===mn}):mn in this.config.on:!1),this.strict=!!this.config.strict,this.onEntry=Ge(this.config.entry||this.config.onEntry).map(function(d){return Vr(d)}),this.onExit=Ge(this.config.exit||this.config.onExit).map(function(d){return Vr(d)}),this.meta=this.config.meta,this.doneData=this.type==="final"?this.config.data:void 0,this.invoke=Ge(this.config.invoke).map(function(d,l){var u,p;if(hr(d)){var h=pn(s.id,l);return s.machine.options.services=M((u={},u[h]=d,u),s.machine.options.services),hn({src:h,id:h})}else if(fe(d.src)){var h=d.id||pn(s.id,l);return hn(M(M({},d),{id:h,src:d.src}))}else if(hr(d.src)||le(d.src)){var h=d.id||pn(s.id,l);return s.machine.options.services=M((p={},p[h]=d.src,p),s.machine.options.services),hn(M(M({id:h},d),{src:h}))}else{var f=d.src;return hn(M(M({id:pn(s.id,l)},d),{src:f}))}}),this.activities=Ge(this.config.activities).concat(this.invoke).map(function(d){return Ts(d)}),this.transition=this.transition.bind(this),this.tags=Ge(this.config.tags)}return r.prototype._init=function(){this.__cache.transitions||uc(this).forEach(function(e){return e.on})},r.prototype.withConfig=function(e,t){var n=this.options,i=n.actions,s=n.activities,o=n.guards,a=n.services,c=n.delays;return new r(this.config,{actions:M(M({},i),e.actions),activities:M(M({},s),e.activities),guards:M(M({},o),e.guards),services:M(M({},a),e.services),delays:M(M({},c),e.delays)},t??this.context)},r.prototype.withContext=function(e){return new r(this.config,this.options,e)},Object.defineProperty(r.prototype,"context",{get:function(){return le(this._context)?this._context():this._context},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"definition",{get:function(){return{id:this.id,key:this.key,version:this.version,context:this.context,type:this.type,initial:this.initial,history:this.history,states:Nr(this.states,function(e){return e.definition}),on:this.on,transitions:this.transitions,entry:this.onEntry,exit:this.onExit,activities:this.activities||[],meta:this.meta,order:this.order||-1,data:this.doneData,invoke:this.invoke,description:this.description,tags:this.tags}},enumerable:!1,configurable:!0}),r.prototype.toJSON=function(){return this.definition},Object.defineProperty(r.prototype,"on",{get:function(){if(this.__cache.on)return this.__cache.on;var e=this.transitions;return this.__cache.on=e.reduce(function(t,n){return t[n.eventType]=t[n.eventType]||[],t[n.eventType].push(n),t},{})},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"after",{get:function(){return this.__cache.delayedTransitions||(this.__cache.delayedTransitions=this.getDelayedTransitions(),this.__cache.delayedTransitions)},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"transitions",{get:function(){return this.__cache.transitions||(this.__cache.transitions=this.formatTransitions(),this.__cache.transitions)},enumerable:!1,configurable:!0}),r.prototype.getCandidates=function(e){if(this.__cache.candidates[e])return this.__cache.candidates[e];var t=e===mn,n=this.transitions.filter(function(i){var s=i.eventType===e;return t?s:s||i.eventType===Oi});return this.__cache.candidates[e]=n,n},r.prototype.getDelayedTransitions=function(){var e=this,t=this.config.after;if(!t)return[];var n=function(s,o){var a=le(s)?"".concat(e.id,":delay[").concat(o,"]"):s,c=El(a,e.id);return e.onEntry.push(vl(c,{delay:s})),e.onExit.push(wl(c)),c},i=vr(t)?t.map(function(s,o){var a=n(s.delay,o);return M(M({},s),{event:a})}):be(Object.keys(t).map(function(s,o){var a=t[s],c=fe(a)?{target:a}:a,d=isNaN(+s)?s:+s,l=n(d,o);return Ge(c).map(function(u){return M(M({},u),{event:l,delay:d})})}));return i.map(function(s){var o=s.delay;return M(M({},e.formatTransition(s)),{delay:o})})},r.prototype.getStateNodes=function(e){var t,n=this;if(!e)return[];var i=e instanceof ot?e.value:Ur(e,this.delimiter);if(fe(i)){var s=this.getStateNode(i).initial;return s!==void 0?this.getStateNodes((t={},t[i]=s,t)):[this,this.states[i]]}var o=Object.keys(i),a=[this];return a.push.apply(a,_e([],de(be(o.map(function(c){return n.getStateNode(c).getStateNodes(i[c])}))),!1)),a},r.prototype.handles=function(e){var t=tc(e);return this.events.includes(t)},r.prototype.resolveState=function(e){var t=e instanceof ot?e:ot.create(e),n=Array.from(jr([],this.getStateNodes(t.value)));return new ot(M(M({},t),{value:this.resolve(t.value),configuration:n,done:Mn(n,this),tags:Eo(n),machine:this.machine}))},r.prototype.transitionLeafNode=function(e,t,n){var i=this.getStateNode(e),s=i.next(t,n);return!s||!s.transitions.length?this.next(t,n):s},r.prototype.transitionCompoundNode=function(e,t,n){var i=Object.keys(e),s=this.getStateNode(i[0]),o=s._transition(e[i[0]],t,n);return!o||!o.transitions.length?this.next(t,n):o},r.prototype.transitionParallelNode=function(e,t,n){var i,s,o={};try{for(var a=ie(Object.keys(e)),c=a.next();!c.done;c=a.next()){var d=c.value,l=e[d];if(l){var u=this.getStateNode(d),p=u._transition(l,t,n);p&&(o[d]=p)}}}catch(w){i={error:w}}finally{try{c&&!c.done&&(s=a.return)&&s.call(a)}finally{if(i)throw i.error}}var h=Object.keys(o).map(function(w){return o[w]}),f=be(h.map(function(w){return w.transitions})),m=h.some(function(w){return w.transitions.length>0});if(!m)return this.next(t,n);var g=be(Object.keys(o).map(function(w){return o[w].configuration}));return{transitions:f,exitSet:be(h.map(function(w){return w.exitSet})),configuration:g,source:t,actions:be(Object.keys(o).map(function(w){return o[w].actions}))}},r.prototype._transition=function(e,t,n){return fe(e)?this.transitionLeafNode(e,t,n):Object.keys(e).length===1?this.transitionCompoundNode(e,t,n):this.transitionParallelNode(e,t,n)},r.prototype.getTransitionData=function(e,t){return this._transition(e.value,e,$e(t))},r.prototype.next=function(e,t){var n,i,s=this,o=t.name,a=[],c=[],d;try{for(var l=ie(this.getCandidates(o)),u=l.next();!u.done;u=l.next()){var p=u.value,h=p.cond,f=p.in,m=e.context,g=f?fe(f)&&zt(f)?e.matches(Ur(this.getStateNodeById(f).path,this.delimiter)):Es(Ur(f,this.delimiter),ol(this.path.slice(0,-2))(e.value)):!0,w=!1;try{w=!h||sc(this.machine,h,m,t,e)}catch(P){throw new Error("Unable to evaluate guard '".concat(h.name||h.type,"' in transition for event '").concat(o,"' in state node '").concat(this.id,`':
`).concat(P.message))}if(w&&g){p.target!==void 0&&(c=p.target),a.push.apply(a,_e([],de(p.actions),!1)),d=p;break}}}catch(P){n={error:P}}finally{try{u&&!u.done&&(i=l.return)&&i.call(l)}finally{if(n)throw n.error}}if(d){if(!c.length)return{transitions:[d],exitSet:[],configuration:e.value?[this]:[],source:e,actions:a};var C=be(c.map(function(P){return s.getRelativeStateNodes(P,e.historyValue)})),b=!!d.internal;return{transitions:[d],exitSet:b?[]:be(c.map(function(P){return s.getPotentiallyReenteringNodes(P)})),configuration:C,source:e,actions:a}}},r.prototype.getPotentiallyReenteringNodes=function(e){if(this.order<e.order)return[this];for(var t=[],n=this,i=e;n&&n!==i;)t.push(n),n=n.parent;return n!==i?[]:(t.push(i),t)},r.prototype.getActions=function(e,t,n,i,s,o,a){var c,d,l,u,p=this,h=o?jr([],this.getStateNodes(o.value)):[],f=new Set;try{for(var m=ie(Array.from(e).sort(function(D,v){return D.order-v.order})),g=m.next();!g.done;g=m.next()){var w=g.value;(!$r(h,w)||$r(n.exitSet,w)||w.parent&&f.has(w.parent))&&f.add(w)}}catch(D){c={error:D}}finally{try{g&&!g.done&&(d=m.return)&&d.call(m)}finally{if(c)throw c.error}}try{for(var C=ie(h),b=C.next();!b.done;b=C.next()){var w=b.value;(!$r(e,w)||$r(n.exitSet,w.parent))&&n.exitSet.push(w)}}catch(D){l={error:D}}finally{try{b&&!b.done&&(u=C.return)&&u.call(C)}finally{if(l)throw l.error}}n.exitSet.sort(function(D,v){return v.order-D.order});var P=Array.from(f).sort(function(D,v){return D.order-v.order}),N=new Set(n.exitSet),$=be(P.map(function(D){var v=[];if(D.type!=="final")return v;var y=D.parent;if(!y.parent)return v;v.push(fn(D.id,D.doneData),fn(y.id,D.doneData?qn(D.doneData,i,s):void 0));var _=y.parent;return _.type==="parallel"&&Jr(_).every(function(E){return Mn(n.configuration,E)})&&v.push(fn(_.id)),v})),B=P.map(function(D){var v=D.onEntry,y=D.activities.map(function(_){return bl(_)});return{type:"entry",actions:Tt(a?_e(_e([],de(v),!1),de(y),!1):_e(_e([],de(y),!1),de(v),!1),p.machine.options.actions)}}).concat({type:"state_done",actions:$.map(function(D){return ac(D)})}),F=Array.from(N).map(function(D){return{type:"exit",actions:Tt(_e(_e([],de(D.onExit),!1),de(D.activities.map(function(v){return Sl(v)})),!1),p.machine.options.actions)}}),S=F.concat({type:"transition",actions:Tt(n.actions,this.machine.options.actions)}).concat(B);if(t){var k=Tt(be(_e([],de(e),!1).sort(function(D,v){return v.order-D.order}).map(function(D){return D.onExit})),this.machine.options.actions).filter(function(D){return!ns(D)});return S.concat({type:"stop",actions:k})}return S},r.prototype.transition=function(e,t,n,i){e===void 0&&(e=this.initialState);var s=$e(t),o;if(e instanceof ot)o=n===void 0?e:this.resolveState(ot.from(e,n));else{var a=fe(e)?this.resolve(Jn(this.getResolvedPath(e))):this.resolve(e),c=n??this.machine.context;o=this.resolveState(ot.from(a,c))}if(this.strict&&!this.events.includes(s.name)&&!cl(s.name))throw new Error("Machine '".concat(this.id,"' does not accept event '").concat(s.name,"'"));var d=this._transition(o.value,o,s)||{transitions:[],configuration:[],exitSet:[],source:o,actions:[]},l=jr([],this.getStateNodes(o.value)),u=d.configuration.length?jr(l,d.configuration):l;return d.configuration=_e([],de(u),!1),this.resolveTransition(d,o,o.context,i,s)},r.prototype.resolveRaisedTransition=function(e,t,n,i){var s,o=e.actions;return e=this.transition(e,t,void 0,i),e._event=n,e.event=n.data,(s=e.actions).unshift.apply(s,_e([],de(o),!1)),e},r.prototype.resolveTransition=function(e,t,n,i,s){var o,a,c,d,l=this;s===void 0&&(s=ur);var u=e.configuration,p=!t||e.transitions.length>0,h=p?e.configuration:t?t.configuration:[],f=Mn(h,this),m=p?Ll(this.machine,u):void 0,g=t?t.historyValue?t.historyValue:e.source?this.machine.historyValue(t.value):void 0:void 0,w=this.getActions(new Set(h),f,e,n,s,t,i),C=t?M({},t.activities):{};try{for(var b=ie(w),P=b.next();!P.done;P=b.next()){var N=P.value;try{for(var $=(c=void 0,ie(N.actions)),B=$.next();!B.done;B=$.next()){var F=B.value;F.type===Zi?C[F.activity.id||F.activity.type]=F:F.type===Rs&&(C[F.activity.id||F.activity.type]=!1)}}catch(De){c={error:De}}finally{try{B&&!B.done&&(d=$.return)&&d.call($)}finally{if(c)throw c.error}}}}catch(De){o={error:De}}finally{try{P&&!P.done&&(a=b.return)&&a.call(b)}finally{if(o)throw o.error}}var S=de(Gn(this,t,n,s,w,i,this.machine.config.predictableActionArguments||this.machine.config.preserveActionOrder),2),k=S[0],D=S[1],v=de(ll(k,ns),2),y=v[0],_=v[1],E=k.filter(function(De){var Fe;return De.type===Zi&&((Fe=De.activity)===null||Fe===void 0?void 0:Fe.type)===es}),R=E.reduce(function(De,Fe){return De[Fe.activity.id]=Pl(Fe.activity,l.machine,D,s),De},t?M({},t.children):{}),I=new ot({value:m||t.value,context:D,_event:s,_sessionid:t?t._sessionid:null,historyValue:m?g?ul(g,m):void 0:t?t.historyValue:void 0,history:!m||e.source?t:void 0,actions:m?_:[],activities:m?C:t?t.activities:{},events:[],configuration:h,transitions:e.transitions,children:R,done:f,tags:Eo(h),machine:this}),O=n!==D;I.changed=s.name===Za||O;var x=I.history;x&&delete x.history;var j=!f&&(this._transient||u.some(function(De){return De._transient}));if(!p&&(!j||s.name===mn))return I;var K=I;if(!f)for(j&&(K=this.resolveRaisedTransition(K,{type:Zd},s,i));y.length;){var Se=y.shift();K=this.resolveRaisedTransition(K,Se._event,s,i)}var me=K.changed||(x?!!K.actions.length||O||typeof x.value!=typeof K.value||!fc(K.value,x.value):void 0);return K.changed=me,K.history=x,K},r.prototype.getStateNode=function(e){if(zt(e))return this.machine.getStateNodeById(e);if(!this.states)throw new Error("Unable to retrieve child state '".concat(e,"' from '").concat(this.id,"'; no child states exist."));var t=this.states[e];if(!t)throw new Error("Child state '".concat(e,"' does not exist on '").concat(this.id,"'"));return t},r.prototype.getStateNodeById=function(e){var t=zt(e)?e.slice(os.length):e;if(t===this.id)return this;var n=this.machine.idMap[t];if(!n)throw new Error("Child state node '#".concat(t,"' does not exist on machine '").concat(this.id,"'"));return n},r.prototype.getStateNodeByPath=function(e){if(typeof e=="string"&&zt(e))try{return this.getStateNodeById(e.slice(1))}catch{}for(var t=rs(e,this.delimiter).slice(),n=this;t.length;){var i=t.shift();if(!i.length)break;n=n.getStateNode(i)}return n},r.prototype.resolve=function(e){var t,n=this;if(!e)return this.initialStateValue||Ut;switch(this.type){case"parallel":return Nr(this.initialStateValue,function(s,o){return s?n.getStateNode(o).resolve(e[o]||s):Ut});case"compound":if(fe(e)){var i=this.getStateNode(e);return i.type==="parallel"||i.type==="compound"?(t={},t[e]=i.initialStateValue,t):e}return Object.keys(e).length?Nr(e,function(s,o){return s?n.getStateNode(o).resolve(s):Ut}):this.initialStateValue||{};default:return e||Ut}},r.prototype.getResolvedPath=function(e){if(zt(e)){var t=this.machine.idMap[e.slice(os.length)];if(!t)throw new Error("Unable to find state node '".concat(e,"'"));return t.path}return rs(e,this.delimiter)},Object.defineProperty(r.prototype,"initialStateValue",{get:function(){var e;if(this.__cache.initialStateValue)return this.__cache.initialStateValue;var t;if(this.type==="parallel")t=bo(this.states,function(n){return n.initialStateValue||Ut},function(n){return n.type!=="history"});else if(this.initial!==void 0){if(!this.states[this.initial])throw new Error("Initial state '".concat(this.initial,"' not found on '").concat(this.key,"'"));t=Hn(this.states[this.initial])?this.initial:(e={},e[this.initial]=this.states[this.initial].initialStateValue,e)}else t={};return this.__cache.initialStateValue=t,this.__cache.initialStateValue},enumerable:!1,configurable:!0}),r.prototype.getInitialState=function(e,t){this._init();var n=this.getStateNodes(e);return this.resolveTransition({configuration:n,exitSet:[],transitions:[],source:void 0,actions:[]},void 0,t??this.machine.context,void 0)},Object.defineProperty(r.prototype,"initialState",{get:function(){var e=this.initialStateValue;if(!e)throw new Error("Cannot retrieve initial state from simple state '".concat(this.id,"'."));return this.getInitialState(e)},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"target",{get:function(){var e;if(this.type==="history"){var t=this.config;fe(t.target)?e=zt(t.target)?Jn(this.machine.getStateNodeById(t.target).path.slice(this.path.length-1)):t.target:e=t.target}return e},enumerable:!1,configurable:!0}),r.prototype.getRelativeStateNodes=function(e,t,n){return n===void 0&&(n=!0),n?e.type==="history"?e.resolveHistory(t):e.initialStateNodes:[e]},Object.defineProperty(r.prototype,"initialStateNodes",{get:function(){var e=this;if(Hn(this))return[this];if(this.type==="compound"&&!this.initial)return[this];var t=Ln(this.initialStateValue);return be(t.map(function(n){return e.getFromRelativePath(n)}))},enumerable:!1,configurable:!0}),r.prototype.getFromRelativePath=function(e){if(!e.length)return[this];var t=de(e),n=t[0],i=t.slice(1);if(!this.states)throw new Error("Cannot retrieve subPath '".concat(n,"' from node with no states"));var s=this.getStateNode(n);if(s.type==="history")return s.resolveHistory();if(!this.states[n])throw new Error("Child state '".concat(n,"' does not exist on '").concat(this.id,"'"));return this.states[n].getFromRelativePath(i)},r.prototype.historyValue=function(e){if(Object.keys(this.states).length)return{current:e||this.initialStateValue,states:bo(this.states,function(t,n){if(!e)return t.historyValue();var i=fe(e)?void 0:e[n];return t.historyValue(i||t.initialStateValue)},function(t){return!t.history})}},r.prototype.resolveHistory=function(e){var t=this;if(this.type!=="history")return[this];var n=this.parent;if(!e){var i=this.target;return i?be(Ln(i).map(function(o){return n.getFromRelativePath(o)})):n.initialStateNodes}var s=al(n.path,"states")(e).current;return fe(s)?[n.getStateNode(s)]:be(Ln(s).map(function(o){return t.history==="deep"?n.getFromRelativePath(o):[n.states[o[0]]]}))},Object.defineProperty(r.prototype,"stateIds",{get:function(){var e=this,t=be(Object.keys(this.states).map(function(n){return e.states[n].stateIds}));return[this.id].concat(t)},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"events",{get:function(){var e,t,n,i;if(this.__cache.events)return this.__cache.events;var s=this.states,o=new Set(this.ownEvents);if(s)try{for(var a=ie(Object.keys(s)),c=a.next();!c.done;c=a.next()){var d=c.value,l=s[d];if(l.states)try{for(var u=(n=void 0,ie(l.events)),p=u.next();!p.done;p=u.next()){var h=p.value;o.add("".concat(h))}}catch(f){n={error:f}}finally{try{p&&!p.done&&(i=u.return)&&i.call(u)}finally{if(n)throw n.error}}}}catch(f){e={error:f}}finally{try{c&&!c.done&&(t=a.return)&&t.call(a)}finally{if(e)throw e.error}}return this.__cache.events=Array.from(o)},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"ownEvents",{get:function(){var e=new Set(this.transitions.filter(function(t){return!(!t.target&&!t.actions.length&&t.internal)}).map(function(t){return t.eventType}));return Array.from(e)},enumerable:!1,configurable:!0}),r.prototype.resolveTarget=function(e){var t=this;if(e!==void 0)return e.map(function(n){if(!fe(n))return n;var i=n[0]===t.delimiter;if(i&&!t.parent)return t.getStateNodeByPath(n.slice(1));var s=i?t.key+n:n;if(t.parent)try{var o=t.parent.getStateNodeByPath(s);return o}catch(a){throw new Error("Invalid transition definition for state node '".concat(t.id,`':
`).concat(a.message))}else return t.getStateNodeByPath(s)})},r.prototype.formatTransition=function(e){var t=this,n=ml(e.target),i="internal"in e?e.internal:n?n.some(function(c){return fe(c)&&c[0]===t.delimiter}):!0,s=this.machine.options.guards,o=this.resolveTarget(n),a=M(M({},e),{actions:Tt(Ge(e.actions)),cond:ic(e.cond,s),target:o,source:this,internal:i,eventType:e.event,toJSON:function(){return M(M({},a),{target:a.target?a.target.map(function(c){return"#".concat(c.id)}):void 0,source:"#".concat(t.id)})}});return a},r.prototype.formatTransitions=function(){var e,t,n=this,i;if(!this.config.on)i=[];else if(Array.isArray(this.config.on))i=this.config.on;else{var s=this.config.on,o=Oi,a=s[o],c=a===void 0?[]:a,d=Ss(s,[typeof o=="symbol"?o:o+""]);i=be(Object.keys(d).map(function(C){var b=Ft(C,d[C]);return b}).concat(Ft(Oi,c)))}var l=this.config.always?Ft("",this.config.always):[],u=this.config.onDone?Ft(String(fn(this.id)),this.config.onDone):[],p=be(this.invoke.map(function(C){var b=[];return C.onDone&&b.push.apply(b,_e([],de(Ft(String(kn(C.id)),C.onDone)),!1)),C.onError&&b.push.apply(b,_e([],de(Ft(String(Ar(C.id)),C.onError)),!1)),b})),h=this.after,f=be(_e(_e(_e(_e([],de(u),!1),de(p),!1),de(i),!1),de(l),!1).map(function(C){return Ge(C).map(function(b){return n.formatTransition(b)})}));try{for(var m=ie(h),g=m.next();!g.done;g=m.next()){var w=g.value;f.push(w)}}catch(C){e={error:C}}finally{try{g&&!g.done&&(t=m.return)&&t.call(m)}finally{if(e)throw e.error}}return f},r}();function Gl(r,e){return new ql(r,e)}var Re=Cl,Po=ac,hc={},as={exports:{}},Li,Do;function Hl(){if(Do)return Li;Do=1;var r=1e3,e=r*60,t=e*60,n=t*24,i=n*7,s=n*365.25;Li=function(l,u){u=u||{};var p=typeof l;if(p==="string"&&l.length>0)return o(l);if(p==="number"&&isFinite(l))return u.long?c(l):a(l);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(l))};function o(l){if(l=String(l),!(l.length>100)){var u=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(l);if(u){var p=parseFloat(u[1]),h=(u[2]||"ms").toLowerCase();switch(h){case"years":case"year":case"yrs":case"yr":case"y":return p*s;case"weeks":case"week":case"w":return p*i;case"days":case"day":case"d":return p*n;case"hours":case"hour":case"hrs":case"hr":case"h":return p*t;case"minutes":case"minute":case"mins":case"min":case"m":return p*e;case"seconds":case"second":case"secs":case"sec":case"s":return p*r;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return p;default:return}}}}function a(l){var u=Math.abs(l);return u>=n?Math.round(l/n)+"d":u>=t?Math.round(l/t)+"h":u>=e?Math.round(l/e)+"m":u>=r?Math.round(l/r)+"s":l+"ms"}function c(l){var u=Math.abs(l);return u>=n?d(l,u,n,"day"):u>=t?d(l,u,t,"hour"):u>=e?d(l,u,e,"minute"):u>=r?d(l,u,r,"second"):l+" ms"}function d(l,u,p,h){var f=u>=p*1.5;return Math.round(l/p)+" "+h+(f?"s":"")}return Li}function Wl(r){t.debug=t,t.default=t,t.coerce=c,t.disable=s,t.enable=i,t.enabled=o,t.humanize=Hl(),t.destroy=d,Object.keys(r).forEach(l=>{t[l]=r[l]}),t.names=[],t.skips=[],t.formatters={};function e(l){let u=0;for(let p=0;p<l.length;p++)u=(u<<5)-u+l.charCodeAt(p),u|=0;return t.colors[Math.abs(u)%t.colors.length]}t.selectColor=e;function t(l){let u,p=null,h,f;function m(...g){if(!m.enabled)return;const w=m,C=Number(new Date),b=C-(u||C);w.diff=b,w.prev=u,w.curr=C,u=C,g[0]=t.coerce(g[0]),typeof g[0]!="string"&&g.unshift("%O");let P=0;g[0]=g[0].replace(/%([a-zA-Z%])/g,($,B)=>{if($==="%%")return"%";P++;const F=t.formatters[B];if(typeof F=="function"){const S=g[P];$=F.call(w,S),g.splice(P,1),P--}return $}),t.formatArgs.call(w,g),(w.log||t.log).apply(w,g)}return m.namespace=l,m.useColors=t.useColors(),m.color=t.selectColor(l),m.extend=n,m.destroy=t.destroy,Object.defineProperty(m,"enabled",{enumerable:!0,configurable:!1,get:()=>p!==null?p:(h!==t.namespaces&&(h=t.namespaces,f=t.enabled(l)),f),set:g=>{p=g}}),typeof t.init=="function"&&t.init(m),m}function n(l,u){const p=t(this.namespace+(typeof u>"u"?":":u)+l);return p.log=this.log,p}function i(l){t.save(l),t.namespaces=l,t.names=[],t.skips=[];let u;const p=(typeof l=="string"?l:"").split(/[\s,]+/),h=p.length;for(u=0;u<h;u++)p[u]&&(l=p[u].replace(/\*/g,".*?"),l[0]==="-"?t.skips.push(new RegExp("^"+l.slice(1)+"$")):t.names.push(new RegExp("^"+l+"$")))}function s(){const l=[...t.names.map(a),...t.skips.map(a).map(u=>"-"+u)].join(",");return t.enable(""),l}function o(l){if(l[l.length-1]==="*")return!0;let u,p;for(u=0,p=t.skips.length;u<p;u++)if(t.skips[u].test(l))return!1;for(u=0,p=t.names.length;u<p;u++)if(t.names[u].test(l))return!0;return!1}function a(l){return l.toString().substring(2,l.toString().length-2).replace(/\.\*\?$/,"*")}function c(l){return l instanceof Error?l.stack||l.message:l}function d(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")}return t.enable(t.load()),t}var Kl=Wl;(function(r,e){e.formatArgs=n,e.save=i,e.load=s,e.useColors=t,e.storage=o(),e.destroy=(()=>{let c=!1;return()=>{c||(c=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}})(),e.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"];function t(){return typeof window<"u"&&window.process&&(window.process.type==="renderer"||window.process.__nwjs)?!0:typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/)?!1:typeof document<"u"&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||typeof window<"u"&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)}function n(c){if(c[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+c[0]+(this.useColors?"%c ":" ")+"+"+r.exports.humanize(this.diff),!this.useColors)return;const d="color: "+this.color;c.splice(1,0,d,"color: inherit");let l=0,u=0;c[0].replace(/%[a-zA-Z%]/g,p=>{p!=="%%"&&(l++,p==="%c"&&(u=l))}),c.splice(u,0,d)}e.log=console.debug||console.log||(()=>{});function i(c){try{c?e.storage.setItem("debug",c):e.storage.removeItem("debug")}catch{}}function s(){let c;try{c=e.storage.getItem("debug")}catch{}return!c&&typeof process<"u"&&"env"in process&&(c={}.DEBUG),c}function o(){try{return localStorage}catch{}}r.exports=Kl(e);const{formatters:a}=r.exports;a.j=function(c){try{return JSON.stringify(c)}catch(d){return"[UnexpectedJSONParseError]: "+d.message}}})(as,as.exports);var ri=as.exports,Mt={},cs={exports:{}};(function(r,e){(function(t,n){var i="1.0.35",s="",o="?",a="function",c="undefined",d="object",l="string",u="major",p="model",h="name",f="type",m="vendor",g="version",w="architecture",C="console",b="mobile",P="tablet",N="smarttv",$="wearable",B="embedded",F=350,S="Amazon",k="Apple",D="ASUS",v="BlackBerry",y="Browser",_="Chrome",E="Edge",R="Firefox",I="Google",O="Huawei",x="LG",j="Microsoft",K="Motorola",Se="Opera",me="Samsung",De="Sharp",Fe="Sony",$t="Xiaomi",Ei="Zebra",po="Facebook",fo="Chromium OS",ho="Mac OS",Nd=function(te,he){var Y={};for(var ye in te)he[ye]&&he[ye].length%2===0?Y[ye]=he[ye].concat(te[ye]):Y[ye]=te[ye];return Y},cn=function(te){for(var he={},Y=0;Y<te.length;Y++)he[te[Y].toUpperCase()]=te[Y];return he},mo=function(te,he){return typeof te===l?Cr(he).indexOf(Cr(te))!==-1:!1},Cr=function(te){return te.toLowerCase()},Ad=function(te){return typeof te===l?te.replace(/[^\d\.]/g,s).split(".")[0]:n},Ti=function(te,he){if(typeof te===l)return te=te.replace(/^\s\s*/,s),typeof he===c?te:te.substring(0,F)},Er=function(te,he){for(var Y=0,ye,yt,Ke,ue,W,Ye;Y<he.length&&!W;){var Di=he[Y],yo=he[Y+1];for(ye=yt=0;ye<Di.length&&!W&&Di[ye];)if(W=Di[ye++].exec(te),W)for(Ke=0;Ke<yo.length;Ke++)Ye=W[++yt],ue=yo[Ke],typeof ue===d&&ue.length>0?ue.length===2?typeof ue[1]==a?this[ue[0]]=ue[1].call(this,Ye):this[ue[0]]=ue[1]:ue.length===3?typeof ue[1]===a&&!(ue[1].exec&&ue[1].test)?this[ue[0]]=Ye?ue[1].call(this,Ye,ue[2]):n:this[ue[0]]=Ye?Ye.replace(ue[1],ue[2]):n:ue.length===4&&(this[ue[0]]=Ye?ue[3].call(this,Ye.replace(ue[1],ue[2])):n):this[ue]=Ye||n;Y+=2}},Pi=function(te,he){for(var Y in he)if(typeof he[Y]===d&&he[Y].length>0){for(var ye=0;ye<he[Y].length;ye++)if(mo(he[Y][ye],te))return Y===o?n:Y}else if(mo(he[Y],te))return Y===o?n:Y;return te},jd={"1.0":"/8","1.2":"/1","1.3":"/3","2.0":"/412","2.0.2":"/416","2.0.3":"/417","2.0.4":"/419","?":"/"},go={ME:"4.90","NT 3.11":"NT3.51","NT 4.0":"NT4.0",2e3:"NT 5.0",XP:["NT 5.1","NT 5.2"],Vista:"NT 6.0",7:"NT 6.1",8:"NT 6.2","8.1":"NT 6.3",10:["NT 6.4","NT 10.0"],RT:"ARM"},vo={browser:[[/\b(?:crmo|crios)\/([\w\.]+)/i],[g,[h,"Chrome"]],[/edg(?:e|ios|a)?\/([\w\.]+)/i],[g,[h,"Edge"]],[/(opera mini)\/([-\w\.]+)/i,/(opera [mobiletab]{3,6})\b.+version\/([-\w\.]+)/i,/(opera)(?:.+version\/|[\/ ]+)([\w\.]+)/i],[h,g],[/opios[\/ ]+([\w\.]+)/i],[g,[h,Se+" Mini"]],[/\bopr\/([\w\.]+)/i],[g,[h,Se]],[/(kindle)\/([\w\.]+)/i,/(lunascape|maxthon|netfront|jasmine|blazer)[\/ ]?([\w\.]*)/i,/(avant |iemobile|slim)(?:browser)?[\/ ]?([\w\.]*)/i,/(ba?idubrowser)[\/ ]?([\w\.]+)/i,/(?:ms|\()(ie) ([\w\.]+)/i,/(flock|rockmelt|midori|epiphany|silk|skyfire|bolt|iron|vivaldi|iridium|phantomjs|bowser|quark|qupzilla|falkon|rekonq|puffin|brave|whale(?!.+naver)|qqbrowserlite|qq|duckduckgo)\/([-\w\.]+)/i,/(heytap|ovi)browser\/([\d\.]+)/i,/(weibo)__([\d\.]+)/i],[h,g],[/(?:\buc? ?browser|(?:juc.+)ucweb)[\/ ]?([\w\.]+)/i],[g,[h,"UC"+y]],[/microm.+\bqbcore\/([\w\.]+)/i,/\bqbcore\/([\w\.]+).+microm/i],[g,[h,"WeChat(Win) Desktop"]],[/micromessenger\/([\w\.]+)/i],[g,[h,"WeChat"]],[/konqueror\/([\w\.]+)/i],[g,[h,"Konqueror"]],[/trident.+rv[: ]([\w\.]{1,9})\b.+like gecko/i],[g,[h,"IE"]],[/ya(?:search)?browser\/([\w\.]+)/i],[g,[h,"Yandex"]],[/(avast|avg)\/([\w\.]+)/i],[[h,/(.+)/,"$1 Secure "+y],g],[/\bfocus\/([\w\.]+)/i],[g,[h,R+" Focus"]],[/\bopt\/([\w\.]+)/i],[g,[h,Se+" Touch"]],[/coc_coc\w+\/([\w\.]+)/i],[g,[h,"Coc Coc"]],[/dolfin\/([\w\.]+)/i],[g,[h,"Dolphin"]],[/coast\/([\w\.]+)/i],[g,[h,Se+" Coast"]],[/miuibrowser\/([\w\.]+)/i],[g,[h,"MIUI "+y]],[/fxios\/([-\w\.]+)/i],[g,[h,R]],[/\bqihu|(qi?ho?o?|360)browser/i],[[h,"360 "+y]],[/(oculus|samsung|sailfish|huawei)browser\/([\w\.]+)/i],[[h,/(.+)/,"$1 "+y],g],[/(comodo_dragon)\/([\w\.]+)/i],[[h,/_/g," "],g],[/(electron)\/([\w\.]+) safari/i,/(tesla)(?: qtcarbrowser|\/(20\d\d\.[-\w\.]+))/i,/m?(qqbrowser|baiduboxapp|2345Explorer)[\/ ]?([\w\.]+)/i],[h,g],[/(metasr)[\/ ]?([\w\.]+)/i,/(lbbrowser)/i,/\[(linkedin)app\]/i],[h],[/((?:fban\/fbios|fb_iab\/fb4a)(?!.+fbav)|;fbav\/([\w\.]+);)/i],[[h,po],g],[/(kakao(?:talk|story))[\/ ]([\w\.]+)/i,/(naver)\(.*?(\d+\.[\w\.]+).*\)/i,/safari (line)\/([\w\.]+)/i,/\b(line)\/([\w\.]+)\/iab/i,/(chromium|instagram)[\/ ]([-\w\.]+)/i],[h,g],[/\bgsa\/([\w\.]+) .*safari\//i],[g,[h,"GSA"]],[/musical_ly(?:.+app_?version\/|_)([\w\.]+)/i],[g,[h,"TikTok"]],[/headlesschrome(?:\/([\w\.]+)| )/i],[g,[h,_+" Headless"]],[/ wv\).+(chrome)\/([\w\.]+)/i],[[h,_+" WebView"],g],[/droid.+ version\/([\w\.]+)\b.+(?:mobile safari|safari)/i],[g,[h,"Android "+y]],[/(chrome|omniweb|arora|[tizenoka]{5} ?browser)\/v?([\w\.]+)/i],[h,g],[/version\/([\w\.\,]+) .*mobile\/\w+ (safari)/i],[g,[h,"Mobile Safari"]],[/version\/([\w(\.|\,)]+) .*(mobile ?safari|safari)/i],[g,h],[/webkit.+?(mobile ?safari|safari)(\/[\w\.]+)/i],[h,[g,Pi,jd]],[/(webkit|khtml)\/([\w\.]+)/i],[h,g],[/(navigator|netscape\d?)\/([-\w\.]+)/i],[[h,"Netscape"],g],[/mobile vr; rv:([\w\.]+)\).+firefox/i],[g,[h,R+" Reality"]],[/ekiohf.+(flow)\/([\w\.]+)/i,/(swiftfox)/i,/(icedragon|iceweasel|camino|chimera|fennec|maemo browser|minimo|conkeror|klar)[\/ ]?([\w\.\+]+)/i,/(seamonkey|k-meleon|icecat|iceape|firebird|phoenix|palemoon|basilisk|waterfox)\/([-\w\.]+)$/i,/(firefox)\/([\w\.]+)/i,/(mozilla)\/([\w\.]+) .+rv\:.+gecko\/\d+/i,/(polaris|lynx|dillo|icab|doris|amaya|w3m|netsurf|sleipnir|obigo|mosaic|(?:go|ice|up)[\. ]?browser)[-\/ ]?v?([\w\.]+)/i,/(links) \(([\w\.]+)/i,/panasonic;(viera)/i],[h,g],[/(cobalt)\/([\w\.]+)/i],[h,[g,/master.|lts./,""]]],cpu:[[/(?:(amd|x(?:(?:86|64)[-_])?|wow|win)64)[;\)]/i],[[w,"amd64"]],[/(ia32(?=;))/i],[[w,Cr]],[/((?:i[346]|x)86)[;\)]/i],[[w,"ia32"]],[/\b(aarch64|arm(v?8e?l?|_?64))\b/i],[[w,"arm64"]],[/\b(arm(?:v[67])?ht?n?[fl]p?)\b/i],[[w,"armhf"]],[/windows (ce|mobile); ppc;/i],[[w,"arm"]],[/((?:ppc|powerpc)(?:64)?)(?: mac|;|\))/i],[[w,/ower/,s,Cr]],[/(sun4\w)[;\)]/i],[[w,"sparc"]],[/((?:avr32|ia64(?=;))|68k(?=\))|\barm(?=v(?:[1-7]|[5-7]1)l?|;|eabi)|(?=atmel )avr|(?:irix|mips|sparc)(?:64)?\b|pa-risc)/i],[[w,Cr]]],device:[[/\b(sch-i[89]0\d|shw-m380s|sm-[ptx]\w{2,4}|gt-[pn]\d{2,4}|sgh-t8[56]9|nexus 10)/i],[p,[m,me],[f,P]],[/\b((?:s[cgp]h|gt|sm)-\w+|sc[g-]?[\d]+a?|galaxy nexus)/i,/samsung[- ]([-\w]+)/i,/sec-(sgh\w+)/i],[p,[m,me],[f,b]],[/(?:\/|\()(ip(?:hone|od)[\w, ]*)(?:\/|;)/i],[p,[m,k],[f,b]],[/\((ipad);[-\w\),; ]+apple/i,/applecoremedia\/[\w\.]+ \((ipad)/i,/\b(ipad)\d\d?,\d\d?[;\]].+ios/i],[p,[m,k],[f,P]],[/(macintosh);/i],[p,[m,k]],[/\b(sh-?[altvz]?\d\d[a-ekm]?)/i],[p,[m,De],[f,b]],[/\b((?:ag[rs][23]?|bah2?|sht?|btv)-a?[lw]\d{2})\b(?!.+d\/s)/i],[p,[m,O],[f,P]],[/(?:huawei|honor)([-\w ]+)[;\)]/i,/\b(nexus 6p|\w{2,4}e?-[atu]?[ln][\dx][012359c][adn]?)\b(?!.+d\/s)/i],[p,[m,O],[f,b]],[/\b(poco[\w ]+)(?: bui|\))/i,/\b; (\w+) build\/hm\1/i,/\b(hm[-_ ]?note?[_ ]?(?:\d\w)?) bui/i,/\b(redmi[\-_ ]?(?:note|k)?[\w_ ]+)(?: bui|\))/i,/\b(mi[-_ ]?(?:a\d|one|one[_ ]plus|note lte|max|cc)?[_ ]?(?:\d?\w?)[_ ]?(?:plus|se|lite)?)(?: bui|\))/i],[[p,/_/g," "],[m,$t],[f,b]],[/\b(mi[-_ ]?(?:pad)(?:[\w_ ]+))(?: bui|\))/i],[[p,/_/g," "],[m,$t],[f,P]],[/; (\w+) bui.+ oppo/i,/\b(cph[12]\d{3}|p(?:af|c[al]|d\w|e[ar])[mt]\d0|x9007|a101op)\b/i],[p,[m,"OPPO"],[f,b]],[/vivo (\w+)(?: bui|\))/i,/\b(v[12]\d{3}\w?[at])(?: bui|;)/i],[p,[m,"Vivo"],[f,b]],[/\b(rmx[12]\d{3})(?: bui|;|\))/i],[p,[m,"Realme"],[f,b]],[/\b(milestone|droid(?:[2-4x]| (?:bionic|x2|pro|razr))?:?( 4g)?)\b[\w ]+build\//i,/\bmot(?:orola)?[- ](\w*)/i,/((?:moto[\w\(\) ]+|xt\d{3,4}|nexus 6)(?= bui|\)))/i],[p,[m,K],[f,b]],[/\b(mz60\d|xoom[2 ]{0,2}) build\//i],[p,[m,K],[f,P]],[/((?=lg)?[vl]k\-?\d{3}) bui| 3\.[-\w; ]{10}lg?-([06cv9]{3,4})/i],[p,[m,x],[f,P]],[/(lm(?:-?f100[nv]?|-[\w\.]+)(?= bui|\))|nexus [45])/i,/\blg[-e;\/ ]+((?!browser|netcast|android tv)\w+)/i,/\blg-?([\d\w]+) bui/i],[p,[m,x],[f,b]],[/(ideatab[-\w ]+)/i,/lenovo ?(s[56]000[-\w]+|tab(?:[\w ]+)|yt[-\d\w]{6}|tb[-\d\w]{6})/i],[p,[m,"Lenovo"],[f,P]],[/(?:maemo|nokia).*(n900|lumia \d+)/i,/nokia[-_ ]?([-\w\.]*)/i],[[p,/_/g," "],[m,"Nokia"],[f,b]],[/(pixel c)\b/i],[p,[m,I],[f,P]],[/droid.+; (pixel[\daxl ]{0,6})(?: bui|\))/i],[p,[m,I],[f,b]],[/droid.+ (a?\d[0-2]{2}so|[c-g]\d{4}|so[-gl]\w+|xq-a\w[4-7][12])(?= bui|\).+chrome\/(?![1-6]{0,1}\d\.))/i],[p,[m,Fe],[f,b]],[/sony tablet [ps]/i,/\b(?:sony)?sgp\w+(?: bui|\))/i],[[p,"Xperia Tablet"],[m,Fe],[f,P]],[/ (kb2005|in20[12]5|be20[12][59])\b/i,/(?:one)?(?:plus)? (a\d0\d\d)(?: b|\))/i],[p,[m,"OnePlus"],[f,b]],[/(alexa)webm/i,/(kf[a-z]{2}wi|aeo[c-r]{2})( bui|\))/i,/(kf[a-z]+)( bui|\)).+silk\//i],[p,[m,S],[f,P]],[/((?:sd|kf)[0349hijorstuw]+)( bui|\)).+silk\//i],[[p,/(.+)/g,"Fire Phone $1"],[m,S],[f,b]],[/(playbook);[-\w\),; ]+(rim)/i],[p,m,[f,P]],[/\b((?:bb[a-f]|st[hv])100-\d)/i,/\(bb10; (\w+)/i],[p,[m,v],[f,b]],[/(?:\b|asus_)(transfo[prime ]{4,10} \w+|eeepc|slider \w+|nexus 7|padfone|p00[cj])/i],[p,[m,D],[f,P]],[/ (z[bes]6[027][012][km][ls]|zenfone \d\w?)\b/i],[p,[m,D],[f,b]],[/(nexus 9)/i],[p,[m,"HTC"],[f,P]],[/(htc)[-;_ ]{1,2}([\w ]+(?=\)| bui)|\w+)/i,/(zte)[- ]([\w ]+?)(?: bui|\/|\))/i,/(alcatel|geeksphone|nexian|panasonic(?!(?:;|\.))|sony(?!-bra))[-_ ]?([-\w]*)/i],[m,[p,/_/g," "],[f,b]],[/droid.+; ([ab][1-7]-?[0178a]\d\d?)/i],[p,[m,"Acer"],[f,P]],[/droid.+; (m[1-5] note) bui/i,/\bmz-([-\w]{2,})/i],[p,[m,"Meizu"],[f,b]],[/(blackberry|benq|palm(?=\-)|sonyericsson|acer|asus|dell|meizu|motorola|polytron)[-_ ]?([-\w]*)/i,/(hp) ([\w ]+\w)/i,/(asus)-?(\w+)/i,/(microsoft); (lumia[\w ]+)/i,/(lenovo)[-_ ]?([-\w]+)/i,/(jolla)/i,/(oppo) ?([\w ]+) bui/i],[m,p,[f,b]],[/(kobo)\s(ereader|touch)/i,/(archos) (gamepad2?)/i,/(hp).+(touchpad(?!.+tablet)|tablet)/i,/(kindle)\/([\w\.]+)/i,/(nook)[\w ]+build\/(\w+)/i,/(dell) (strea[kpr\d ]*[\dko])/i,/(le[- ]+pan)[- ]+(\w{1,9}) bui/i,/(trinity)[- ]*(t\d{3}) bui/i,/(gigaset)[- ]+(q\w{1,9}) bui/i,/(vodafone) ([\w ]+)(?:\)| bui)/i],[m,p,[f,P]],[/(surface duo)/i],[p,[m,j],[f,P]],[/droid [\d\.]+; (fp\du?)(?: b|\))/i],[p,[m,"Fairphone"],[f,b]],[/(u304aa)/i],[p,[m,"AT&T"],[f,b]],[/\bsie-(\w*)/i],[p,[m,"Siemens"],[f,b]],[/\b(rct\w+) b/i],[p,[m,"RCA"],[f,P]],[/\b(venue[\d ]{2,7}) b/i],[p,[m,"Dell"],[f,P]],[/\b(q(?:mv|ta)\w+) b/i],[p,[m,"Verizon"],[f,P]],[/\b(?:barnes[& ]+noble |bn[rt])([\w\+ ]*) b/i],[p,[m,"Barnes & Noble"],[f,P]],[/\b(tm\d{3}\w+) b/i],[p,[m,"NuVision"],[f,P]],[/\b(k88) b/i],[p,[m,"ZTE"],[f,P]],[/\b(nx\d{3}j) b/i],[p,[m,"ZTE"],[f,b]],[/\b(gen\d{3}) b.+49h/i],[p,[m,"Swiss"],[f,b]],[/\b(zur\d{3}) b/i],[p,[m,"Swiss"],[f,P]],[/\b((zeki)?tb.*\b) b/i],[p,[m,"Zeki"],[f,P]],[/\b([yr]\d{2}) b/i,/\b(dragon[- ]+touch |dt)(\w{5}) b/i],[[m,"Dragon Touch"],p,[f,P]],[/\b(ns-?\w{0,9}) b/i],[p,[m,"Insignia"],[f,P]],[/\b((nxa|next)-?\w{0,9}) b/i],[p,[m,"NextBook"],[f,P]],[/\b(xtreme\_)?(v(1[045]|2[015]|[3469]0|7[05])) b/i],[[m,"Voice"],p,[f,b]],[/\b(lvtel\-)?(v1[12]) b/i],[[m,"LvTel"],p,[f,b]],[/\b(ph-1) /i],[p,[m,"Essential"],[f,b]],[/\b(v(100md|700na|7011|917g).*\b) b/i],[p,[m,"Envizen"],[f,P]],[/\b(trio[-\w\. ]+) b/i],[p,[m,"MachSpeed"],[f,P]],[/\btu_(1491) b/i],[p,[m,"Rotor"],[f,P]],[/(shield[\w ]+) b/i],[p,[m,"Nvidia"],[f,P]],[/(sprint) (\w+)/i],[m,p,[f,b]],[/(kin\.[onetw]{3})/i],[[p,/\./g," "],[m,j],[f,b]],[/droid.+; (cc6666?|et5[16]|mc[239][23]x?|vc8[03]x?)\)/i],[p,[m,Ei],[f,P]],[/droid.+; (ec30|ps20|tc[2-8]\d[kx])\)/i],[p,[m,Ei],[f,b]],[/smart-tv.+(samsung)/i],[m,[f,N]],[/hbbtv.+maple;(\d+)/i],[[p,/^/,"SmartTV"],[m,me],[f,N]],[/(nux; netcast.+smarttv|lg (netcast\.tv-201\d|android tv))/i],[[m,x],[f,N]],[/(apple) ?tv/i],[m,[p,k+" TV"],[f,N]],[/crkey/i],[[p,_+"cast"],[m,I],[f,N]],[/droid.+aft(\w)( bui|\))/i],[p,[m,S],[f,N]],[/\(dtv[\);].+(aquos)/i,/(aquos-tv[\w ]+)\)/i],[p,[m,De],[f,N]],[/(bravia[\w ]+)( bui|\))/i],[p,[m,Fe],[f,N]],[/(mitv-\w{5}) bui/i],[p,[m,$t],[f,N]],[/Hbbtv.*(technisat) (.*);/i],[m,p,[f,N]],[/\b(roku)[\dx]*[\)\/]((?:dvp-)?[\d\.]*)/i,/hbbtv\/\d+\.\d+\.\d+ +\([\w\+ ]*; *([\w\d][^;]*);([^;]*)/i],[[m,Ti],[p,Ti],[f,N]],[/\b(android tv|smart[- ]?tv|opera tv|tv; rv:)\b/i],[[f,N]],[/(ouya)/i,/(nintendo) ([wids3utch]+)/i],[m,p,[f,C]],[/droid.+; (shield) bui/i],[p,[m,"Nvidia"],[f,C]],[/(playstation [345portablevi]+)/i],[p,[m,Fe],[f,C]],[/\b(xbox(?: one)?(?!; xbox))[\); ]/i],[p,[m,j],[f,C]],[/((pebble))app/i],[m,p,[f,$]],[/(watch)(?: ?os[,\/]|\d,\d\/)[\d\.]+/i],[p,[m,k],[f,$]],[/droid.+; (glass) \d/i],[p,[m,I],[f,$]],[/droid.+; (wt63?0{2,3})\)/i],[p,[m,Ei],[f,$]],[/(quest( 2| pro)?)/i],[p,[m,po],[f,$]],[/(tesla)(?: qtcarbrowser|\/[-\w\.]+)/i],[m,[f,B]],[/(aeobc)\b/i],[p,[m,S],[f,B]],[/droid .+?; ([^;]+?)(?: bui|\) applew).+? mobile safari/i],[p,[f,b]],[/droid .+?; ([^;]+?)(?: bui|\) applew).+?(?! mobile) safari/i],[p,[f,P]],[/\b((tablet|tab)[;\/]|focus\/\d(?!.+mobile))/i],[[f,P]],[/(phone|mobile(?:[;\/]| [ \w\/\.]*safari)|pda(?=.+windows ce))/i],[[f,b]],[/(android[-\w\. ]{0,9});.+buil/i],[p,[m,"Generic"]]],engine:[[/windows.+ edge\/([\w\.]+)/i],[g,[h,E+"HTML"]],[/webkit\/537\.36.+chrome\/(?!27)([\w\.]+)/i],[g,[h,"Blink"]],[/(presto)\/([\w\.]+)/i,/(webkit|trident|netfront|netsurf|amaya|lynx|w3m|goanna)\/([\w\.]+)/i,/ekioh(flow)\/([\w\.]+)/i,/(khtml|tasman|links)[\/ ]\(?([\w\.]+)/i,/(icab)[\/ ]([23]\.[\d\.]+)/i,/\b(libweb)/i],[h,g],[/rv\:([\w\.]{1,9})\b.+(gecko)/i],[g,h]],os:[[/microsoft (windows) (vista|xp)/i],[h,g],[/(windows) nt 6\.2; (arm)/i,/(windows (?:phone(?: os)?|mobile))[\/ ]?([\d\.\w ]*)/i,/(windows)[\/ ]?([ntce\d\. ]+\w)(?!.+xbox)/i],[h,[g,Pi,go]],[/(win(?=3|9|n)|win 9x )([nt\d\.]+)/i],[[h,"Windows"],[g,Pi,go]],[/ip[honead]{2,4}\b(?:.*os ([\w]+) like mac|; opera)/i,/ios;fbsv\/([\d\.]+)/i,/cfnetwork\/.+darwin/i],[[g,/_/g,"."],[h,"iOS"]],[/(mac os x) ?([\w\. ]*)/i,/(macintosh|mac_powerpc\b)(?!.+haiku)/i],[[h,ho],[g,/_/g,"."]],[/droid ([\w\.]+)\b.+(android[- ]x86|harmonyos)/i],[g,h],[/(android|webos|qnx|bada|rim tablet os|maemo|meego|sailfish)[-\/ ]?([\w\.]*)/i,/(blackberry)\w*\/([\w\.]*)/i,/(tizen|kaios)[\/ ]([\w\.]+)/i,/\((series40);/i],[h,g],[/\(bb(10);/i],[g,[h,v]],[/(?:symbian ?os|symbos|s60(?=;)|series60)[-\/ ]?([\w\.]*)/i],[g,[h,"Symbian"]],[/mozilla\/[\d\.]+ \((?:mobile|tablet|tv|mobile; [\w ]+); rv:.+ gecko\/([\w\.]+)/i],[g,[h,R+" OS"]],[/web0s;.+rt(tv)/i,/\b(?:hp)?wos(?:browser)?\/([\w\.]+)/i],[g,[h,"webOS"]],[/watch(?: ?os[,\/]|\d,\d\/)([\d\.]+)/i],[g,[h,"watchOS"]],[/crkey\/([\d\.]+)/i],[g,[h,_+"cast"]],[/(cros) [\w]+(?:\)| ([\w\.]+)\b)/i],[[h,fo],g],[/panasonic;(viera)/i,/(netrange)mmh/i,/(nettv)\/(\d+\.[\w\.]+)/i,/(nintendo|playstation) ([wids345portablevuch]+)/i,/(xbox); +xbox ([^\);]+)/i,/\b(joli|palm)\b ?(?:os)?\/?([\w\.]*)/i,/(mint)[\/\(\) ]?(\w*)/i,/(mageia|vectorlinux)[; ]/i,/([kxln]?ubuntu|debian|suse|opensuse|gentoo|arch(?= linux)|slackware|fedora|mandriva|centos|pclinuxos|red ?hat|zenwalk|linpus|raspbian|plan 9|minix|risc os|contiki|deepin|manjaro|elementary os|sabayon|linspire)(?: gnu\/linux)?(?: enterprise)?(?:[- ]linux)?(?:-gnu)?[-\/ ]?(?!chrom|package)([-\w\.]*)/i,/(hurd|linux) ?([\w\.]*)/i,/(gnu) ?([\w\.]*)/i,/\b([-frentopcghs]{0,5}bsd|dragonfly)[\/ ]?(?!amd|[ix346]{1,2}86)([\w\.]*)/i,/(haiku) (\w+)/i],[h,g],[/(sunos) ?([\w\.\d]*)/i],[[h,"Solaris"],g],[/((?:open)?solaris)[-\/ ]?([\w\.]*)/i,/(aix) ((\d)(?=\.|\)| )[\w\.])*/i,/\b(beos|os\/2|amigaos|morphos|openvms|fuchsia|hp-ux|serenityos)/i,/(unix) ?([\w\.]*)/i],[h,g]]},qe=function(te,he){if(typeof te===d&&(he=te,te=n),!(this instanceof qe))return new qe(te,he).getResult();var Y=typeof t!==c&&t.navigator?t.navigator:n,ye=te||(Y&&Y.userAgent?Y.userAgent:s),yt=Y&&Y.userAgentData?Y.userAgentData:n,Ke=he?Nd(vo,he):vo,ue=Y&&Y.userAgent==ye;return this.getBrowser=function(){var W={};return W[h]=n,W[g]=n,Er.call(W,ye,Ke.browser),W[u]=Ad(W[g]),ue&&Y&&Y.brave&&typeof Y.brave.isBrave==a&&(W[h]="Brave"),W},this.getCPU=function(){var W={};return W[w]=n,Er.call(W,ye,Ke.cpu),W},this.getDevice=function(){var W={};return W[m]=n,W[p]=n,W[f]=n,Er.call(W,ye,Ke.device),ue&&!W[f]&&yt&&yt.mobile&&(W[f]=b),ue&&W[p]=="Macintosh"&&Y&&typeof Y.standalone!==c&&Y.maxTouchPoints&&Y.maxTouchPoints>2&&(W[p]="iPad",W[f]=P),W},this.getEngine=function(){var W={};return W[h]=n,W[g]=n,Er.call(W,ye,Ke.engine),W},this.getOS=function(){var W={};return W[h]=n,W[g]=n,Er.call(W,ye,Ke.os),ue&&!W[h]&&yt&&yt.platform!="Unknown"&&(W[h]=yt.platform.replace(/chrome os/i,fo).replace(/macos/i,ho)),W},this.getResult=function(){return{ua:this.getUA(),browser:this.getBrowser(),engine:this.getEngine(),os:this.getOS(),device:this.getDevice(),cpu:this.getCPU()}},this.getUA=function(){return ye},this.setUA=function(W){return ye=typeof W===l&&W.length>F?Ti(W,F):W,this},this.setUA(ye),this};qe.VERSION=i,qe.BROWSER=cn([h,g,u]),qe.CPU=cn([w]),qe.DEVICE=cn([p,m,f,C,b,N,P,$,B]),qe.ENGINE=qe.OS=cn([h,g]),r.exports&&(e=r.exports=qe),e.UAParser=qe;var Bt=typeof t!==c&&(t.jQuery||t.Zepto);if(Bt&&!Bt.ua){var dn=new qe;Bt.ua=dn.getResult(),Bt.ua.get=function(){return dn.getUA()},Bt.ua.set=function(te){dn.setUA(te);var he=dn.getResult();for(var Y in he)Bt.ua[Y]=he[Y]}}})(typeof window=="object"?window:T)})(cs,cs.exports);var Yl=cs.exports,Ce={},Ql=T&&T.__importDefault||function(r){return r&&r.__esModule?r:{default:r}};Object.defineProperty(Ce,"__esModule",{value:!0});Ce.Logger=void 0;const Vt=Ql(ri),Jt="mediasoup-client";let Xl=class{constructor(e){e?(this._debug=(0,Vt.default)(`${Jt}:${e}`),this._warn=(0,Vt.default)(`${Jt}:WARN:${e}`),this._error=(0,Vt.default)(`${Jt}:ERROR:${e}`)):(this._debug=(0,Vt.default)(Jt),this._warn=(0,Vt.default)(`${Jt}:WARN`),this._error=(0,Vt.default)(`${Jt}:ERROR`)),this._debug.log=console.info.bind(console),this._warn.log=console.warn.bind(console),this._error.log=console.error.bind(console)}get debug(){return this._debug}get warn(){return this._warn}get error(){return this._error}};Ce.Logger=Xl;var lt={},xs={exports:{}},pr=typeof Reflect=="object"?Reflect:null,xo=pr&&typeof pr.apply=="function"?pr.apply:function(e,t,n){return Function.prototype.apply.call(e,t,n)},Nn;pr&&typeof pr.ownKeys=="function"?Nn=pr.ownKeys:Object.getOwnPropertySymbols?Nn=function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:Nn=function(e){return Object.getOwnPropertyNames(e)};function Zl(r){console&&console.warn&&console.warn(r)}var mc=Number.isNaN||function(e){return e!==e};function ve(){ve.init.call(this)}xs.exports=ve;xs.exports.once=nu;ve.EventEmitter=ve;ve.prototype._events=void 0;ve.prototype._eventsCount=0;ve.prototype._maxListeners=void 0;var Oo=10;function ni(r){if(typeof r!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof r)}Object.defineProperty(ve,"defaultMaxListeners",{enumerable:!0,get:function(){return Oo},set:function(r){if(typeof r!="number"||r<0||mc(r))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+r+".");Oo=r}});ve.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0};ve.prototype.setMaxListeners=function(e){if(typeof e!="number"||e<0||mc(e))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this};function gc(r){return r._maxListeners===void 0?ve.defaultMaxListeners:r._maxListeners}ve.prototype.getMaxListeners=function(){return gc(this)};ve.prototype.emit=function(e){for(var t=[],n=1;n<arguments.length;n++)t.push(arguments[n]);var i=e==="error",s=this._events;if(s!==void 0)i=i&&s.error===void 0;else if(!i)return!1;if(i){var o;if(t.length>0&&(o=t[0]),o instanceof Error)throw o;var a=new Error("Unhandled error."+(o?" ("+o.message+")":""));throw a.context=o,a}var c=s[e];if(c===void 0)return!1;if(typeof c=="function")xo(c,this,t);else for(var d=c.length,l=bc(c,d),n=0;n<d;++n)xo(l[n],this,t);return!0};function vc(r,e,t,n){var i,s,o;if(ni(t),s=r._events,s===void 0?(s=r._events=Object.create(null),r._eventsCount=0):(s.newListener!==void 0&&(r.emit("newListener",e,t.listener?t.listener:t),s=r._events),o=s[e]),o===void 0)o=s[e]=t,++r._eventsCount;else if(typeof o=="function"?o=s[e]=n?[t,o]:[o,t]:n?o.unshift(t):o.push(t),i=gc(r),i>0&&o.length>i&&!o.warned){o.warned=!0;var a=new Error("Possible EventEmitter memory leak detected. "+o.length+" "+String(e)+" listeners added. Use emitter.setMaxListeners() to increase limit");a.name="MaxListenersExceededWarning",a.emitter=r,a.type=e,a.count=o.length,Zl(a)}return r}ve.prototype.addListener=function(e,t){return vc(this,e,t,!1)};ve.prototype.on=ve.prototype.addListener;ve.prototype.prependListener=function(e,t){return vc(this,e,t,!0)};function eu(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function yc(r,e,t){var n={fired:!1,wrapFn:void 0,target:r,type:e,listener:t},i=eu.bind(n);return i.listener=t,n.wrapFn=i,i}ve.prototype.once=function(e,t){return ni(t),this.on(e,yc(this,e,t)),this};ve.prototype.prependOnceListener=function(e,t){return ni(t),this.prependListener(e,yc(this,e,t)),this};ve.prototype.removeListener=function(e,t){var n,i,s,o,a;if(ni(t),i=this._events,i===void 0)return this;if(n=i[e],n===void 0)return this;if(n===t||n.listener===t)--this._eventsCount===0?this._events=Object.create(null):(delete i[e],i.removeListener&&this.emit("removeListener",e,n.listener||t));else if(typeof n!="function"){for(s=-1,o=n.length-1;o>=0;o--)if(n[o]===t||n[o].listener===t){a=n[o].listener,s=o;break}if(s<0)return this;s===0?n.shift():tu(n,s),n.length===1&&(i[e]=n[0]),i.removeListener!==void 0&&this.emit("removeListener",e,a||t)}return this};ve.prototype.off=ve.prototype.removeListener;ve.prototype.removeAllListeners=function(e){var t,n,i;if(n=this._events,n===void 0)return this;if(n.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):n[e]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete n[e]),this;if(arguments.length===0){var s=Object.keys(n),o;for(i=0;i<s.length;++i)o=s[i],o!=="removeListener"&&this.removeAllListeners(o);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(t=n[e],typeof t=="function")this.removeListener(e,t);else if(t!==void 0)for(i=t.length-1;i>=0;i--)this.removeListener(e,t[i]);return this};function _c(r,e,t){var n=r._events;if(n===void 0)return[];var i=n[e];return i===void 0?[]:typeof i=="function"?t?[i.listener||i]:[i]:t?ru(i):bc(i,i.length)}ve.prototype.listeners=function(e){return _c(this,e,!0)};ve.prototype.rawListeners=function(e){return _c(this,e,!1)};ve.listenerCount=function(r,e){return typeof r.listenerCount=="function"?r.listenerCount(e):wc.call(r,e)};ve.prototype.listenerCount=wc;function wc(r){var e=this._events;if(e!==void 0){var t=e[r];if(typeof t=="function")return 1;if(t!==void 0)return t.length}return 0}ve.prototype.eventNames=function(){return this._eventsCount>0?Nn(this._events):[]};function bc(r,e){for(var t=new Array(e),n=0;n<e;++n)t[n]=r[n];return t}function tu(r,e){for(;e+1<r.length;e++)r[e]=r[e+1];r.pop()}function ru(r){for(var e=new Array(r.length),t=0;t<e.length;++t)e[t]=r[t].listener||r[t];return e}function nu(r,e){return new Promise(function(t,n){function i(o){r.removeListener(e,s),n(o)}function s(){typeof r.removeListener=="function"&&r.removeListener("error",i),t([].slice.call(arguments))}Sc(r,e,s,{once:!0}),e!=="error"&&iu(r,i,{once:!0})})}function iu(r,e,t){typeof r.on=="function"&&Sc(r,"error",e,t)}function Sc(r,e,t,n){if(typeof r.on=="function")n.once?r.once(e,t):r.on(e,t);else if(typeof r.addEventListener=="function")r.addEventListener(e,function i(s){n.once&&r.removeEventListener(e,i),t(s)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof r)}var su=xs.exports;Object.defineProperty(lt,"__esModule",{value:!0});lt.EnhancedEventEmitter=void 0;const ou=su,au=Ce,cu=new au.Logger("EnhancedEventEmitter");class du extends ou.EventEmitter{constructor(){super(),this.setMaxListeners(1/0)}emit(e,...t){return super.emit(e,...t)}safeEmit(e,...t){const n=super.listenerCount(e);try{return super.emit(e,...t)}catch(i){return cu.error("safeEmit() | event listener threw an error [eventName:%s]:%o",e,i),!!n}}on(e,t){return super.on(e,t),this}off(e,t){return super.off(e,t),this}addListener(e,t){return super.on(e,t),this}prependListener(e,t){return super.prependListener(e,t),this}once(e,t){return super.once(e,t),this}prependOnceListener(e,t){return super.prependOnceListener(e,t),this}removeListener(e,t){return super.off(e,t),this}removeAllListeners(e){return super.removeAllListeners(e),this}listenerCount(e){return super.listenerCount(e)}listeners(e){return super.listeners(e)}rawListeners(e){return super.rawListeners(e)}}lt.EnhancedEventEmitter=du;var Ne={};Object.defineProperty(Ne,"__esModule",{value:!0});Ne.InvalidStateError=Ne.UnsupportedError=void 0;class Os extends Error{constructor(e){super(e),this.name="UnsupportedError",Error.hasOwnProperty("captureStackTrace")?Error.captureStackTrace(this,Os):this.stack=new Error(e).stack}}Ne.UnsupportedError=Os;class Ls extends Error{constructor(e){super(e),this.name="InvalidStateError",Error.hasOwnProperty("captureStackTrace")?Error.captureStackTrace(this,Ls):this.stack=new Error(e).stack}}Ne.InvalidStateError=Ls;var Te={};Object.defineProperty(Te,"__esModule",{value:!0});Te.generateRandomNumber=Te.clone=void 0;function lu(r,e){return typeof r>"u"?e:JSON.parse(JSON.stringify(r))}Te.clone=lu;function uu(){return Math.round(Math.random()*1e7)}Te.generateRandomNumber=uu;var z={},Rc={};(function(r){const e=ri("h264-profile-level-id");e.log=console.info.bind(console);const t=1,n=2,i=3,s=4,o=5;r.ProfileConstrainedBaseline=t,r.ProfileBaseline=n,r.ProfileMain=i,r.ProfileConstrainedHigh=s,r.ProfileHigh=o;const a=0,c=10,d=11,l=12,u=13,p=20,h=21,f=22,m=30,g=31,w=32,C=40,b=41,P=42,N=50,$=51,B=52;r.Level1_b=a,r.Level1=c,r.Level1_1=d,r.Level1_2=l,r.Level1_3=u,r.Level2=p,r.Level2_1=h,r.Level2_2=f,r.Level3=m,r.Level3_1=g,r.Level3_2=w,r.Level4=C,r.Level4_1=b,r.Level4_2=P,r.Level5=N,r.Level5_1=$,r.Level5_2=B;class F{constructor(x,j){this.profile=x,this.level=j}}r.ProfileLevelId=F;const S=new F(t,g),k=16;class D{constructor(x){this._mask=~_("x",x),this._maskedValue=_("1",x)}isMatch(x){return this._maskedValue===(x&this._mask)}}class v{constructor(x,j,K){this.profile_idc=x,this.profile_iop=j,this.profile=K}}const y=[new v(66,new D("x1xx0000"),t),new v(77,new D("1xxx0000"),t),new v(88,new D("11xx0000"),t),new v(66,new D("x0xx0000"),n),new v(88,new D("10xx0000"),n),new v(77,new D("0x0x0000"),i),new v(100,new D("00000000"),o),new v(100,new D("00001100"),s)];r.parseProfileLevelId=function(O){if(typeof O!="string"||O.length!==6)return null;const x=parseInt(O,16);if(x===0)return null;const j=x&255,K=x>>8&255,Se=x>>16&255;let me;switch(j){case d:{me=K&k?a:d;break}case c:case l:case u:case p:case h:case f:case m:case g:case w:case C:case b:case P:case N:case $:case B:{me=j;break}default:return e("parseProfileLevelId() | unrecognized level_idc:%s",j),null}for(const De of y)if(Se===De.profile_idc&&De.profile_iop.isMatch(K))return new F(De.profile,me);return e("parseProfileLevelId() | unrecognized profile_idc/profile_iop combination"),null},r.profileLevelIdToString=function(O){if(O.level==a)switch(O.profile){case t:return"42f00b";case n:return"42100b";case i:return"4d100b";default:return e("profileLevelIdToString() | Level 1_b not is allowed for profile:%s",O.profile),null}let x;switch(O.profile){case t:{x="42e0";break}case n:{x="4200";break}case i:{x="4d00";break}case s:{x="640c";break}case o:{x="6400";break}default:return e("profileLevelIdToString() | unrecognized profile:%s",O.profile),null}let j=O.level.toString(16);return j.length===1&&(j=`0${j}`),`${x}${j}`},r.parseSdpProfileLevelId=function(O={}){const x=O["profile-level-id"];return x?r.parseProfileLevelId(x):S},r.isSameProfile=function(O={},x={}){const j=r.parseSdpProfileLevelId(O),K=r.parseSdpProfileLevelId(x);return!!(j&&K&&j.profile===K.profile)},r.generateProfileLevelIdForAnswer=function(O={},x={}){if(!O["profile-level-id"]&&!x["profile-level-id"])return e("generateProfileLevelIdForAnswer() | no profile-level-id in local and remote params"),null;const j=r.parseSdpProfileLevelId(O),K=r.parseSdpProfileLevelId(x);if(!j)throw new TypeError("invalid local_profile_level_id");if(!K)throw new TypeError("invalid remote_profile_level_id");if(j.profile!==K.profile)throw new TypeError("H264 Profile mismatch");const Se=I(O)&&I(x),me=j.level,De=K.level,Fe=R(me,De),$t=Se?me:Fe;return e("generateProfileLevelIdForAnswer() | result: [profile:%s, level:%s]",j.profile,$t),r.profileLevelIdToString(new F(j.profile,$t))};function _(O,x){return(x[0]===O)<<7|(x[1]===O)<<6|(x[2]===O)<<5|(x[3]===O)<<4|(x[4]===O)<<3|(x[5]===O)<<2|(x[6]===O)<<1|(x[7]===O)<<0}function E(O,x){return O===a?x!==c&&x!==a:x===a?O!==c:O<x}function R(O,x){return E(O,x)?O:x}function I(O={}){const x=O["level-asymmetry-allowed"];return x===1||x==="1"}})(Rc);var pu=T&&T.__createBinding||(Object.create?function(r,e,t,n){n===void 0&&(n=t);var i=Object.getOwnPropertyDescriptor(e,t);(!i||("get"in i?!e.__esModule:i.writable||i.configurable))&&(i={enumerable:!0,get:function(){return e[t]}}),Object.defineProperty(r,n,i)}:function(r,e,t,n){n===void 0&&(n=t),r[n]=e[t]}),fu=T&&T.__setModuleDefault||(Object.create?function(r,e){Object.defineProperty(r,"default",{enumerable:!0,value:e})}:function(r,e){r.default=e}),Cc=T&&T.__importStar||function(r){if(r&&r.__esModule)return r;var e={};if(r!=null)for(var t in r)t!=="default"&&Object.prototype.hasOwnProperty.call(r,t)&&pu(e,r,t);return fu(e,r),e};Object.defineProperty(z,"__esModule",{value:!0});z.canReceive=z.canSend=z.generateProbatorRtpParameters=z.reduceCodecs=z.getSendingRemoteRtpParameters=z.getSendingRtpParameters=z.getRecvRtpCapabilities=z.getExtendedRtpCapabilities=z.validateSctpStreamParameters=z.validateSctpParameters=z.validateNumSctpStreams=z.validateSctpCapabilities=z.validateRtcpParameters=z.validateRtpEncodingParameters=z.validateRtpHeaderExtensionParameters=z.validateRtpCodecParameters=z.validateRtpParameters=z.validateRtpHeaderExtension=z.validateRtcpFeedback=z.validateRtpCodecCapability=z.validateRtpCapabilities=void 0;const Lo=Cc(Rc),hu=Cc(Te),mu="probator",gu=1234,vu=127;function yu(r){if(typeof r!="object")throw new TypeError("caps is not an object");if(r.codecs&&!Array.isArray(r.codecs))throw new TypeError("caps.codecs is not an array");r.codecs||(r.codecs=[]);for(const e of r.codecs)Ec(e);if(r.headerExtensions&&!Array.isArray(r.headerExtensions))throw new TypeError("caps.headerExtensions is not an array");r.headerExtensions||(r.headerExtensions=[]);for(const e of r.headerExtensions)Tc(e)}z.validateRtpCapabilities=yu;function Ec(r){const e=new RegExp("^(audio|video)/(.+)","i");if(typeof r!="object")throw new TypeError("codec is not an object");if(!r.mimeType||typeof r.mimeType!="string")throw new TypeError("missing codec.mimeType");const t=e.exec(r.mimeType);if(!t)throw new TypeError("invalid codec.mimeType");if(r.kind=t[1].toLowerCase(),r.preferredPayloadType&&typeof r.preferredPayloadType!="number")throw new TypeError("invalid codec.preferredPayloadType");if(typeof r.clockRate!="number")throw new TypeError("missing codec.clockRate");r.kind==="audio"?typeof r.channels!="number"&&(r.channels=1):delete r.channels,(!r.parameters||typeof r.parameters!="object")&&(r.parameters={});for(const n of Object.keys(r.parameters)){let i=r.parameters[n];if(i===void 0&&(r.parameters[n]="",i=""),typeof i!="string"&&typeof i!="number")throw new TypeError(`invalid codec parameter [key:${n}s, value:${i}]`);if(n==="apt"&&typeof i!="number")throw new TypeError("invalid codec apt parameter")}(!r.rtcpFeedback||!Array.isArray(r.rtcpFeedback))&&(r.rtcpFeedback=[]);for(const n of r.rtcpFeedback)Is(n)}z.validateRtpCodecCapability=Ec;function Is(r){if(typeof r!="object")throw new TypeError("fb is not an object");if(!r.type||typeof r.type!="string")throw new TypeError("missing fb.type");(!r.parameter||typeof r.parameter!="string")&&(r.parameter="")}z.validateRtcpFeedback=Is;function Tc(r){if(typeof r!="object")throw new TypeError("ext is not an object");if(r.kind!=="audio"&&r.kind!=="video")throw new TypeError("invalid ext.kind");if(!r.uri||typeof r.uri!="string")throw new TypeError("missing ext.uri");if(typeof r.preferredId!="number")throw new TypeError("missing ext.preferredId");if(r.preferredEncrypt&&typeof r.preferredEncrypt!="boolean")throw new TypeError("invalid ext.preferredEncrypt");if(r.preferredEncrypt||(r.preferredEncrypt=!1),r.direction&&typeof r.direction!="string")throw new TypeError("invalid ext.direction");r.direction||(r.direction="sendrecv")}z.validateRtpHeaderExtension=Tc;function ks(r){if(typeof r!="object")throw new TypeError("params is not an object");if(r.mid&&typeof r.mid!="string")throw new TypeError("params.mid is not a string");if(!Array.isArray(r.codecs))throw new TypeError("missing params.codecs");for(const e of r.codecs)Pc(e);if(r.headerExtensions&&!Array.isArray(r.headerExtensions))throw new TypeError("params.headerExtensions is not an array");r.headerExtensions||(r.headerExtensions=[]);for(const e of r.headerExtensions)Dc(e);if(r.encodings&&!Array.isArray(r.encodings))throw new TypeError("params.encodings is not an array");r.encodings||(r.encodings=[]);for(const e of r.encodings)xc(e);if(r.rtcp&&typeof r.rtcp!="object")throw new TypeError("params.rtcp is not an object");r.rtcp||(r.rtcp={}),Oc(r.rtcp)}z.validateRtpParameters=ks;function Pc(r){const e=new RegExp("^(audio|video)/(.+)","i");if(typeof r!="object")throw new TypeError("codec is not an object");if(!r.mimeType||typeof r.mimeType!="string")throw new TypeError("missing codec.mimeType");const t=e.exec(r.mimeType);if(!t)throw new TypeError("invalid codec.mimeType");if(typeof r.payloadType!="number")throw new TypeError("missing codec.payloadType");if(typeof r.clockRate!="number")throw new TypeError("missing codec.clockRate");t[1].toLowerCase()==="audio"?typeof r.channels!="number"&&(r.channels=1):delete r.channels,(!r.parameters||typeof r.parameters!="object")&&(r.parameters={});for(const i of Object.keys(r.parameters)){let s=r.parameters[i];if(s===void 0&&(r.parameters[i]="",s=""),typeof s!="string"&&typeof s!="number")throw new TypeError(`invalid codec parameter [key:${i}s, value:${s}]`);if(i==="apt"&&typeof s!="number")throw new TypeError("invalid codec apt parameter")}(!r.rtcpFeedback||!Array.isArray(r.rtcpFeedback))&&(r.rtcpFeedback=[]);for(const i of r.rtcpFeedback)Is(i)}z.validateRtpCodecParameters=Pc;function Dc(r){if(typeof r!="object")throw new TypeError("ext is not an object");if(!r.uri||typeof r.uri!="string")throw new TypeError("missing ext.uri");if(typeof r.id!="number")throw new TypeError("missing ext.id");if(r.encrypt&&typeof r.encrypt!="boolean")throw new TypeError("invalid ext.encrypt");r.encrypt||(r.encrypt=!1),(!r.parameters||typeof r.parameters!="object")&&(r.parameters={});for(const e of Object.keys(r.parameters)){let t=r.parameters[e];if(t===void 0&&(r.parameters[e]="",t=""),typeof t!="string"&&typeof t!="number")throw new TypeError("invalid header extension parameter")}}z.validateRtpHeaderExtensionParameters=Dc;function xc(r){if(typeof r!="object")throw new TypeError("encoding is not an object");if(r.ssrc&&typeof r.ssrc!="number")throw new TypeError("invalid encoding.ssrc");if(r.rid&&typeof r.rid!="string")throw new TypeError("invalid encoding.rid");if(r.rtx&&typeof r.rtx!="object")throw new TypeError("invalid encoding.rtx");if(r.rtx&&typeof r.rtx.ssrc!="number")throw new TypeError("missing encoding.rtx.ssrc");if((!r.dtx||typeof r.dtx!="boolean")&&(r.dtx=!1),r.scalabilityMode&&typeof r.scalabilityMode!="string")throw new TypeError("invalid encoding.scalabilityMode")}z.validateRtpEncodingParameters=xc;function Oc(r){if(typeof r!="object")throw new TypeError("rtcp is not an object");if(r.cname&&typeof r.cname!="string")throw new TypeError("invalid rtcp.cname");(!r.reducedSize||typeof r.reducedSize!="boolean")&&(r.reducedSize=!0)}z.validateRtcpParameters=Oc;function _u(r){if(typeof r!="object")throw new TypeError("caps is not an object");if(!r.numStreams||typeof r.numStreams!="object")throw new TypeError("missing caps.numStreams");Lc(r.numStreams)}z.validateSctpCapabilities=_u;function Lc(r){if(typeof r!="object")throw new TypeError("numStreams is not an object");if(typeof r.OS!="number")throw new TypeError("missing numStreams.OS");if(typeof r.MIS!="number")throw new TypeError("missing numStreams.MIS")}z.validateNumSctpStreams=Lc;function wu(r){if(typeof r!="object")throw new TypeError("params is not an object");if(typeof r.port!="number")throw new TypeError("missing params.port");if(typeof r.OS!="number")throw new TypeError("missing params.OS");if(typeof r.MIS!="number")throw new TypeError("missing params.MIS");if(typeof r.maxMessageSize!="number")throw new TypeError("missing params.maxMessageSize")}z.validateSctpParameters=wu;function bu(r){if(typeof r!="object")throw new TypeError("params is not an object");if(typeof r.streamId!="number")throw new TypeError("missing params.streamId");let e=!1;if(typeof r.ordered=="boolean"?e=!0:r.ordered=!0,r.maxPacketLifeTime&&typeof r.maxPacketLifeTime!="number")throw new TypeError("invalid params.maxPacketLifeTime");if(r.maxRetransmits&&typeof r.maxRetransmits!="number")throw new TypeError("invalid params.maxRetransmits");if(r.maxPacketLifeTime&&r.maxRetransmits)throw new TypeError("cannot provide both maxPacketLifeTime and maxRetransmits");if(e&&r.ordered&&(r.maxPacketLifeTime||r.maxRetransmits))throw new TypeError("cannot be ordered with maxPacketLifeTime or maxRetransmits");if(!e&&(r.maxPacketLifeTime||r.maxRetransmits)&&(r.ordered=!1),r.label&&typeof r.label!="string")throw new TypeError("invalid params.label");if(r.protocol&&typeof r.protocol!="string")throw new TypeError("invalid params.protocol")}z.validateSctpStreamParameters=bu;function Su(r,e){const t={codecs:[],headerExtensions:[]};for(const n of e.codecs||[]){if(zr(n))continue;const i=(r.codecs||[]).find(o=>Ic(o,n,{strict:!0,modify:!0}));if(!i)continue;const s={mimeType:i.mimeType,kind:i.kind,clockRate:i.clockRate,channels:i.channels,localPayloadType:i.preferredPayloadType,localRtxPayloadType:void 0,remotePayloadType:n.preferredPayloadType,remoteRtxPayloadType:void 0,localParameters:i.parameters,remoteParameters:n.parameters,rtcpFeedback:Lu(i,n)};t.codecs.push(s)}for(const n of t.codecs){const i=r.codecs.find(o=>zr(o)&&o.parameters.apt===n.localPayloadType),s=e.codecs.find(o=>zr(o)&&o.parameters.apt===n.remotePayloadType);i&&s&&(n.localRtxPayloadType=i.preferredPayloadType,n.remoteRtxPayloadType=s.preferredPayloadType)}for(const n of e.headerExtensions){const i=r.headerExtensions.find(o=>Ou(o,n));if(!i)continue;const s={kind:n.kind,uri:n.uri,sendId:i.preferredId,recvId:n.preferredId,encrypt:i.preferredEncrypt,direction:"sendrecv"};switch(n.direction){case"sendrecv":s.direction="sendrecv";break;case"recvonly":s.direction="sendonly";break;case"sendonly":s.direction="recvonly";break;case"inactive":s.direction="inactive";break}t.headerExtensions.push(s)}return t}z.getExtendedRtpCapabilities=Su;function Ru(r){const e={codecs:[],headerExtensions:[]};for(const t of r.codecs){const n={mimeType:t.mimeType,kind:t.kind,preferredPayloadType:t.remotePayloadType,clockRate:t.clockRate,channels:t.channels,parameters:t.localParameters,rtcpFeedback:t.rtcpFeedback};if(e.codecs.push(n),!t.remoteRtxPayloadType)continue;const i={mimeType:`${t.kind}/rtx`,kind:t.kind,preferredPayloadType:t.remoteRtxPayloadType,clockRate:t.clockRate,parameters:{apt:t.remotePayloadType},rtcpFeedback:[]};e.codecs.push(i)}for(const t of r.headerExtensions){if(t.direction!=="sendrecv"&&t.direction!=="recvonly")continue;const n={kind:t.kind,uri:t.uri,preferredId:t.recvId,preferredEncrypt:t.encrypt,direction:t.direction};e.headerExtensions.push(n)}return e}z.getRecvRtpCapabilities=Ru;function Cu(r,e){const t={mid:void 0,codecs:[],headerExtensions:[],encodings:[],rtcp:{}};for(const n of e.codecs){if(n.kind!==r)continue;const i={mimeType:n.mimeType,payloadType:n.localPayloadType,clockRate:n.clockRate,channels:n.channels,parameters:n.localParameters,rtcpFeedback:n.rtcpFeedback};if(t.codecs.push(i),n.localRtxPayloadType){const s={mimeType:`${n.kind}/rtx`,payloadType:n.localRtxPayloadType,clockRate:n.clockRate,parameters:{apt:n.localPayloadType},rtcpFeedback:[]};t.codecs.push(s)}}for(const n of e.headerExtensions){if(n.kind&&n.kind!==r||n.direction!=="sendrecv"&&n.direction!=="sendonly")continue;const i={uri:n.uri,id:n.sendId,encrypt:n.encrypt,parameters:{}};t.headerExtensions.push(i)}return t}z.getSendingRtpParameters=Cu;function Eu(r,e){const t={mid:void 0,codecs:[],headerExtensions:[],encodings:[],rtcp:{}};for(const n of e.codecs){if(n.kind!==r)continue;const i={mimeType:n.mimeType,payloadType:n.localPayloadType,clockRate:n.clockRate,channels:n.channels,parameters:n.remoteParameters,rtcpFeedback:n.rtcpFeedback};if(t.codecs.push(i),n.localRtxPayloadType){const s={mimeType:`${n.kind}/rtx`,payloadType:n.localRtxPayloadType,clockRate:n.clockRate,parameters:{apt:n.localPayloadType},rtcpFeedback:[]};t.codecs.push(s)}}for(const n of e.headerExtensions){if(n.kind&&n.kind!==r||n.direction!=="sendrecv"&&n.direction!=="sendonly")continue;const i={uri:n.uri,id:n.sendId,encrypt:n.encrypt,parameters:{}};t.headerExtensions.push(i)}if(t.headerExtensions.some(n=>n.uri==="http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"))for(const n of t.codecs)n.rtcpFeedback=(n.rtcpFeedback||[]).filter(i=>i.type!=="goog-remb");else if(t.headerExtensions.some(n=>n.uri==="http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time"))for(const n of t.codecs)n.rtcpFeedback=(n.rtcpFeedback||[]).filter(i=>i.type!=="transport-cc");else for(const n of t.codecs)n.rtcpFeedback=(n.rtcpFeedback||[]).filter(i=>i.type!=="transport-cc"&&i.type!=="goog-remb");return t}z.getSendingRemoteRtpParameters=Eu;function Tu(r,e){const t=[];if(!e)t.push(r[0]),zr(r[1])&&t.push(r[1]);else{for(let n=0;n<r.length;++n)if(Ic(r[n],e)){t.push(r[n]),zr(r[n+1])&&t.push(r[n+1]);break}if(t.length===0)throw new TypeError("no matching codec found")}return t}z.reduceCodecs=Tu;function Pu(r){r=hu.clone(r,{}),ks(r);const e={mid:mu,codecs:[],headerExtensions:[],encodings:[{ssrc:gu}],rtcp:{cname:"probator"}};return e.codecs.push(r.codecs[0]),e.codecs[0].payloadType=vu,e.headerExtensions=r.headerExtensions,e}z.generateProbatorRtpParameters=Pu;function Du(r,e){return e.codecs.some(t=>t.kind===r)}z.canSend=Du;function xu(r,e){if(ks(r),r.codecs.length===0)return!1;const t=r.codecs[0];return e.codecs.some(n=>n.remotePayloadType===t.payloadType)}z.canReceive=xu;function zr(r){return r?/.+\/rtx$/i.test(r.mimeType):!1}function Ic(r,e,{strict:t=!1,modify:n=!1}={}){const i=r.mimeType.toLowerCase(),s=e.mimeType.toLowerCase();if(i!==s||r.clockRate!==e.clockRate||r.channels!==e.channels)return!1;switch(i){case"video/h264":{if(t){const o=r.parameters["packetization-mode"]||0,a=e.parameters["packetization-mode"]||0;if(o!==a||!Lo.isSameProfile(r.parameters,e.parameters))return!1;let c;try{c=Lo.generateProfileLevelIdForAnswer(r.parameters,e.parameters)}catch{return!1}n&&(c?(r.parameters["profile-level-id"]=c,e.parameters["profile-level-id"]=c):(delete r.parameters["profile-level-id"],delete e.parameters["profile-level-id"]))}break}case"video/vp9":{if(t){const o=r.parameters["profile-id"]||0,a=e.parameters["profile-id"]||0;if(o!==a)return!1}break}}return!0}function Ou(r,e){return!(r.kind&&e.kind&&r.kind!==e.kind||r.uri!==e.uri)}function Lu(r,e){const t=[];for(const n of r.rtcpFeedback||[]){const i=(e.rtcpFeedback||[]).find(s=>s.type===n.type&&(s.parameter===n.parameter||!s.parameter&&!n.parameter));i&&t.push(i)}return t}var Wr={},Pt={},ii={},Iu=T&&T.__importDefault||function(r){return r&&r.__esModule?r:{default:r}};Object.defineProperty(ii,"__esModule",{value:!0});ii.Logger=void 0;const qt=Iu(ri),Gt="awaitqueue";class ku{constructor(e){e?(this._debug=(0,qt.default)(`${Gt}:${e}`),this._warn=(0,qt.default)(`${Gt}:WARN:${e}`),this._error=(0,qt.default)(`${Gt}:ERROR:${e}`)):(this._debug=(0,qt.default)(Gt),this._warn=(0,qt.default)(`${Gt}:WARN`),this._error=(0,qt.default)(`${Gt}:ERROR`)),this._debug.log=console.info.bind(console),this._warn.log=console.warn.bind(console),this._error.log=console.error.bind(console)}get debug(){return this._debug}get warn(){return this._warn}get error(){return this._error}}ii.Logger=ku;Object.defineProperty(Pt,"__esModule",{value:!0});Pt.AwaitQueue=Pt.AwaitQueueRemovedTaskError=Pt.AwaitQueueStoppedError=void 0;const Mu=ii,_t=new Mu.Logger;class si extends Error{constructor(e){super(e??"AwaitQueue stopped"),this.name="AwaitQueueStoppedError",typeof Error.captureStackTrace=="function"&&Error.captureStackTrace(this,si)}}Pt.AwaitQueueStoppedError=si;class oi extends Error{constructor(e){super(e??"AwaitQueue task removed"),this.name="AwaitQueueRemovedTaskError",typeof Error.captureStackTrace=="function"&&Error.captureStackTrace(this,oi)}}Pt.AwaitQueueRemovedTaskError=oi;class Nu{constructor(){this.pendingTasks=new Map,this.nextTaskId=0,this.stopping=!1}get size(){return this.pendingTasks.size}async push(e,t){if(t=t??e.name,_t.debug(`push() [name:${t}]`),typeof e!="function")throw new TypeError("given task is not a function");if(t)try{Object.defineProperty(e,"name",{value:t})}catch{}return new Promise((n,i)=>{const s={id:this.nextTaskId++,task:e,name:t,enqueuedAt:Date.now(),executedAt:void 0,completed:!1,resolve:o=>{if(s.completed)return;s.completed=!0,this.pendingTasks.delete(s.id),_t.debug(`resolving task [name:${s.name}]`),n(o);const[a]=this.pendingTasks.values();a&&!a.executedAt&&this.execute(a)},reject:o=>{if(!s.completed&&(s.completed=!0,this.pendingTasks.delete(s.id),_t.debug(`rejecting task [name:${s.name}]: %s`,String(o)),i(o),!this.stopping)){const[a]=this.pendingTasks.values();a&&!a.executedAt&&this.execute(a)}}};this.pendingTasks.set(s.id,s),this.pendingTasks.size===1&&this.execute(s)})}stop(){_t.debug("stop()"),this.stopping=!0;for(const e of this.pendingTasks.values())_t.debug(`stop() | stopping task [name:${e.name}]`),e.reject(new si);this.stopping=!1}remove(e){_t.debug(`remove() [taskIdx:${e}]`);const t=Array.from(this.pendingTasks.values())[e];if(!t){_t.debug(`stop() | no task with given idx [taskIdx:${e}]`);return}t.reject(new oi)}dump(){const e=Date.now();let t=0;return Array.from(this.pendingTasks.values()).map(n=>({idx:t++,task:n.task,name:n.name,enqueuedTime:n.executedAt?n.executedAt-n.enqueuedAt:e-n.enqueuedAt,executionTime:n.executedAt?e-n.executedAt:0}))}async execute(e){if(_t.debug(`execute() [name:${e.name}]`),e.executedAt)throw new Error("task already being executed");e.executedAt=Date.now();try{const t=await e.task();e.resolve(t)}catch(t){e.reject(t)}}}Pt.AwaitQueue=Nu;/*! queue-microtask. MIT License. Feross Aboukhadijeh <https://feross.org/opensource> */let Io;var Au=typeof queueMicrotask=="function"?queueMicrotask.bind(typeof window<"u"?window:T):r=>(Io||(Io=Promise.resolve())).then(r).catch(e=>setTimeout(()=>{throw e},0)),Kr={};Object.defineProperty(Kr,"__esModule",{value:!0});Kr.Producer=void 0;const ju=Ce,ko=lt,Ht=Ne,Qe=new ju.Logger("Producer");class $u extends ko.EnhancedEventEmitter{constructor({id:e,localId:t,rtpSender:n,track:i,rtpParameters:s,stopTracks:o,disableTrackOnPause:a,zeroRtpOnPause:c,appData:d}){super(),this._closed=!1,this._observer=new ko.EnhancedEventEmitter,Qe.debug("constructor()"),this._id=e,this._localId=t,this._rtpSender=n,this._track=i,this._kind=i.kind,this._rtpParameters=s,this._paused=a?!i.enabled:!1,this._maxSpatialLayer=void 0,this._stopTracks=o,this._disableTrackOnPause=a,this._zeroRtpOnPause=c,this._appData=d||{},this.onTrackEnded=this.onTrackEnded.bind(this),this.handleTrack()}get id(){return this._id}get localId(){return this._localId}get closed(){return this._closed}get kind(){return this._kind}get rtpSender(){return this._rtpSender}get track(){return this._track}get rtpParameters(){return this._rtpParameters}get paused(){return this._paused}get maxSpatialLayer(){return this._maxSpatialLayer}get appData(){return this._appData}set appData(e){this._appData=e}get observer(){return this._observer}close(){this._closed||(Qe.debug("close()"),this._closed=!0,this.destroyTrack(),this.emit("@close"),this._observer.safeEmit("close"))}transportClosed(){this._closed||(Qe.debug("transportClosed()"),this._closed=!0,this.destroyTrack(),this.safeEmit("transportclose"),this._observer.safeEmit("close"))}async getStats(){if(this._closed)throw new Ht.InvalidStateError("closed");return new Promise((e,t)=>{this.safeEmit("@getstats",e,t)})}pause(){if(Qe.debug("pause()"),this._closed){Qe.error("pause() | Producer closed");return}this._paused=!0,this._track&&this._disableTrackOnPause&&(this._track.enabled=!1),this._zeroRtpOnPause&&new Promise((e,t)=>{this.safeEmit("@pause",e,t)}).catch(()=>{}),this._observer.safeEmit("pause")}resume(){if(Qe.debug("resume()"),this._closed){Qe.error("resume() | Producer closed");return}this._paused=!1,this._track&&this._disableTrackOnPause&&(this._track.enabled=!0),this._zeroRtpOnPause&&new Promise((e,t)=>{this.safeEmit("@resume",e,t)}).catch(()=>{}),this._observer.safeEmit("resume")}async replaceTrack({track:e}){if(Qe.debug("replaceTrack() [track:%o]",e),this._closed){if(e&&this._stopTracks)try{e.stop()}catch{}throw new Ht.InvalidStateError("closed")}else if(e&&e.readyState==="ended")throw new Ht.InvalidStateError("track ended");if(e===this._track){Qe.debug("replaceTrack() | same track, ignored");return}await new Promise((t,n)=>{this.safeEmit("@replacetrack",e,t,n)}),this.destroyTrack(),this._track=e,this._track&&this._disableTrackOnPause&&(this._paused?this._paused&&(this._track.enabled=!1):this._track.enabled=!0),this.handleTrack()}async setMaxSpatialLayer(e){if(this._closed)throw new Ht.InvalidStateError("closed");if(this._kind!=="video")throw new Ht.UnsupportedError("not a video Producer");if(typeof e!="number")throw new TypeError("invalid spatialLayer");e!==this._maxSpatialLayer&&(await new Promise((t,n)=>{this.safeEmit("@setmaxspatiallayer",e,t,n)}).catch(()=>{}),this._maxSpatialLayer=e)}async setRtpEncodingParameters(e){if(this._closed)throw new Ht.InvalidStateError("closed");if(typeof e!="object")throw new TypeError("invalid params");await new Promise((t,n)=>{this.safeEmit("@setrtpencodingparameters",e,t,n)})}onTrackEnded(){Qe.debug('track "ended" event'),this.safeEmit("trackended"),this._observer.safeEmit("trackended")}handleTrack(){this._track&&this._track.addEventListener("ended",this.onTrackEnded)}destroyTrack(){if(this._track)try{this._track.removeEventListener("ended",this.onTrackEnded),this._stopTracks&&this._track.stop()}catch{}}}Kr.Producer=$u;var Yr={};Object.defineProperty(Yr,"__esModule",{value:!0});Yr.Consumer=void 0;const Bu=Ce,Mo=lt,Fu=Ne,Xe=new Bu.Logger("Consumer");class Uu extends Mo.EnhancedEventEmitter{constructor({id:e,localId:t,producerId:n,rtpReceiver:i,track:s,rtpParameters:o,appData:a}){super(),this._closed=!1,this._observer=new Mo.EnhancedEventEmitter,Xe.debug("constructor()"),this._id=e,this._localId=t,this._producerId=n,this._rtpReceiver=i,this._track=s,this._rtpParameters=o,this._paused=!s.enabled,this._appData=a||{},this.onTrackEnded=this.onTrackEnded.bind(this),this.handleTrack()}get id(){return this._id}get localId(){return this._localId}get producerId(){return this._producerId}get closed(){return this._closed}get kind(){return this._track.kind}get rtpReceiver(){return this._rtpReceiver}get track(){return this._track}get rtpParameters(){return this._rtpParameters}get paused(){return this._paused}get appData(){return this._appData}set appData(e){this._appData=e}get observer(){return this._observer}close(){this._closed||(Xe.debug("close()"),this._closed=!0,this.destroyTrack(),this.emit("@close"),this._observer.safeEmit("close"))}transportClosed(){this._closed||(Xe.debug("transportClosed()"),this._closed=!0,this.destroyTrack(),this.safeEmit("transportclose"),this._observer.safeEmit("close"))}async getStats(){if(this._closed)throw new Fu.InvalidStateError("closed");return new Promise((e,t)=>{this.safeEmit("@getstats",e,t)})}pause(){if(Xe.debug("pause()"),this._closed){Xe.error("pause() | Consumer closed");return}if(this._paused){Xe.debug("pause() | Consumer is already paused");return}this._paused=!0,this._track.enabled=!1,this.emit("@pause"),this._observer.safeEmit("pause")}resume(){if(Xe.debug("resume()"),this._closed){Xe.error("resume() | Consumer closed");return}if(!this._paused){Xe.debug("resume() | Consumer is already resumed");return}this._paused=!1,this._track.enabled=!0,this.emit("@resume"),this._observer.safeEmit("resume")}onTrackEnded(){Xe.debug('track "ended" event'),this.safeEmit("trackended"),this._observer.safeEmit("trackended")}handleTrack(){this._track.addEventListener("ended",this.onTrackEnded)}destroyTrack(){try{this._track.removeEventListener("ended",this.onTrackEnded),this._track.stop()}catch{}}}Yr.Consumer=Uu;var Qr={};Object.defineProperty(Qr,"__esModule",{value:!0});Qr.DataProducer=void 0;const zu=Ce,No=lt,Vu=Ne,ht=new zu.Logger("DataProducer");class Ju extends No.EnhancedEventEmitter{constructor({id:e,dataChannel:t,sctpStreamParameters:n,appData:i}){super(),this._closed=!1,this._observer=new No.EnhancedEventEmitter,ht.debug("constructor()"),this._id=e,this._dataChannel=t,this._sctpStreamParameters=n,this._appData=i||{},this.handleDataChannel()}get id(){return this._id}get closed(){return this._closed}get sctpStreamParameters(){return this._sctpStreamParameters}get readyState(){return this._dataChannel.readyState}get label(){return this._dataChannel.label}get protocol(){return this._dataChannel.protocol}get bufferedAmount(){return this._dataChannel.bufferedAmount}get bufferedAmountLowThreshold(){return this._dataChannel.bufferedAmountLowThreshold}set bufferedAmountLowThreshold(e){this._dataChannel.bufferedAmountLowThreshold=e}get appData(){return this._appData}set appData(e){this._appData=e}get observer(){return this._observer}close(){this._closed||(ht.debug("close()"),this._closed=!0,this._dataChannel.close(),this.emit("@close"),this._observer.safeEmit("close"))}transportClosed(){this._closed||(ht.debug("transportClosed()"),this._closed=!0,this._dataChannel.close(),this.safeEmit("transportclose"),this._observer.safeEmit("close"))}send(e){if(ht.debug("send()"),this._closed)throw new Vu.InvalidStateError("closed");this._dataChannel.send(e)}handleDataChannel(){this._dataChannel.addEventListener("open",()=>{this._closed||(ht.debug('DataChannel "open" event'),this.safeEmit("open"))}),this._dataChannel.addEventListener("error",e=>{if(this._closed)return;let{error:t}=e;t||(t=new Error("unknown DataChannel error")),t.errorDetail==="sctp-failure"?ht.error("DataChannel SCTP error [sctpCauseCode:%s]: %s",t.sctpCauseCode,t.message):ht.error('DataChannel "error" event: %o',t),this.safeEmit("error",t)}),this._dataChannel.addEventListener("close",()=>{this._closed||(ht.warn('DataChannel "close" event'),this._closed=!0,this.emit("@close"),this.safeEmit("close"),this._observer.safeEmit("close"))}),this._dataChannel.addEventListener("message",()=>{this._closed||ht.warn('DataChannel "message" event in a DataProducer, message discarded')}),this._dataChannel.addEventListener("bufferedamountlow",()=>{this._closed||this.safeEmit("bufferedamountlow")})}}Qr.DataProducer=Ju;var Xr={};Object.defineProperty(Xr,"__esModule",{value:!0});Xr.DataConsumer=void 0;const qu=Ce,Ao=lt,Ot=new qu.Logger("DataConsumer");class Gu extends Ao.EnhancedEventEmitter{constructor({id:e,dataProducerId:t,dataChannel:n,sctpStreamParameters:i,appData:s}){super(),this._closed=!1,this._observer=new Ao.EnhancedEventEmitter,Ot.debug("constructor()"),this._id=e,this._dataProducerId=t,this._dataChannel=n,this._sctpStreamParameters=i,this._appData=s||{},this.handleDataChannel()}get id(){return this._id}get dataProducerId(){return this._dataProducerId}get closed(){return this._closed}get sctpStreamParameters(){return this._sctpStreamParameters}get readyState(){return this._dataChannel.readyState}get label(){return this._dataChannel.label}get protocol(){return this._dataChannel.protocol}get binaryType(){return this._dataChannel.binaryType}set binaryType(e){this._dataChannel.binaryType=e}get appData(){return this._appData}set appData(e){this._appData=e}get observer(){return this._observer}close(){this._closed||(Ot.debug("close()"),this._closed=!0,this._dataChannel.close(),this.emit("@close"),this._observer.safeEmit("close"))}transportClosed(){this._closed||(Ot.debug("transportClosed()"),this._closed=!0,this._dataChannel.close(),this.safeEmit("transportclose"),this._observer.safeEmit("close"))}handleDataChannel(){this._dataChannel.addEventListener("open",()=>{this._closed||(Ot.debug('DataChannel "open" event'),this.safeEmit("open"))}),this._dataChannel.addEventListener("error",e=>{if(this._closed)return;let{error:t}=e;t||(t=new Error("unknown DataChannel error")),t.errorDetail==="sctp-failure"?Ot.error("DataChannel SCTP error [sctpCauseCode:%s]: %s",t.sctpCauseCode,t.message):Ot.error('DataChannel "error" event: %o',t),this.safeEmit("error",t)}),this._dataChannel.addEventListener("close",()=>{this._closed||(Ot.warn('DataChannel "close" event'),this._closed=!0,this.emit("@close"),this.safeEmit("close"),this._observer.safeEmit("close"))}),this._dataChannel.addEventListener("message",e=>{this._closed||this.safeEmit("message",e.data)})}}Xr.DataConsumer=Gu;var Hu=T&&T.__createBinding||(Object.create?function(r,e,t,n){n===void 0&&(n=t);var i=Object.getOwnPropertyDescriptor(e,t);(!i||("get"in i?!e.__esModule:i.writable||i.configurable))&&(i={enumerable:!0,get:function(){return e[t]}}),Object.defineProperty(r,n,i)}:function(r,e,t,n){n===void 0&&(n=t),r[n]=e[t]}),Wu=T&&T.__setModuleDefault||(Object.create?function(r,e){Object.defineProperty(r,"default",{enumerable:!0,value:e})}:function(r,e){r.default=e}),kc=T&&T.__importStar||function(r){if(r&&r.__esModule)return r;var e={};if(r!=null)for(var t in r)t!=="default"&&Object.prototype.hasOwnProperty.call(r,t)&&Hu(e,r,t);return Wu(e,r),e},Ku=T&&T.__importDefault||function(r){return r&&r.__esModule?r:{default:r}};Object.defineProperty(Wr,"__esModule",{value:!0});Wr.Transport=void 0;const Yu=Pt,Ii=Ku(Au),Qu=Ce,jo=lt,Ie=Ne,ki=kc(Te),Pr=kc(z),Xu=Kr,Zu=Yr,ep=Qr,tp=Xr,xe=new Qu.Logger("Transport");class rp{constructor(e){this.consumerOptions=e,this.promise=new Promise((t,n)=>{this.resolve=t,this.reject=n})}}let np=class extends jo.EnhancedEventEmitter{constructor({direction:e,id:t,iceParameters:n,iceCandidates:i,dtlsParameters:s,sctpParameters:o,iceServers:a,iceTransportPolicy:c,additionalSettings:d,proprietaryConstraints:l,appData:u,handlerFactory:p,extendedRtpCapabilities:h,canProduceByKind:f}){super(),this._closed=!1,this._iceGatheringState="new",this._connectionState="new",this._producers=new Map,this._consumers=new Map,this._dataProducers=new Map,this._dataConsumers=new Map,this._probatorConsumerCreated=!1,this._awaitQueue=new Yu.AwaitQueue,this._pendingConsumerTasks=[],this._consumerCreationInProgress=!1,this._pendingPauseConsumers=new Map,this._consumerPauseInProgress=!1,this._pendingResumeConsumers=new Map,this._consumerResumeInProgress=!1,this._pendingCloseConsumers=new Map,this._consumerCloseInProgress=!1,this._observer=new jo.EnhancedEventEmitter,xe.debug("constructor() [id:%s, direction:%s]",t,e),this._id=t,this._direction=e,this._extendedRtpCapabilities=h,this._canProduceByKind=f,this._maxSctpMessageSize=o?o.maxMessageSize:null,d=ki.clone(d,{}),delete d.iceServers,delete d.iceTransportPolicy,delete d.bundlePolicy,delete d.rtcpMuxPolicy,delete d.sdpSemantics,this._handler=p(),this._handler.run({direction:e,iceParameters:n,iceCandidates:i,dtlsParameters:s,sctpParameters:o,iceServers:a,iceTransportPolicy:c,additionalSettings:d,proprietaryConstraints:l,extendedRtpCapabilities:h}),this._appData=u||{},this.handleHandler()}get id(){return this._id}get closed(){return this._closed}get direction(){return this._direction}get handler(){return this._handler}get iceGatheringState(){return this._iceGatheringState}get connectionState(){return this._connectionState}get appData(){return this._appData}set appData(e){this._appData=e}get observer(){return this._observer}close(){if(!this._closed){xe.debug("close()"),this._closed=!0,this._awaitQueue.stop(),this._handler.close(),this._connectionState="closed";for(const e of this._producers.values())e.transportClosed();this._producers.clear();for(const e of this._consumers.values())e.transportClosed();this._consumers.clear();for(const e of this._dataProducers.values())e.transportClosed();this._dataProducers.clear();for(const e of this._dataConsumers.values())e.transportClosed();this._dataConsumers.clear(),this._observer.safeEmit("close")}}async getStats(){if(this._closed)throw new Ie.InvalidStateError("closed");return this._handler.getTransportStats()}async restartIce({iceParameters:e}){if(xe.debug("restartIce()"),this._closed)throw new Ie.InvalidStateError("closed");if(!e)throw new TypeError("missing iceParameters");return this._awaitQueue.push(async()=>await this._handler.restartIce(e),"transport.restartIce()")}async updateIceServers({iceServers:e}={}){if(xe.debug("updateIceServers()"),this._closed)throw new Ie.InvalidStateError("closed");if(!Array.isArray(e))throw new TypeError("missing iceServers");return this._awaitQueue.push(async()=>this._handler.updateIceServers(e),"transport.updateIceServers()")}async produce({track:e,encodings:t,codecOptions:n,codec:i,stopTracks:s=!0,disableTrackOnPause:o=!0,zeroRtpOnPause:a=!1,appData:c={}}={}){if(xe.debug("produce() [track:%o]",e),this._closed)throw new Ie.InvalidStateError("closed");if(e){if(this._direction!=="send")throw new Ie.UnsupportedError("not a sending Transport");if(this._canProduceByKind[e.kind]){if(e.readyState==="ended")throw new Ie.InvalidStateError("track ended");if(this.listenerCount("connect")===0&&this._connectionState==="new")throw new TypeError('no "connect" listener set into this transport');if(this.listenerCount("produce")===0)throw new TypeError('no "produce" listener set into this transport');if(c&&typeof c!="object")throw new TypeError("if given, appData must be an object")}else throw new Ie.UnsupportedError(`cannot produce ${e.kind}`)}else throw new TypeError("missing track");return this._awaitQueue.push(async()=>{let d;if(t&&!Array.isArray(t))throw TypeError("encodings must be an array");t&&t.length===0?d=void 0:t&&(d=t.map(h=>{const f={active:!0};return h.active===!1&&(f.active=!1),typeof h.dtx=="boolean"&&(f.dtx=h.dtx),typeof h.scalabilityMode=="string"&&(f.scalabilityMode=h.scalabilityMode),typeof h.scaleResolutionDownBy=="number"&&(f.scaleResolutionDownBy=h.scaleResolutionDownBy),typeof h.maxBitrate=="number"&&(f.maxBitrate=h.maxBitrate),typeof h.maxFramerate=="number"&&(f.maxFramerate=h.maxFramerate),typeof h.adaptivePtime=="boolean"&&(f.adaptivePtime=h.adaptivePtime),typeof h.priority=="string"&&(f.priority=h.priority),typeof h.networkPriority=="string"&&(f.networkPriority=h.networkPriority),f}));const{localId:l,rtpParameters:u,rtpSender:p}=await this._handler.send({track:e,encodings:d,codecOptions:n,codec:i});try{Pr.validateRtpParameters(u);const{id:h}=await new Promise((m,g)=>{this.safeEmit("produce",{kind:e.kind,rtpParameters:u,appData:c},m,g)}),f=new Xu.Producer({id:h,localId:l,rtpSender:p,track:e,rtpParameters:u,stopTracks:s,disableTrackOnPause:o,zeroRtpOnPause:a,appData:c});return this._producers.set(f.id,f),this.handleProducer(f),this._observer.safeEmit("newproducer",f),f}catch(h){throw this._handler.stopSending(l).catch(()=>{}),h}},"transport.produce()").catch(d=>{if(s)try{e.stop()}catch{}throw d})}async consume({id:e,producerId:t,kind:n,rtpParameters:i,streamId:s,appData:o={}}){if(xe.debug("consume()"),i=ki.clone(i,void 0),this._closed)throw new Ie.InvalidStateError("closed");if(this._direction!=="recv")throw new Ie.UnsupportedError("not a receiving Transport");if(typeof e!="string")throw new TypeError("missing id");if(typeof t!="string")throw new TypeError("missing producerId");if(n!=="audio"&&n!=="video")throw new TypeError(`invalid kind '${n}'`);if(this.listenerCount("connect")===0&&this._connectionState==="new")throw new TypeError('no "connect" listener set into this transport');if(o&&typeof o!="object")throw new TypeError("if given, appData must be an object");if(!Pr.canReceive(i,this._extendedRtpCapabilities))throw new Ie.UnsupportedError("cannot consume this Producer");const c=new rp({id:e,producerId:t,kind:n,rtpParameters:i,streamId:s,appData:o});return this._pendingConsumerTasks.push(c),(0,Ii.default)(()=>{this._closed||this._consumerCreationInProgress===!1&&this.createPendingConsumers()}),c.promise}async produceData({ordered:e=!0,maxPacketLifeTime:t,maxRetransmits:n,label:i="",protocol:s="",appData:o={}}={}){if(xe.debug("produceData()"),this._closed)throw new Ie.InvalidStateError("closed");if(this._direction!=="send")throw new Ie.UnsupportedError("not a sending Transport");if(this._maxSctpMessageSize){if(this.listenerCount("connect")===0&&this._connectionState==="new")throw new TypeError('no "connect" listener set into this transport');if(this.listenerCount("producedata")===0)throw new TypeError('no "producedata" listener set into this transport');if(o&&typeof o!="object")throw new TypeError("if given, appData must be an object")}else throw new Ie.UnsupportedError("SCTP not enabled by remote Transport");return(t||n)&&(e=!1),this._awaitQueue.push(async()=>{const{dataChannel:a,sctpStreamParameters:c}=await this._handler.sendDataChannel({ordered:e,maxPacketLifeTime:t,maxRetransmits:n,label:i,protocol:s});Pr.validateSctpStreamParameters(c);const{id:d}=await new Promise((u,p)=>{this.safeEmit("producedata",{sctpStreamParameters:c,label:i,protocol:s,appData:o},u,p)}),l=new ep.DataProducer({id:d,dataChannel:a,sctpStreamParameters:c,appData:o});return this._dataProducers.set(l.id,l),this.handleDataProducer(l),this._observer.safeEmit("newdataproducer",l),l},"transport.produceData()")}async consumeData({id:e,dataProducerId:t,sctpStreamParameters:n,label:i="",protocol:s="",appData:o={}}){if(xe.debug("consumeData()"),n=ki.clone(n,void 0),this._closed)throw new Ie.InvalidStateError("closed");if(this._direction!=="recv")throw new Ie.UnsupportedError("not a receiving Transport");if(this._maxSctpMessageSize){if(typeof e!="string")throw new TypeError("missing id");if(typeof t!="string")throw new TypeError("missing dataProducerId");if(this.listenerCount("connect")===0&&this._connectionState==="new")throw new TypeError('no "connect" listener set into this transport');if(o&&typeof o!="object")throw new TypeError("if given, appData must be an object")}else throw new Ie.UnsupportedError("SCTP not enabled by remote Transport");return Pr.validateSctpStreamParameters(n),this._awaitQueue.push(async()=>{const{dataChannel:a}=await this._handler.receiveDataChannel({sctpStreamParameters:n,label:i,protocol:s}),c=new tp.DataConsumer({id:e,dataProducerId:t,dataChannel:a,sctpStreamParameters:n,appData:o});return this._dataConsumers.set(c.id,c),this.handleDataConsumer(c),this._observer.safeEmit("newdataconsumer",c),c},"transport.consumeData()")}async createPendingConsumers(){this._consumerCreationInProgress=!0,this._awaitQueue.push(async()=>{if(this._pendingConsumerTasks.length===0){xe.debug("createPendingConsumers() | there is no Consumer to be created");return}const e=[...this._pendingConsumerTasks];this._pendingConsumerTasks=[];let t;const n=[];for(const i of e){const{id:s,kind:o,rtpParameters:a,streamId:c}=i.consumerOptions;n.push({trackId:s,kind:o,rtpParameters:a,streamId:c})}try{const i=await this._handler.receive(n);for(let s=0;s<i.length;++s){const o=e[s],a=i[s],{id:c,producerId:d,kind:l,rtpParameters:u,appData:p}=o.consumerOptions,{localId:h,rtpReceiver:f,track:m}=a,g=new Zu.Consumer({id:c,localId:h,producerId:d,rtpReceiver:f,track:m,rtpParameters:u,appData:p});this._consumers.set(g.id,g),this.handleConsumer(g),!this._probatorConsumerCreated&&!t&&l==="video"&&(t=g),this._observer.safeEmit("newconsumer",g),o.resolve(g)}}catch(i){for(const s of e)s.reject(i)}if(t)try{const i=Pr.generateProbatorRtpParameters(t.rtpParameters);await this._handler.receive([{trackId:"probator",kind:"video",rtpParameters:i}]),xe.debug("createPendingConsumers() | Consumer for RTP probation created"),this._probatorConsumerCreated=!0}catch(i){xe.error("createPendingConsumers() | failed to create Consumer for RTP probation:%o",i)}},"transport.createPendingConsumers()").then(()=>{this._consumerCreationInProgress=!1,this._pendingConsumerTasks.length>0&&this.createPendingConsumers()}).catch(()=>{})}pausePendingConsumers(){this._consumerPauseInProgress=!0,this._awaitQueue.push(async()=>{if(this._pendingPauseConsumers.size===0){xe.debug("pausePendingConsumers() | there is no Consumer to be paused");return}const e=Array.from(this._pendingPauseConsumers.values());this._pendingPauseConsumers.clear();try{const t=e.map(n=>n.localId);await this._handler.pauseReceiving(t)}catch(t){xe.error("pausePendingConsumers() | failed to pause Consumers:",t)}},"transport.pausePendingConsumers").then(()=>{this._consumerPauseInProgress=!1,this._pendingPauseConsumers.size>0&&this.pausePendingConsumers()}).catch(()=>{})}resumePendingConsumers(){this._consumerResumeInProgress=!0,this._awaitQueue.push(async()=>{if(this._pendingResumeConsumers.size===0){xe.debug("resumePendingConsumers() | there is no Consumer to be resumed");return}const e=Array.from(this._pendingResumeConsumers.values());this._pendingResumeConsumers.clear();try{const t=e.map(n=>n.localId);await this._handler.resumeReceiving(t)}catch(t){xe.error("resumePendingConsumers() | failed to resume Consumers:",t)}},"transport.resumePendingConsumers").then(()=>{this._consumerResumeInProgress=!1,this._pendingResumeConsumers.size>0&&this.resumePendingConsumers()}).catch(()=>{})}closePendingConsumers(){this._consumerCloseInProgress=!0,this._awaitQueue.push(async()=>{if(this._pendingCloseConsumers.size===0){xe.debug("closePendingConsumers() | there is no Consumer to be closed");return}const e=Array.from(this._pendingCloseConsumers.values());this._pendingCloseConsumers.clear();try{await this._handler.stopReceiving(e.map(t=>t.localId))}catch(t){xe.error("closePendingConsumers() | failed to close Consumers:",t)}},"transport.closePendingConsumers").then(()=>{this._consumerCloseInProgress=!1,this._pendingCloseConsumers.size>0&&this.closePendingConsumers()}).catch(()=>{})}handleHandler(){const e=this._handler;e.on("@connect",({dtlsParameters:t},n,i)=>{if(this._closed){i(new Ie.InvalidStateError("closed"));return}this.safeEmit("connect",{dtlsParameters:t},n,i)}),e.on("@icegatheringstatechange",t=>{t!==this._iceGatheringState&&(xe.debug("ICE gathering state changed to %s",t),this._iceGatheringState=t,this._closed||this.safeEmit("icegatheringstatechange",t))}),e.on("@connectionstatechange",t=>{t!==this._connectionState&&(xe.debug("connection state changed to %s",t),this._connectionState=t,this._closed||this.safeEmit("connectionstatechange",t))})}handleProducer(e){e.on("@close",()=>{this._producers.delete(e.id),!this._closed&&this._awaitQueue.push(async()=>await this._handler.stopSending(e.localId),"producer @close event").catch(t=>xe.warn("producer.close() failed:%o",t))}),e.on("@pause",(t,n)=>{this._awaitQueue.push(async()=>await this._handler.pauseSending(e.localId),"producer @pause event").then(t).catch(n)}),e.on("@resume",(t,n)=>{this._awaitQueue.push(async()=>await this._handler.resumeSending(e.localId),"producer @resume event").then(t).catch(n)}),e.on("@replacetrack",(t,n,i)=>{this._awaitQueue.push(async()=>await this._handler.replaceTrack(e.localId,t),"producer @replacetrack event").then(n).catch(i)}),e.on("@setmaxspatiallayer",(t,n,i)=>{this._awaitQueue.push(async()=>await this._handler.setMaxSpatialLayer(e.localId,t),"producer @setmaxspatiallayer event").then(n).catch(i)}),e.on("@setrtpencodingparameters",(t,n,i)=>{this._awaitQueue.push(async()=>await this._handler.setRtpEncodingParameters(e.localId,t),"producer @setrtpencodingparameters event").then(n).catch(i)}),e.on("@getstats",(t,n)=>{if(this._closed)return n(new Ie.InvalidStateError("closed"));this._handler.getSenderStats(e.localId).then(t).catch(n)})}handleConsumer(e){e.on("@close",()=>{this._consumers.delete(e.id),this._pendingPauseConsumers.delete(e.id),this._pendingResumeConsumers.delete(e.id),!this._closed&&(this._pendingCloseConsumers.set(e.id,e),this._consumerCloseInProgress===!1&&this.closePendingConsumers())}),e.on("@pause",()=>{this._pendingResumeConsumers.has(e.id)&&this._pendingResumeConsumers.delete(e.id),this._pendingPauseConsumers.set(e.id,e),(0,Ii.default)(()=>{this._closed||this._consumerPauseInProgress===!1&&this.pausePendingConsumers()})}),e.on("@resume",()=>{this._pendingPauseConsumers.has(e.id)&&this._pendingPauseConsumers.delete(e.id),this._pendingResumeConsumers.set(e.id,e),(0,Ii.default)(()=>{this._closed||this._consumerResumeInProgress===!1&&this.resumePendingConsumers()})}),e.on("@getstats",(t,n)=>{if(this._closed)return n(new Ie.InvalidStateError("closed"));this._handler.getReceiverStats(e.localId).then(t).catch(n)})}handleDataProducer(e){e.on("@close",()=>{this._dataProducers.delete(e.id)})}handleDataConsumer(e){e.on("@close",()=>{this._dataConsumers.delete(e.id)})}};Wr.Transport=np;var ai={},Pe={},Mc={},Nc={exports:{}},$o=Nc.exports={v:[{name:"version",reg:/^(\d*)$/}],o:[{name:"origin",reg:/^(\S*) (\d*) (\d*) (\S*) IP(\d) (\S*)/,names:["username","sessionId","sessionVersion","netType","ipVer","address"],format:"%s %s %d %s IP%d %s"}],s:[{name:"name"}],i:[{name:"description"}],u:[{name:"uri"}],e:[{name:"email"}],p:[{name:"phone"}],z:[{name:"timezones"}],r:[{name:"repeats"}],t:[{name:"timing",reg:/^(\d*) (\d*)/,names:["start","stop"],format:"%d %d"}],c:[{name:"connection",reg:/^IN IP(\d) (\S*)/,names:["version","ip"],format:"IN IP%d %s"}],b:[{push:"bandwidth",reg:/^(TIAS|AS|CT|RR|RS):(\d*)/,names:["type","limit"],format:"%s:%s"}],m:[{reg:/^(\w*) (\d*) ([\w/]*)(?: (.*))?/,names:["type","port","protocol","payloads"],format:"%s %d %s %s"}],a:[{push:"rtp",reg:/^rtpmap:(\d*) ([\w\-.]*)(?:\s*\/(\d*)(?:\s*\/(\S*))?)?/,names:["payload","codec","rate","encoding"],format:function(r){return r.encoding?"rtpmap:%d %s/%s/%s":r.rate?"rtpmap:%d %s/%s":"rtpmap:%d %s"}},{push:"fmtp",reg:/^fmtp:(\d*) ([\S| ]*)/,names:["payload","config"],format:"fmtp:%d %s"},{name:"control",reg:/^control:(.*)/,format:"control:%s"},{name:"rtcp",reg:/^rtcp:(\d*)(?: (\S*) IP(\d) (\S*))?/,names:["port","netType","ipVer","address"],format:function(r){return r.address!=null?"rtcp:%d %s IP%d %s":"rtcp:%d"}},{push:"rtcpFbTrrInt",reg:/^rtcp-fb:(\*|\d*) trr-int (\d*)/,names:["payload","value"],format:"rtcp-fb:%s trr-int %d"},{push:"rtcpFb",reg:/^rtcp-fb:(\*|\d*) ([\w-_]*)(?: ([\w-_]*))?/,names:["payload","type","subtype"],format:function(r){return r.subtype!=null?"rtcp-fb:%s %s %s":"rtcp-fb:%s %s"}},{push:"ext",reg:/^extmap:(\d+)(?:\/(\w+))?(?: (urn:ietf:params:rtp-hdrext:encrypt))? (\S*)(?: (\S*))?/,names:["value","direction","encrypt-uri","uri","config"],format:function(r){return"extmap:%d"+(r.direction?"/%s":"%v")+(r["encrypt-uri"]?" %s":"%v")+" %s"+(r.config?" %s":"")}},{name:"extmapAllowMixed",reg:/^(extmap-allow-mixed)/},{push:"crypto",reg:/^crypto:(\d*) ([\w_]*) (\S*)(?: (\S*))?/,names:["id","suite","config","sessionConfig"],format:function(r){return r.sessionConfig!=null?"crypto:%d %s %s %s":"crypto:%d %s %s"}},{name:"setup",reg:/^setup:(\w*)/,format:"setup:%s"},{name:"connectionType",reg:/^connection:(new|existing)/,format:"connection:%s"},{name:"mid",reg:/^mid:([^\s]*)/,format:"mid:%s"},{name:"msid",reg:/^msid:(.*)/,format:"msid:%s"},{name:"ptime",reg:/^ptime:(\d*(?:\.\d*)*)/,format:"ptime:%d"},{name:"maxptime",reg:/^maxptime:(\d*(?:\.\d*)*)/,format:"maxptime:%d"},{name:"direction",reg:/^(sendrecv|recvonly|sendonly|inactive)/},{name:"icelite",reg:/^(ice-lite)/},{name:"iceUfrag",reg:/^ice-ufrag:(\S*)/,format:"ice-ufrag:%s"},{name:"icePwd",reg:/^ice-pwd:(\S*)/,format:"ice-pwd:%s"},{name:"fingerprint",reg:/^fingerprint:(\S*) (\S*)/,names:["type","hash"],format:"fingerprint:%s %s"},{push:"candidates",reg:/^candidate:(\S*) (\d*) (\S*) (\d*) (\S*) (\d*) typ (\S*)(?: raddr (\S*) rport (\d*))?(?: tcptype (\S*))?(?: generation (\d*))?(?: network-id (\d*))?(?: network-cost (\d*))?/,names:["foundation","component","transport","priority","ip","port","type","raddr","rport","tcptype","generation","network-id","network-cost"],format:function(r){var e="candidate:%s %d %s %d %s %d typ %s";return e+=r.raddr!=null?" raddr %s rport %d":"%v%v",e+=r.tcptype!=null?" tcptype %s":"%v",r.generation!=null&&(e+=" generation %d"),e+=r["network-id"]!=null?" network-id %d":"%v",e+=r["network-cost"]!=null?" network-cost %d":"%v",e}},{name:"endOfCandidates",reg:/^(end-of-candidates)/},{name:"remoteCandidates",reg:/^remote-candidates:(.*)/,format:"remote-candidates:%s"},{name:"iceOptions",reg:/^ice-options:(\S*)/,format:"ice-options:%s"},{push:"ssrcs",reg:/^ssrc:(\d*) ([\w_-]*)(?::(.*))?/,names:["id","attribute","value"],format:function(r){var e="ssrc:%d";return r.attribute!=null&&(e+=" %s",r.value!=null&&(e+=":%s")),e}},{push:"ssrcGroups",reg:/^ssrc-group:([\x21\x23\x24\x25\x26\x27\x2A\x2B\x2D\x2E\w]*) (.*)/,names:["semantics","ssrcs"],format:"ssrc-group:%s %s"},{name:"msidSemantic",reg:/^msid-semantic:\s?(\w*) (\S*)/,names:["semantic","token"],format:"msid-semantic: %s %s"},{push:"groups",reg:/^group:(\w*) (.*)/,names:["type","mids"],format:"group:%s %s"},{name:"rtcpMux",reg:/^(rtcp-mux)/},{name:"rtcpRsize",reg:/^(rtcp-rsize)/},{name:"sctpmap",reg:/^sctpmap:([\w_/]*) (\S*)(?: (\S*))?/,names:["sctpmapNumber","app","maxMessageSize"],format:function(r){return r.maxMessageSize!=null?"sctpmap:%s %s %s":"sctpmap:%s %s"}},{name:"xGoogleFlag",reg:/^x-google-flag:([^\s]*)/,format:"x-google-flag:%s"},{push:"rids",reg:/^rid:([\d\w]+) (\w+)(?: ([\S| ]*))?/,names:["id","direction","params"],format:function(r){return r.params?"rid:%s %s %s":"rid:%s %s"}},{push:"imageattrs",reg:new RegExp("^imageattr:(\\d+|\\*)[\\s\\t]+(send|recv)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*)(?:[\\s\\t]+(recv|send)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*))?"),names:["pt","dir1","attrs1","dir2","attrs2"],format:function(r){return"imageattr:%s %s %s"+(r.dir2?" %s %s":"")}},{name:"simulcast",reg:new RegExp("^simulcast:(send|recv) ([a-zA-Z0-9\\-_~;,]+)(?:\\s?(send|recv) ([a-zA-Z0-9\\-_~;,]+))?$"),names:["dir1","list1","dir2","list2"],format:function(r){return"simulcast:%s %s"+(r.dir2?" %s %s":"")}},{name:"simulcast_03",reg:/^simulcast:[\s\t]+([\S+\s\t]+)$/,names:["value"],format:"simulcast: %s"},{name:"framerate",reg:/^framerate:(\d+(?:$|\.\d+))/,format:"framerate:%s"},{name:"sourceFilter",reg:/^source-filter: *(excl|incl) (\S*) (IP4|IP6|\*) (\S*) (.*)/,names:["filterMode","netType","addressTypes","destAddress","srcList"],format:"source-filter: %s %s %s %s %s"},{name:"bundleOnly",reg:/^(bundle-only)/},{name:"label",reg:/^label:(.+)/,format:"label:%s"},{name:"sctpPort",reg:/^sctp-port:(\d+)$/,format:"sctp-port:%s"},{name:"maxMessageSize",reg:/^max-message-size:(\d+)$/,format:"max-message-size:%s"},{push:"tsRefClocks",reg:/^ts-refclk:([^\s=]*)(?:=(\S*))?/,names:["clksrc","clksrcExt"],format:function(r){return"ts-refclk:%s"+(r.clksrcExt!=null?"=%s":"")}},{name:"mediaClk",reg:/^mediaclk:(?:id=(\S*))? *([^\s=]*)(?:=(\S*))?(?: *rate=(\d+)\/(\d+))?/,names:["id","mediaClockName","mediaClockValue","rateNumerator","rateDenominator"],format:function(r){var e="mediaclk:";return e+=r.id!=null?"id=%s %s":"%v%s",e+=r.mediaClockValue!=null?"=%s":"",e+=r.rateNumerator!=null?" rate=%s":"",e+=r.rateDenominator!=null?"/%s":"",e}},{name:"keywords",reg:/^keywds:(.+)$/,format:"keywds:%s"},{name:"content",reg:/^content:(.+)/,format:"content:%s"},{name:"bfcpFloorCtrl",reg:/^floorctrl:(c-only|s-only|c-s)/,format:"floorctrl:%s"},{name:"bfcpConfId",reg:/^confid:(\d+)/,format:"confid:%s"},{name:"bfcpUserId",reg:/^userid:(\d+)/,format:"userid:%s"},{name:"bfcpFloorId",reg:/^floorid:(.+) (?:m-stream|mstrm):(.+)/,names:["id","mStream"],format:"floorid:%s mstrm:%s"},{push:"invalid",names:["value"]}]};Object.keys($o).forEach(function(r){var e=$o[r];e.forEach(function(t){t.reg||(t.reg=/(.*)/),t.format||(t.format="%s")})});var Ac=Nc.exports;(function(r){var e=function(a){return String(Number(a))===a?Number(a):a},t=function(a,c,d,l){if(l&&!d)c[l]=e(a[1]);else for(var u=0;u<d.length;u+=1)a[u+1]!=null&&(c[d[u]]=e(a[u+1]))},n=function(a,c,d){var l=a.name&&a.names;a.push&&!c[a.push]?c[a.push]=[]:l&&!c[a.name]&&(c[a.name]={});var u=a.push?{}:l?c[a.name]:c;t(d.match(a.reg),u,a.names,a.name),a.push&&c[a.push].push(u)},i=Ac,s=RegExp.prototype.test.bind(/^([a-z])=(.*)/);r.parse=function(a){var c={},d=[],l=c;return a.split(/(\r\n|\r|\n)/).filter(s).forEach(function(u){var p=u[0],h=u.slice(2);p==="m"&&(d.push({rtp:[],fmtp:[]}),l=d[d.length-1]);for(var f=0;f<(i[p]||[]).length;f+=1){var m=i[p][f];if(m.reg.test(h))return n(m,l,h)}}),c.media=d,c};var o=function(a,c){var d=c.split(/=(.+)/,2);return d.length===2?a[d[0]]=e(d[1]):d.length===1&&c.length>1&&(a[d[0]]=void 0),a};r.parseParams=function(a){return a.split(/;\s?/).reduce(o,{})},r.parseFmtpConfig=r.parseParams,r.parsePayloads=function(a){return a.toString().split(" ").map(Number)},r.parseRemoteCandidates=function(a){for(var c=[],d=a.split(" ").map(e),l=0;l<d.length;l+=3)c.push({component:d[l],ip:d[l+1],port:d[l+2]});return c},r.parseImageAttributes=function(a){return a.split(" ").map(function(c){return c.substring(1,c.length-1).split(",").reduce(o,{})})},r.parseSimulcastStreamList=function(a){return a.split(";").map(function(c){return c.split(",").map(function(d){var l,u=!1;return d[0]!=="~"?l=e(d):(l=e(d.substring(1,d.length)),u=!0),{scid:l,paused:u}})})}})(Mc);var Mi=Ac,ip=/%[sdv%]/g,sp=function(r){var e=1,t=arguments,n=t.length;return r.replace(ip,function(i){if(e>=n)return i;var s=t[e];switch(e+=1,i){case"%%":return"%";case"%s":return String(s);case"%d":return Number(s);case"%v":return""}})},Dr=function(r,e,t){var n=e.format instanceof Function?e.format(e.push?t:t[e.name]):e.format,i=[r+"="+n];if(e.names)for(var s=0;s<e.names.length;s+=1){var o=e.names[s];e.name?i.push(t[e.name][o]):i.push(t[e.names[s]])}else i.push(t[e.name]);return sp.apply(null,i)},op=["v","o","s","i","u","e","p","c","b","t","r","z","a"],ap=["i","c","b","a"],cp=function(r,e){e=e||{},r.version==null&&(r.version=0),r.name==null&&(r.name=" "),r.media.forEach(function(s){s.payloads==null&&(s.payloads="")});var t=e.outerOrder||op,n=e.innerOrder||ap,i=[];return t.forEach(function(s){Mi[s].forEach(function(o){o.name in r&&r[o.name]!=null?i.push(Dr(s,o,r)):o.push in r&&r[o.push]!=null&&r[o.push].forEach(function(a){i.push(Dr(s,o,a))})})}),r.media.forEach(function(s){i.push(Dr("m",Mi.m[0],s)),n.forEach(function(o){Mi[o].forEach(function(a){a.name in s&&s[a.name]!=null?i.push(Dr(o,a,s)):a.push in s&&s[a.push]!=null&&s[a.push].forEach(function(c){i.push(Dr(o,a,c))})})})}),i.join(`\r
`)+`\r
`},Nt=Mc,dp=cp;Pe.write=dp;Pe.parse=Nt.parse;Pe.parseParams=Nt.parseParams;Pe.parseFmtpConfig=Nt.parseFmtpConfig;Pe.parsePayloads=Nt.parsePayloads;Pe.parseRemoteCandidates=Nt.parseRemoteCandidates;Pe.parseImageAttributes=Nt.parseImageAttributes;Pe.parseSimulcastStreamList=Nt.parseSimulcastStreamList;var Me={},lp=T&&T.__createBinding||(Object.create?function(r,e,t,n){n===void 0&&(n=t);var i=Object.getOwnPropertyDescriptor(e,t);(!i||("get"in i?!e.__esModule:i.writable||i.configurable))&&(i={enumerable:!0,get:function(){return e[t]}}),Object.defineProperty(r,n,i)}:function(r,e,t,n){n===void 0&&(n=t),r[n]=e[t]}),up=T&&T.__setModuleDefault||(Object.create?function(r,e){Object.defineProperty(r,"default",{enumerable:!0,value:e})}:function(r,e){r.default=e}),pp=T&&T.__importStar||function(r){if(r&&r.__esModule)return r;var e={};if(r!=null)for(var t in r)t!=="default"&&Object.prototype.hasOwnProperty.call(r,t)&&lp(e,r,t);return up(e,r),e};Object.defineProperty(Me,"__esModule",{value:!0});Me.applyCodecParameters=Me.getCname=Me.extractDtlsParameters=Me.extractRtpCapabilities=void 0;const jc=pp(Pe);function fp({sdpObject:r}){const e=new Map,t=[];let n=!1,i=!1;for(const o of r.media){const a=o.type;switch(a){case"audio":{if(n)continue;n=!0;break}case"video":{if(i)continue;i=!0;break}default:continue}for(const c of o.rtp){const d={kind:a,mimeType:`${a}/${c.codec}`,preferredPayloadType:c.payload,clockRate:c.rate,channels:c.encoding,parameters:{},rtcpFeedback:[]};e.set(d.preferredPayloadType,d)}for(const c of o.fmtp||[]){const d=jc.parseParams(c.config),l=e.get(c.payload);l&&(d&&d.hasOwnProperty("profile-level-id")&&(d["profile-level-id"]=String(d["profile-level-id"])),l.parameters=d)}for(const c of o.rtcpFb||[]){const d={type:c.type,parameter:c.subtype};if(d.parameter||delete d.parameter,c.payload!=="*"){const l=e.get(c.payload);if(!l)continue;l.rtcpFeedback.push(d)}else for(const l of e.values())l.kind===a&&!/.+\/rtx$/i.test(l.mimeType)&&l.rtcpFeedback.push(d)}for(const c of o.ext||[]){if(c["encrypt-uri"])continue;const d={kind:a,uri:c.uri,preferredId:c.value};t.push(d)}}return{codecs:Array.from(e.values()),headerExtensions:t}}Me.extractRtpCapabilities=fp;function hp({sdpObject:r}){const e=(r.media||[]).find(s=>s.iceUfrag&&s.port!==0);if(!e)throw new Error("no active media section found");const t=e.fingerprint||r.fingerprint;let n;switch(e.setup){case"active":n="client";break;case"passive":n="server";break;case"actpass":n="auto";break}return{role:n,fingerprints:[{algorithm:t.type,value:t.hash}]}}Me.extractDtlsParameters=hp;function mp({offerMediaObject:r}){const e=(r.ssrcs||[]).find(t=>t.attribute==="cname");return e?e.value:""}Me.getCname=mp;function gp({offerRtpParameters:r,answerMediaObject:e}){for(const t of r.codecs){const n=t.mimeType.toLowerCase();if(n!=="audio/opus"||!(e.rtp||[]).find(a=>a.payload===t.payloadType))continue;e.fmtp=e.fmtp||[];let s=e.fmtp.find(a=>a.payload===t.payloadType);s||(s={payload:t.payloadType,config:""},e.fmtp.push(s));const o=jc.parseParams(s.config);switch(n){case"audio/opus":{const a=t.parameters["sprop-stereo"];a!==void 0&&(o.stereo=a?1:0);break}}s.config="";for(const a of Object.keys(o))s.config&&(s.config+=";"),s.config+=`${a}=${o[a]}`}}Me.applyCodecParameters=gp;var We={};Object.defineProperty(We,"__esModule",{value:!0});We.addLegacySimulcast=We.getRtpEncodings=void 0;function vp({offerMediaObject:r}){const e=new Set;for(const i of r.ssrcs||[]){const s=i.id;e.add(s)}if(e.size===0)throw new Error("no a=ssrc lines found");const t=new Map;for(const i of r.ssrcGroups||[]){if(i.semantics!=="FID")continue;let[s,o]=i.ssrcs.split(/\s+/);s=Number(s),o=Number(o),e.has(s)&&(e.delete(s),e.delete(o),t.set(s,o))}for(const i of e)t.set(i,null);const n=[];for(const[i,s]of t){const o={ssrc:i};s&&(o.rtx={ssrc:s}),n.push(o)}return n}We.getRtpEncodings=vp;function yp({offerMediaObject:r,numStreams:e}){if(e<=1)throw new TypeError("numStreams must be greater than 1");const t=(r.ssrcs||[]).find(u=>u.attribute==="msid");if(!t)throw new Error("a=ssrc line with msid information not found");const[n,i]=t.value.split(" "),s=t.id;let o;(r.ssrcGroups||[]).some(u=>{if(u.semantics!=="FID")return!1;const p=u.ssrcs.split(/\s+/);return Number(p[0])===s?(o=Number(p[1]),!0):!1});const a=r.ssrcs.find(u=>u.attribute==="cname");if(!a)throw new Error("a=ssrc line with cname information not found");const c=a.value,d=[],l=[];for(let u=0;u<e;++u)d.push(s+u),o&&l.push(o+u);r.ssrcGroups=[],r.ssrcs=[],r.ssrcGroups.push({semantics:"SIM",ssrcs:d.join(" ")});for(let u=0;u<d.length;++u){const p=d[u];r.ssrcs.push({id:p,attribute:"cname",value:c}),r.ssrcs.push({id:p,attribute:"msid",value:`${n} ${i}`})}for(let u=0;u<l.length;++u){const p=d[u],h=l[u];r.ssrcs.push({id:h,attribute:"cname",value:c}),r.ssrcs.push({id:h,attribute:"msid",value:`${n} ${i}`}),r.ssrcGroups.push({semantics:"FID",ssrcs:`${p} ${h}`})}}We.addLegacySimulcast=yp;var At={};Object.defineProperty(At,"__esModule",{value:!0});At.addNackSuppportForOpus=void 0;function _p(r){var e;for(const t of r.codecs||[])(t.mimeType.toLowerCase()==="audio/opus"||t.mimeType.toLowerCase()==="audio/multiopus")&&!((e=t.rtcpFeedback)!=null&&e.some(n=>n.type==="nack"&&!n.parameter))&&(t.rtcpFeedback||(t.rtcpFeedback=[]),t.rtcpFeedback.push({type:"nack"}))}At.addNackSuppportForOpus=_p;var Be={};Object.defineProperty(Be,"__esModule",{value:!0});Be.HandlerInterface=void 0;const wp=lt;class bp extends wp.EnhancedEventEmitter{constructor(){super()}}Be.HandlerInterface=bp;var Ue={},Dt={},Sp=T&&T.__createBinding||(Object.create?function(r,e,t,n){n===void 0&&(n=t);var i=Object.getOwnPropertyDescriptor(e,t);(!i||("get"in i?!e.__esModule:i.writable||i.configurable))&&(i={enumerable:!0,get:function(){return e[t]}}),Object.defineProperty(r,n,i)}:function(r,e,t,n){n===void 0&&(n=t),r[n]=e[t]}),Rp=T&&T.__setModuleDefault||(Object.create?function(r,e){Object.defineProperty(r,"default",{enumerable:!0,value:e})}:function(r,e){r.default=e}),$c=T&&T.__importStar||function(r){if(r&&r.__esModule)return r;var e={};if(r!=null)for(var t in r)t!=="default"&&Object.prototype.hasOwnProperty.call(r,t)&&Sp(e,r,t);return Rp(e,r),e};Object.defineProperty(Dt,"__esModule",{value:!0});Dt.OfferMediaSection=Dt.AnswerMediaSection=Dt.MediaSection=void 0;const Cp=$c(Pe),Bo=$c(Te);class Ms{constructor({iceParameters:e,iceCandidates:t,dtlsParameters:n,planB:i=!1}){if(this._mediaObject={},this._planB=i,e&&this.setIceParameters(e),t){this._mediaObject.candidates=[];for(const s of t){const o={};o.component=1,o.foundation=s.foundation,o.ip=s.ip,o.port=s.port,o.priority=s.priority,o.transport=s.protocol,o.type=s.type,s.tcpType&&(o.tcptype=s.tcpType),this._mediaObject.candidates.push(o)}this._mediaObject.endOfCandidates="end-of-candidates",this._mediaObject.iceOptions="renomination"}n&&this.setDtlsRole(n.role)}get mid(){return String(this._mediaObject.mid)}get closed(){return this._mediaObject.port===0}getObject(){return this._mediaObject}setIceParameters(e){this._mediaObject.iceUfrag=e.usernameFragment,this._mediaObject.icePwd=e.password}pause(){this._mediaObject.direction="inactive"}disable(){this.pause(),delete this._mediaObject.ext,delete this._mediaObject.ssrcs,delete this._mediaObject.ssrcGroups,delete this._mediaObject.simulcast,delete this._mediaObject.simulcast_03,delete this._mediaObject.rids,delete this._mediaObject.extmapAllowMixed}close(){this.disable(),this._mediaObject.port=0}}Dt.MediaSection=Ms;class Ep extends Ms{constructor({iceParameters:e,iceCandidates:t,dtlsParameters:n,sctpParameters:i,plainRtpParameters:s,planB:o=!1,offerMediaObject:a,offerRtpParameters:c,answerRtpParameters:d,codecOptions:l,extmapAllowMixed:u=!1}){switch(super({iceParameters:e,iceCandidates:t,dtlsParameters:n,planB:o}),this._mediaObject.mid=String(a.mid),this._mediaObject.type=a.type,this._mediaObject.protocol=a.protocol,s?(this._mediaObject.connection={ip:s.ip,version:s.ipVersion},this._mediaObject.port=s.port):(this._mediaObject.connection={ip:"127.0.0.1",version:4},this._mediaObject.port=7),a.type){case"audio":case"video":{this._mediaObject.direction="recvonly",this._mediaObject.rtp=[],this._mediaObject.rtcpFb=[],this._mediaObject.fmtp=[];for(const p of d.codecs){const h={payload:p.payloadType,codec:ds(p),rate:p.clockRate};p.channels>1&&(h.encoding=p.channels),this._mediaObject.rtp.push(h);const f=Bo.clone(p.parameters,{});let m=Bo.clone(p.rtcpFeedback,[]);if(l){const{opusStereo:w,opusFec:C,opusDtx:b,opusMaxPlaybackRate:P,opusMaxAverageBitrate:N,opusPtime:$,opusNack:B,videoGoogleStartBitrate:F,videoGoogleMaxBitrate:S,videoGoogleMinBitrate:k}=l,D=c.codecs.find(v=>v.payloadType===p.payloadType);switch(p.mimeType.toLowerCase()){case"audio/opus":case"audio/multiopus":{w!==void 0&&(D.parameters["sprop-stereo"]=w?1:0,f.stereo=w?1:0),C!==void 0&&(D.parameters.useinbandfec=C?1:0,f.useinbandfec=C?1:0),b!==void 0&&(D.parameters.usedtx=b?1:0,f.usedtx=b?1:0),P!==void 0&&(f.maxplaybackrate=P),N!==void 0&&(f.maxaveragebitrate=N),$!==void 0&&(D.parameters.ptime=$,f.ptime=$),B||(D.rtcpFeedback=D.rtcpFeedback.filter(v=>v.type!=="nack"||v.parameter),m=m.filter(v=>v.type!=="nack"||v.parameter));break}case"video/vp8":case"video/vp9":case"video/h264":case"video/h265":{F!==void 0&&(f["x-google-start-bitrate"]=F),S!==void 0&&(f["x-google-max-bitrate"]=S),k!==void 0&&(f["x-google-min-bitrate"]=k);break}}}const g={payload:p.payloadType,config:""};for(const w of Object.keys(f))g.config&&(g.config+=";"),g.config+=`${w}=${f[w]}`;g.config&&this._mediaObject.fmtp.push(g);for(const w of m)this._mediaObject.rtcpFb.push({payload:p.payloadType,type:w.type,subtype:w.parameter})}this._mediaObject.payloads=d.codecs.map(p=>p.payloadType).join(" "),this._mediaObject.ext=[];for(const p of d.headerExtensions)(a.ext||[]).some(f=>f.uri===p.uri)&&this._mediaObject.ext.push({uri:p.uri,value:p.id});if(u&&a.extmapAllowMixed==="extmap-allow-mixed"&&(this._mediaObject.extmapAllowMixed="extmap-allow-mixed"),a.simulcast){this._mediaObject.simulcast={dir1:"recv",list1:a.simulcast.list1},this._mediaObject.rids=[];for(const p of a.rids||[])p.direction==="send"&&this._mediaObject.rids.push({id:p.id,direction:"recv"})}else if(a.simulcast_03){this._mediaObject.simulcast_03={value:a.simulcast_03.value.replace(/send/g,"recv")},this._mediaObject.rids=[];for(const p of a.rids||[])p.direction==="send"&&this._mediaObject.rids.push({id:p.id,direction:"recv"})}this._mediaObject.rtcpMux="rtcp-mux",this._mediaObject.rtcpRsize="rtcp-rsize",this._planB&&this._mediaObject.type==="video"&&(this._mediaObject.xGoogleFlag="conference");break}case"application":{typeof a.sctpPort=="number"?(this._mediaObject.payloads="webrtc-datachannel",this._mediaObject.sctpPort=i.port,this._mediaObject.maxMessageSize=i.maxMessageSize):a.sctpmap&&(this._mediaObject.payloads=i.port,this._mediaObject.sctpmap={app:"webrtc-datachannel",sctpmapNumber:i.port,maxMessageSize:i.maxMessageSize});break}}}setDtlsRole(e){switch(e){case"client":this._mediaObject.setup="active";break;case"server":this._mediaObject.setup="passive";break;case"auto":this._mediaObject.setup="actpass";break}}resume(){this._mediaObject.direction="recvonly"}muxSimulcastStreams(e){var s;if(!this._mediaObject.simulcast||!this._mediaObject.simulcast.list1)return;const t={};for(const o of e)o.rid&&(t[o.rid]=o);const n=this._mediaObject.simulcast.list1,i=Cp.parseSimulcastStreamList(n);for(const o of i)for(const a of o)a.paused=!((s=t[a.scid])!=null&&s.active);this._mediaObject.simulcast.list1=i.map(o=>o.map(a=>`${a.paused?"~":""}${a.scid}`).join(",")).join(";")}}Dt.AnswerMediaSection=Ep;class Tp extends Ms{constructor({iceParameters:e,iceCandidates:t,dtlsParameters:n,sctpParameters:i,plainRtpParameters:s,planB:o=!1,mid:a,kind:c,offerRtpParameters:d,streamId:l,trackId:u,oldDataChannelSpec:p=!1}){switch(super({iceParameters:e,iceCandidates:t,dtlsParameters:n,planB:o}),this._mediaObject.mid=String(a),this._mediaObject.type=c,s?(this._mediaObject.connection={ip:s.ip,version:s.ipVersion},this._mediaObject.protocol="RTP/AVP",this._mediaObject.port=s.port):(this._mediaObject.connection={ip:"127.0.0.1",version:4},i?this._mediaObject.protocol="UDP/DTLS/SCTP":this._mediaObject.protocol="UDP/TLS/RTP/SAVPF",this._mediaObject.port=7),c){case"audio":case"video":{this._mediaObject.direction="sendonly",this._mediaObject.rtp=[],this._mediaObject.rtcpFb=[],this._mediaObject.fmtp=[],this._planB||(this._mediaObject.msid=`${l||"-"} ${u}`);for(const g of d.codecs){const w={payload:g.payloadType,codec:ds(g),rate:g.clockRate};g.channels>1&&(w.encoding=g.channels),this._mediaObject.rtp.push(w);const C={payload:g.payloadType,config:""};for(const b of Object.keys(g.parameters))C.config&&(C.config+=";"),C.config+=`${b}=${g.parameters[b]}`;C.config&&this._mediaObject.fmtp.push(C);for(const b of g.rtcpFeedback)this._mediaObject.rtcpFb.push({payload:g.payloadType,type:b.type,subtype:b.parameter})}this._mediaObject.payloads=d.codecs.map(g=>g.payloadType).join(" "),this._mediaObject.ext=[];for(const g of d.headerExtensions)this._mediaObject.ext.push({uri:g.uri,value:g.id});this._mediaObject.rtcpMux="rtcp-mux",this._mediaObject.rtcpRsize="rtcp-rsize";const h=d.encodings[0],f=h.ssrc,m=h.rtx&&h.rtx.ssrc?h.rtx.ssrc:void 0;this._mediaObject.ssrcs=[],this._mediaObject.ssrcGroups=[],d.rtcp.cname&&this._mediaObject.ssrcs.push({id:f,attribute:"cname",value:d.rtcp.cname}),this._planB&&this._mediaObject.ssrcs.push({id:f,attribute:"msid",value:`${l||"-"} ${u}`}),m&&(d.rtcp.cname&&this._mediaObject.ssrcs.push({id:m,attribute:"cname",value:d.rtcp.cname}),this._planB&&this._mediaObject.ssrcs.push({id:m,attribute:"msid",value:`${l||"-"} ${u}`}),this._mediaObject.ssrcGroups.push({semantics:"FID",ssrcs:`${f} ${m}`}));break}case"application":{p?(this._mediaObject.payloads=i.port,this._mediaObject.sctpmap={app:"webrtc-datachannel",sctpmapNumber:i.port,maxMessageSize:i.maxMessageSize}):(this._mediaObject.payloads="webrtc-datachannel",this._mediaObject.sctpPort=i.port,this._mediaObject.maxMessageSize=i.maxMessageSize);break}}}setDtlsRole(e){this._mediaObject.setup="actpass"}resume(){this._mediaObject.direction="sendonly"}planBReceive({offerRtpParameters:e,streamId:t,trackId:n}){const i=e.encodings[0],s=i.ssrc,o=i.rtx&&i.rtx.ssrc?i.rtx.ssrc:void 0,a=this._mediaObject.payloads.split(" ");for(const c of e.codecs){if(a.includes(String(c.payloadType)))continue;const d={payload:c.payloadType,codec:ds(c),rate:c.clockRate};c.channels>1&&(d.encoding=c.channels),this._mediaObject.rtp.push(d);const l={payload:c.payloadType,config:""};for(const u of Object.keys(c.parameters))l.config&&(l.config+=";"),l.config+=`${u}=${c.parameters[u]}`;l.config&&this._mediaObject.fmtp.push(l);for(const u of c.rtcpFeedback)this._mediaObject.rtcpFb.push({payload:c.payloadType,type:u.type,subtype:u.parameter})}this._mediaObject.payloads+=` ${e.codecs.filter(c=>!this._mediaObject.payloads.includes(c.payloadType)).map(c=>c.payloadType).join(" ")}`,this._mediaObject.payloads=this._mediaObject.payloads.trim(),e.rtcp.cname&&this._mediaObject.ssrcs.push({id:s,attribute:"cname",value:e.rtcp.cname}),this._mediaObject.ssrcs.push({id:s,attribute:"msid",value:`${t||"-"} ${n}`}),o&&(e.rtcp.cname&&this._mediaObject.ssrcs.push({id:o,attribute:"cname",value:e.rtcp.cname}),this._mediaObject.ssrcs.push({id:o,attribute:"msid",value:`${t||"-"} ${n}`}),this._mediaObject.ssrcGroups.push({semantics:"FID",ssrcs:`${s} ${o}`}))}planBStopReceiving({offerRtpParameters:e}){const t=e.encodings[0],n=t.ssrc,i=t.rtx&&t.rtx.ssrc?t.rtx.ssrc:void 0;this._mediaObject.ssrcs=this._mediaObject.ssrcs.filter(s=>s.id!==n&&s.id!==i),i&&(this._mediaObject.ssrcGroups=this._mediaObject.ssrcGroups.filter(s=>s.ssrcs!==`${n} ${i}`))}}Dt.OfferMediaSection=Tp;function ds(r){const t=new RegExp("^(audio|video)/(.+)","i").exec(r.mimeType);if(!t)throw new TypeError("invalid codec.mimeType");return t[2]}var Pp=T&&T.__createBinding||(Object.create?function(r,e,t,n){n===void 0&&(n=t);var i=Object.getOwnPropertyDescriptor(e,t);(!i||("get"in i?!e.__esModule:i.writable||i.configurable))&&(i={enumerable:!0,get:function(){return e[t]}}),Object.defineProperty(r,n,i)}:function(r,e,t,n){n===void 0&&(n=t),r[n]=e[t]}),Dp=T&&T.__setModuleDefault||(Object.create?function(r,e){Object.defineProperty(r,"default",{enumerable:!0,value:e})}:function(r,e){r.default=e}),xp=T&&T.__importStar||function(r){if(r&&r.__esModule)return r;var e={};if(r!=null)for(var t in r)t!=="default"&&Object.prototype.hasOwnProperty.call(r,t)&&Pp(e,r,t);return Dp(e,r),e};Object.defineProperty(Ue,"__esModule",{value:!0});Ue.RemoteSdp=void 0;const Op=xp(Pe),Lp=Ce,gn=Dt,Ni=new Lp.Logger("RemoteSdp");class Ip{constructor({iceParameters:e,iceCandidates:t,dtlsParameters:n,sctpParameters:i,plainRtpParameters:s,planB:o=!1}){if(this._mediaSections=[],this._midToIndex=new Map,this._iceParameters=e,this._iceCandidates=t,this._dtlsParameters=n,this._sctpParameters=i,this._plainRtpParameters=s,this._planB=o,this._sdpObject={version:0,origin:{address:"0.0.0.0",ipVer:4,netType:"IN",sessionId:1e4,sessionVersion:0,username:"mediasoup-client"},name:"-",timing:{start:0,stop:0},media:[]},e&&e.iceLite&&(this._sdpObject.icelite="ice-lite"),n){this._sdpObject.msidSemantic={semantic:"WMS",token:"*"};const a=this._dtlsParameters.fingerprints.length;this._sdpObject.fingerprint={type:n.fingerprints[a-1].algorithm,hash:n.fingerprints[a-1].value},this._sdpObject.groups=[{type:"BUNDLE",mids:""}]}s&&(this._sdpObject.origin.address=s.ip,this._sdpObject.origin.ipVer=s.ipVersion)}updateIceParameters(e){Ni.debug("updateIceParameters() [iceParameters:%o]",e),this._iceParameters=e,this._sdpObject.icelite=e.iceLite?"ice-lite":void 0;for(const t of this._mediaSections)t.setIceParameters(e)}updateDtlsRole(e){Ni.debug("updateDtlsRole() [role:%s]",e),this._dtlsParameters.role=e;for(const t of this._mediaSections)t.setDtlsRole(e)}getNextMediaSectionIdx(){for(let e=0;e<this._mediaSections.length;++e){const t=this._mediaSections[e];if(t.closed)return{idx:e,reuseMid:t.mid}}return{idx:this._mediaSections.length}}send({offerMediaObject:e,reuseMid:t,offerRtpParameters:n,answerRtpParameters:i,codecOptions:s,extmapAllowMixed:o=!1}){const a=new gn.AnswerMediaSection({iceParameters:this._iceParameters,iceCandidates:this._iceCandidates,dtlsParameters:this._dtlsParameters,plainRtpParameters:this._plainRtpParameters,planB:this._planB,offerMediaObject:e,offerRtpParameters:n,answerRtpParameters:i,codecOptions:s,extmapAllowMixed:o});t?this._replaceMediaSection(a,t):this._midToIndex.has(a.mid)?this._replaceMediaSection(a):this._addMediaSection(a)}receive({mid:e,kind:t,offerRtpParameters:n,streamId:i,trackId:s}){const o=this._midToIndex.get(e);let a;if(o!==void 0&&(a=this._mediaSections[o]),a)a.planBReceive({offerRtpParameters:n,streamId:i,trackId:s}),this._replaceMediaSection(a);else{a=new gn.OfferMediaSection({iceParameters:this._iceParameters,iceCandidates:this._iceCandidates,dtlsParameters:this._dtlsParameters,plainRtpParameters:this._plainRtpParameters,planB:this._planB,mid:e,kind:t,offerRtpParameters:n,streamId:i,trackId:s});const c=this._mediaSections.find(d=>d.closed);c?this._replaceMediaSection(a,c.mid):this._addMediaSection(a)}}pauseMediaSection(e){this._findMediaSection(e).pause()}resumeSendingMediaSection(e){this._findMediaSection(e).resume()}resumeReceivingMediaSection(e){this._findMediaSection(e).resume()}disableMediaSection(e){this._findMediaSection(e).disable()}closeMediaSection(e){const t=this._findMediaSection(e);return e===this._firstMid?(Ni.debug("closeMediaSection() | cannot close first media section, disabling it instead [mid:%s]",e),this.disableMediaSection(e),!1):(t.close(),this._regenerateBundleMids(),!0)}muxMediaSectionSimulcast(e,t){const n=this._findMediaSection(e);n.muxSimulcastStreams(t),this._replaceMediaSection(n)}planBStopReceiving({mid:e,offerRtpParameters:t}){const n=this._findMediaSection(e);n.planBStopReceiving({offerRtpParameters:t}),this._replaceMediaSection(n)}sendSctpAssociation({offerMediaObject:e}){const t=new gn.AnswerMediaSection({iceParameters:this._iceParameters,iceCandidates:this._iceCandidates,dtlsParameters:this._dtlsParameters,sctpParameters:this._sctpParameters,plainRtpParameters:this._plainRtpParameters,offerMediaObject:e});this._addMediaSection(t)}receiveSctpAssociation({oldDataChannelSpec:e=!1}={}){const t=new gn.OfferMediaSection({iceParameters:this._iceParameters,iceCandidates:this._iceCandidates,dtlsParameters:this._dtlsParameters,sctpParameters:this._sctpParameters,plainRtpParameters:this._plainRtpParameters,mid:"datachannel",kind:"application",oldDataChannelSpec:e});this._addMediaSection(t)}getSdp(){return this._sdpObject.origin.sessionVersion++,Op.write(this._sdpObject)}_addMediaSection(e){this._firstMid||(this._firstMid=e.mid),this._mediaSections.push(e),this._midToIndex.set(e.mid,this._mediaSections.length-1),this._sdpObject.media.push(e.getObject()),this._regenerateBundleMids()}_replaceMediaSection(e,t){if(typeof t=="string"){const n=this._midToIndex.get(t);if(n===void 0)throw new Error(`no media section found for reuseMid '${t}'`);const i=this._mediaSections[n];this._mediaSections[n]=e,this._midToIndex.delete(i.mid),this._midToIndex.set(e.mid,n),this._sdpObject.media[n]=e.getObject(),this._regenerateBundleMids()}else{const n=this._midToIndex.get(e.mid);if(n===void 0)throw new Error(`no media section found with mid '${e.mid}'`);this._mediaSections[n]=e,this._sdpObject.media[n]=e.getObject()}}_findMediaSection(e){const t=this._midToIndex.get(e);if(t===void 0)throw new Error(`no media section found with mid '${e}'`);return this._mediaSections[t]}_regenerateBundleMids(){this._dtlsParameters&&(this._sdpObject.groups[0].mids=this._mediaSections.filter(e=>!e.closed).map(e=>e.mid).join(" "))}}Ue.RemoteSdp=Ip;var ut={};Object.defineProperty(ut,"__esModule",{value:!0});ut.parse=void 0;const kp=new RegExp("^[LS]([1-9]\\d{0,1})T([1-9]\\d{0,1})");function Mp(r){const e=kp.exec(r||"");return e?{spatialLayers:Number(e[1]),temporalLayers:Number(e[2])}:{spatialLayers:1,temporalLayers:1}}ut.parse=Mp;var Np=T&&T.__createBinding||(Object.create?function(r,e,t,n){n===void 0&&(n=t);var i=Object.getOwnPropertyDescriptor(e,t);(!i||("get"in i?!e.__esModule:i.writable||i.configurable))&&(i={enumerable:!0,get:function(){return e[t]}}),Object.defineProperty(r,n,i)}:function(r,e,t,n){n===void 0&&(n=t),r[n]=e[t]}),Ap=T&&T.__setModuleDefault||(Object.create?function(r,e){Object.defineProperty(r,"default",{enumerable:!0,value:e})}:function(r,e){r.default=e}),yr=T&&T.__importStar||function(r){if(r&&r.__esModule)return r;var e={};if(r!=null)for(var t in r)t!=="default"&&Object.prototype.hasOwnProperty.call(r,t)&&Np(e,r,t);return Ap(e,r),e};Object.defineProperty(ai,"__esModule",{value:!0});ai.Chrome111=void 0;const wt=yr(Pe),jp=Ce,Fo=yr(Te),Wt=yr(z),vn=yr(Me),Uo=yr(We),$p=yr(At),Bp=Ne,Fp=Be,Up=Ue,zp=ut,G=new jp.Logger("Chrome111"),zo={OS:1024,MIS:1024};class Ns extends Fp.HandlerInterface{static createFactory(){return()=>new Ns}constructor(){super(),this._closed=!1,this._mapMidTransceiver=new Map,this._sendStream=new MediaStream,this._hasDataChannelMediaSection=!1,this._nextSendSctpStreamId=0,this._transportReady=!1}get name(){return"Chrome111"}close(){if(G.debug("close()"),!this._closed){if(this._closed=!0,this._pc)try{this._pc.close()}catch{}this.emit("@close")}}async getNativeRtpCapabilities(){G.debug("getNativeRtpCapabilities()");const e=new RTCPeerConnection({iceServers:[],iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"unified-plan"});try{e.addTransceiver("audio"),e.addTransceiver("video");const t=await e.createOffer();try{e.close()}catch{}const n=wt.parse(t.sdp),i=vn.extractRtpCapabilities({sdpObject:n});return $p.addNackSuppportForOpus(i),i}catch(t){try{e.close()}catch{}throw t}}async getNativeSctpCapabilities(){return G.debug("getNativeSctpCapabilities()"),{numStreams:zo}}run({direction:e,iceParameters:t,iceCandidates:n,dtlsParameters:i,sctpParameters:s,iceServers:o,iceTransportPolicy:a,additionalSettings:c,proprietaryConstraints:d,extendedRtpCapabilities:l}){this.assertNotClosed(),G.debug("run()"),this._direction=e,this._remoteSdp=new Up.RemoteSdp({iceParameters:t,iceCandidates:n,dtlsParameters:i,sctpParameters:s}),this._sendingRtpParametersByKind={audio:Wt.getSendingRtpParameters("audio",l),video:Wt.getSendingRtpParameters("video",l)},this._sendingRemoteRtpParametersByKind={audio:Wt.getSendingRemoteRtpParameters("audio",l),video:Wt.getSendingRemoteRtpParameters("video",l)},i.role&&i.role!=="auto"&&(this._forcedLocalDtlsRole=i.role==="server"?"client":"server"),this._pc=new RTCPeerConnection({iceServers:o||[],iceTransportPolicy:a||"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"unified-plan",...c},d),this._pc.addEventListener("icegatheringstatechange",()=>{this.emit("@icegatheringstatechange",this._pc.iceGatheringState)}),this._pc.connectionState?this._pc.addEventListener("connectionstatechange",()=>{this.emit("@connectionstatechange",this._pc.connectionState)}):(G.warn("run() | pc.connectionState not supported, using pc.iceConnectionState"),this._pc.addEventListener("iceconnectionstatechange",()=>{switch(this._pc.iceConnectionState){case"checking":this.emit("@connectionstatechange","connecting");break;case"connected":case"completed":this.emit("@connectionstatechange","connected");break;case"failed":this.emit("@connectionstatechange","failed");break;case"disconnected":this.emit("@connectionstatechange","disconnected");break;case"closed":this.emit("@connectionstatechange","closed");break}}))}async updateIceServers(e){this.assertNotClosed(),G.debug("updateIceServers()");const t=this._pc.getConfiguration();t.iceServers=e,this._pc.setConfiguration(t)}async restartIce(e){if(this.assertNotClosed(),G.debug("restartIce()"),this._remoteSdp.updateIceParameters(e),!!this._transportReady)if(this._direction==="send"){const t=await this._pc.createOffer({iceRestart:!0});G.debug("restartIce() | calling pc.setLocalDescription() [offer:%o]",t),await this._pc.setLocalDescription(t);const n={type:"answer",sdp:this._remoteSdp.getSdp()};G.debug("restartIce() | calling pc.setRemoteDescription() [answer:%o]",n),await this._pc.setRemoteDescription(n)}else{const t={type:"offer",sdp:this._remoteSdp.getSdp()};G.debug("restartIce() | calling pc.setRemoteDescription() [offer:%o]",t),await this._pc.setRemoteDescription(t);const n=await this._pc.createAnswer();G.debug("restartIce() | calling pc.setLocalDescription() [answer:%o]",n),await this._pc.setLocalDescription(n)}}async getTransportStats(){return this.assertNotClosed(),this._pc.getStats()}async send({track:e,encodings:t,codecOptions:n,codec:i}){if(this.assertNotClosed(),this.assertSendDirection(),G.debug("send() [kind:%s, track.id:%s]",e.kind,e.id),t&&t.length>1){t.forEach((g,w)=>{g.rid=`r${w}`});let f=1,m=1;for(const g of t){const w=g.scalabilityMode?(0,zp.parse)(g.scalabilityMode).temporalLayers:3;w>m&&(m=w)}for(const g of t)g.rid=`r${f++}`,g.scalabilityMode=`L1T${m}`}const s=Fo.clone(this._sendingRtpParametersByKind[e.kind],{});s.codecs=Wt.reduceCodecs(s.codecs,i);const o=Fo.clone(this._sendingRemoteRtpParametersByKind[e.kind],{});o.codecs=Wt.reduceCodecs(o.codecs,i);const a=this._remoteSdp.getNextMediaSectionIdx(),c=this._pc.addTransceiver(e,{direction:"sendonly",streams:[this._sendStream],sendEncodings:t}),d=await this._pc.createOffer();let l=wt.parse(d.sdp);this._transportReady||await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:l}),G.debug("send() | calling pc.setLocalDescription() [offer:%o]",d),await this._pc.setLocalDescription(d);const u=c.mid;s.mid=u,l=wt.parse(this._pc.localDescription.sdp);const p=l.media[a.idx];if(s.rtcp.cname=vn.getCname({offerMediaObject:p}),!t)s.encodings=Uo.getRtpEncodings({offerMediaObject:p});else if(t.length===1){const f=Uo.getRtpEncodings({offerMediaObject:p});Object.assign(f[0],t[0]),s.encodings=f}else s.encodings=t;this._remoteSdp.send({offerMediaObject:p,reuseMid:a.reuseMid,offerRtpParameters:s,answerRtpParameters:o,codecOptions:n,extmapAllowMixed:!0});const h={type:"answer",sdp:this._remoteSdp.getSdp()};return G.debug("send() | calling pc.setRemoteDescription() [answer:%o]",h),await this._pc.setRemoteDescription(h),this._mapMidTransceiver.set(u,c),{localId:u,rtpParameters:s,rtpSender:c.sender}}async stopSending(e){if(this.assertSendDirection(),G.debug("stopSending() [localId:%s]",e),this._closed)return;const t=this._mapMidTransceiver.get(e);if(!t)throw new Error("associated RTCRtpTransceiver not found");if(t.sender.replaceTrack(null),this._pc.removeTrack(t.sender),this._remoteSdp.closeMediaSection(t.mid))try{t.stop()}catch{}const i=await this._pc.createOffer();G.debug("stopSending() | calling pc.setLocalDescription() [offer:%o]",i),await this._pc.setLocalDescription(i);const s={type:"answer",sdp:this._remoteSdp.getSdp()};G.debug("stopSending() | calling pc.setRemoteDescription() [answer:%o]",s),await this._pc.setRemoteDescription(s),this._mapMidTransceiver.delete(e)}async pauseSending(e){this.assertNotClosed(),this.assertSendDirection(),G.debug("pauseSending() [localId:%s]",e);const t=this._mapMidTransceiver.get(e);if(!t)throw new Error("associated RTCRtpTransceiver not found");t.direction="inactive",this._remoteSdp.pauseMediaSection(e);const n=await this._pc.createOffer();G.debug("pauseSending() | calling pc.setLocalDescription() [offer:%o]",n),await this._pc.setLocalDescription(n);const i={type:"answer",sdp:this._remoteSdp.getSdp()};G.debug("pauseSending() | calling pc.setRemoteDescription() [answer:%o]",i),await this._pc.setRemoteDescription(i)}async resumeSending(e){this.assertNotClosed(),this.assertSendDirection(),G.debug("resumeSending() [localId:%s]",e);const t=this._mapMidTransceiver.get(e);if(this._remoteSdp.resumeSendingMediaSection(e),!t)throw new Error("associated RTCRtpTransceiver not found");t.direction="sendonly";const n=await this._pc.createOffer();G.debug("resumeSending() | calling pc.setLocalDescription() [offer:%o]",n),await this._pc.setLocalDescription(n);const i={type:"answer",sdp:this._remoteSdp.getSdp()};G.debug("resumeSending() | calling pc.setRemoteDescription() [answer:%o]",i),await this._pc.setRemoteDescription(i)}async replaceTrack(e,t){this.assertNotClosed(),this.assertSendDirection(),t?G.debug("replaceTrack() [localId:%s, track.id:%s]",e,t.id):G.debug("replaceTrack() [localId:%s, no track]",e);const n=this._mapMidTransceiver.get(e);if(!n)throw new Error("associated RTCRtpTransceiver not found");await n.sender.replaceTrack(t)}async setMaxSpatialLayer(e,t){this.assertNotClosed(),this.assertSendDirection(),G.debug("setMaxSpatialLayer() [localId:%s, spatialLayer:%s]",e,t);const n=this._mapMidTransceiver.get(e);if(!n)throw new Error("associated RTCRtpTransceiver not found");const i=n.sender.getParameters();i.encodings.forEach((a,c)=>{c<=t?a.active=!0:a.active=!1}),await n.sender.setParameters(i),this._remoteSdp.muxMediaSectionSimulcast(e,i.encodings);const s=await this._pc.createOffer();G.debug("setMaxSpatialLayer() | calling pc.setLocalDescription() [offer:%o]",s),await this._pc.setLocalDescription(s);const o={type:"answer",sdp:this._remoteSdp.getSdp()};G.debug("setMaxSpatialLayer() | calling pc.setRemoteDescription() [answer:%o]",o),await this._pc.setRemoteDescription(o)}async setRtpEncodingParameters(e,t){this.assertNotClosed(),this.assertSendDirection(),G.debug("setRtpEncodingParameters() [localId:%s, params:%o]",e,t);const n=this._mapMidTransceiver.get(e);if(!n)throw new Error("associated RTCRtpTransceiver not found");const i=n.sender.getParameters();i.encodings.forEach((a,c)=>{i.encodings[c]={...a,...t}}),await n.sender.setParameters(i),this._remoteSdp.muxMediaSectionSimulcast(e,i.encodings);const s=await this._pc.createOffer();G.debug("setRtpEncodingParameters() | calling pc.setLocalDescription() [offer:%o]",s),await this._pc.setLocalDescription(s);const o={type:"answer",sdp:this._remoteSdp.getSdp()};G.debug("setRtpEncodingParameters() | calling pc.setRemoteDescription() [answer:%o]",o),await this._pc.setRemoteDescription(o)}async getSenderStats(e){this.assertNotClosed(),this.assertSendDirection();const t=this._mapMidTransceiver.get(e);if(!t)throw new Error("associated RTCRtpTransceiver not found");return t.sender.getStats()}async sendDataChannel({ordered:e,maxPacketLifeTime:t,maxRetransmits:n,label:i,protocol:s}){this.assertNotClosed(),this.assertSendDirection();const o={negotiated:!0,id:this._nextSendSctpStreamId,ordered:e,maxPacketLifeTime:t,maxRetransmits:n,protocol:s};G.debug("sendDataChannel() [options:%o]",o);const a=this._pc.createDataChannel(i,o);if(this._nextSendSctpStreamId=++this._nextSendSctpStreamId%zo.MIS,!this._hasDataChannelMediaSection){const d=await this._pc.createOffer(),l=wt.parse(d.sdp),u=l.media.find(h=>h.type==="application");this._transportReady||await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:l}),G.debug("sendDataChannel() | calling pc.setLocalDescription() [offer:%o]",d),await this._pc.setLocalDescription(d),this._remoteSdp.sendSctpAssociation({offerMediaObject:u});const p={type:"answer",sdp:this._remoteSdp.getSdp()};G.debug("sendDataChannel() | calling pc.setRemoteDescription() [answer:%o]",p),await this._pc.setRemoteDescription(p),this._hasDataChannelMediaSection=!0}const c={streamId:o.id,ordered:o.ordered,maxPacketLifeTime:o.maxPacketLifeTime,maxRetransmits:o.maxRetransmits};return{dataChannel:a,sctpStreamParameters:c}}async receive(e){this.assertNotClosed(),this.assertRecvDirection();const t=[],n=new Map;for(const a of e){const{trackId:c,kind:d,rtpParameters:l,streamId:u}=a;G.debug("receive() [trackId:%s, kind:%s]",c,d);const p=l.mid||String(this._mapMidTransceiver.size);n.set(c,p),this._remoteSdp.receive({mid:p,kind:d,offerRtpParameters:l,streamId:u||l.rtcp.cname,trackId:c})}const i={type:"offer",sdp:this._remoteSdp.getSdp()};G.debug("receive() | calling pc.setRemoteDescription() [offer:%o]",i),await this._pc.setRemoteDescription(i);let s=await this._pc.createAnswer();const o=wt.parse(s.sdp);for(const a of e){const{trackId:c,rtpParameters:d}=a,l=n.get(c),u=o.media.find(p=>String(p.mid)===l);vn.applyCodecParameters({offerRtpParameters:d,answerMediaObject:u})}s={type:"answer",sdp:wt.write(o)},this._transportReady||await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:o}),G.debug("receive() | calling pc.setLocalDescription() [answer:%o]",s),await this._pc.setLocalDescription(s);for(const a of e){const{trackId:c}=a,d=n.get(c),l=this._pc.getTransceivers().find(u=>u.mid===d);if(l)this._mapMidTransceiver.set(d,l),t.push({localId:d,track:l.receiver.track,rtpReceiver:l.receiver});else throw new Error("new RTCRtpTransceiver not found")}return t}async stopReceiving(e){if(this.assertRecvDirection(),this._closed)return;for(const i of e){G.debug("stopReceiving() [localId:%s]",i);const s=this._mapMidTransceiver.get(i);if(!s)throw new Error("associated RTCRtpTransceiver not found");this._remoteSdp.closeMediaSection(s.mid)}const t={type:"offer",sdp:this._remoteSdp.getSdp()};G.debug("stopReceiving() | calling pc.setRemoteDescription() [offer:%o]",t),await this._pc.setRemoteDescription(t);const n=await this._pc.createAnswer();G.debug("stopReceiving() | calling pc.setLocalDescription() [answer:%o]",n),await this._pc.setLocalDescription(n);for(const i of e)this._mapMidTransceiver.delete(i)}async pauseReceiving(e){this.assertNotClosed(),this.assertRecvDirection();for(const i of e){G.debug("pauseReceiving() [localId:%s]",i);const s=this._mapMidTransceiver.get(i);if(!s)throw new Error("associated RTCRtpTransceiver not found");s.direction="inactive",this._remoteSdp.pauseMediaSection(i)}const t={type:"offer",sdp:this._remoteSdp.getSdp()};G.debug("pauseReceiving() | calling pc.setRemoteDescription() [offer:%o]",t),await this._pc.setRemoteDescription(t);const n=await this._pc.createAnswer();G.debug("pauseReceiving() | calling pc.setLocalDescription() [answer:%o]",n),await this._pc.setLocalDescription(n)}async resumeReceiving(e){this.assertNotClosed(),this.assertRecvDirection();for(const i of e){G.debug("resumeReceiving() [localId:%s]",i);const s=this._mapMidTransceiver.get(i);if(!s)throw new Error("associated RTCRtpTransceiver not found");s.direction="recvonly",this._remoteSdp.resumeReceivingMediaSection(i)}const t={type:"offer",sdp:this._remoteSdp.getSdp()};G.debug("resumeReceiving() | calling pc.setRemoteDescription() [offer:%o]",t),await this._pc.setRemoteDescription(t);const n=await this._pc.createAnswer();G.debug("resumeReceiving() | calling pc.setLocalDescription() [answer:%o]",n),await this._pc.setLocalDescription(n)}async getReceiverStats(e){this.assertNotClosed(),this.assertRecvDirection();const t=this._mapMidTransceiver.get(e);if(!t)throw new Error("associated RTCRtpTransceiver not found");return t.receiver.getStats()}async receiveDataChannel({sctpStreamParameters:e,label:t,protocol:n}){this.assertNotClosed(),this.assertRecvDirection();const{streamId:i,ordered:s,maxPacketLifeTime:o,maxRetransmits:a}=e,c={negotiated:!0,id:i,ordered:s,maxPacketLifeTime:o,maxRetransmits:a,protocol:n};G.debug("receiveDataChannel() [options:%o]",c);const d=this._pc.createDataChannel(t,c);if(!this._hasDataChannelMediaSection){this._remoteSdp.receiveSctpAssociation();const l={type:"offer",sdp:this._remoteSdp.getSdp()};G.debug("receiveDataChannel() | calling pc.setRemoteDescription() [offer:%o]",l),await this._pc.setRemoteDescription(l);const u=await this._pc.createAnswer();if(!this._transportReady){const p=wt.parse(u.sdp);await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:p})}G.debug("receiveDataChannel() | calling pc.setRemoteDescription() [answer:%o]",u),await this._pc.setLocalDescription(u),this._hasDataChannelMediaSection=!0}return{dataChannel:d}}async setupTransport({localDtlsRole:e,localSdpObject:t}){t||(t=wt.parse(this._pc.localDescription.sdp));const n=vn.extractDtlsParameters({sdpObject:t});n.role=e,this._remoteSdp.updateDtlsRole(e==="client"?"server":"client"),await new Promise((i,s)=>{this.safeEmit("@connect",{dtlsParameters:n},i,s)}),this._transportReady=!0}assertNotClosed(){if(this._closed)throw new Bp.InvalidStateError("method called in a closed handler")}assertSendDirection(){if(this._direction!=="send")throw new Error('method can just be called for handlers with "send" direction')}assertRecvDirection(){if(this._direction!=="recv")throw new Error('method can just be called for handlers with "recv" direction')}}ai.Chrome111=Ns;var ci={},Vp=T&&T.__createBinding||(Object.create?function(r,e,t,n){n===void 0&&(n=t);var i=Object.getOwnPropertyDescriptor(e,t);(!i||("get"in i?!e.__esModule:i.writable||i.configurable))&&(i={enumerable:!0,get:function(){return e[t]}}),Object.defineProperty(r,n,i)}:function(r,e,t,n){n===void 0&&(n=t),r[n]=e[t]}),Jp=T&&T.__setModuleDefault||(Object.create?function(r,e){Object.defineProperty(r,"default",{enumerable:!0,value:e})}:function(r,e){r.default=e}),_r=T&&T.__importStar||function(r){if(r&&r.__esModule)return r;var e={};if(r!=null)for(var t in r)t!=="default"&&Object.prototype.hasOwnProperty.call(r,t)&&Vp(e,r,t);return Jp(e,r),e};Object.defineProperty(ci,"__esModule",{value:!0});ci.Chrome74=void 0;const Ze=_r(Pe),qp=Ce,Vo=_r(Te),Kt=_r(z),yn=_r(Me),Ai=_r(We),Gp=_r(At),Hp=Ne,Wp=Be,Kp=Ue,Yp=ut,J=new qp.Logger("Chrome74"),Jo={OS:1024,MIS:1024};class As extends Wp.HandlerInterface{static createFactory(){return()=>new As}constructor(){super(),this._closed=!1,this._mapMidTransceiver=new Map,this._sendStream=new MediaStream,this._hasDataChannelMediaSection=!1,this._nextSendSctpStreamId=0,this._transportReady=!1}get name(){return"Chrome74"}close(){if(J.debug("close()"),!this._closed){if(this._closed=!0,this._pc)try{this._pc.close()}catch{}this.emit("@close")}}async getNativeRtpCapabilities(){J.debug("getNativeRtpCapabilities()");const e=new RTCPeerConnection({iceServers:[],iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"unified-plan"});try{e.addTransceiver("audio"),e.addTransceiver("video");const t=await e.createOffer();try{e.close()}catch{}const n=Ze.parse(t.sdp),i=yn.extractRtpCapabilities({sdpObject:n});return Gp.addNackSuppportForOpus(i),i}catch(t){try{e.close()}catch{}throw t}}async getNativeSctpCapabilities(){return J.debug("getNativeSctpCapabilities()"),{numStreams:Jo}}run({direction:e,iceParameters:t,iceCandidates:n,dtlsParameters:i,sctpParameters:s,iceServers:o,iceTransportPolicy:a,additionalSettings:c,proprietaryConstraints:d,extendedRtpCapabilities:l}){J.debug("run()"),this._direction=e,this._remoteSdp=new Kp.RemoteSdp({iceParameters:t,iceCandidates:n,dtlsParameters:i,sctpParameters:s}),this._sendingRtpParametersByKind={audio:Kt.getSendingRtpParameters("audio",l),video:Kt.getSendingRtpParameters("video",l)},this._sendingRemoteRtpParametersByKind={audio:Kt.getSendingRemoteRtpParameters("audio",l),video:Kt.getSendingRemoteRtpParameters("video",l)},i.role&&i.role!=="auto"&&(this._forcedLocalDtlsRole=i.role==="server"?"client":"server"),this._pc=new RTCPeerConnection({iceServers:o||[],iceTransportPolicy:a||"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"unified-plan",...c},d),this._pc.addEventListener("icegatheringstatechange",()=>{this.emit("@icegatheringstatechange",this._pc.iceGatheringState)}),this._pc.connectionState?this._pc.addEventListener("connectionstatechange",()=>{this.emit("@connectionstatechange",this._pc.connectionState)}):(J.warn("run() | pc.connectionState not supported, using pc.iceConnectionState"),this._pc.addEventListener("iceconnectionstatechange",()=>{switch(this._pc.iceConnectionState){case"checking":this.emit("@connectionstatechange","connecting");break;case"connected":case"completed":this.emit("@connectionstatechange","connected");break;case"failed":this.emit("@connectionstatechange","failed");break;case"disconnected":this.emit("@connectionstatechange","disconnected");break;case"closed":this.emit("@connectionstatechange","closed");break}}))}async updateIceServers(e){this.assertNotClosed(),J.debug("updateIceServers()");const t=this._pc.getConfiguration();t.iceServers=e,this._pc.setConfiguration(t)}async restartIce(e){if(this.assertNotClosed(),J.debug("restartIce()"),this._remoteSdp.updateIceParameters(e),!!this._transportReady)if(this._direction==="send"){const t=await this._pc.createOffer({iceRestart:!0});J.debug("restartIce() | calling pc.setLocalDescription() [offer:%o]",t),await this._pc.setLocalDescription(t);const n={type:"answer",sdp:this._remoteSdp.getSdp()};J.debug("restartIce() | calling pc.setRemoteDescription() [answer:%o]",n),await this._pc.setRemoteDescription(n)}else{const t={type:"offer",sdp:this._remoteSdp.getSdp()};J.debug("restartIce() | calling pc.setRemoteDescription() [offer:%o]",t),await this._pc.setRemoteDescription(t);const n=await this._pc.createAnswer();J.debug("restartIce() | calling pc.setLocalDescription() [answer:%o]",n),await this._pc.setLocalDescription(n)}}async getTransportStats(){return this.assertNotClosed(),this._pc.getStats()}async send({track:e,encodings:t,codecOptions:n,codec:i}){this.assertNotClosed(),this.assertSendDirection(),J.debug("send() [kind:%s, track.id:%s]",e.kind,e.id),t&&t.length>1&&t.forEach((g,w)=>{g.rid=`r${w}`});const s=Vo.clone(this._sendingRtpParametersByKind[e.kind],{});s.codecs=Kt.reduceCodecs(s.codecs,i);const o=Vo.clone(this._sendingRemoteRtpParametersByKind[e.kind],{});o.codecs=Kt.reduceCodecs(o.codecs,i);const a=this._remoteSdp.getNextMediaSectionIdx(),c=this._pc.addTransceiver(e,{direction:"sendonly",streams:[this._sendStream],sendEncodings:t});let d=await this._pc.createOffer(),l=Ze.parse(d.sdp),u;this._transportReady||await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:l});let p=!1;const h=(0,Yp.parse)((t||[{}])[0].scalabilityMode);t&&t.length===1&&h.spatialLayers>1&&s.codecs[0].mimeType.toLowerCase()==="video/vp9"&&(J.debug("send() | enabling legacy simulcast for VP9 SVC"),p=!0,l=Ze.parse(d.sdp),u=l.media[a.idx],Ai.addLegacySimulcast({offerMediaObject:u,numStreams:h.spatialLayers}),d={type:"offer",sdp:Ze.write(l)}),J.debug("send() | calling pc.setLocalDescription() [offer:%o]",d),await this._pc.setLocalDescription(d);const f=c.mid;if(s.mid=f,l=Ze.parse(this._pc.localDescription.sdp),u=l.media[a.idx],s.rtcp.cname=yn.getCname({offerMediaObject:u}),!t)s.encodings=Ai.getRtpEncodings({offerMediaObject:u});else if(t.length===1){let g=Ai.getRtpEncodings({offerMediaObject:u});Object.assign(g[0],t[0]),p&&(g=[g[0]]),s.encodings=g}else s.encodings=t;if(s.encodings.length>1&&(s.codecs[0].mimeType.toLowerCase()==="video/vp8"||s.codecs[0].mimeType.toLowerCase()==="video/h264"))for(const g of s.encodings)g.scalabilityMode?g.scalabilityMode=`L1T${h.temporalLayers}`:g.scalabilityMode="L1T3";this._remoteSdp.send({offerMediaObject:u,reuseMid:a.reuseMid,offerRtpParameters:s,answerRtpParameters:o,codecOptions:n,extmapAllowMixed:!0});const m={type:"answer",sdp:this._remoteSdp.getSdp()};return J.debug("send() | calling pc.setRemoteDescription() [answer:%o]",m),await this._pc.setRemoteDescription(m),this._mapMidTransceiver.set(f,c),{localId:f,rtpParameters:s,rtpSender:c.sender}}async stopSending(e){if(this.assertSendDirection(),J.debug("stopSending() [localId:%s]",e),this._closed)return;const t=this._mapMidTransceiver.get(e);if(!t)throw new Error("associated RTCRtpTransceiver not found");if(t.sender.replaceTrack(null),this._pc.removeTrack(t.sender),this._remoteSdp.closeMediaSection(t.mid))try{t.stop()}catch{}const i=await this._pc.createOffer();J.debug("stopSending() | calling pc.setLocalDescription() [offer:%o]",i),await this._pc.setLocalDescription(i);const s={type:"answer",sdp:this._remoteSdp.getSdp()};J.debug("stopSending() | calling pc.setRemoteDescription() [answer:%o]",s),await this._pc.setRemoteDescription(s),this._mapMidTransceiver.delete(e)}async pauseSending(e){this.assertNotClosed(),this.assertSendDirection(),J.debug("pauseSending() [localId:%s]",e);const t=this._mapMidTransceiver.get(e);if(!t)throw new Error("associated RTCRtpTransceiver not found");t.direction="inactive",this._remoteSdp.pauseMediaSection(e);const n=await this._pc.createOffer();J.debug("pauseSending() | calling pc.setLocalDescription() [offer:%o]",n),await this._pc.setLocalDescription(n);const i={type:"answer",sdp:this._remoteSdp.getSdp()};J.debug("pauseSending() | calling pc.setRemoteDescription() [answer:%o]",i),await this._pc.setRemoteDescription(i)}async resumeSending(e){this.assertNotClosed(),this.assertSendDirection(),J.debug("resumeSending() [localId:%s]",e);const t=this._mapMidTransceiver.get(e);if(this._remoteSdp.resumeSendingMediaSection(e),!t)throw new Error("associated RTCRtpTransceiver not found");t.direction="sendonly";const n=await this._pc.createOffer();J.debug("resumeSending() | calling pc.setLocalDescription() [offer:%o]",n),await this._pc.setLocalDescription(n);const i={type:"answer",sdp:this._remoteSdp.getSdp()};J.debug("resumeSending() | calling pc.setRemoteDescription() [answer:%o]",i),await this._pc.setRemoteDescription(i)}async replaceTrack(e,t){this.assertNotClosed(),this.assertSendDirection(),t?J.debug("replaceTrack() [localId:%s, track.id:%s]",e,t.id):J.debug("replaceTrack() [localId:%s, no track]",e);const n=this._mapMidTransceiver.get(e);if(!n)throw new Error("associated RTCRtpTransceiver not found");await n.sender.replaceTrack(t)}async setMaxSpatialLayer(e,t){this.assertNotClosed(),this.assertSendDirection(),J.debug("setMaxSpatialLayer() [localId:%s, spatialLayer:%s]",e,t);const n=this._mapMidTransceiver.get(e);if(!n)throw new Error("associated RTCRtpTransceiver not found");const i=n.sender.getParameters();i.encodings.forEach((a,c)=>{c<=t?a.active=!0:a.active=!1}),await n.sender.setParameters(i),this._remoteSdp.muxMediaSectionSimulcast(e,i.encodings);const s=await this._pc.createOffer();J.debug("setMaxSpatialLayer() | calling pc.setLocalDescription() [offer:%o]",s),await this._pc.setLocalDescription(s);const o={type:"answer",sdp:this._remoteSdp.getSdp()};J.debug("setMaxSpatialLayer() | calling pc.setRemoteDescription() [answer:%o]",o),await this._pc.setRemoteDescription(o)}async setRtpEncodingParameters(e,t){this.assertNotClosed(),this.assertSendDirection(),J.debug("setRtpEncodingParameters() [localId:%s, params:%o]",e,t);const n=this._mapMidTransceiver.get(e);if(!n)throw new Error("associated RTCRtpTransceiver not found");const i=n.sender.getParameters();i.encodings.forEach((a,c)=>{i.encodings[c]={...a,...t}}),await n.sender.setParameters(i),this._remoteSdp.muxMediaSectionSimulcast(e,i.encodings);const s=await this._pc.createOffer();J.debug("setRtpEncodingParameters() | calling pc.setLocalDescription() [offer:%o]",s),await this._pc.setLocalDescription(s);const o={type:"answer",sdp:this._remoteSdp.getSdp()};J.debug("setRtpEncodingParameters() | calling pc.setRemoteDescription() [answer:%o]",o),await this._pc.setRemoteDescription(o)}async getSenderStats(e){this.assertNotClosed(),this.assertSendDirection();const t=this._mapMidTransceiver.get(e);if(!t)throw new Error("associated RTCRtpTransceiver not found");return t.sender.getStats()}async sendDataChannel({ordered:e,maxPacketLifeTime:t,maxRetransmits:n,label:i,protocol:s}){this.assertNotClosed(),this.assertSendDirection();const o={negotiated:!0,id:this._nextSendSctpStreamId,ordered:e,maxPacketLifeTime:t,maxRetransmits:n,protocol:s};J.debug("sendDataChannel() [options:%o]",o);const a=this._pc.createDataChannel(i,o);if(this._nextSendSctpStreamId=++this._nextSendSctpStreamId%Jo.MIS,!this._hasDataChannelMediaSection){const d=await this._pc.createOffer(),l=Ze.parse(d.sdp),u=l.media.find(h=>h.type==="application");this._transportReady||await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:l}),J.debug("sendDataChannel() | calling pc.setLocalDescription() [offer:%o]",d),await this._pc.setLocalDescription(d),this._remoteSdp.sendSctpAssociation({offerMediaObject:u});const p={type:"answer",sdp:this._remoteSdp.getSdp()};J.debug("sendDataChannel() | calling pc.setRemoteDescription() [answer:%o]",p),await this._pc.setRemoteDescription(p),this._hasDataChannelMediaSection=!0}const c={streamId:o.id,ordered:o.ordered,maxPacketLifeTime:o.maxPacketLifeTime,maxRetransmits:o.maxRetransmits};return{dataChannel:a,sctpStreamParameters:c}}async receive(e){this.assertNotClosed(),this.assertRecvDirection();const t=[],n=new Map;for(const a of e){const{trackId:c,kind:d,rtpParameters:l,streamId:u}=a;J.debug("receive() [trackId:%s, kind:%s]",c,d);const p=l.mid||String(this._mapMidTransceiver.size);n.set(c,p),this._remoteSdp.receive({mid:p,kind:d,offerRtpParameters:l,streamId:u||l.rtcp.cname,trackId:c})}const i={type:"offer",sdp:this._remoteSdp.getSdp()};J.debug("receive() | calling pc.setRemoteDescription() [offer:%o]",i),await this._pc.setRemoteDescription(i);let s=await this._pc.createAnswer();const o=Ze.parse(s.sdp);for(const a of e){const{trackId:c,rtpParameters:d}=a,l=n.get(c),u=o.media.find(p=>String(p.mid)===l);yn.applyCodecParameters({offerRtpParameters:d,answerMediaObject:u})}s={type:"answer",sdp:Ze.write(o)},this._transportReady||await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:o}),J.debug("receive() | calling pc.setLocalDescription() [answer:%o]",s),await this._pc.setLocalDescription(s);for(const a of e){const{trackId:c}=a,d=n.get(c),l=this._pc.getTransceivers().find(u=>u.mid===d);if(l)this._mapMidTransceiver.set(d,l),t.push({localId:d,track:l.receiver.track,rtpReceiver:l.receiver});else throw new Error("new RTCRtpTransceiver not found")}return t}async stopReceiving(e){if(this.assertRecvDirection(),this._closed)return;for(const i of e){J.debug("stopReceiving() [localId:%s]",i);const s=this._mapMidTransceiver.get(i);if(!s)throw new Error("associated RTCRtpTransceiver not found");this._remoteSdp.closeMediaSection(s.mid)}const t={type:"offer",sdp:this._remoteSdp.getSdp()};J.debug("stopReceiving() | calling pc.setRemoteDescription() [offer:%o]",t),await this._pc.setRemoteDescription(t);const n=await this._pc.createAnswer();J.debug("stopReceiving() | calling pc.setLocalDescription() [answer:%o]",n),await this._pc.setLocalDescription(n);for(const i of e)this._mapMidTransceiver.delete(i)}async pauseReceiving(e){this.assertNotClosed(),this.assertRecvDirection();for(const i of e){J.debug("pauseReceiving() [localId:%s]",i);const s=this._mapMidTransceiver.get(i);if(!s)throw new Error("associated RTCRtpTransceiver not found");s.direction="inactive",this._remoteSdp.pauseMediaSection(i)}const t={type:"offer",sdp:this._remoteSdp.getSdp()};J.debug("pauseReceiving() | calling pc.setRemoteDescription() [offer:%o]",t),await this._pc.setRemoteDescription(t);const n=await this._pc.createAnswer();J.debug("pauseReceiving() | calling pc.setLocalDescription() [answer:%o]",n),await this._pc.setLocalDescription(n)}async resumeReceiving(e){this.assertNotClosed(),this.assertRecvDirection();for(const i of e){J.debug("resumeReceiving() [localId:%s]",i);const s=this._mapMidTransceiver.get(i);if(!s)throw new Error("associated RTCRtpTransceiver not found");s.direction="recvonly",this._remoteSdp.resumeReceivingMediaSection(i)}const t={type:"offer",sdp:this._remoteSdp.getSdp()};J.debug("resumeReceiving() | calling pc.setRemoteDescription() [offer:%o]",t),await this._pc.setRemoteDescription(t);const n=await this._pc.createAnswer();J.debug("resumeReceiving() | calling pc.setLocalDescription() [answer:%o]",n),await this._pc.setLocalDescription(n)}async getReceiverStats(e){this.assertNotClosed(),this.assertRecvDirection();const t=this._mapMidTransceiver.get(e);if(!t)throw new Error("associated RTCRtpTransceiver not found");return t.receiver.getStats()}async receiveDataChannel({sctpStreamParameters:e,label:t,protocol:n}){this.assertNotClosed(),this.assertRecvDirection();const{streamId:i,ordered:s,maxPacketLifeTime:o,maxRetransmits:a}=e,c={negotiated:!0,id:i,ordered:s,maxPacketLifeTime:o,maxRetransmits:a,protocol:n};J.debug("receiveDataChannel() [options:%o]",c);const d=this._pc.createDataChannel(t,c);if(!this._hasDataChannelMediaSection){this._remoteSdp.receiveSctpAssociation();const l={type:"offer",sdp:this._remoteSdp.getSdp()};J.debug("receiveDataChannel() | calling pc.setRemoteDescription() [offer:%o]",l),await this._pc.setRemoteDescription(l);const u=await this._pc.createAnswer();if(!this._transportReady){const p=Ze.parse(u.sdp);await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:p})}J.debug("receiveDataChannel() | calling pc.setRemoteDescription() [answer:%o]",u),await this._pc.setLocalDescription(u),this._hasDataChannelMediaSection=!0}return{dataChannel:d}}async setupTransport({localDtlsRole:e,localSdpObject:t}){t||(t=Ze.parse(this._pc.localDescription.sdp));const n=yn.extractDtlsParameters({sdpObject:t});n.role=e,this._remoteSdp.updateDtlsRole(e==="client"?"server":"client"),await new Promise((i,s)=>{this.safeEmit("@connect",{dtlsParameters:n},i,s)}),this._transportReady=!0}assertNotClosed(){if(this._closed)throw new Hp.InvalidStateError("method called in a closed handler")}assertSendDirection(){if(this._direction!=="send")throw new Error('method can just be called for handlers with "send" direction')}assertRecvDirection(){if(this._direction!=="recv")throw new Error('method can just be called for handlers with "recv" direction')}}ci.Chrome74=As;var di={},Qp=T&&T.__createBinding||(Object.create?function(r,e,t,n){n===void 0&&(n=t);var i=Object.getOwnPropertyDescriptor(e,t);(!i||("get"in i?!e.__esModule:i.writable||i.configurable))&&(i={enumerable:!0,get:function(){return e[t]}}),Object.defineProperty(r,n,i)}:function(r,e,t,n){n===void 0&&(n=t),r[n]=e[t]}),Xp=T&&T.__setModuleDefault||(Object.create?function(r,e){Object.defineProperty(r,"default",{enumerable:!0,value:e})}:function(r,e){r.default=e}),Zr=T&&T.__importStar||function(r){if(r&&r.__esModule)return r;var e={};if(r!=null)for(var t in r)t!=="default"&&Object.prototype.hasOwnProperty.call(r,t)&&Qp(e,r,t);return Xp(e,r),e};Object.defineProperty(di,"__esModule",{value:!0});di.Chrome70=void 0;const ze=Zr(Pe),Zp=Ce,qo=Zr(Te),Yt=Zr(z),_n=Zr(Me),ji=Zr(We),ef=Be,tf=Ue,rf=ut,Z=new Zp.Logger("Chrome70"),Go={OS:1024,MIS:1024};class js extends ef.HandlerInterface{static createFactory(){return()=>new js}constructor(){super(),this._mapMidTransceiver=new Map,this._sendStream=new MediaStream,this._hasDataChannelMediaSection=!1,this._nextSendSctpStreamId=0,this._transportReady=!1}get name(){return"Chrome70"}close(){if(Z.debug("close()"),this._pc)try{this._pc.close()}catch{}this.emit("@close")}async getNativeRtpCapabilities(){Z.debug("getNativeRtpCapabilities()");const e=new RTCPeerConnection({iceServers:[],iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"unified-plan"});try{e.addTransceiver("audio"),e.addTransceiver("video");const t=await e.createOffer();try{e.close()}catch{}const n=ze.parse(t.sdp);return _n.extractRtpCapabilities({sdpObject:n})}catch(t){try{e.close()}catch{}throw t}}async getNativeSctpCapabilities(){return Z.debug("getNativeSctpCapabilities()"),{numStreams:Go}}run({direction:e,iceParameters:t,iceCandidates:n,dtlsParameters:i,sctpParameters:s,iceServers:o,iceTransportPolicy:a,additionalSettings:c,proprietaryConstraints:d,extendedRtpCapabilities:l}){Z.debug("run()"),this._direction=e,this._remoteSdp=new tf.RemoteSdp({iceParameters:t,iceCandidates:n,dtlsParameters:i,sctpParameters:s}),this._sendingRtpParametersByKind={audio:Yt.getSendingRtpParameters("audio",l),video:Yt.getSendingRtpParameters("video",l)},this._sendingRemoteRtpParametersByKind={audio:Yt.getSendingRemoteRtpParameters("audio",l),video:Yt.getSendingRemoteRtpParameters("video",l)},i.role&&i.role!=="auto"&&(this._forcedLocalDtlsRole=i.role==="server"?"client":"server"),this._pc=new RTCPeerConnection({iceServers:o||[],iceTransportPolicy:a||"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"unified-plan",...c},d),this._pc.addEventListener("icegatheringstatechange",()=>{this.emit("@icegatheringstatechange",this._pc.iceGatheringState)}),this._pc.connectionState?this._pc.addEventListener("connectionstatechange",()=>{this.emit("@connectionstatechange",this._pc.connectionState)}):this._pc.addEventListener("iceconnectionstatechange",()=>{switch(Z.warn("run() | pc.connectionState not supported, using pc.iceConnectionState"),this._pc.iceConnectionState){case"checking":this.emit("@connectionstatechange","connecting");break;case"connected":case"completed":this.emit("@connectionstatechange","connected");break;case"failed":this.emit("@connectionstatechange","failed");break;case"disconnected":this.emit("@connectionstatechange","disconnected");break;case"closed":this.emit("@connectionstatechange","closed");break}})}async updateIceServers(e){Z.debug("updateIceServers()");const t=this._pc.getConfiguration();t.iceServers=e,this._pc.setConfiguration(t)}async restartIce(e){if(Z.debug("restartIce()"),this._remoteSdp.updateIceParameters(e),!!this._transportReady)if(this._direction==="send"){const t=await this._pc.createOffer({iceRestart:!0});Z.debug("restartIce() | calling pc.setLocalDescription() [offer:%o]",t),await this._pc.setLocalDescription(t);const n={type:"answer",sdp:this._remoteSdp.getSdp()};Z.debug("restartIce() | calling pc.setRemoteDescription() [answer:%o]",n),await this._pc.setRemoteDescription(n)}else{const t={type:"offer",sdp:this._remoteSdp.getSdp()};Z.debug("restartIce() | calling pc.setRemoteDescription() [offer:%o]",t),await this._pc.setRemoteDescription(t);const n=await this._pc.createAnswer();Z.debug("restartIce() | calling pc.setLocalDescription() [answer:%o]",n),await this._pc.setLocalDescription(n)}}async getTransportStats(){return this._pc.getStats()}async send({track:e,encodings:t,codecOptions:n,codec:i}){this.assertSendDirection(),Z.debug("send() [kind:%s, track.id:%s]",e.kind,e.id);const s=qo.clone(this._sendingRtpParametersByKind[e.kind],{});s.codecs=Yt.reduceCodecs(s.codecs,i);const o=qo.clone(this._sendingRemoteRtpParametersByKind[e.kind],{});o.codecs=Yt.reduceCodecs(o.codecs,i);const a=this._remoteSdp.getNextMediaSectionIdx(),c=this._pc.addTransceiver(e,{direction:"sendonly",streams:[this._sendStream]});let d=await this._pc.createOffer(),l=ze.parse(d.sdp),u;this._transportReady||await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:l}),t&&t.length>1&&(Z.debug("send() | enabling legacy simulcast"),l=ze.parse(d.sdp),u=l.media[a.idx],ji.addLegacySimulcast({offerMediaObject:u,numStreams:t.length}),d={type:"offer",sdp:ze.write(l)});let p=!1;const h=(0,rf.parse)((t||[{}])[0].scalabilityMode);if(t&&t.length===1&&h.spatialLayers>1&&s.codecs[0].mimeType.toLowerCase()==="video/vp9"&&(Z.debug("send() | enabling legacy simulcast for VP9 SVC"),p=!0,l=ze.parse(d.sdp),u=l.media[a.idx],ji.addLegacySimulcast({offerMediaObject:u,numStreams:h.spatialLayers}),d={type:"offer",sdp:ze.write(l)}),Z.debug("send() | calling pc.setLocalDescription() [offer:%o]",d),await this._pc.setLocalDescription(d),t){Z.debug("send() | applying given encodings");const g=c.sender.getParameters();for(let w=0;w<(g.encodings||[]).length;++w){const C=g.encodings[w],b=t[w];if(!b)break;g.encodings[w]=Object.assign(C,b)}await c.sender.setParameters(g)}const f=c.mid;if(s.mid=f,l=ze.parse(this._pc.localDescription.sdp),u=l.media[a.idx],s.rtcp.cname=_n.getCname({offerMediaObject:u}),s.encodings=ji.getRtpEncodings({offerMediaObject:u}),t)for(let g=0;g<s.encodings.length;++g)t[g]&&Object.assign(s.encodings[g],t[g]);if(p&&(s.encodings=[s.encodings[0]]),s.encodings.length>1&&(s.codecs[0].mimeType.toLowerCase()==="video/vp8"||s.codecs[0].mimeType.toLowerCase()==="video/h264"))for(const g of s.encodings)g.scalabilityMode="L1T3";this._remoteSdp.send({offerMediaObject:u,reuseMid:a.reuseMid,offerRtpParameters:s,answerRtpParameters:o,codecOptions:n});const m={type:"answer",sdp:this._remoteSdp.getSdp()};return Z.debug("send() | calling pc.setRemoteDescription() [answer:%o]",m),await this._pc.setRemoteDescription(m),this._mapMidTransceiver.set(f,c),{localId:f,rtpParameters:s,rtpSender:c.sender}}async stopSending(e){this.assertSendDirection(),Z.debug("stopSending() [localId:%s]",e);const t=this._mapMidTransceiver.get(e);if(!t)throw new Error("associated RTCRtpTransceiver not found");if(t.sender.replaceTrack(null),this._pc.removeTrack(t.sender),this._remoteSdp.closeMediaSection(t.mid))try{t.stop()}catch{}const i=await this._pc.createOffer();Z.debug("stopSending() | calling pc.setLocalDescription() [offer:%o]",i),await this._pc.setLocalDescription(i);const s={type:"answer",sdp:this._remoteSdp.getSdp()};Z.debug("stopSending() | calling pc.setRemoteDescription() [answer:%o]",s),await this._pc.setRemoteDescription(s),this._mapMidTransceiver.delete(e)}async pauseSending(e){}async resumeSending(e){}async replaceTrack(e,t){this.assertSendDirection(),t?Z.debug("replaceTrack() [localId:%s, track.id:%s]",e,t.id):Z.debug("replaceTrack() [localId:%s, no track]",e);const n=this._mapMidTransceiver.get(e);if(!n)throw new Error("associated RTCRtpTransceiver not found");await n.sender.replaceTrack(t)}async setMaxSpatialLayer(e,t){this.assertSendDirection(),Z.debug("setMaxSpatialLayer() [localId:%s, spatialLayer:%s]",e,t);const n=this._mapMidTransceiver.get(e);if(!n)throw new Error("associated RTCRtpTransceiver not found");const i=n.sender.getParameters();i.encodings.forEach((a,c)=>{c<=t?a.active=!0:a.active=!1}),await n.sender.setParameters(i),this._remoteSdp.muxMediaSectionSimulcast(e,i.encodings);const s=await this._pc.createOffer();Z.debug("setMaxSpatialLayer() | calling pc.setLocalDescription() [offer:%o]",s),await this._pc.setLocalDescription(s);const o={type:"answer",sdp:this._remoteSdp.getSdp()};Z.debug("setMaxSpatialLayer() | calling pc.setRemoteDescription() [answer:%o]",o),await this._pc.setRemoteDescription(o)}async setRtpEncodingParameters(e,t){this.assertSendDirection(),Z.debug("setRtpEncodingParameters() [localId:%s, params:%o]",e,t);const n=this._mapMidTransceiver.get(e);if(!n)throw new Error("associated RTCRtpTransceiver not found");const i=n.sender.getParameters();i.encodings.forEach((a,c)=>{i.encodings[c]={...a,...t}}),await n.sender.setParameters(i),this._remoteSdp.muxMediaSectionSimulcast(e,i.encodings);const s=await this._pc.createOffer();Z.debug("setRtpEncodingParameters() | calling pc.setLocalDescription() [offer:%o]",s),await this._pc.setLocalDescription(s);const o={type:"answer",sdp:this._remoteSdp.getSdp()};Z.debug("setRtpEncodingParameters() | calling pc.setRemoteDescription() [answer:%o]",o),await this._pc.setRemoteDescription(o)}async getSenderStats(e){this.assertSendDirection();const t=this._mapMidTransceiver.get(e);if(!t)throw new Error("associated RTCRtpTransceiver not found");return t.sender.getStats()}async sendDataChannel({ordered:e,maxPacketLifeTime:t,maxRetransmits:n,label:i,protocol:s}){this.assertSendDirection();const o={negotiated:!0,id:this._nextSendSctpStreamId,ordered:e,maxPacketLifeTime:t,maxRetransmitTime:t,maxRetransmits:n,protocol:s};Z.debug("sendDataChannel() [options:%o]",o);const a=this._pc.createDataChannel(i,o);if(this._nextSendSctpStreamId=++this._nextSendSctpStreamId%Go.MIS,!this._hasDataChannelMediaSection){const d=await this._pc.createOffer(),l=ze.parse(d.sdp),u=l.media.find(h=>h.type==="application");this._transportReady||await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:l}),Z.debug("sendDataChannel() | calling pc.setLocalDescription() [offer:%o]",d),await this._pc.setLocalDescription(d),this._remoteSdp.sendSctpAssociation({offerMediaObject:u});const p={type:"answer",sdp:this._remoteSdp.getSdp()};Z.debug("sendDataChannel() | calling pc.setRemoteDescription() [answer:%o]",p),await this._pc.setRemoteDescription(p),this._hasDataChannelMediaSection=!0}const c={streamId:o.id,ordered:o.ordered,maxPacketLifeTime:o.maxPacketLifeTime,maxRetransmits:o.maxRetransmits};return{dataChannel:a,sctpStreamParameters:c}}async receive(e){this.assertRecvDirection();const t=[],n=new Map;for(const a of e){const{trackId:c,kind:d,rtpParameters:l,streamId:u}=a;Z.debug("receive() [trackId:%s, kind:%s]",c,d);const p=l.mid||String(this._mapMidTransceiver.size);n.set(c,p),this._remoteSdp.receive({mid:p,kind:d,offerRtpParameters:l,streamId:u||l.rtcp.cname,trackId:c})}const i={type:"offer",sdp:this._remoteSdp.getSdp()};Z.debug("receive() | calling pc.setRemoteDescription() [offer:%o]",i),await this._pc.setRemoteDescription(i);let s=await this._pc.createAnswer();const o=ze.parse(s.sdp);for(const a of e){const{trackId:c,rtpParameters:d}=a,l=n.get(c),u=o.media.find(p=>String(p.mid)===l);_n.applyCodecParameters({offerRtpParameters:d,answerMediaObject:u})}s={type:"answer",sdp:ze.write(o)},this._transportReady||await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:o}),Z.debug("receive() | calling pc.setLocalDescription() [answer:%o]",s),await this._pc.setLocalDescription(s);for(const a of e){const{trackId:c}=a,d=n.get(c),l=this._pc.getTransceivers().find(u=>u.mid===d);if(!l)throw new Error("new RTCRtpTransceiver not found");this._mapMidTransceiver.set(d,l),t.push({localId:d,track:l.receiver.track,rtpReceiver:l.receiver})}return t}async stopReceiving(e){this.assertRecvDirection();for(const i of e){Z.debug("stopReceiving() [localId:%s]",i);const s=this._mapMidTransceiver.get(i);if(!s)throw new Error("associated RTCRtpTransceiver not found");this._remoteSdp.closeMediaSection(s.mid)}const t={type:"offer",sdp:this._remoteSdp.getSdp()};Z.debug("stopReceiving() | calling pc.setRemoteDescription() [offer:%o]",t),await this._pc.setRemoteDescription(t);const n=await this._pc.createAnswer();Z.debug("stopReceiving() | calling pc.setLocalDescription() [answer:%o]",n),await this._pc.setLocalDescription(n);for(const i of e)this._mapMidTransceiver.delete(i)}async pauseReceiving(e){}async resumeReceiving(e){}async getReceiverStats(e){this.assertRecvDirection();const t=this._mapMidTransceiver.get(e);if(!t)throw new Error("associated RTCRtpTransceiver not found");return t.receiver.getStats()}async receiveDataChannel({sctpStreamParameters:e,label:t,protocol:n}){this.assertRecvDirection();const{streamId:i,ordered:s,maxPacketLifeTime:o,maxRetransmits:a}=e,c={negotiated:!0,id:i,ordered:s,maxPacketLifeTime:o,maxRetransmitTime:o,maxRetransmits:a,protocol:n};Z.debug("receiveDataChannel() [options:%o]",c);const d=this._pc.createDataChannel(t,c);if(!this._hasDataChannelMediaSection){this._remoteSdp.receiveSctpAssociation();const l={type:"offer",sdp:this._remoteSdp.getSdp()};Z.debug("receiveDataChannel() | calling pc.setRemoteDescription() [offer:%o]",l),await this._pc.setRemoteDescription(l);const u=await this._pc.createAnswer();if(!this._transportReady){const p=ze.parse(u.sdp);await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:p})}Z.debug("receiveDataChannel() | calling pc.setRemoteDescription() [answer:%o]",u),await this._pc.setLocalDescription(u),this._hasDataChannelMediaSection=!0}return{dataChannel:d}}async setupTransport({localDtlsRole:e,localSdpObject:t}){t||(t=ze.parse(this._pc.localDescription.sdp));const n=_n.extractDtlsParameters({sdpObject:t});n.role=e,this._remoteSdp.updateDtlsRole(e==="client"?"server":"client"),await new Promise((i,s)=>{this.safeEmit("@connect",{dtlsParameters:n},i,s)}),this._transportReady=!0}assertSendDirection(){if(this._direction!=="send")throw new Error('method can just be called for handlers with "send" direction')}assertRecvDirection(){if(this._direction!=="recv")throw new Error('method can just be called for handlers with "recv" direction')}}di.Chrome70=js;var li={},gt={};Object.defineProperty(gt,"__esModule",{value:!0});gt.addLegacySimulcast=gt.getRtpEncodings=void 0;function nf({offerMediaObject:r,track:e}){const t=new Set;for(const s of r.ssrcs||[]){if(s.attribute!=="msid")continue;if(s.value.split(" ")[1]===e.id){const a=s.id;t.add(a)}}if(t.size===0)throw new Error(`a=ssrc line with msid information not found [track.id:${e.id}]`);const n=new Map;for(const s of r.ssrcGroups||[]){if(s.semantics!=="FID")continue;let[o,a]=s.ssrcs.split(/\s+/);o=Number(o),a=Number(a),t.has(o)&&(t.delete(o),t.delete(a),n.set(o,a))}for(const s of t)n.set(s,null);const i=[];for(const[s,o]of n){const a={ssrc:s};o&&(a.rtx={ssrc:o}),i.push(a)}return i}gt.getRtpEncodings=nf;function sf({offerMediaObject:r,track:e,numStreams:t}){if(t<=1)throw new TypeError("numStreams must be greater than 1");let n,i,s;if(!(r.ssrcs||[]).find(u=>u.attribute!=="msid"?!1:u.value.split(" ")[1]===e.id?(n=u.id,s=u.value.split(" ")[0],!0):!1))throw new Error(`a=ssrc line with msid information not found [track.id:${e.id}]`);(r.ssrcGroups||[]).some(u=>{if(u.semantics!=="FID")return!1;const p=u.ssrcs.split(/\s+/);return Number(p[0])===n?(i=Number(p[1]),!0):!1});const a=r.ssrcs.find(u=>u.attribute==="cname"&&u.id===n);if(!a)throw new Error(`a=ssrc line with cname information not found [track.id:${e.id}]`);const c=a.value,d=[],l=[];for(let u=0;u<t;++u)d.push(n+u),i&&l.push(i+u);r.ssrcGroups=r.ssrcGroups||[],r.ssrcs=r.ssrcs||[],r.ssrcGroups.push({semantics:"SIM",ssrcs:d.join(" ")});for(let u=0;u<d.length;++u){const p=d[u];r.ssrcs.push({id:p,attribute:"cname",value:c}),r.ssrcs.push({id:p,attribute:"msid",value:`${s} ${e.id}`})}for(let u=0;u<l.length;++u){const p=d[u],h=l[u];r.ssrcs.push({id:h,attribute:"cname",value:c}),r.ssrcs.push({id:h,attribute:"msid",value:`${s} ${e.id}`}),r.ssrcGroups.push({semantics:"FID",ssrcs:`${p} ${h}`})}}gt.addLegacySimulcast=sf;var of=T&&T.__createBinding||(Object.create?function(r,e,t,n){n===void 0&&(n=t);var i=Object.getOwnPropertyDescriptor(e,t);(!i||("get"in i?!e.__esModule:i.writable||i.configurable))&&(i={enumerable:!0,get:function(){return e[t]}}),Object.defineProperty(r,n,i)}:function(r,e,t,n){n===void 0&&(n=t),r[n]=e[t]}),af=T&&T.__setModuleDefault||(Object.create?function(r,e){Object.defineProperty(r,"default",{enumerable:!0,value:e})}:function(r,e){r.default=e}),en=T&&T.__importStar||function(r){if(r&&r.__esModule)return r;var e={};if(r!=null)for(var t in r)t!=="default"&&Object.prototype.hasOwnProperty.call(r,t)&&of(e,r,t);return af(e,r),e};Object.defineProperty(li,"__esModule",{value:!0});li.Chrome67=void 0;const et=en(Pe),cf=Ce,Ho=en(Te),Qt=en(z),wn=en(Me),Wo=en(gt),df=Be,lf=Ue,ee=new cf.Logger("Chrome67"),Ko={OS:1024,MIS:1024};class $s extends df.HandlerInterface{static createFactory(){return()=>new $s}constructor(){super(),this._sendStream=new MediaStream,this._mapSendLocalIdRtpSender=new Map,this._nextSendLocalId=0,this._mapRecvLocalIdInfo=new Map,this._hasDataChannelMediaSection=!1,this._nextSendSctpStreamId=0,this._transportReady=!1}get name(){return"Chrome67"}close(){if(ee.debug("close()"),this._pc)try{this._pc.close()}catch{}this.emit("@close")}async getNativeRtpCapabilities(){ee.debug("getNativeRtpCapabilities()");const e=new RTCPeerConnection({iceServers:[],iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"plan-b"});try{const t=await e.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0});try{e.close()}catch{}const n=et.parse(t.sdp);return wn.extractRtpCapabilities({sdpObject:n})}catch(t){try{e.close()}catch{}throw t}}async getNativeSctpCapabilities(){return ee.debug("getNativeSctpCapabilities()"),{numStreams:Ko}}run({direction:e,iceParameters:t,iceCandidates:n,dtlsParameters:i,sctpParameters:s,iceServers:o,iceTransportPolicy:a,additionalSettings:c,proprietaryConstraints:d,extendedRtpCapabilities:l}){ee.debug("run()"),this._direction=e,this._remoteSdp=new lf.RemoteSdp({iceParameters:t,iceCandidates:n,dtlsParameters:i,sctpParameters:s,planB:!0}),this._sendingRtpParametersByKind={audio:Qt.getSendingRtpParameters("audio",l),video:Qt.getSendingRtpParameters("video",l)},this._sendingRemoteRtpParametersByKind={audio:Qt.getSendingRemoteRtpParameters("audio",l),video:Qt.getSendingRemoteRtpParameters("video",l)},i.role&&i.role!=="auto"&&(this._forcedLocalDtlsRole=i.role==="server"?"client":"server"),this._pc=new RTCPeerConnection({iceServers:o||[],iceTransportPolicy:a||"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"plan-b",...c},d),this._pc.addEventListener("icegatheringstatechange",()=>{this.emit("@icegatheringstatechange",this._pc.iceGatheringState)}),this._pc.connectionState?this._pc.addEventListener("connectionstatechange",()=>{this.emit("@connectionstatechange",this._pc.connectionState)}):this._pc.addEventListener("iceconnectionstatechange",()=>{switch(ee.warn("run() | pc.connectionState not supported, using pc.iceConnectionState"),this._pc.iceConnectionState){case"checking":this.emit("@connectionstatechange","connecting");break;case"connected":case"completed":this.emit("@connectionstatechange","connected");break;case"failed":this.emit("@connectionstatechange","failed");break;case"disconnected":this.emit("@connectionstatechange","disconnected");break;case"closed":this.emit("@connectionstatechange","closed");break}})}async updateIceServers(e){ee.debug("updateIceServers()");const t=this._pc.getConfiguration();t.iceServers=e,this._pc.setConfiguration(t)}async restartIce(e){if(ee.debug("restartIce()"),this._remoteSdp.updateIceParameters(e),!!this._transportReady)if(this._direction==="send"){const t=await this._pc.createOffer({iceRestart:!0});ee.debug("restartIce() | calling pc.setLocalDescription() [offer:%o]",t),await this._pc.setLocalDescription(t);const n={type:"answer",sdp:this._remoteSdp.getSdp()};ee.debug("restartIce() | calling pc.setRemoteDescription() [answer:%o]",n),await this._pc.setRemoteDescription(n)}else{const t={type:"offer",sdp:this._remoteSdp.getSdp()};ee.debug("restartIce() | calling pc.setRemoteDescription() [offer:%o]",t),await this._pc.setRemoteDescription(t);const n=await this._pc.createAnswer();ee.debug("restartIce() | calling pc.setLocalDescription() [answer:%o]",n),await this._pc.setLocalDescription(n)}}async getTransportStats(){return this._pc.getStats()}async send({track:e,encodings:t,codecOptions:n,codec:i}){this.assertSendDirection(),ee.debug("send() [kind:%s, track.id:%s]",e.kind,e.id),i&&ee.warn("send() | codec selection is not available in %s handler",this.name),this._sendStream.addTrack(e),this._pc.addTrack(e,this._sendStream);let s=await this._pc.createOffer(),o=et.parse(s.sdp),a;const c=Ho.clone(this._sendingRtpParametersByKind[e.kind],{});c.codecs=Qt.reduceCodecs(c.codecs);const d=Ho.clone(this._sendingRemoteRtpParametersByKind[e.kind],{});if(d.codecs=Qt.reduceCodecs(d.codecs),this._transportReady||await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:o}),e.kind==="video"&&t&&t.length>1&&(ee.debug("send() | enabling simulcast"),o=et.parse(s.sdp),a=o.media.find(h=>h.type==="video"),Wo.addLegacySimulcast({offerMediaObject:a,track:e,numStreams:t.length}),s={type:"offer",sdp:et.write(o)}),ee.debug("send() | calling pc.setLocalDescription() [offer:%o]",s),await this._pc.setLocalDescription(s),o=et.parse(this._pc.localDescription.sdp),a=o.media.find(h=>h.type===e.kind),c.rtcp.cname=wn.getCname({offerMediaObject:a}),c.encodings=Wo.getRtpEncodings({offerMediaObject:a,track:e}),t)for(let h=0;h<c.encodings.length;++h)t[h]&&Object.assign(c.encodings[h],t[h]);if(c.encodings.length>1&&c.codecs[0].mimeType.toLowerCase()==="video/vp8")for(const h of c.encodings)h.scalabilityMode="L1T3";this._remoteSdp.send({offerMediaObject:a,offerRtpParameters:c,answerRtpParameters:d,codecOptions:n});const l={type:"answer",sdp:this._remoteSdp.getSdp()};ee.debug("send() | calling pc.setRemoteDescription() [answer:%o]",l),await this._pc.setRemoteDescription(l);const u=String(this._nextSendLocalId);this._nextSendLocalId++;const p=this._pc.getSenders().find(h=>h.track===e);return this._mapSendLocalIdRtpSender.set(u,p),{localId:u,rtpParameters:c,rtpSender:p}}async stopSending(e){this.assertSendDirection(),ee.debug("stopSending() [localId:%s]",e);const t=this._mapSendLocalIdRtpSender.get(e);if(!t)throw new Error("associated RTCRtpSender not found");this._pc.removeTrack(t),t.track&&this._sendStream.removeTrack(t.track),this._mapSendLocalIdRtpSender.delete(e);const n=await this._pc.createOffer();ee.debug("stopSending() | calling pc.setLocalDescription() [offer:%o]",n);try{await this._pc.setLocalDescription(n)}catch(s){if(this._sendStream.getTracks().length===0){ee.warn("stopSending() | ignoring expected error due no sending tracks: %s",s.toString());return}throw s}if(this._pc.signalingState==="stable")return;const i={type:"answer",sdp:this._remoteSdp.getSdp()};ee.debug("stopSending() | calling pc.setRemoteDescription() [answer:%o]",i),await this._pc.setRemoteDescription(i)}async pauseSending(e){}async resumeSending(e){}async replaceTrack(e,t){this.assertSendDirection(),t?ee.debug("replaceTrack() [localId:%s, track.id:%s]",e,t.id):ee.debug("replaceTrack() [localId:%s, no track]",e);const n=this._mapSendLocalIdRtpSender.get(e);if(!n)throw new Error("associated RTCRtpSender not found");const i=n.track;await n.replaceTrack(t),i&&this._sendStream.removeTrack(i),t&&this._sendStream.addTrack(t)}async setMaxSpatialLayer(e,t){this.assertSendDirection(),ee.debug("setMaxSpatialLayer() [localId:%s, spatialLayer:%s]",e,t);const n=this._mapSendLocalIdRtpSender.get(e);if(!n)throw new Error("associated RTCRtpSender not found");const i=n.getParameters();i.encodings.forEach((s,o)=>{o<=t?s.active=!0:s.active=!1}),await n.setParameters(i)}async setRtpEncodingParameters(e,t){this.assertSendDirection(),ee.debug("setRtpEncodingParameters() [localId:%s, params:%o]",e,t);const n=this._mapSendLocalIdRtpSender.get(e);if(!n)throw new Error("associated RTCRtpSender not found");const i=n.getParameters();i.encodings.forEach((s,o)=>{i.encodings[o]={...s,...t}}),await n.setParameters(i)}async getSenderStats(e){this.assertSendDirection();const t=this._mapSendLocalIdRtpSender.get(e);if(!t)throw new Error("associated RTCRtpSender not found");return t.getStats()}async sendDataChannel({ordered:e,maxPacketLifeTime:t,maxRetransmits:n,label:i,protocol:s}){this.assertSendDirection();const o={negotiated:!0,id:this._nextSendSctpStreamId,ordered:e,maxPacketLifeTime:t,maxRetransmitTime:t,maxRetransmits:n,protocol:s};ee.debug("sendDataChannel() [options:%o]",o);const a=this._pc.createDataChannel(i,o);if(this._nextSendSctpStreamId=++this._nextSendSctpStreamId%Ko.MIS,!this._hasDataChannelMediaSection){const d=await this._pc.createOffer(),l=et.parse(d.sdp),u=l.media.find(h=>h.type==="application");this._transportReady||await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:l}),ee.debug("sendDataChannel() | calling pc.setLocalDescription() [offer:%o]",d),await this._pc.setLocalDescription(d),this._remoteSdp.sendSctpAssociation({offerMediaObject:u});const p={type:"answer",sdp:this._remoteSdp.getSdp()};ee.debug("sendDataChannel() | calling pc.setRemoteDescription() [answer:%o]",p),await this._pc.setRemoteDescription(p),this._hasDataChannelMediaSection=!0}const c={streamId:o.id,ordered:o.ordered,maxPacketLifeTime:o.maxPacketLifeTime,maxRetransmits:o.maxRetransmits};return{dataChannel:a,sctpStreamParameters:c}}async receive(e){this.assertRecvDirection();const t=[];for(const o of e){const{trackId:a,kind:c,rtpParameters:d,streamId:l}=o;ee.debug("receive() [trackId:%s, kind:%s]",a,c);const u=c;this._remoteSdp.receive({mid:u,kind:c,offerRtpParameters:d,streamId:l||d.rtcp.cname,trackId:a})}const n={type:"offer",sdp:this._remoteSdp.getSdp()};ee.debug("receive() | calling pc.setRemoteDescription() [offer:%o]",n),await this._pc.setRemoteDescription(n);let i=await this._pc.createAnswer();const s=et.parse(i.sdp);for(const o of e){const{kind:a,rtpParameters:c}=o,d=a,l=s.media.find(u=>String(u.mid)===d);wn.applyCodecParameters({offerRtpParameters:c,answerMediaObject:l})}i={type:"answer",sdp:et.write(s)},this._transportReady||await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:s}),ee.debug("receive() | calling pc.setLocalDescription() [answer:%o]",i),await this._pc.setLocalDescription(i);for(const o of e){const{kind:a,trackId:c,rtpParameters:d}=o,l=c,u=a,p=this._pc.getReceivers().find(h=>h.track&&h.track.id===l);if(!p)throw new Error("new RTCRtpReceiver not");this._mapRecvLocalIdInfo.set(l,{mid:u,rtpParameters:d,rtpReceiver:p}),t.push({localId:l,track:p.track,rtpReceiver:p})}return t}async stopReceiving(e){this.assertRecvDirection();for(const i of e){ee.debug("stopReceiving() [localId:%s]",i);const{mid:s,rtpParameters:o}=this._mapRecvLocalIdInfo.get(i)||{};this._mapRecvLocalIdInfo.delete(i),this._remoteSdp.planBStopReceiving({mid:s,offerRtpParameters:o})}const t={type:"offer",sdp:this._remoteSdp.getSdp()};ee.debug("stopReceiving() | calling pc.setRemoteDescription() [offer:%o]",t),await this._pc.setRemoteDescription(t);const n=await this._pc.createAnswer();ee.debug("stopReceiving() | calling pc.setLocalDescription() [answer:%o]",n),await this._pc.setLocalDescription(n)}async pauseReceiving(e){}async resumeReceiving(e){}async getReceiverStats(e){this.assertRecvDirection();const{rtpReceiver:t}=this._mapRecvLocalIdInfo.get(e)||{};if(!t)throw new Error("associated RTCRtpReceiver not found");return t.getStats()}async receiveDataChannel({sctpStreamParameters:e,label:t,protocol:n}){this.assertRecvDirection();const{streamId:i,ordered:s,maxPacketLifeTime:o,maxRetransmits:a}=e,c={negotiated:!0,id:i,ordered:s,maxPacketLifeTime:o,maxRetransmitTime:o,maxRetransmits:a,protocol:n};ee.debug("receiveDataChannel() [options:%o]",c);const d=this._pc.createDataChannel(t,c);if(!this._hasDataChannelMediaSection){this._remoteSdp.receiveSctpAssociation({oldDataChannelSpec:!0});const l={type:"offer",sdp:this._remoteSdp.getSdp()};ee.debug("receiveDataChannel() | calling pc.setRemoteDescription() [offer:%o]",l),await this._pc.setRemoteDescription(l);const u=await this._pc.createAnswer();if(!this._transportReady){const p=et.parse(u.sdp);await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:p})}ee.debug("receiveDataChannel() | calling pc.setRemoteDescription() [answer:%o]",u),await this._pc.setLocalDescription(u),this._hasDataChannelMediaSection=!0}return{dataChannel:d}}async setupTransport({localDtlsRole:e,localSdpObject:t}){t||(t=et.parse(this._pc.localDescription.sdp));const n=wn.extractDtlsParameters({sdpObject:t});n.role=e,this._remoteSdp.updateDtlsRole(e==="client"?"server":"client"),await new Promise((i,s)=>{this.safeEmit("@connect",{dtlsParameters:n},i,s)}),this._transportReady=!0}assertSendDirection(){if(this._direction!=="send")throw new Error('method can just be called for handlers with "send" direction')}assertRecvDirection(){if(this._direction!=="recv")throw new Error('method can just be called for handlers with "recv" direction')}}li.Chrome67=$s;var ui={},uf=T&&T.__createBinding||(Object.create?function(r,e,t,n){n===void 0&&(n=t);var i=Object.getOwnPropertyDescriptor(e,t);(!i||("get"in i?!e.__esModule:i.writable||i.configurable))&&(i={enumerable:!0,get:function(){return e[t]}}),Object.defineProperty(r,n,i)}:function(r,e,t,n){n===void 0&&(n=t),r[n]=e[t]}),pf=T&&T.__setModuleDefault||(Object.create?function(r,e){Object.defineProperty(r,"default",{enumerable:!0,value:e})}:function(r,e){r.default=e}),tn=T&&T.__importStar||function(r){if(r&&r.__esModule)return r;var e={};if(r!=null)for(var t in r)t!=="default"&&Object.prototype.hasOwnProperty.call(r,t)&&uf(e,r,t);return pf(e,r),e};Object.defineProperty(ui,"__esModule",{value:!0});ui.Chrome55=void 0;const tt=tn(Pe),ff=Ce,xr=Ne,Yo=tn(Te),Xt=tn(z),bn=tn(Me),Qo=tn(gt),hf=Be,mf=Ue,ce=new ff.Logger("Chrome55"),Xo={OS:1024,MIS:1024};class Bs extends hf.HandlerInterface{static createFactory(){return()=>new Bs}constructor(){super(),this._sendStream=new MediaStream,this._mapSendLocalIdTrack=new Map,this._nextSendLocalId=0,this._mapRecvLocalIdInfo=new Map,this._hasDataChannelMediaSection=!1,this._nextSendSctpStreamId=0,this._transportReady=!1}get name(){return"Chrome55"}close(){if(ce.debug("close()"),this._pc)try{this._pc.close()}catch{}this.emit("@close")}async getNativeRtpCapabilities(){ce.debug("getNativeRtpCapabilities()");const e=new RTCPeerConnection({iceServers:[],iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"plan-b"});try{const t=await e.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0});try{e.close()}catch{}const n=tt.parse(t.sdp);return bn.extractRtpCapabilities({sdpObject:n})}catch(t){try{e.close()}catch{}throw t}}async getNativeSctpCapabilities(){return ce.debug("getNativeSctpCapabilities()"),{numStreams:Xo}}run({direction:e,iceParameters:t,iceCandidates:n,dtlsParameters:i,sctpParameters:s,iceServers:o,iceTransportPolicy:a,additionalSettings:c,proprietaryConstraints:d,extendedRtpCapabilities:l}){ce.debug("run()"),this._direction=e,this._remoteSdp=new mf.RemoteSdp({iceParameters:t,iceCandidates:n,dtlsParameters:i,sctpParameters:s,planB:!0}),this._sendingRtpParametersByKind={audio:Xt.getSendingRtpParameters("audio",l),video:Xt.getSendingRtpParameters("video",l)},this._sendingRemoteRtpParametersByKind={audio:Xt.getSendingRemoteRtpParameters("audio",l),video:Xt.getSendingRemoteRtpParameters("video",l)},i.role&&i.role!=="auto"&&(this._forcedLocalDtlsRole=i.role==="server"?"client":"server"),this._pc=new RTCPeerConnection({iceServers:o||[],iceTransportPolicy:a||"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"plan-b",...c},d),this._pc.addEventListener("icegatheringstatechange",()=>{this.emit("@icegatheringstatechange",this._pc.iceGatheringState)}),this._pc.connectionState?this._pc.addEventListener("connectionstatechange",()=>{this.emit("@connectionstatechange",this._pc.connectionState)}):this._pc.addEventListener("iceconnectionstatechange",()=>{switch(ce.warn("run() | pc.connectionState not supported, using pc.iceConnectionState"),this._pc.iceConnectionState){case"checking":this.emit("@connectionstatechange","connecting");break;case"connected":case"completed":this.emit("@connectionstatechange","connected");break;case"failed":this.emit("@connectionstatechange","failed");break;case"disconnected":this.emit("@connectionstatechange","disconnected");break;case"closed":this.emit("@connectionstatechange","closed");break}})}async updateIceServers(e){ce.debug("updateIceServers()");const t=this._pc.getConfiguration();t.iceServers=e,this._pc.setConfiguration(t)}async restartIce(e){if(ce.debug("restartIce()"),this._remoteSdp.updateIceParameters(e),!!this._transportReady)if(this._direction==="send"){const t=await this._pc.createOffer({iceRestart:!0});ce.debug("restartIce() | calling pc.setLocalDescription() [offer:%o]",t),await this._pc.setLocalDescription(t);const n={type:"answer",sdp:this._remoteSdp.getSdp()};ce.debug("restartIce() | calling pc.setRemoteDescription() [answer:%o]",n),await this._pc.setRemoteDescription(n)}else{const t={type:"offer",sdp:this._remoteSdp.getSdp()};ce.debug("restartIce() | calling pc.setRemoteDescription() [offer:%o]",t),await this._pc.setRemoteDescription(t);const n=await this._pc.createAnswer();ce.debug("restartIce() | calling pc.setLocalDescription() [answer:%o]",n),await this._pc.setLocalDescription(n)}}async getTransportStats(){return this._pc.getStats()}async send({track:e,encodings:t,codecOptions:n,codec:i}){this.assertSendDirection(),ce.debug("send() [kind:%s, track.id:%s]",e.kind,e.id),i&&ce.warn("send() | codec selection is not available in %s handler",this.name),this._sendStream.addTrack(e),this._pc.addStream(this._sendStream);let s=await this._pc.createOffer(),o=tt.parse(s.sdp),a;const c=Yo.clone(this._sendingRtpParametersByKind[e.kind],{});c.codecs=Xt.reduceCodecs(c.codecs);const d=Yo.clone(this._sendingRemoteRtpParametersByKind[e.kind],{});if(d.codecs=Xt.reduceCodecs(d.codecs),this._transportReady||await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:o}),e.kind==="video"&&t&&t.length>1&&(ce.debug("send() | enabling simulcast"),o=tt.parse(s.sdp),a=o.media.find(p=>p.type==="video"),Qo.addLegacySimulcast({offerMediaObject:a,track:e,numStreams:t.length}),s={type:"offer",sdp:tt.write(o)}),ce.debug("send() | calling pc.setLocalDescription() [offer:%o]",s),await this._pc.setLocalDescription(s),o=tt.parse(this._pc.localDescription.sdp),a=o.media.find(p=>p.type===e.kind),c.rtcp.cname=bn.getCname({offerMediaObject:a}),c.encodings=Qo.getRtpEncodings({offerMediaObject:a,track:e}),t)for(let p=0;p<c.encodings.length;++p)t[p]&&Object.assign(c.encodings[p],t[p]);if(c.encodings.length>1&&c.codecs[0].mimeType.toLowerCase()==="video/vp8")for(const p of c.encodings)p.scalabilityMode="L1T3";this._remoteSdp.send({offerMediaObject:a,offerRtpParameters:c,answerRtpParameters:d,codecOptions:n});const l={type:"answer",sdp:this._remoteSdp.getSdp()};ce.debug("send() | calling pc.setRemoteDescription() [answer:%o]",l),await this._pc.setRemoteDescription(l);const u=String(this._nextSendLocalId);return this._nextSendLocalId++,this._mapSendLocalIdTrack.set(u,e),{localId:u,rtpParameters:c}}async stopSending(e){this.assertSendDirection(),ce.debug("stopSending() [localId:%s]",e);const t=this._mapSendLocalIdTrack.get(e);if(!t)throw new Error("track not found");this._mapSendLocalIdTrack.delete(e),this._sendStream.removeTrack(t),this._pc.addStream(this._sendStream);const n=await this._pc.createOffer();ce.debug("stopSending() | calling pc.setLocalDescription() [offer:%o]",n);try{await this._pc.setLocalDescription(n)}catch(s){if(this._sendStream.getTracks().length===0){ce.warn("stopSending() | ignoring expected error due no sending tracks: %s",s.toString());return}throw s}if(this._pc.signalingState==="stable")return;const i={type:"answer",sdp:this._remoteSdp.getSdp()};ce.debug("stopSending() | calling pc.setRemoteDescription() [answer:%o]",i),await this._pc.setRemoteDescription(i)}async pauseSending(e){}async resumeSending(e){}async replaceTrack(e,t){throw new xr.UnsupportedError("not implemented")}async setMaxSpatialLayer(e,t){throw new xr.UnsupportedError(" not implemented")}async setRtpEncodingParameters(e,t){throw new xr.UnsupportedError("not supported")}async getSenderStats(e){throw new xr.UnsupportedError("not implemented")}async sendDataChannel({ordered:e,maxPacketLifeTime:t,maxRetransmits:n,label:i,protocol:s}){this.assertSendDirection();const o={negotiated:!0,id:this._nextSendSctpStreamId,ordered:e,maxPacketLifeTime:t,maxRetransmitTime:t,maxRetransmits:n,protocol:s};ce.debug("sendDataChannel() [options:%o]",o);const a=this._pc.createDataChannel(i,o);if(this._nextSendSctpStreamId=++this._nextSendSctpStreamId%Xo.MIS,!this._hasDataChannelMediaSection){const d=await this._pc.createOffer(),l=tt.parse(d.sdp),u=l.media.find(h=>h.type==="application");this._transportReady||await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:l}),ce.debug("sendDataChannel() | calling pc.setLocalDescription() [offer:%o]",d),await this._pc.setLocalDescription(d),this._remoteSdp.sendSctpAssociation({offerMediaObject:u});const p={type:"answer",sdp:this._remoteSdp.getSdp()};ce.debug("sendDataChannel() | calling pc.setRemoteDescription() [answer:%o]",p),await this._pc.setRemoteDescription(p),this._hasDataChannelMediaSection=!0}const c={streamId:o.id,ordered:o.ordered,maxPacketLifeTime:o.maxPacketLifeTime,maxRetransmits:o.maxRetransmits};return{dataChannel:a,sctpStreamParameters:c}}async receive(e){this.assertRecvDirection();const t=[];for(const o of e){const{trackId:a,kind:c,rtpParameters:d,streamId:l}=o;ce.debug("receive() [trackId:%s, kind:%s]",a,c);const u=c;this._remoteSdp.receive({mid:u,kind:c,offerRtpParameters:d,streamId:l||d.rtcp.cname,trackId:a})}const n={type:"offer",sdp:this._remoteSdp.getSdp()};ce.debug("receive() | calling pc.setRemoteDescription() [offer:%o]",n),await this._pc.setRemoteDescription(n);let i=await this._pc.createAnswer();const s=tt.parse(i.sdp);for(const o of e){const{kind:a,rtpParameters:c}=o,d=a,l=s.media.find(u=>String(u.mid)===d);bn.applyCodecParameters({offerRtpParameters:c,answerMediaObject:l})}i={type:"answer",sdp:tt.write(s)},this._transportReady||await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:s}),ce.debug("receive() | calling pc.setLocalDescription() [answer:%o]",i),await this._pc.setLocalDescription(i);for(const o of e){const{kind:a,trackId:c,rtpParameters:d}=o,l=a,u=c,p=o.streamId||d.rtcp.cname,f=this._pc.getRemoteStreams().find(m=>m.id===p).getTrackById(u);if(!f)throw new Error("remote track not found");this._mapRecvLocalIdInfo.set(u,{mid:l,rtpParameters:d}),t.push({localId:u,track:f})}return t}async stopReceiving(e){this.assertRecvDirection();for(const i of e){ce.debug("stopReceiving() [localId:%s]",i);const{mid:s,rtpParameters:o}=this._mapRecvLocalIdInfo.get(i)||{};this._mapRecvLocalIdInfo.delete(i),this._remoteSdp.planBStopReceiving({mid:s,offerRtpParameters:o})}const t={type:"offer",sdp:this._remoteSdp.getSdp()};ce.debug("stopReceiving() | calling pc.setRemoteDescription() [offer:%o]",t),await this._pc.setRemoteDescription(t);const n=await this._pc.createAnswer();ce.debug("stopReceiving() | calling pc.setLocalDescription() [answer:%o]",n),await this._pc.setLocalDescription(n)}async pauseReceiving(e){}async resumeReceiving(e){}async getReceiverStats(e){throw new xr.UnsupportedError("not implemented")}async receiveDataChannel({sctpStreamParameters:e,label:t,protocol:n}){this.assertRecvDirection();const{streamId:i,ordered:s,maxPacketLifeTime:o,maxRetransmits:a}=e,c={negotiated:!0,id:i,ordered:s,maxPacketLifeTime:o,maxRetransmitTime:o,maxRetransmits:a,protocol:n};ce.debug("receiveDataChannel() [options:%o]",c);const d=this._pc.createDataChannel(t,c);if(!this._hasDataChannelMediaSection){this._remoteSdp.receiveSctpAssociation({oldDataChannelSpec:!0});const l={type:"offer",sdp:this._remoteSdp.getSdp()};ce.debug("receiveDataChannel() | calling pc.setRemoteDescription() [offer:%o]",l),await this._pc.setRemoteDescription(l);const u=await this._pc.createAnswer();if(!this._transportReady){const p=tt.parse(u.sdp);await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:p})}ce.debug("receiveDataChannel() | calling pc.setRemoteDescription() [answer:%o]",u),await this._pc.setLocalDescription(u),this._hasDataChannelMediaSection=!0}return{dataChannel:d}}async setupTransport({localDtlsRole:e,localSdpObject:t}){t||(t=tt.parse(this._pc.localDescription.sdp));const n=bn.extractDtlsParameters({sdpObject:t});n.role=e,this._remoteSdp.updateDtlsRole(e==="client"?"server":"client"),await new Promise((i,s)=>{this.safeEmit("@connect",{dtlsParameters:n},i,s)}),this._transportReady=!0}assertSendDirection(){if(this._direction!=="send")throw new Error('method can just be called for handlers with "send" direction')}assertRecvDirection(){if(this._direction!=="recv")throw new Error('method can just be called for handlers with "recv" direction')}}ui.Chrome55=Bs;var pi={},gf=T&&T.__createBinding||(Object.create?function(r,e,t,n){n===void 0&&(n=t);var i=Object.getOwnPropertyDescriptor(e,t);(!i||("get"in i?!e.__esModule:i.writable||i.configurable))&&(i={enumerable:!0,get:function(){return e[t]}}),Object.defineProperty(r,n,i)}:function(r,e,t,n){n===void 0&&(n=t),r[n]=e[t]}),vf=T&&T.__setModuleDefault||(Object.create?function(r,e){Object.defineProperty(r,"default",{enumerable:!0,value:e})}:function(r,e){r.default=e}),rn=T&&T.__importStar||function(r){if(r&&r.__esModule)return r;var e={};if(r!=null)for(var t in r)t!=="default"&&Object.prototype.hasOwnProperty.call(r,t)&&gf(e,r,t);return vf(e,r),e};Object.defineProperty(pi,"__esModule",{value:!0});pi.Firefox60=void 0;const bt=rn(Pe),yf=Ce,Zo=Ne,$i=rn(Te),Zt=rn(z),Sn=rn(Me),ea=rn(We),_f=Be,wf=Ue,bf=ut,H=new yf.Logger("Firefox60"),ta={OS:16,MIS:2048};class Fs extends _f.HandlerInterface{static createFactory(){return()=>new Fs}constructor(){super(),this._closed=!1,this._mapMidTransceiver=new Map,this._sendStream=new MediaStream,this._hasDataChannelMediaSection=!1,this._nextSendSctpStreamId=0,this._transportReady=!1}get name(){return"Firefox60"}close(){if(H.debug("close()"),!this._closed){if(this._closed=!0,this._pc)try{this._pc.close()}catch{}this.emit("@close")}}async getNativeRtpCapabilities(){H.debug("getNativeRtpCapabilities()");const e=new RTCPeerConnection({iceServers:[],iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require"}),t=document.createElement("canvas");t.getContext("2d");const i=t.captureStream().getVideoTracks()[0];try{e.addTransceiver("audio",{direction:"sendrecv"});const s=e.addTransceiver(i,{direction:"sendrecv"}),o=s.sender.getParameters(),a=[{rid:"r0",maxBitrate:1e5},{rid:"r1",maxBitrate:5e5}];o.encodings=a,await s.sender.setParameters(o);const c=await e.createOffer();try{t.remove()}catch{}try{i.stop()}catch{}try{e.close()}catch{}const d=bt.parse(c.sdp);return Sn.extractRtpCapabilities({sdpObject:d})}catch(s){try{t.remove()}catch{}try{i.stop()}catch{}try{e.close()}catch{}throw s}}async getNativeSctpCapabilities(){return H.debug("getNativeSctpCapabilities()"),{numStreams:ta}}run({direction:e,iceParameters:t,iceCandidates:n,dtlsParameters:i,sctpParameters:s,iceServers:o,iceTransportPolicy:a,additionalSettings:c,proprietaryConstraints:d,extendedRtpCapabilities:l}){this.assertNotClosed(),H.debug("run()"),this._direction=e,this._remoteSdp=new wf.RemoteSdp({iceParameters:t,iceCandidates:n,dtlsParameters:i,sctpParameters:s}),this._sendingRtpParametersByKind={audio:Zt.getSendingRtpParameters("audio",l),video:Zt.getSendingRtpParameters("video",l)},this._sendingRemoteRtpParametersByKind={audio:Zt.getSendingRemoteRtpParameters("audio",l),video:Zt.getSendingRemoteRtpParameters("video",l)},this._pc=new RTCPeerConnection({iceServers:o||[],iceTransportPolicy:a||"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",...c},d),this._pc.addEventListener("icegatheringstatechange",()=>{this.emit("@icegatheringstatechange",this._pc.iceGatheringState)}),this._pc.connectionState?this._pc.addEventListener("connectionstatechange",()=>{this.emit("@connectionstatechange",this._pc.connectionState)}):this._pc.addEventListener("iceconnectionstatechange",()=>{switch(H.warn("run() | pc.connectionState not supported, using pc.iceConnectionState"),this._pc.iceConnectionState){case"checking":this.emit("@connectionstatechange","connecting");break;case"connected":case"completed":this.emit("@connectionstatechange","connected");break;case"failed":this.emit("@connectionstatechange","failed");break;case"disconnected":this.emit("@connectionstatechange","disconnected");break;case"closed":this.emit("@connectionstatechange","closed");break}})}async updateIceServers(e){throw this.assertNotClosed(),new Zo.UnsupportedError("not supported")}async restartIce(e){if(this.assertNotClosed(),H.debug("restartIce()"),this._remoteSdp.updateIceParameters(e),!!this._transportReady)if(this._direction==="send"){const t=await this._pc.createOffer({iceRestart:!0});H.debug("restartIce() | calling pc.setLocalDescription() [offer:%o]",t),await this._pc.setLocalDescription(t);const n={type:"answer",sdp:this._remoteSdp.getSdp()};H.debug("restartIce() | calling pc.setRemoteDescription() [answer:%o]",n),await this._pc.setRemoteDescription(n)}else{const t={type:"offer",sdp:this._remoteSdp.getSdp()};H.debug("restartIce() | calling pc.setRemoteDescription() [offer:%o]",t),await this._pc.setRemoteDescription(t);const n=await this._pc.createAnswer();H.debug("restartIce() | calling pc.setLocalDescription() [answer:%o]",n),await this._pc.setLocalDescription(n)}}async getTransportStats(){return this.assertNotClosed(),this._pc.getStats()}async send({track:e,encodings:t,codecOptions:n,codec:i}){this.assertNotClosed(),this.assertSendDirection(),H.debug("send() [kind:%s, track.id:%s]",e.kind,e.id),t&&(t=$i.clone(t,[]),t.length>1&&(t.forEach((f,m)=>{f.rid=`r${m}`}),t.reverse()));const s=$i.clone(this._sendingRtpParametersByKind[e.kind],{});s.codecs=Zt.reduceCodecs(s.codecs,i);const o=$i.clone(this._sendingRemoteRtpParametersByKind[e.kind],{});o.codecs=Zt.reduceCodecs(o.codecs,i);const a=this._pc.addTransceiver(e,{direction:"sendonly",streams:[this._sendStream]});if(t){const f=a.sender.getParameters();f.encodings=t,await a.sender.setParameters(f)}const c=await this._pc.createOffer();let d=bt.parse(c.sdp);this._transportReady||await this.setupTransport({localDtlsRole:"client",localSdpObject:d});const l=(0,bf.parse)((t||[{}])[0].scalabilityMode);H.debug("send() | calling pc.setLocalDescription() [offer:%o]",c),await this._pc.setLocalDescription(c);const u=a.mid;s.mid=u,d=bt.parse(this._pc.localDescription.sdp);const p=d.media[d.media.length-1];if(s.rtcp.cname=Sn.getCname({offerMediaObject:p}),!t)s.encodings=ea.getRtpEncodings({offerMediaObject:p});else if(t.length===1){const f=ea.getRtpEncodings({offerMediaObject:p});Object.assign(f[0],t[0]),s.encodings=f}else s.encodings=t.reverse();if(s.encodings.length>1&&(s.codecs[0].mimeType.toLowerCase()==="video/vp8"||s.codecs[0].mimeType.toLowerCase()==="video/h264"))for(const f of s.encodings)f.scalabilityMode?f.scalabilityMode=`L1T${l.temporalLayers}`:f.scalabilityMode="L1T3";this._remoteSdp.send({offerMediaObject:p,offerRtpParameters:s,answerRtpParameters:o,codecOptions:n,extmapAllowMixed:!0});const h={type:"answer",sdp:this._remoteSdp.getSdp()};return H.debug("send() | calling pc.setRemoteDescription() [answer:%o]",h),await this._pc.setRemoteDescription(h),this._mapMidTransceiver.set(u,a),{localId:u,rtpParameters:s,rtpSender:a.sender}}async stopSending(e){if(this.assertSendDirection(),H.debug("stopSending() [localId:%s]",e),this._closed)return;const t=this._mapMidTransceiver.get(e);if(!t)throw new Error("associated transceiver not found");t.sender.replaceTrack(null),this._pc.removeTrack(t.sender),this._remoteSdp.disableMediaSection(t.mid);const n=await this._pc.createOffer();H.debug("stopSending() | calling pc.setLocalDescription() [offer:%o]",n),await this._pc.setLocalDescription(n);const i={type:"answer",sdp:this._remoteSdp.getSdp()};H.debug("stopSending() | calling pc.setRemoteDescription() [answer:%o]",i),await this._pc.setRemoteDescription(i),this._mapMidTransceiver.delete(e)}async pauseSending(e){this.assertNotClosed(),this.assertSendDirection(),H.debug("pauseSending() [localId:%s]",e);const t=this._mapMidTransceiver.get(e);if(!t)throw new Error("associated RTCRtpTransceiver not found");t.direction="inactive",this._remoteSdp.pauseMediaSection(e);const n=await this._pc.createOffer();H.debug("pauseSending() | calling pc.setLocalDescription() [offer:%o]",n),await this._pc.setLocalDescription(n);const i={type:"answer",sdp:this._remoteSdp.getSdp()};H.debug("pauseSending() | calling pc.setRemoteDescription() [answer:%o]",i),await this._pc.setRemoteDescription(i)}async resumeSending(e){this.assertNotClosed(),this.assertSendDirection(),H.debug("resumeSending() [localId:%s]",e);const t=this._mapMidTransceiver.get(e);if(!t)throw new Error("associated RTCRtpTransceiver not found");t.direction="sendonly",this._remoteSdp.resumeSendingMediaSection(e);const n=await this._pc.createOffer();H.debug("resumeSending() | calling pc.setLocalDescription() [offer:%o]",n),await this._pc.setLocalDescription(n);const i={type:"answer",sdp:this._remoteSdp.getSdp()};H.debug("resumeSending() | calling pc.setRemoteDescription() [answer:%o]",i),await this._pc.setRemoteDescription(i)}async replaceTrack(e,t){this.assertNotClosed(),this.assertSendDirection(),t?H.debug("replaceTrack() [localId:%s, track.id:%s]",e,t.id):H.debug("replaceTrack() [localId:%s, no track]",e);const n=this._mapMidTransceiver.get(e);if(!n)throw new Error("associated RTCRtpTransceiver not found");await n.sender.replaceTrack(t)}async setMaxSpatialLayer(e,t){this.assertNotClosed(),this.assertSendDirection(),H.debug("setMaxSpatialLayer() [localId:%s, spatialLayer:%s]",e,t);const n=this._mapMidTransceiver.get(e);if(!n)throw new Error("associated transceiver not found");const i=n.sender.getParameters();t=i.encodings.length-1-t,i.encodings.forEach((a,c)=>{c>=t?a.active=!0:a.active=!1}),await n.sender.setParameters(i),this._remoteSdp.muxMediaSectionSimulcast(e,i.encodings);const s=await this._pc.createOffer();H.debug("setMaxSpatialLayer() | calling pc.setLocalDescription() [offer:%o]",s),await this._pc.setLocalDescription(s);const o={type:"answer",sdp:this._remoteSdp.getSdp()};H.debug("setMaxSpatialLayer() | calling pc.setRemoteDescription() [answer:%o]",o),await this._pc.setRemoteDescription(o)}async setRtpEncodingParameters(e,t){this.assertNotClosed(),this.assertSendDirection(),H.debug("setRtpEncodingParameters() [localId:%s, params:%o]",e,t);const n=this._mapMidTransceiver.get(e);if(!n)throw new Error("associated RTCRtpTransceiver not found");const i=n.sender.getParameters();i.encodings.forEach((a,c)=>{i.encodings[c]={...a,...t}}),await n.sender.setParameters(i),this._remoteSdp.muxMediaSectionSimulcast(e,i.encodings);const s=await this._pc.createOffer();H.debug("setRtpEncodingParameters() | calling pc.setLocalDescription() [offer:%o]",s),await this._pc.setLocalDescription(s);const o={type:"answer",sdp:this._remoteSdp.getSdp()};H.debug("setRtpEncodingParameters() | calling pc.setRemoteDescription() [answer:%o]",o),await this._pc.setRemoteDescription(o)}async getSenderStats(e){this.assertNotClosed(),this.assertSendDirection();const t=this._mapMidTransceiver.get(e);if(!t)throw new Error("associated RTCRtpTransceiver not found");return t.sender.getStats()}async sendDataChannel({ordered:e,maxPacketLifeTime:t,maxRetransmits:n,label:i,protocol:s}){this.assertNotClosed(),this.assertSendDirection();const o={negotiated:!0,id:this._nextSendSctpStreamId,ordered:e,maxPacketLifeTime:t,maxRetransmits:n,protocol:s};H.debug("sendDataChannel() [options:%o]",o);const a=this._pc.createDataChannel(i,o);if(this._nextSendSctpStreamId=++this._nextSendSctpStreamId%ta.MIS,!this._hasDataChannelMediaSection){const d=await this._pc.createOffer(),l=bt.parse(d.sdp),u=l.media.find(h=>h.type==="application");this._transportReady||await this.setupTransport({localDtlsRole:"client",localSdpObject:l}),H.debug("sendDataChannel() | calling pc.setLocalDescription() [offer:%o]",d),await this._pc.setLocalDescription(d),this._remoteSdp.sendSctpAssociation({offerMediaObject:u});const p={type:"answer",sdp:this._remoteSdp.getSdp()};H.debug("sendDataChannel() | calling pc.setRemoteDescription() [answer:%o]",p),await this._pc.setRemoteDescription(p),this._hasDataChannelMediaSection=!0}const c={streamId:o.id,ordered:o.ordered,maxPacketLifeTime:o.maxPacketLifeTime,maxRetransmits:o.maxRetransmits};return{dataChannel:a,sctpStreamParameters:c}}async receive(e){this.assertNotClosed(),this.assertRecvDirection();const t=[],n=new Map;for(const a of e){const{trackId:c,kind:d,rtpParameters:l,streamId:u}=a;H.debug("receive() [trackId:%s, kind:%s]",c,d);const p=l.mid||String(this._mapMidTransceiver.size);n.set(c,p),this._remoteSdp.receive({mid:p,kind:d,offerRtpParameters:l,streamId:u||l.rtcp.cname,trackId:c})}const i={type:"offer",sdp:this._remoteSdp.getSdp()};H.debug("receive() | calling pc.setRemoteDescription() [offer:%o]",i),await this._pc.setRemoteDescription(i);let s=await this._pc.createAnswer();const o=bt.parse(s.sdp);for(const a of e){const{trackId:c,rtpParameters:d}=a,l=n.get(c),u=o.media.find(p=>String(p.mid)===l);Sn.applyCodecParameters({offerRtpParameters:d,answerMediaObject:u}),s={type:"answer",sdp:bt.write(o)}}this._transportReady||await this.setupTransport({localDtlsRole:"client",localSdpObject:o}),H.debug("receive() | calling pc.setLocalDescription() [answer:%o]",s),await this._pc.setLocalDescription(s);for(const a of e){const{trackId:c}=a,d=n.get(c),l=this._pc.getTransceivers().find(u=>u.mid===d);if(!l)throw new Error("new RTCRtpTransceiver not found");this._mapMidTransceiver.set(d,l),t.push({localId:d,track:l.receiver.track,rtpReceiver:l.receiver})}return t}async stopReceiving(e){if(this.assertRecvDirection(),this._closed)return;for(const i of e){H.debug("stopReceiving() [localId:%s]",i);const s=this._mapMidTransceiver.get(i);if(!s)throw new Error("associated RTCRtpTransceiver not found");this._remoteSdp.closeMediaSection(s.mid)}const t={type:"offer",sdp:this._remoteSdp.getSdp()};H.debug("stopReceiving() | calling pc.setRemoteDescription() [offer:%o]",t),await this._pc.setRemoteDescription(t);const n=await this._pc.createAnswer();H.debug("stopReceiving() | calling pc.setLocalDescription() [answer:%o]",n),await this._pc.setLocalDescription(n);for(const i of e)this._mapMidTransceiver.delete(i)}async pauseReceiving(e){this.assertNotClosed(),this.assertRecvDirection();for(const i of e){H.debug("pauseReceiving() [localId:%s]",i);const s=this._mapMidTransceiver.get(i);if(!s)throw new Error("associated RTCRtpTransceiver not found");s.direction="inactive",this._remoteSdp.pauseMediaSection(i)}const t={type:"offer",sdp:this._remoteSdp.getSdp()};H.debug("pauseReceiving() | calling pc.setRemoteDescription() [offer:%o]",t),await this._pc.setRemoteDescription(t);const n=await this._pc.createAnswer();H.debug("pauseReceiving() | calling pc.setLocalDescription() [answer:%o]",n),await this._pc.setLocalDescription(n)}async resumeReceiving(e){this.assertNotClosed(),this.assertRecvDirection();for(const i of e){H.debug("resumeReceiving() [localId:%s]",i);const s=this._mapMidTransceiver.get(i);if(!s)throw new Error("associated RTCRtpTransceiver not found");s.direction="recvonly",this._remoteSdp.resumeReceivingMediaSection(i)}const t={type:"offer",sdp:this._remoteSdp.getSdp()};H.debug("resumeReceiving() | calling pc.setRemoteDescription() [offer:%o]",t),await this._pc.setRemoteDescription(t);const n=await this._pc.createAnswer();H.debug("resumeReceiving() | calling pc.setLocalDescription() [answer:%o]",n),await this._pc.setLocalDescription(n)}async getReceiverStats(e){this.assertRecvDirection();const t=this._mapMidTransceiver.get(e);if(!t)throw new Error("associated RTCRtpTransceiver not found");return t.receiver.getStats()}async receiveDataChannel({sctpStreamParameters:e,label:t,protocol:n}){this.assertNotClosed(),this.assertRecvDirection();const{streamId:i,ordered:s,maxPacketLifeTime:o,maxRetransmits:a}=e,c={negotiated:!0,id:i,ordered:s,maxPacketLifeTime:o,maxRetransmits:a,protocol:n};H.debug("receiveDataChannel() [options:%o]",c);const d=this._pc.createDataChannel(t,c);if(!this._hasDataChannelMediaSection){this._remoteSdp.receiveSctpAssociation();const l={type:"offer",sdp:this._remoteSdp.getSdp()};H.debug("receiveDataChannel() | calling pc.setRemoteDescription() [offer:%o]",l),await this._pc.setRemoteDescription(l);const u=await this._pc.createAnswer();if(!this._transportReady){const p=bt.parse(u.sdp);await this.setupTransport({localDtlsRole:"client",localSdpObject:p})}H.debug("receiveDataChannel() | calling pc.setRemoteDescription() [answer:%o]",u),await this._pc.setLocalDescription(u),this._hasDataChannelMediaSection=!0}return{dataChannel:d}}async setupTransport({localDtlsRole:e,localSdpObject:t}){t||(t=bt.parse(this._pc.localDescription.sdp));const n=Sn.extractDtlsParameters({sdpObject:t});n.role=e,this._remoteSdp.updateDtlsRole(e==="client"?"server":"client"),await new Promise((i,s)=>{this.safeEmit("@connect",{dtlsParameters:n},i,s)}),this._transportReady=!0}assertNotClosed(){if(this._closed)throw new Zo.InvalidStateError("method called in a closed handler")}assertSendDirection(){if(this._direction!=="send")throw new Error('method can just be called for handlers with "send" direction')}assertRecvDirection(){if(this._direction!=="recv")throw new Error('method can just be called for handlers with "recv" direction')}}pi.Firefox60=Fs;var fi={},Sf=T&&T.__createBinding||(Object.create?function(r,e,t,n){n===void 0&&(n=t);var i=Object.getOwnPropertyDescriptor(e,t);(!i||("get"in i?!e.__esModule:i.writable||i.configurable))&&(i={enumerable:!0,get:function(){return e[t]}}),Object.defineProperty(r,n,i)}:function(r,e,t,n){n===void 0&&(n=t),r[n]=e[t]}),Rf=T&&T.__setModuleDefault||(Object.create?function(r,e){Object.defineProperty(r,"default",{enumerable:!0,value:e})}:function(r,e){r.default=e}),wr=T&&T.__importStar||function(r){if(r&&r.__esModule)return r;var e={};if(r!=null)for(var t in r)t!=="default"&&Object.prototype.hasOwnProperty.call(r,t)&&Sf(e,r,t);return Rf(e,r),e};Object.defineProperty(fi,"__esModule",{value:!0});fi.Safari12=void 0;const rt=wr(Pe),Cf=Ce,ra=wr(Te),er=wr(z),Rn=wr(Me),na=wr(We),Ef=wr(At),Tf=Ne,Pf=Be,Df=Ue,xf=ut,q=new Cf.Logger("Safari12"),ia={OS:1024,MIS:1024};class Us extends Pf.HandlerInterface{static createFactory(){return()=>new Us}constructor(){super(),this._closed=!1,this._mapMidTransceiver=new Map,this._sendStream=new MediaStream,this._hasDataChannelMediaSection=!1,this._nextSendSctpStreamId=0,this._transportReady=!1}get name(){return"Safari12"}close(){if(q.debug("close()"),!this._closed){if(this._closed=!0,this._pc)try{this._pc.close()}catch{}this.emit("@close")}}async getNativeRtpCapabilities(){q.debug("getNativeRtpCapabilities()");const e=new RTCPeerConnection({iceServers:[],iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require"});try{e.addTransceiver("audio"),e.addTransceiver("video");const t=await e.createOffer();try{e.close()}catch{}const n=rt.parse(t.sdp),i=Rn.extractRtpCapabilities({sdpObject:n});return Ef.addNackSuppportForOpus(i),i}catch(t){try{e.close()}catch{}throw t}}async getNativeSctpCapabilities(){return q.debug("getNativeSctpCapabilities()"),{numStreams:ia}}run({direction:e,iceParameters:t,iceCandidates:n,dtlsParameters:i,sctpParameters:s,iceServers:o,iceTransportPolicy:a,additionalSettings:c,proprietaryConstraints:d,extendedRtpCapabilities:l}){this.assertNotClosed(),q.debug("run()"),this._direction=e,this._remoteSdp=new Df.RemoteSdp({iceParameters:t,iceCandidates:n,dtlsParameters:i,sctpParameters:s}),this._sendingRtpParametersByKind={audio:er.getSendingRtpParameters("audio",l),video:er.getSendingRtpParameters("video",l)},this._sendingRemoteRtpParametersByKind={audio:er.getSendingRemoteRtpParameters("audio",l),video:er.getSendingRemoteRtpParameters("video",l)},i.role&&i.role!=="auto"&&(this._forcedLocalDtlsRole=i.role==="server"?"client":"server"),this._pc=new RTCPeerConnection({iceServers:o||[],iceTransportPolicy:a||"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",...c},d),this._pc.addEventListener("icegatheringstatechange",()=>{this.emit("@icegatheringstatechange",this._pc.iceGatheringState)}),this._pc.connectionState?this._pc.addEventListener("connectionstatechange",()=>{this.emit("@connectionstatechange",this._pc.connectionState)}):this._pc.addEventListener("iceconnectionstatechange",()=>{switch(q.warn("run() | pc.connectionState not supported, using pc.iceConnectionState"),this._pc.iceConnectionState){case"checking":this.emit("@connectionstatechange","connecting");break;case"connected":case"completed":this.emit("@connectionstatechange","connected");break;case"failed":this.emit("@connectionstatechange","failed");break;case"disconnected":this.emit("@connectionstatechange","disconnected");break;case"closed":this.emit("@connectionstatechange","closed");break}})}async updateIceServers(e){this.assertNotClosed(),q.debug("updateIceServers()");const t=this._pc.getConfiguration();t.iceServers=e,this._pc.setConfiguration(t)}async restartIce(e){if(this.assertNotClosed(),q.debug("restartIce()"),this._remoteSdp.updateIceParameters(e),!!this._transportReady)if(this._direction==="send"){const t=await this._pc.createOffer({iceRestart:!0});q.debug("restartIce() | calling pc.setLocalDescription() [offer:%o]",t),await this._pc.setLocalDescription(t);const n={type:"answer",sdp:this._remoteSdp.getSdp()};q.debug("restartIce() | calling pc.setRemoteDescription() [answer:%o]",n),await this._pc.setRemoteDescription(n)}else{const t={type:"offer",sdp:this._remoteSdp.getSdp()};q.debug("restartIce() | calling pc.setRemoteDescription() [offer:%o]",t),await this._pc.setRemoteDescription(t);const n=await this._pc.createAnswer();q.debug("restartIce() | calling pc.setLocalDescription() [answer:%o]",n),await this._pc.setLocalDescription(n)}}async getTransportStats(){return this.assertNotClosed(),this._pc.getStats()}async send({track:e,encodings:t,codecOptions:n,codec:i}){this.assertNotClosed(),this.assertSendDirection(),q.debug("send() [kind:%s, track.id:%s]",e.kind,e.id);const s=ra.clone(this._sendingRtpParametersByKind[e.kind],{});s.codecs=er.reduceCodecs(s.codecs,i);const o=ra.clone(this._sendingRemoteRtpParametersByKind[e.kind],{});o.codecs=er.reduceCodecs(o.codecs,i);const a=this._remoteSdp.getNextMediaSectionIdx(),c=this._pc.addTransceiver(e,{direction:"sendonly",streams:[this._sendStream]});let d=await this._pc.createOffer(),l=rt.parse(d.sdp),u;this._transportReady||await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:l});const p=(0,xf.parse)((t||[{}])[0].scalabilityMode);t&&t.length>1&&(q.debug("send() | enabling legacy simulcast"),l=rt.parse(d.sdp),u=l.media[a.idx],na.addLegacySimulcast({offerMediaObject:u,numStreams:t.length}),d={type:"offer",sdp:rt.write(l)}),q.debug("send() | calling pc.setLocalDescription() [offer:%o]",d),await this._pc.setLocalDescription(d);const h=c.mid;if(s.mid=h,l=rt.parse(this._pc.localDescription.sdp),u=l.media[a.idx],s.rtcp.cname=Rn.getCname({offerMediaObject:u}),s.encodings=na.getRtpEncodings({offerMediaObject:u}),t)for(let m=0;m<s.encodings.length;++m)t[m]&&Object.assign(s.encodings[m],t[m]);if(s.encodings.length>1&&(s.codecs[0].mimeType.toLowerCase()==="video/vp8"||s.codecs[0].mimeType.toLowerCase()==="video/h264"))for(const m of s.encodings)m.scalabilityMode?m.scalabilityMode=`L1T${p.temporalLayers}`:m.scalabilityMode="L1T3";this._remoteSdp.send({offerMediaObject:u,reuseMid:a.reuseMid,offerRtpParameters:s,answerRtpParameters:o,codecOptions:n});const f={type:"answer",sdp:this._remoteSdp.getSdp()};return q.debug("send() | calling pc.setRemoteDescription() [answer:%o]",f),await this._pc.setRemoteDescription(f),this._mapMidTransceiver.set(h,c),{localId:h,rtpParameters:s,rtpSender:c.sender}}async stopSending(e){if(this.assertSendDirection(),this._closed)return;q.debug("stopSending() [localId:%s]",e);const t=this._mapMidTransceiver.get(e);if(!t)throw new Error("associated RTCRtpTransceiver not found");if(t.sender.replaceTrack(null),this._pc.removeTrack(t.sender),this._remoteSdp.closeMediaSection(t.mid))try{t.stop()}catch{}const i=await this._pc.createOffer();q.debug("stopSending() | calling pc.setLocalDescription() [offer:%o]",i),await this._pc.setLocalDescription(i);const s={type:"answer",sdp:this._remoteSdp.getSdp()};q.debug("stopSending() | calling pc.setRemoteDescription() [answer:%o]",s),await this._pc.setRemoteDescription(s),this._mapMidTransceiver.delete(e)}async pauseSending(e){this.assertNotClosed(),this.assertSendDirection(),q.debug("pauseSending() [localId:%s]",e);const t=this._mapMidTransceiver.get(e);if(!t)throw new Error("associated RTCRtpTransceiver not found");t.direction="inactive",this._remoteSdp.pauseMediaSection(e);const n=await this._pc.createOffer();q.debug("pauseSending() | calling pc.setLocalDescription() [offer:%o]",n),await this._pc.setLocalDescription(n);const i={type:"answer",sdp:this._remoteSdp.getSdp()};q.debug("pauseSending() | calling pc.setRemoteDescription() [answer:%o]",i),await this._pc.setRemoteDescription(i)}async resumeSending(e){this.assertNotClosed(),this.assertSendDirection(),q.debug("resumeSending() [localId:%s]",e);const t=this._mapMidTransceiver.get(e);if(!t)throw new Error("associated RTCRtpTransceiver not found");t.direction="sendonly",this._remoteSdp.resumeSendingMediaSection(e);const n=await this._pc.createOffer();q.debug("resumeSending() | calling pc.setLocalDescription() [offer:%o]",n),await this._pc.setLocalDescription(n);const i={type:"answer",sdp:this._remoteSdp.getSdp()};q.debug("resumeSending() | calling pc.setRemoteDescription() [answer:%o]",i),await this._pc.setRemoteDescription(i)}async replaceTrack(e,t){this.assertNotClosed(),this.assertSendDirection(),t?q.debug("replaceTrack() [localId:%s, track.id:%s]",e,t.id):q.debug("replaceTrack() [localId:%s, no track]",e);const n=this._mapMidTransceiver.get(e);if(!n)throw new Error("associated RTCRtpTransceiver not found");await n.sender.replaceTrack(t)}async setMaxSpatialLayer(e,t){this.assertNotClosed(),this.assertSendDirection(),q.debug("setMaxSpatialLayer() [localId:%s, spatialLayer:%s]",e,t);const n=this._mapMidTransceiver.get(e);if(!n)throw new Error("associated RTCRtpTransceiver not found");const i=n.sender.getParameters();i.encodings.forEach((a,c)=>{c<=t?a.active=!0:a.active=!1}),await n.sender.setParameters(i),this._remoteSdp.muxMediaSectionSimulcast(e,i.encodings);const s=await this._pc.createOffer();q.debug("setMaxSpatialLayer() | calling pc.setLocalDescription() [offer:%o]",s),await this._pc.setLocalDescription(s);const o={type:"answer",sdp:this._remoteSdp.getSdp()};q.debug("setMaxSpatialLayer() | calling pc.setRemoteDescription() [answer:%o]",o),await this._pc.setRemoteDescription(o)}async setRtpEncodingParameters(e,t){this.assertNotClosed(),this.assertSendDirection(),q.debug("setRtpEncodingParameters() [localId:%s, params:%o]",e,t);const n=this._mapMidTransceiver.get(e);if(!n)throw new Error("associated RTCRtpTransceiver not found");const i=n.sender.getParameters();i.encodings.forEach((a,c)=>{i.encodings[c]={...a,...t}}),await n.sender.setParameters(i),this._remoteSdp.muxMediaSectionSimulcast(e,i.encodings);const s=await this._pc.createOffer();q.debug("setRtpEncodingParameters() | calling pc.setLocalDescription() [offer:%o]",s),await this._pc.setLocalDescription(s);const o={type:"answer",sdp:this._remoteSdp.getSdp()};q.debug("setRtpEncodingParameters() | calling pc.setRemoteDescription() [answer:%o]",o),await this._pc.setRemoteDescription(o)}async getSenderStats(e){this.assertNotClosed(),this.assertSendDirection();const t=this._mapMidTransceiver.get(e);if(!t)throw new Error("associated RTCRtpTransceiver not found");return t.sender.getStats()}async sendDataChannel({ordered:e,maxPacketLifeTime:t,maxRetransmits:n,label:i,protocol:s}){this.assertNotClosed(),this.assertSendDirection();const o={negotiated:!0,id:this._nextSendSctpStreamId,ordered:e,maxPacketLifeTime:t,maxRetransmits:n,protocol:s};q.debug("sendDataChannel() [options:%o]",o);const a=this._pc.createDataChannel(i,o);if(this._nextSendSctpStreamId=++this._nextSendSctpStreamId%ia.MIS,!this._hasDataChannelMediaSection){const d=await this._pc.createOffer(),l=rt.parse(d.sdp),u=l.media.find(h=>h.type==="application");this._transportReady||await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:l}),q.debug("sendDataChannel() | calling pc.setLocalDescription() [offer:%o]",d),await this._pc.setLocalDescription(d),this._remoteSdp.sendSctpAssociation({offerMediaObject:u});const p={type:"answer",sdp:this._remoteSdp.getSdp()};q.debug("sendDataChannel() | calling pc.setRemoteDescription() [answer:%o]",p),await this._pc.setRemoteDescription(p),this._hasDataChannelMediaSection=!0}const c={streamId:o.id,ordered:o.ordered,maxPacketLifeTime:o.maxPacketLifeTime,maxRetransmits:o.maxRetransmits};return{dataChannel:a,sctpStreamParameters:c}}async receive(e){this.assertNotClosed(),this.assertRecvDirection();const t=[],n=new Map;for(const a of e){const{trackId:c,kind:d,rtpParameters:l,streamId:u}=a;q.debug("receive() [trackId:%s, kind:%s]",c,d);const p=l.mid||String(this._mapMidTransceiver.size);n.set(c,p),this._remoteSdp.receive({mid:p,kind:d,offerRtpParameters:l,streamId:u||l.rtcp.cname,trackId:c})}const i={type:"offer",sdp:this._remoteSdp.getSdp()};q.debug("receive() | calling pc.setRemoteDescription() [offer:%o]",i),await this._pc.setRemoteDescription(i);let s=await this._pc.createAnswer();const o=rt.parse(s.sdp);for(const a of e){const{trackId:c,rtpParameters:d}=a,l=n.get(c),u=o.media.find(p=>String(p.mid)===l);Rn.applyCodecParameters({offerRtpParameters:d,answerMediaObject:u})}s={type:"answer",sdp:rt.write(o)},this._transportReady||await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:o}),q.debug("receive() | calling pc.setLocalDescription() [answer:%o]",s),await this._pc.setLocalDescription(s);for(const a of e){const{trackId:c}=a,d=n.get(c),l=this._pc.getTransceivers().find(u=>u.mid===d);if(!l)throw new Error("new RTCRtpTransceiver not found");this._mapMidTransceiver.set(d,l),t.push({localId:d,track:l.receiver.track,rtpReceiver:l.receiver})}return t}async stopReceiving(e){if(this.assertRecvDirection(),this._closed)return;for(const i of e){q.debug("stopReceiving() [localId:%s]",i);const s=this._mapMidTransceiver.get(i);if(!s)throw new Error("associated RTCRtpTransceiver not found");this._remoteSdp.closeMediaSection(s.mid)}const t={type:"offer",sdp:this._remoteSdp.getSdp()};q.debug("stopReceiving() | calling pc.setRemoteDescription() [offer:%o]",t),await this._pc.setRemoteDescription(t);const n=await this._pc.createAnswer();q.debug("stopReceiving() | calling pc.setLocalDescription() [answer:%o]",n),await this._pc.setLocalDescription(n);for(const i of e)this._mapMidTransceiver.delete(i)}async pauseReceiving(e){this.assertNotClosed(),this.assertRecvDirection();for(const i of e){q.debug("pauseReceiving() [localId:%s]",i);const s=this._mapMidTransceiver.get(i);if(!s)throw new Error("associated RTCRtpTransceiver not found");s.direction="inactive",this._remoteSdp.pauseMediaSection(i)}const t={type:"offer",sdp:this._remoteSdp.getSdp()};q.debug("pauseReceiving() | calling pc.setRemoteDescription() [offer:%o]",t),await this._pc.setRemoteDescription(t);const n=await this._pc.createAnswer();q.debug("pauseReceiving() | calling pc.setLocalDescription() [answer:%o]",n),await this._pc.setLocalDescription(n)}async resumeReceiving(e){this.assertNotClosed(),this.assertRecvDirection();for(const i of e){q.debug("resumeReceiving() [localId:%s]",i);const s=this._mapMidTransceiver.get(i);if(!s)throw new Error("associated RTCRtpTransceiver not found");s.direction="recvonly",this._remoteSdp.resumeReceivingMediaSection(i)}const t={type:"offer",sdp:this._remoteSdp.getSdp()};q.debug("resumeReceiving() | calling pc.setRemoteDescription() [offer:%o]",t),await this._pc.setRemoteDescription(t);const n=await this._pc.createAnswer();q.debug("resumeReceiving() | calling pc.setLocalDescription() [answer:%o]",n),await this._pc.setLocalDescription(n)}async getReceiverStats(e){this.assertNotClosed(),this.assertRecvDirection();const t=this._mapMidTransceiver.get(e);if(!t)throw new Error("associated RTCRtpTransceiver not found");return t.receiver.getStats()}async receiveDataChannel({sctpStreamParameters:e,label:t,protocol:n}){this.assertNotClosed(),this.assertRecvDirection();const{streamId:i,ordered:s,maxPacketLifeTime:o,maxRetransmits:a}=e,c={negotiated:!0,id:i,ordered:s,maxPacketLifeTime:o,maxRetransmits:a,protocol:n};q.debug("receiveDataChannel() [options:%o]",c);const d=this._pc.createDataChannel(t,c);if(!this._hasDataChannelMediaSection){this._remoteSdp.receiveSctpAssociation();const l={type:"offer",sdp:this._remoteSdp.getSdp()};q.debug("receiveDataChannel() | calling pc.setRemoteDescription() [offer:%o]",l),await this._pc.setRemoteDescription(l);const u=await this._pc.createAnswer();if(!this._transportReady){const p=rt.parse(u.sdp);await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:p})}q.debug("receiveDataChannel() | calling pc.setRemoteDescription() [answer:%o]",u),await this._pc.setLocalDescription(u),this._hasDataChannelMediaSection=!0}return{dataChannel:d}}async setupTransport({localDtlsRole:e,localSdpObject:t}){t||(t=rt.parse(this._pc.localDescription.sdp));const n=Rn.extractDtlsParameters({sdpObject:t});n.role=e,this._remoteSdp.updateDtlsRole(e==="client"?"server":"client"),await new Promise((i,s)=>{this.safeEmit("@connect",{dtlsParameters:n},i,s)}),this._transportReady=!0}assertNotClosed(){if(this._closed)throw new Tf.InvalidStateError("method called in a closed handler")}assertSendDirection(){if(this._direction!=="send")throw new Error('method can just be called for handlers with "send" direction')}assertRecvDirection(){if(this._direction!=="recv")throw new Error('method can just be called for handlers with "recv" direction')}}fi.Safari12=Us;var hi={},Of=T&&T.__createBinding||(Object.create?function(r,e,t,n){n===void 0&&(n=t);var i=Object.getOwnPropertyDescriptor(e,t);(!i||("get"in i?!e.__esModule:i.writable||i.configurable))&&(i={enumerable:!0,get:function(){return e[t]}}),Object.defineProperty(r,n,i)}:function(r,e,t,n){n===void 0&&(n=t),r[n]=e[t]}),Lf=T&&T.__setModuleDefault||(Object.create?function(r,e){Object.defineProperty(r,"default",{enumerable:!0,value:e})}:function(r,e){r.default=e}),nn=T&&T.__importStar||function(r){if(r&&r.__esModule)return r;var e={};if(r!=null)for(var t in r)t!=="default"&&Object.prototype.hasOwnProperty.call(r,t)&&Of(e,r,t);return Lf(e,r),e};Object.defineProperty(hi,"__esModule",{value:!0});hi.Safari11=void 0;const nt=nn(Pe),If=Ce,sa=nn(Te),tr=nn(z),Cn=nn(Me),oa=nn(gt),kf=Be,Mf=Ue,re=new If.Logger("Safari11"),aa={OS:1024,MIS:1024};class zs extends kf.HandlerInterface{static createFactory(){return()=>new zs}constructor(){super(),this._sendStream=new MediaStream,this._mapSendLocalIdRtpSender=new Map,this._nextSendLocalId=0,this._mapRecvLocalIdInfo=new Map,this._hasDataChannelMediaSection=!1,this._nextSendSctpStreamId=0,this._transportReady=!1}get name(){return"Safari11"}close(){if(re.debug("close()"),this._pc)try{this._pc.close()}catch{}this.emit("@close")}async getNativeRtpCapabilities(){re.debug("getNativeRtpCapabilities()");const e=new RTCPeerConnection({iceServers:[],iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"plan-b"});try{const t=await e.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0});try{e.close()}catch{}const n=nt.parse(t.sdp);return Cn.extractRtpCapabilities({sdpObject:n})}catch(t){try{e.close()}catch{}throw t}}async getNativeSctpCapabilities(){return re.debug("getNativeSctpCapabilities()"),{numStreams:aa}}run({direction:e,iceParameters:t,iceCandidates:n,dtlsParameters:i,sctpParameters:s,iceServers:o,iceTransportPolicy:a,additionalSettings:c,proprietaryConstraints:d,extendedRtpCapabilities:l}){re.debug("run()"),this._direction=e,this._remoteSdp=new Mf.RemoteSdp({iceParameters:t,iceCandidates:n,dtlsParameters:i,sctpParameters:s,planB:!0}),this._sendingRtpParametersByKind={audio:tr.getSendingRtpParameters("audio",l),video:tr.getSendingRtpParameters("video",l)},this._sendingRemoteRtpParametersByKind={audio:tr.getSendingRemoteRtpParameters("audio",l),video:tr.getSendingRemoteRtpParameters("video",l)},i.role&&i.role!=="auto"&&(this._forcedLocalDtlsRole=i.role==="server"?"client":"server"),this._pc=new RTCPeerConnection({iceServers:o||[],iceTransportPolicy:a||"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",...c},d),this._pc.addEventListener("icegatheringstatechange",()=>{this.emit("@icegatheringstatechange",this._pc.iceGatheringState)}),this._pc.connectionState?this._pc.addEventListener("connectionstatechange",()=>{this.emit("@connectionstatechange",this._pc.connectionState)}):this._pc.addEventListener("iceconnectionstatechange",()=>{switch(re.warn("run() | pc.connectionState not supported, using pc.iceConnectionState"),this._pc.iceConnectionState){case"checking":this.emit("@connectionstatechange","connecting");break;case"connected":case"completed":this.emit("@connectionstatechange","connected");break;case"failed":this.emit("@connectionstatechange","failed");break;case"disconnected":this.emit("@connectionstatechange","disconnected");break;case"closed":this.emit("@connectionstatechange","closed");break}})}async updateIceServers(e){re.debug("updateIceServers()");const t=this._pc.getConfiguration();t.iceServers=e,this._pc.setConfiguration(t)}async restartIce(e){if(re.debug("restartIce()"),this._remoteSdp.updateIceParameters(e),!!this._transportReady)if(this._direction==="send"){const t=await this._pc.createOffer({iceRestart:!0});re.debug("restartIce() | calling pc.setLocalDescription() [offer:%o]",t),await this._pc.setLocalDescription(t);const n={type:"answer",sdp:this._remoteSdp.getSdp()};re.debug("restartIce() | calling pc.setRemoteDescription() [answer:%o]",n),await this._pc.setRemoteDescription(n)}else{const t={type:"offer",sdp:this._remoteSdp.getSdp()};re.debug("restartIce() | calling pc.setRemoteDescription() [offer:%o]",t),await this._pc.setRemoteDescription(t);const n=await this._pc.createAnswer();re.debug("restartIce() | calling pc.setLocalDescription() [answer:%o]",n),await this._pc.setLocalDescription(n)}}async getTransportStats(){return this._pc.getStats()}async send({track:e,encodings:t,codecOptions:n,codec:i}){this.assertSendDirection(),re.debug("send() [kind:%s, track.id:%s]",e.kind,e.id),i&&re.warn("send() | codec selection is not available in %s handler",this.name),this._sendStream.addTrack(e),this._pc.addTrack(e,this._sendStream);let s=await this._pc.createOffer(),o=nt.parse(s.sdp),a;const c=sa.clone(this._sendingRtpParametersByKind[e.kind],{});c.codecs=tr.reduceCodecs(c.codecs);const d=sa.clone(this._sendingRemoteRtpParametersByKind[e.kind],{});if(d.codecs=tr.reduceCodecs(d.codecs),this._transportReady||await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:o}),e.kind==="video"&&t&&t.length>1&&(re.debug("send() | enabling simulcast"),o=nt.parse(s.sdp),a=o.media.find(h=>h.type==="video"),oa.addLegacySimulcast({offerMediaObject:a,track:e,numStreams:t.length}),s={type:"offer",sdp:nt.write(o)}),re.debug("send() | calling pc.setLocalDescription() [offer:%o]",s),await this._pc.setLocalDescription(s),o=nt.parse(this._pc.localDescription.sdp),a=o.media.find(h=>h.type===e.kind),c.rtcp.cname=Cn.getCname({offerMediaObject:a}),c.encodings=oa.getRtpEncodings({offerMediaObject:a,track:e}),t)for(let h=0;h<c.encodings.length;++h)t[h]&&Object.assign(c.encodings[h],t[h]);if(c.encodings.length>1&&c.codecs[0].mimeType.toLowerCase()==="video/vp8")for(const h of c.encodings)h.scalabilityMode="L1T3";this._remoteSdp.send({offerMediaObject:a,offerRtpParameters:c,answerRtpParameters:d,codecOptions:n});const l={type:"answer",sdp:this._remoteSdp.getSdp()};re.debug("send() | calling pc.setRemoteDescription() [answer:%o]",l),await this._pc.setRemoteDescription(l);const u=String(this._nextSendLocalId);this._nextSendLocalId++;const p=this._pc.getSenders().find(h=>h.track===e);return this._mapSendLocalIdRtpSender.set(u,p),{localId:u,rtpParameters:c,rtpSender:p}}async stopSending(e){this.assertSendDirection();const t=this._mapSendLocalIdRtpSender.get(e);if(!t)throw new Error("associated RTCRtpSender not found");t.track&&this._sendStream.removeTrack(t.track),this._mapSendLocalIdRtpSender.delete(e);const n=await this._pc.createOffer();re.debug("stopSending() | calling pc.setLocalDescription() [offer:%o]",n);try{await this._pc.setLocalDescription(n)}catch(s){if(this._sendStream.getTracks().length===0){re.warn("stopSending() | ignoring expected error due no sending tracks: %s",s.toString());return}throw s}if(this._pc.signalingState==="stable")return;const i={type:"answer",sdp:this._remoteSdp.getSdp()};re.debug("stopSending() | calling pc.setRemoteDescription() [answer:%o]",i),await this._pc.setRemoteDescription(i)}async pauseSending(e){}async resumeSending(e){}async replaceTrack(e,t){this.assertSendDirection(),t?re.debug("replaceTrack() [localId:%s, track.id:%s]",e,t.id):re.debug("replaceTrack() [localId:%s, no track]",e);const n=this._mapSendLocalIdRtpSender.get(e);if(!n)throw new Error("associated RTCRtpSender not found");const i=n.track;await n.replaceTrack(t),i&&this._sendStream.removeTrack(i),t&&this._sendStream.addTrack(t)}async setMaxSpatialLayer(e,t){this.assertSendDirection(),re.debug("setMaxSpatialLayer() [localId:%s, spatialLayer:%s]",e,t);const n=this._mapSendLocalIdRtpSender.get(e);if(!n)throw new Error("associated RTCRtpSender not found");const i=n.getParameters();i.encodings.forEach((s,o)=>{o<=t?s.active=!0:s.active=!1}),await n.setParameters(i)}async setRtpEncodingParameters(e,t){this.assertSendDirection(),re.debug("setRtpEncodingParameters() [localId:%s, params:%o]",e,t);const n=this._mapSendLocalIdRtpSender.get(e);if(!n)throw new Error("associated RTCRtpSender not found");const i=n.getParameters();i.encodings.forEach((s,o)=>{i.encodings[o]={...s,...t}}),await n.setParameters(i)}async getSenderStats(e){this.assertSendDirection();const t=this._mapSendLocalIdRtpSender.get(e);if(!t)throw new Error("associated RTCRtpSender not found");return t.getStats()}async sendDataChannel({ordered:e,maxPacketLifeTime:t,maxRetransmits:n,label:i,protocol:s}){this.assertSendDirection();const o={negotiated:!0,id:this._nextSendSctpStreamId,ordered:e,maxPacketLifeTime:t,maxRetransmits:n,protocol:s};re.debug("sendDataChannel() [options:%o]",o);const a=this._pc.createDataChannel(i,o);if(this._nextSendSctpStreamId=++this._nextSendSctpStreamId%aa.MIS,!this._hasDataChannelMediaSection){const d=await this._pc.createOffer(),l=nt.parse(d.sdp),u=l.media.find(h=>h.type==="application");this._transportReady||await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:l}),re.debug("sendDataChannel() | calling pc.setLocalDescription() [offer:%o]",d),await this._pc.setLocalDescription(d),this._remoteSdp.sendSctpAssociation({offerMediaObject:u});const p={type:"answer",sdp:this._remoteSdp.getSdp()};re.debug("sendDataChannel() | calling pc.setRemoteDescription() [answer:%o]",p),await this._pc.setRemoteDescription(p),this._hasDataChannelMediaSection=!0}const c={streamId:o.id,ordered:o.ordered,maxPacketLifeTime:o.maxPacketLifeTime,maxRetransmits:o.maxRetransmits};return{dataChannel:a,sctpStreamParameters:c}}async receive(e){this.assertRecvDirection();const t=[];for(const o of e){const{trackId:a,kind:c,rtpParameters:d,streamId:l}=o;re.debug("receive() [trackId:%s, kind:%s]",a,c);const u=c;this._remoteSdp.receive({mid:u,kind:c,offerRtpParameters:d,streamId:l||d.rtcp.cname,trackId:a})}const n={type:"offer",sdp:this._remoteSdp.getSdp()};re.debug("receive() | calling pc.setRemoteDescription() [offer:%o]",n),await this._pc.setRemoteDescription(n);let i=await this._pc.createAnswer();const s=nt.parse(i.sdp);for(const o of e){const{kind:a,rtpParameters:c}=o,d=a,l=s.media.find(u=>String(u.mid)===d);Cn.applyCodecParameters({offerRtpParameters:c,answerMediaObject:l})}i={type:"answer",sdp:nt.write(s)},this._transportReady||await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:s}),re.debug("receive() | calling pc.setLocalDescription() [answer:%o]",i),await this._pc.setLocalDescription(i);for(const o of e){const{kind:a,trackId:c,rtpParameters:d}=o,l=a,u=c,p=this._pc.getReceivers().find(h=>h.track&&h.track.id===u);if(!p)throw new Error("new RTCRtpReceiver not");this._mapRecvLocalIdInfo.set(u,{mid:l,rtpParameters:d,rtpReceiver:p}),t.push({localId:u,track:p.track,rtpReceiver:p})}return t}async stopReceiving(e){this.assertRecvDirection();for(const i of e){re.debug("stopReceiving() [localId:%s]",i);const{mid:s,rtpParameters:o}=this._mapRecvLocalIdInfo.get(i)||{};this._mapRecvLocalIdInfo.delete(i),this._remoteSdp.planBStopReceiving({mid:s,offerRtpParameters:o})}const t={type:"offer",sdp:this._remoteSdp.getSdp()};re.debug("stopReceiving() | calling pc.setRemoteDescription() [offer:%o]",t),await this._pc.setRemoteDescription(t);const n=await this._pc.createAnswer();re.debug("stopReceiving() | calling pc.setLocalDescription() [answer:%o]",n),await this._pc.setLocalDescription(n)}async getReceiverStats(e){this.assertRecvDirection();const{rtpReceiver:t}=this._mapRecvLocalIdInfo.get(e)||{};if(!t)throw new Error("associated RTCRtpReceiver not found");return t.getStats()}async pauseReceiving(e){}async resumeReceiving(e){}async receiveDataChannel({sctpStreamParameters:e,label:t,protocol:n}){this.assertRecvDirection();const{streamId:i,ordered:s,maxPacketLifeTime:o,maxRetransmits:a}=e,c={negotiated:!0,id:i,ordered:s,maxPacketLifeTime:o,maxRetransmits:a,protocol:n};re.debug("receiveDataChannel() [options:%o]",c);const d=this._pc.createDataChannel(t,c);if(!this._hasDataChannelMediaSection){this._remoteSdp.receiveSctpAssociation({oldDataChannelSpec:!0});const l={type:"offer",sdp:this._remoteSdp.getSdp()};re.debug("receiveDataChannel() | calling pc.setRemoteDescription() [offer:%o]",l),await this._pc.setRemoteDescription(l);const u=await this._pc.createAnswer();if(!this._transportReady){const p=nt.parse(u.sdp);await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:p})}re.debug("receiveDataChannel() | calling pc.setRemoteDescription() [answer:%o]",u),await this._pc.setLocalDescription(u),this._hasDataChannelMediaSection=!0}return{dataChannel:d}}async setupTransport({localDtlsRole:e,localSdpObject:t}){t||(t=nt.parse(this._pc.localDescription.sdp));const n=Cn.extractDtlsParameters({sdpObject:t});n.role=e,this._remoteSdp.updateDtlsRole(e==="client"?"server":"client"),await new Promise((i,s)=>{this.safeEmit("@connect",{dtlsParameters:n},i,s)}),this._transportReady=!0}assertSendDirection(){if(this._direction!=="send")throw new Error('method can just be called for handlers with "send" direction')}assertRecvDirection(){if(this._direction!=="recv")throw new Error('method can just be called for handlers with "recv" direction')}}hi.Safari11=zs;var mi={},mr={},Nf=T&&T.__createBinding||(Object.create?function(r,e,t,n){n===void 0&&(n=t);var i=Object.getOwnPropertyDescriptor(e,t);(!i||("get"in i?!e.__esModule:i.writable||i.configurable))&&(i={enumerable:!0,get:function(){return e[t]}}),Object.defineProperty(r,n,i)}:function(r,e,t,n){n===void 0&&(n=t),r[n]=e[t]}),Af=T&&T.__setModuleDefault||(Object.create?function(r,e){Object.defineProperty(r,"default",{enumerable:!0,value:e})}:function(r,e){r.default=e}),jf=T&&T.__importStar||function(r){if(r&&r.__esModule)return r;var e={};if(r!=null)for(var t in r)t!=="default"&&Object.prototype.hasOwnProperty.call(r,t)&&Nf(e,r,t);return Af(e,r),e};Object.defineProperty(mr,"__esModule",{value:!0});mr.mangleRtpParameters=mr.getCapabilities=void 0;const Bc=jf(Te);function $f(){const r=RTCRtpReceiver.getCapabilities(),e=Bc.clone(r,{});for(const t of e.codecs){if(t.channels=t.numChannels,delete t.numChannels,t.mimeType=t.mimeType||`${t.kind}/${t.name}`,t.parameters){const n=t.parameters;n.apt&&(n.apt=Number(n.apt)),n["packetization-mode"]&&(n["packetization-mode"]=Number(n["packetization-mode"]))}for(const n of t.rtcpFeedback||[])n.parameter||(n.parameter="")}return e}mr.getCapabilities=$f;function Bf(r){const e=Bc.clone(r,{});e.mid&&(e.muxId=e.mid,delete e.mid);for(const t of e.codecs)t.channels&&(t.numChannels=t.channels,delete t.channels),t.mimeType&&!t.name&&(t.name=t.mimeType.split("/")[1]),delete t.mimeType;return e}mr.mangleRtpParameters=Bf;var Ff=T&&T.__createBinding||(Object.create?function(r,e,t,n){n===void 0&&(n=t);var i=Object.getOwnPropertyDescriptor(e,t);(!i||("get"in i?!e.__esModule:i.writable||i.configurable))&&(i={enumerable:!0,get:function(){return e[t]}}),Object.defineProperty(r,n,i)}:function(r,e,t,n){n===void 0&&(n=t),r[n]=e[t]}),Uf=T&&T.__setModuleDefault||(Object.create?function(r,e){Object.defineProperty(r,"default",{enumerable:!0,value:e})}:function(r,e){r.default=e}),Vs=T&&T.__importStar||function(r){if(r&&r.__esModule)return r;var e={};if(r!=null)for(var t in r)t!=="default"&&Object.prototype.hasOwnProperty.call(r,t)&&Ff(e,r,t);return Uf(e,r),e};Object.defineProperty(mi,"__esModule",{value:!0});mi.Edge11=void 0;const zf=Ce,Bi=Ne,En=Vs(Te),Fi=Vs(z),Ui=Vs(mr),Vf=Be,pe=new zf.Logger("Edge11");class Js extends Vf.HandlerInterface{static createFactory(){return()=>new Js}constructor(){super(),this._rtpSenders=new Map,this._rtpReceivers=new Map,this._nextSendLocalId=0,this._transportReady=!1}get name(){return"Edge11"}close(){pe.debug("close()");try{this._iceGatherer.close()}catch{}try{this._iceTransport.stop()}catch{}try{this._dtlsTransport.stop()}catch{}for(const e of this._rtpSenders.values())try{e.stop()}catch{}for(const e of this._rtpReceivers.values())try{e.stop()}catch{}this.emit("@close")}async getNativeRtpCapabilities(){return pe.debug("getNativeRtpCapabilities()"),Ui.getCapabilities()}async getNativeSctpCapabilities(){return pe.debug("getNativeSctpCapabilities()"),{numStreams:{OS:0,MIS:0}}}run({direction:e,iceParameters:t,iceCandidates:n,dtlsParameters:i,sctpParameters:s,iceServers:o,iceTransportPolicy:a,additionalSettings:c,proprietaryConstraints:d,extendedRtpCapabilities:l}){pe.debug("run()"),this._sendingRtpParametersByKind={audio:Fi.getSendingRtpParameters("audio",l),video:Fi.getSendingRtpParameters("video",l)},this._remoteIceParameters=t,this._remoteIceCandidates=n,this._remoteDtlsParameters=i,this._cname=`CNAME-${En.generateRandomNumber()}`,this.setIceGatherer({iceServers:o,iceTransportPolicy:a}),this.setIceTransport(),this.setDtlsTransport()}async updateIceServers(e){throw new Bi.UnsupportedError("not supported")}async restartIce(e){if(pe.debug("restartIce()"),this._remoteIceParameters=e,!!this._transportReady){pe.debug("restartIce() | calling iceTransport.start()"),this._iceTransport.start(this._iceGatherer,e,"controlling");for(const t of this._remoteIceCandidates)this._iceTransport.addRemoteCandidate(t);this._iceTransport.addRemoteCandidate({})}}async getTransportStats(){return this._iceTransport.getStats()}async send({track:e,encodings:t,codecOptions:n,codec:i}){pe.debug("send() [kind:%s, track.id:%s]",e.kind,e.id),this._transportReady||await this.setupTransport({localDtlsRole:"server"}),pe.debug("send() | calling new RTCRtpSender()");const s=new RTCRtpSender(e,this._dtlsTransport),o=En.clone(this._sendingRtpParametersByKind[e.kind],{});o.codecs=Fi.reduceCodecs(o.codecs,i);const a=o.codecs.some(l=>/.+\/rtx$/i.test(l.mimeType));t||(t=[{}]);for(const l of t)l.ssrc=En.generateRandomNumber(),a&&(l.rtx={ssrc:En.generateRandomNumber()});o.encodings=t,o.rtcp={cname:this._cname,reducedSize:!0,mux:!0};const c=Ui.mangleRtpParameters(o);pe.debug("send() | calling rtpSender.send() [params:%o]",c),await s.send(c);const d=String(this._nextSendLocalId);return this._nextSendLocalId++,this._rtpSenders.set(d,s),{localId:d,rtpParameters:o,rtpSender:s}}async stopSending(e){pe.debug("stopSending() [localId:%s]",e);const t=this._rtpSenders.get(e);if(!t)throw new Error("RTCRtpSender not found");this._rtpSenders.delete(e);try{pe.debug("stopSending() | calling rtpSender.stop()"),t.stop()}catch(n){throw pe.warn("stopSending() | rtpSender.stop() failed:%o",n),n}}async pauseSending(e){}async resumeSending(e){}async replaceTrack(e,t){t?pe.debug("replaceTrack() [localId:%s, track.id:%s]",e,t.id):pe.debug("replaceTrack() [localId:%s, no track]",e);const n=this._rtpSenders.get(e);if(!n)throw new Error("RTCRtpSender not found");n.setTrack(t)}async setMaxSpatialLayer(e,t){pe.debug("setMaxSpatialLayer() [localId:%s, spatialLayer:%s]",e,t);const n=this._rtpSenders.get(e);if(!n)throw new Error("RTCRtpSender not found");const i=n.getParameters();i.encodings.forEach((s,o)=>{o<=t?s.active=!0:s.active=!1}),await n.setParameters(i)}async setRtpEncodingParameters(e,t){pe.debug("setRtpEncodingParameters() [localId:%s, params:%o]",e,t);const n=this._rtpSenders.get(e);if(!n)throw new Error("RTCRtpSender not found");const i=n.getParameters();i.encodings.forEach((s,o)=>{i.encodings[o]={...s,...t}}),await n.setParameters(i)}async getSenderStats(e){const t=this._rtpSenders.get(e);if(!t)throw new Error("RTCRtpSender not found");return t.getStats()}async sendDataChannel(e){throw new Bi.UnsupportedError("not implemented")}async receive(e){const t=[];for(const n of e){const{trackId:i,kind:s}=n;pe.debug("receive() [trackId:%s, kind:%s]",i,s)}this._transportReady||await this.setupTransport({localDtlsRole:"server"});for(const n of e){const{trackId:i,kind:s,rtpParameters:o}=n;pe.debug("receive() | calling new RTCRtpReceiver()");const a=new RTCRtpReceiver(this._dtlsTransport,s);a.addEventListener("error",l=>{pe.error('rtpReceiver "error" event [event:%o]',l)});const c=Ui.mangleRtpParameters(o);pe.debug("receive() | calling rtpReceiver.receive() [params:%o]",c),await a.receive(c);const d=i;this._rtpReceivers.set(d,a),t.push({localId:d,track:a.track,rtpReceiver:a})}return t}async stopReceiving(e){for(const t of e){pe.debug("stopReceiving() [localId:%s]",t);const n=this._rtpReceivers.get(t);if(!n)throw new Error("RTCRtpReceiver not found");this._rtpReceivers.delete(t);try{pe.debug("stopReceiving() | calling rtpReceiver.stop()"),n.stop()}catch(i){pe.warn("stopReceiving() | rtpReceiver.stop() failed:%o",i)}}}async pauseReceiving(e){}async resumeReceiving(e){}async getReceiverStats(e){const t=this._rtpReceivers.get(e);if(!t)throw new Error("RTCRtpReceiver not found");return t.getStats()}async receiveDataChannel(e){throw new Bi.UnsupportedError("not implemented")}setIceGatherer({iceServers:e,iceTransportPolicy:t}){const n=new RTCIceGatherer({iceServers:e||[],gatherPolicy:t||"all"});n.addEventListener("error",i=>{pe.error('iceGatherer "error" event [event:%o]',i)});try{n.gather()}catch(i){pe.debug("setIceGatherer() | iceGatherer.gather() failed: %s",i.toString())}this._iceGatherer=n}setIceTransport(){const e=new RTCIceTransport(this._iceGatherer);e.addEventListener("statechange",()=>{switch(e.state){case"checking":this.emit("@connectionstatechange","connecting");break;case"connected":case"completed":this.emit("@connectionstatechange","connected");break;case"failed":this.emit("@connectionstatechange","failed");break;case"disconnected":this.emit("@connectionstatechange","disconnected");break;case"closed":this.emit("@connectionstatechange","closed");break}}),e.addEventListener("icestatechange",()=>{switch(e.state){case"checking":this.emit("@connectionstatechange","connecting");break;case"connected":case"completed":this.emit("@connectionstatechange","connected");break;case"failed":this.emit("@connectionstatechange","failed");break;case"disconnected":this.emit("@connectionstatechange","disconnected");break;case"closed":this.emit("@connectionstatechange","closed");break}}),e.addEventListener("candidatepairchange",t=>{pe.debug('iceTransport "candidatepairchange" event [pair:%o]',t.pair)}),this._iceTransport=e}setDtlsTransport(){const e=new RTCDtlsTransport(this._iceTransport);e.addEventListener("statechange",()=>{pe.debug('dtlsTransport "statechange" event [state:%s]',e.state)}),e.addEventListener("dtlsstatechange",()=>{pe.debug('dtlsTransport "dtlsstatechange" event [state:%s]',e.state),e.state==="closed"&&this.emit("@connectionstatechange","closed")}),e.addEventListener("error",t=>{pe.error('dtlsTransport "error" event [event:%o]',t)}),this._dtlsTransport=e}async setupTransport({localDtlsRole:e}){pe.debug("setupTransport()");const t=this._dtlsTransport.getLocalParameters();t.role=e,await new Promise((n,i)=>{this.safeEmit("@connect",{dtlsParameters:t},n,i)}),this._iceTransport.start(this._iceGatherer,this._remoteIceParameters,"controlling");for(const n of this._remoteIceCandidates)this._iceTransport.addRemoteCandidate(n);this._iceTransport.addRemoteCandidate({}),this._remoteDtlsParameters.fingerprints=this._remoteDtlsParameters.fingerprints.filter(n=>n.algorithm==="sha-256"||n.algorithm==="sha-384"||n.algorithm==="sha-512"),this._dtlsTransport.start(this._remoteDtlsParameters),this._transportReady=!0}}mi.Edge11=Js;var gi={},Jf=T&&T.__createBinding||(Object.create?function(r,e,t,n){n===void 0&&(n=t);var i=Object.getOwnPropertyDescriptor(e,t);(!i||("get"in i?!e.__esModule:i.writable||i.configurable))&&(i={enumerable:!0,get:function(){return e[t]}}),Object.defineProperty(r,n,i)}:function(r,e,t,n){n===void 0&&(n=t),r[n]=e[t]}),qf=T&&T.__setModuleDefault||(Object.create?function(r,e){Object.defineProperty(r,"default",{enumerable:!0,value:e})}:function(r,e){r.default=e}),br=T&&T.__importStar||function(r){if(r&&r.__esModule)return r;var e={};if(r!=null)for(var t in r)t!=="default"&&Object.prototype.hasOwnProperty.call(r,t)&&Jf(e,r,t);return qf(e,r),e};Object.defineProperty(gi,"__esModule",{value:!0});gi.ReactNativeUnifiedPlan=void 0;const it=br(Pe),Gf=Ce,ca=br(Te),rr=br(z),Tn=br(Me),zi=br(We),Hf=br(At),Wf=Ne,Kf=Be,Yf=Ue,Qf=ut,V=new Gf.Logger("ReactNativeUnifiedPlan"),da={OS:1024,MIS:1024};class qs extends Kf.HandlerInterface{static createFactory(){return()=>new qs}constructor(){super(),this._closed=!1,this._mapMidTransceiver=new Map,this._sendStream=new MediaStream,this._hasDataChannelMediaSection=!1,this._nextSendSctpStreamId=0,this._transportReady=!1}get name(){return"ReactNativeUnifiedPlan"}close(){if(V.debug("close()"),!this._closed){if(this._closed=!0,this._sendStream.release(!1),this._pc)try{this._pc.close()}catch{}this.emit("@close")}}async getNativeRtpCapabilities(){V.debug("getNativeRtpCapabilities()");const e=new RTCPeerConnection({iceServers:[],iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"unified-plan"});try{e.addTransceiver("audio"),e.addTransceiver("video");const t=await e.createOffer();try{e.close()}catch{}const n=it.parse(t.sdp),i=Tn.extractRtpCapabilities({sdpObject:n});return Hf.addNackSuppportForOpus(i),i}catch(t){try{e.close()}catch{}throw t}}async getNativeSctpCapabilities(){return V.debug("getNativeSctpCapabilities()"),{numStreams:da}}run({direction:e,iceParameters:t,iceCandidates:n,dtlsParameters:i,sctpParameters:s,iceServers:o,iceTransportPolicy:a,additionalSettings:c,proprietaryConstraints:d,extendedRtpCapabilities:l}){this.assertNotClosed(),V.debug("run()"),this._direction=e,this._remoteSdp=new Yf.RemoteSdp({iceParameters:t,iceCandidates:n,dtlsParameters:i,sctpParameters:s}),this._sendingRtpParametersByKind={audio:rr.getSendingRtpParameters("audio",l),video:rr.getSendingRtpParameters("video",l)},this._sendingRemoteRtpParametersByKind={audio:rr.getSendingRemoteRtpParameters("audio",l),video:rr.getSendingRemoteRtpParameters("video",l)},i.role&&i.role!=="auto"&&(this._forcedLocalDtlsRole=i.role==="server"?"client":"server"),this._pc=new RTCPeerConnection({iceServers:o||[],iceTransportPolicy:a||"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"unified-plan",...c},d),this._pc.addEventListener("icegatheringstatechange",()=>{this.emit("@icegatheringstatechange",this._pc.iceGatheringState)}),this._pc.connectionState?this._pc.addEventListener("connectionstatechange",()=>{this.emit("@connectionstatechange",this._pc.connectionState)}):this._pc.addEventListener("iceconnectionstatechange",()=>{switch(V.warn("run() | pc.connectionState not supported, using pc.iceConnectionState"),this._pc.iceConnectionState){case"checking":this.emit("@connectionstatechange","connecting");break;case"connected":case"completed":this.emit("@connectionstatechange","connected");break;case"failed":this.emit("@connectionstatechange","failed");break;case"disconnected":this.emit("@connectionstatechange","disconnected");break;case"closed":this.emit("@connectionstatechange","closed");break}})}async updateIceServers(e){this.assertNotClosed(),V.debug("updateIceServers()");const t=this._pc.getConfiguration();t.iceServers=e,this._pc.setConfiguration(t)}async restartIce(e){if(this.assertNotClosed(),V.debug("restartIce()"),this._remoteSdp.updateIceParameters(e),!!this._transportReady)if(this._direction==="send"){const t=await this._pc.createOffer({iceRestart:!0});V.debug("restartIce() | calling pc.setLocalDescription() [offer:%o]",t),await this._pc.setLocalDescription(t);const n={type:"answer",sdp:this._remoteSdp.getSdp()};V.debug("restartIce() | calling pc.setRemoteDescription() [answer:%o]",n),await this._pc.setRemoteDescription(n)}else{const t={type:"offer",sdp:this._remoteSdp.getSdp()};V.debug("restartIce() | calling pc.setRemoteDescription() [offer:%o]",t),await this._pc.setRemoteDescription(t);const n=await this._pc.createAnswer();V.debug("restartIce() | calling pc.setLocalDescription() [answer:%o]",n),await this._pc.setLocalDescription(n)}}async getTransportStats(){return this.assertNotClosed(),this._pc.getStats()}async send({track:e,encodings:t,codecOptions:n,codec:i}){this.assertNotClosed(),this.assertSendDirection(),V.debug("send() [kind:%s, track.id:%s]",e.kind,e.id),t&&t.length>1&&t.forEach((g,w)=>{g.rid=`r${w}`});const s=ca.clone(this._sendingRtpParametersByKind[e.kind],{});s.codecs=rr.reduceCodecs(s.codecs,i);const o=ca.clone(this._sendingRemoteRtpParametersByKind[e.kind],{});o.codecs=rr.reduceCodecs(o.codecs,i);const a=this._remoteSdp.getNextMediaSectionIdx(),c=this._pc.addTransceiver(e,{direction:"sendonly",streams:[this._sendStream],sendEncodings:t});let d=await this._pc.createOffer(),l=it.parse(d.sdp),u;this._transportReady||await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:l});let p=!1;const h=(0,Qf.parse)((t||[{}])[0].scalabilityMode);t&&t.length===1&&h.spatialLayers>1&&s.codecs[0].mimeType.toLowerCase()==="video/vp9"&&(V.debug("send() | enabling legacy simulcast for VP9 SVC"),p=!0,l=it.parse(d.sdp),u=l.media[a.idx],zi.addLegacySimulcast({offerMediaObject:u,numStreams:h.spatialLayers}),d={type:"offer",sdp:it.write(l)}),V.debug("send() | calling pc.setLocalDescription() [offer:%o]",d),await this._pc.setLocalDescription(d);let f=c.mid??void 0;if(f||V.warn("send() | missing transceiver.mid (bug in react-native-webrtc, using a workaround"),s.mid=f,l=it.parse(this._pc.localDescription.sdp),u=l.media[a.idx],s.rtcp.cname=Tn.getCname({offerMediaObject:u}),!t)s.encodings=zi.getRtpEncodings({offerMediaObject:u});else if(t.length===1){let g=zi.getRtpEncodings({offerMediaObject:u});Object.assign(g[0],t[0]),p&&(g=[g[0]]),s.encodings=g}else s.encodings=t;if(s.encodings.length>1&&(s.codecs[0].mimeType.toLowerCase()==="video/vp8"||s.codecs[0].mimeType.toLowerCase()==="video/h264"))for(const g of s.encodings)g.scalabilityMode?g.scalabilityMode=`L1T${h.temporalLayers}`:g.scalabilityMode="L1T3";this._remoteSdp.send({offerMediaObject:u,reuseMid:a.reuseMid,offerRtpParameters:s,answerRtpParameters:o,codecOptions:n,extmapAllowMixed:!0});const m={type:"answer",sdp:this._remoteSdp.getSdp()};return V.debug("send() | calling pc.setRemoteDescription() [answer:%o]",m),await this._pc.setRemoteDescription(m),f||(f=c.mid,s.mid=f),this._mapMidTransceiver.set(f,c),{localId:f,rtpParameters:s,rtpSender:c.sender}}async stopSending(e){if(this.assertSendDirection(),this._closed)return;V.debug("stopSending() [localId:%s]",e);const t=this._mapMidTransceiver.get(e);if(!t)throw new Error("associated RTCRtpTransceiver not found");if(t.sender.replaceTrack(null),this._pc.removeTrack(t.sender),this._remoteSdp.closeMediaSection(t.mid))try{t.stop()}catch{}const i=await this._pc.createOffer();V.debug("stopSending() | calling pc.setLocalDescription() [offer:%o]",i),await this._pc.setLocalDescription(i);const s={type:"answer",sdp:this._remoteSdp.getSdp()};V.debug("stopSending() | calling pc.setRemoteDescription() [answer:%o]",s),await this._pc.setRemoteDescription(s),this._mapMidTransceiver.delete(e)}async pauseSending(e){this.assertNotClosed(),this.assertSendDirection(),V.debug("pauseSending() [localId:%s]",e);const t=this._mapMidTransceiver.get(e);if(!t)throw new Error("associated RTCRtpTransceiver not found");t.direction="inactive",this._remoteSdp.pauseMediaSection(e);const n=await this._pc.createOffer();V.debug("pauseSending() | calling pc.setLocalDescription() [offer:%o]",n),await this._pc.setLocalDescription(n);const i={type:"answer",sdp:this._remoteSdp.getSdp()};V.debug("pauseSending() | calling pc.setRemoteDescription() [answer:%o]",i),await this._pc.setRemoteDescription(i)}async resumeSending(e){this.assertNotClosed(),this.assertSendDirection(),V.debug("resumeSending() [localId:%s]",e);const t=this._mapMidTransceiver.get(e);if(this._remoteSdp.resumeSendingMediaSection(e),!t)throw new Error("associated RTCRtpTransceiver not found");t.direction="sendonly";const n=await this._pc.createOffer();V.debug("resumeSending() | calling pc.setLocalDescription() [offer:%o]",n),await this._pc.setLocalDescription(n);const i={type:"answer",sdp:this._remoteSdp.getSdp()};V.debug("resumeSending() | calling pc.setRemoteDescription() [answer:%o]",i),await this._pc.setRemoteDescription(i)}async replaceTrack(e,t){this.assertNotClosed(),this.assertSendDirection(),t?V.debug("replaceTrack() [localId:%s, track.id:%s]",e,t.id):V.debug("replaceTrack() [localId:%s, no track]",e);const n=this._mapMidTransceiver.get(e);if(!n)throw new Error("associated RTCRtpTransceiver not found");await n.sender.replaceTrack(t)}async setMaxSpatialLayer(e,t){this.assertNotClosed(),this.assertSendDirection(),V.debug("setMaxSpatialLayer() [localId:%s, spatialLayer:%s]",e,t);const n=this._mapMidTransceiver.get(e);if(!n)throw new Error("associated RTCRtpTransceiver not found");const i=n.sender.getParameters();i.encodings.forEach((a,c)=>{c<=t?a.active=!0:a.active=!1}),await n.sender.setParameters(i),this._remoteSdp.muxMediaSectionSimulcast(e,i.encodings);const s=await this._pc.createOffer();V.debug("setMaxSpatialLayer() | calling pc.setLocalDescription() [offer:%o]",s),await this._pc.setLocalDescription(s);const o={type:"answer",sdp:this._remoteSdp.getSdp()};V.debug("setMaxSpatialLayer() | calling pc.setRemoteDescription() [answer:%o]",o),await this._pc.setRemoteDescription(o)}async setRtpEncodingParameters(e,t){this.assertNotClosed(),this.assertSendDirection(),V.debug("setRtpEncodingParameters() [localId:%s, params:%o]",e,t);const n=this._mapMidTransceiver.get(e);if(!n)throw new Error("associated RTCRtpTransceiver not found");const i=n.sender.getParameters();i.encodings.forEach((a,c)=>{i.encodings[c]={...a,...t}}),await n.sender.setParameters(i),this._remoteSdp.muxMediaSectionSimulcast(e,i.encodings);const s=await this._pc.createOffer();V.debug("setRtpEncodingParameters() | calling pc.setLocalDescription() [offer:%o]",s),await this._pc.setLocalDescription(s);const o={type:"answer",sdp:this._remoteSdp.getSdp()};V.debug("setRtpEncodingParameters() | calling pc.setRemoteDescription() [answer:%o]",o),await this._pc.setRemoteDescription(o)}async getSenderStats(e){this.assertNotClosed(),this.assertSendDirection();const t=this._mapMidTransceiver.get(e);if(!t)throw new Error("associated RTCRtpTransceiver not found");return t.sender.getStats()}async sendDataChannel({ordered:e,maxPacketLifeTime:t,maxRetransmits:n,label:i,protocol:s}){this.assertNotClosed(),this.assertSendDirection();const o={negotiated:!0,id:this._nextSendSctpStreamId,ordered:e,maxPacketLifeTime:t,maxRetransmits:n,protocol:s};V.debug("sendDataChannel() [options:%o]",o);const a=this._pc.createDataChannel(i,o);if(this._nextSendSctpStreamId=++this._nextSendSctpStreamId%da.MIS,!this._hasDataChannelMediaSection){const d=await this._pc.createOffer(),l=it.parse(d.sdp),u=l.media.find(h=>h.type==="application");this._transportReady||await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:l}),V.debug("sendDataChannel() | calling pc.setLocalDescription() [offer:%o]",d),await this._pc.setLocalDescription(d),this._remoteSdp.sendSctpAssociation({offerMediaObject:u});const p={type:"answer",sdp:this._remoteSdp.getSdp()};V.debug("sendDataChannel() | calling pc.setRemoteDescription() [answer:%o]",p),await this._pc.setRemoteDescription(p),this._hasDataChannelMediaSection=!0}const c={streamId:o.id,ordered:o.ordered,maxPacketLifeTime:o.maxPacketLifeTime,maxRetransmits:o.maxRetransmits};return{dataChannel:a,sctpStreamParameters:c}}async receive(e){this.assertNotClosed(),this.assertRecvDirection();const t=[],n=new Map;for(const a of e){const{trackId:c,kind:d,rtpParameters:l,streamId:u}=a;V.debug("receive() [trackId:%s, kind:%s]",c,d);const p=l.mid||String(this._mapMidTransceiver.size);n.set(c,p),this._remoteSdp.receive({mid:p,kind:d,offerRtpParameters:l,streamId:u||l.rtcp.cname,trackId:c})}const i={type:"offer",sdp:this._remoteSdp.getSdp()};V.debug("receive() | calling pc.setRemoteDescription() [offer:%o]",i),await this._pc.setRemoteDescription(i);let s=await this._pc.createAnswer();const o=it.parse(s.sdp);for(const a of e){const{trackId:c,rtpParameters:d}=a,l=n.get(c),u=o.media.find(p=>String(p.mid)===l);Tn.applyCodecParameters({offerRtpParameters:d,answerMediaObject:u})}s={type:"answer",sdp:it.write(o)},this._transportReady||await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:o}),V.debug("receive() | calling pc.setLocalDescription() [answer:%o]",s),await this._pc.setLocalDescription(s);for(const a of e){const{trackId:c}=a,d=n.get(c),l=this._pc.getTransceivers().find(u=>u.mid===d);if(l)this._mapMidTransceiver.set(d,l),t.push({localId:d,track:l.receiver.track,rtpReceiver:l.receiver});else throw new Error("new RTCRtpTransceiver not found")}return t}async stopReceiving(e){if(this.assertRecvDirection(),this._closed)return;for(const i of e){V.debug("stopReceiving() [localId:%s]",i);const s=this._mapMidTransceiver.get(i);if(!s)throw new Error("associated RTCRtpTransceiver not found");this._remoteSdp.closeMediaSection(s.mid)}const t={type:"offer",sdp:this._remoteSdp.getSdp()};V.debug("stopReceiving() | calling pc.setRemoteDescription() [offer:%o]",t),await this._pc.setRemoteDescription(t);const n=await this._pc.createAnswer();V.debug("stopReceiving() | calling pc.setLocalDescription() [answer:%o]",n),await this._pc.setLocalDescription(n);for(const i of e)this._mapMidTransceiver.delete(i)}async pauseReceiving(e){this.assertNotClosed(),this.assertRecvDirection();for(const i of e){V.debug("pauseReceiving() [localId:%s]",i);const s=this._mapMidTransceiver.get(i);if(!s)throw new Error("associated RTCRtpTransceiver not found");s.direction="inactive",this._remoteSdp.pauseMediaSection(i)}const t={type:"offer",sdp:this._remoteSdp.getSdp()};V.debug("pauseReceiving() | calling pc.setRemoteDescription() [offer:%o]",t),await this._pc.setRemoteDescription(t);const n=await this._pc.createAnswer();V.debug("pauseReceiving() | calling pc.setLocalDescription() [answer:%o]",n),await this._pc.setLocalDescription(n)}async resumeReceiving(e){this.assertNotClosed(),this.assertRecvDirection();for(const i of e){V.debug("resumeReceiving() [localId:%s]",i);const s=this._mapMidTransceiver.get(i);if(!s)throw new Error("associated RTCRtpTransceiver not found");s.direction="recvonly",this._remoteSdp.resumeReceivingMediaSection(i)}const t={type:"offer",sdp:this._remoteSdp.getSdp()};V.debug("resumeReceiving() | calling pc.setRemoteDescription() [offer:%o]",t),await this._pc.setRemoteDescription(t);const n=await this._pc.createAnswer();V.debug("resumeReceiving() | calling pc.setLocalDescription() [answer:%o]",n),await this._pc.setLocalDescription(n)}async getReceiverStats(e){this.assertNotClosed(),this.assertRecvDirection();const t=this._mapMidTransceiver.get(e);if(!t)throw new Error("associated RTCRtpTransceiver not found");return t.receiver.getStats()}async receiveDataChannel({sctpStreamParameters:e,label:t,protocol:n}){this.assertNotClosed(),this.assertRecvDirection();const{streamId:i,ordered:s,maxPacketLifeTime:o,maxRetransmits:a}=e,c={negotiated:!0,id:i,ordered:s,maxPacketLifeTime:o,maxRetransmits:a,protocol:n};V.debug("receiveDataChannel() [options:%o]",c);const d=this._pc.createDataChannel(t,c);if(!this._hasDataChannelMediaSection){this._remoteSdp.receiveSctpAssociation();const l={type:"offer",sdp:this._remoteSdp.getSdp()};V.debug("receiveDataChannel() | calling pc.setRemoteDescription() [offer:%o]",l),await this._pc.setRemoteDescription(l);const u=await this._pc.createAnswer();if(!this._transportReady){const p=it.parse(u.sdp);await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:p})}V.debug("receiveDataChannel() | calling pc.setRemoteDescription() [answer:%o]",u),await this._pc.setLocalDescription(u),this._hasDataChannelMediaSection=!0}return{dataChannel:d}}async setupTransport({localDtlsRole:e,localSdpObject:t}){t||(t=it.parse(this._pc.localDescription.sdp));const n=Tn.extractDtlsParameters({sdpObject:t});n.role=e,this._remoteSdp.updateDtlsRole(e==="client"?"server":"client"),await new Promise((i,s)=>{this.safeEmit("@connect",{dtlsParameters:n},i,s)}),this._transportReady=!0}assertNotClosed(){if(this._closed)throw new Wf.InvalidStateError("method called in a closed handler")}assertSendDirection(){if(this._direction!=="send")throw new Error('method can just be called for handlers with "send" direction')}assertRecvDirection(){if(this._direction!=="recv")throw new Error('method can just be called for handlers with "recv" direction')}}gi.ReactNativeUnifiedPlan=qs;var vi={},Xf=T&&T.__createBinding||(Object.create?function(r,e,t,n){n===void 0&&(n=t);var i=Object.getOwnPropertyDescriptor(e,t);(!i||("get"in i?!e.__esModule:i.writable||i.configurable))&&(i={enumerable:!0,get:function(){return e[t]}}),Object.defineProperty(r,n,i)}:function(r,e,t,n){n===void 0&&(n=t),r[n]=e[t]}),Zf=T&&T.__setModuleDefault||(Object.create?function(r,e){Object.defineProperty(r,"default",{enumerable:!0,value:e})}:function(r,e){r.default=e}),sn=T&&T.__importStar||function(r){if(r&&r.__esModule)return r;var e={};if(r!=null)for(var t in r)t!=="default"&&Object.prototype.hasOwnProperty.call(r,t)&&Xf(e,r,t);return Zf(e,r),e};Object.defineProperty(vi,"__esModule",{value:!0});vi.ReactNative=void 0;const st=sn(Pe),eh=Ce,Or=Ne,Vi=sn(Te),nr=sn(z),Pn=sn(Me),la=sn(gt),th=Be,rh=Ue,oe=new eh.Logger("ReactNative"),ua={OS:1024,MIS:1024};class Gs extends th.HandlerInterface{static createFactory(){return()=>new Gs}constructor(){super(),this._sendStream=new MediaStream,this._mapSendLocalIdTrack=new Map,this._nextSendLocalId=0,this._mapRecvLocalIdInfo=new Map,this._hasDataChannelMediaSection=!1,this._nextSendSctpStreamId=0,this._transportReady=!1}get name(){return"ReactNative"}close(){if(oe.debug("close()"),this._sendStream.release(!1),this._pc)try{this._pc.close()}catch{}this.emit("@close")}async getNativeRtpCapabilities(){oe.debug("getNativeRtpCapabilities()");const e=new RTCPeerConnection({iceServers:[],iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"plan-b"});try{const t=await e.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0});try{e.close()}catch{}const n=st.parse(t.sdp);return Pn.extractRtpCapabilities({sdpObject:n})}catch(t){try{e.close()}catch{}throw t}}async getNativeSctpCapabilities(){return oe.debug("getNativeSctpCapabilities()"),{numStreams:ua}}run({direction:e,iceParameters:t,iceCandidates:n,dtlsParameters:i,sctpParameters:s,iceServers:o,iceTransportPolicy:a,additionalSettings:c,proprietaryConstraints:d,extendedRtpCapabilities:l}){oe.debug("run()"),this._direction=e,this._remoteSdp=new rh.RemoteSdp({iceParameters:t,iceCandidates:n,dtlsParameters:i,sctpParameters:s,planB:!0}),this._sendingRtpParametersByKind={audio:nr.getSendingRtpParameters("audio",l),video:nr.getSendingRtpParameters("video",l)},this._sendingRemoteRtpParametersByKind={audio:nr.getSendingRemoteRtpParameters("audio",l),video:nr.getSendingRemoteRtpParameters("video",l)},i.role&&i.role!=="auto"&&(this._forcedLocalDtlsRole=i.role==="server"?"client":"server"),this._pc=new RTCPeerConnection({iceServers:o||[],iceTransportPolicy:a||"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"plan-b",...c},d),this._pc.addEventListener("icegatheringstatechange",()=>{this.emit("@icegatheringstatechange",this._pc.iceGatheringState)}),this._pc.connectionState?this._pc.addEventListener("connectionstatechange",()=>{this.emit("@connectionstatechange",this._pc.connectionState)}):this._pc.addEventListener("iceconnectionstatechange",()=>{switch(oe.warn("run() | pc.connectionState not supported, using pc.iceConnectionState"),this._pc.iceConnectionState){case"checking":this.emit("@connectionstatechange","connecting");break;case"connected":case"completed":this.emit("@connectionstatechange","connected");break;case"failed":this.emit("@connectionstatechange","failed");break;case"disconnected":this.emit("@connectionstatechange","disconnected");break;case"closed":this.emit("@connectionstatechange","closed");break}})}async updateIceServers(e){oe.debug("updateIceServers()");const t=this._pc.getConfiguration();t.iceServers=e,this._pc.setConfiguration(t)}async restartIce(e){if(oe.debug("restartIce()"),this._remoteSdp.updateIceParameters(e),!!this._transportReady)if(this._direction==="send"){const t=await this._pc.createOffer({iceRestart:!0});oe.debug("restartIce() | calling pc.setLocalDescription() [offer:%o]",t),await this._pc.setLocalDescription(t);const n={type:"answer",sdp:this._remoteSdp.getSdp()};oe.debug("restartIce() | calling pc.setRemoteDescription() [answer:%o]",n),await this._pc.setRemoteDescription(n)}else{const t={type:"offer",sdp:this._remoteSdp.getSdp()};oe.debug("restartIce() | calling pc.setRemoteDescription() [offer:%o]",t),await this._pc.setRemoteDescription(t);const n=await this._pc.createAnswer();oe.debug("restartIce() | calling pc.setLocalDescription() [answer:%o]",n),await this._pc.setLocalDescription(n)}}async getTransportStats(){return this._pc.getStats()}async send({track:e,encodings:t,codecOptions:n,codec:i}){this.assertSendDirection(),oe.debug("send() [kind:%s, track.id:%s]",e.kind,e.id),i&&oe.warn("send() | codec selection is not available in %s handler",this.name),this._sendStream.addTrack(e),this._pc.addStream(this._sendStream);let s=await this._pc.createOffer(),o=st.parse(s.sdp),a;const c=Vi.clone(this._sendingRtpParametersByKind[e.kind],{});c.codecs=nr.reduceCodecs(c.codecs);const d=Vi.clone(this._sendingRemoteRtpParametersByKind[e.kind],{});if(d.codecs=nr.reduceCodecs(d.codecs),this._transportReady||await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:o}),e.kind==="video"&&t&&t.length>1&&(oe.debug("send() | enabling simulcast"),o=st.parse(s.sdp),a=o.media.find(p=>p.type==="video"),la.addLegacySimulcast({offerMediaObject:a,track:e,numStreams:t.length}),s={type:"offer",sdp:st.write(o)}),oe.debug("send() | calling pc.setLocalDescription() [offer:%o]",s),await this._pc.setLocalDescription(s),o=st.parse(this._pc.localDescription.sdp),a=o.media.find(p=>p.type===e.kind),c.rtcp.cname=Pn.getCname({offerMediaObject:a}),c.encodings=la.getRtpEncodings({offerMediaObject:a,track:e}),t)for(let p=0;p<c.encodings.length;++p)t[p]&&Object.assign(c.encodings[p],t[p]);if(c.encodings.length>1&&(c.codecs[0].mimeType.toLowerCase()==="video/vp8"||c.codecs[0].mimeType.toLowerCase()==="video/h264"))for(const p of c.encodings)p.scalabilityMode="L1T3";this._remoteSdp.send({offerMediaObject:a,offerRtpParameters:c,answerRtpParameters:d,codecOptions:n});const l={type:"answer",sdp:this._remoteSdp.getSdp()};oe.debug("send() | calling pc.setRemoteDescription() [answer:%o]",l),await this._pc.setRemoteDescription(l);const u=String(this._nextSendLocalId);return this._nextSendLocalId++,this._mapSendLocalIdTrack.set(u,e),{localId:u,rtpParameters:c}}async stopSending(e){this.assertSendDirection(),oe.debug("stopSending() [localId:%s]",e);const t=this._mapSendLocalIdTrack.get(e);if(!t)throw new Error("track not found");this._mapSendLocalIdTrack.delete(e),this._sendStream.removeTrack(t),this._pc.addStream(this._sendStream);const n=await this._pc.createOffer();oe.debug("stopSending() | calling pc.setLocalDescription() [offer:%o]",n);try{await this._pc.setLocalDescription(n)}catch(s){if(this._sendStream.getTracks().length===0){oe.warn("stopSending() | ignoring expected error due no sending tracks: %s",s.toString());return}throw s}if(this._pc.signalingState==="stable")return;const i={type:"answer",sdp:this._remoteSdp.getSdp()};oe.debug("stopSending() | calling pc.setRemoteDescription() [answer:%o]",i),await this._pc.setRemoteDescription(i)}async pauseSending(e){}async resumeSending(e){}async replaceTrack(e,t){throw new Or.UnsupportedError("not implemented")}async setMaxSpatialLayer(e,t){throw new Or.UnsupportedError("not implemented")}async setRtpEncodingParameters(e,t){throw new Or.UnsupportedError("not implemented")}async getSenderStats(e){throw new Or.UnsupportedError("not implemented")}async sendDataChannel({ordered:e,maxPacketLifeTime:t,maxRetransmits:n,label:i,protocol:s}){this.assertSendDirection();const o={negotiated:!0,id:this._nextSendSctpStreamId,ordered:e,maxPacketLifeTime:t,maxRetransmitTime:t,maxRetransmits:n,protocol:s};oe.debug("sendDataChannel() [options:%o]",o);const a=this._pc.createDataChannel(i,o);if(this._nextSendSctpStreamId=++this._nextSendSctpStreamId%ua.MIS,!this._hasDataChannelMediaSection){const d=await this._pc.createOffer(),l=st.parse(d.sdp),u=l.media.find(h=>h.type==="application");this._transportReady||await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:l}),oe.debug("sendDataChannel() | calling pc.setLocalDescription() [offer:%o]",d),await this._pc.setLocalDescription(d),this._remoteSdp.sendSctpAssociation({offerMediaObject:u});const p={type:"answer",sdp:this._remoteSdp.getSdp()};oe.debug("sendDataChannel() | calling pc.setRemoteDescription() [answer:%o]",p),await this._pc.setRemoteDescription(p),this._hasDataChannelMediaSection=!0}const c={streamId:o.id,ordered:o.ordered,maxPacketLifeTime:o.maxPacketLifeTime,maxRetransmits:o.maxRetransmits};return{dataChannel:a,sctpStreamParameters:c}}async receive(e){this.assertRecvDirection();const t=[],n=new Map;for(const a of e){const{trackId:c,kind:d,rtpParameters:l}=a;oe.debug("receive() [trackId:%s, kind:%s]",c,d);const u=d;let p=a.streamId||l.rtcp.cname;oe.debug("receive() | forcing a random remote streamId to avoid well known bug in react-native-webrtc"),p+=`-hack-${Vi.generateRandomNumber()}`,n.set(c,p),this._remoteSdp.receive({mid:u,kind:d,offerRtpParameters:l,streamId:p,trackId:c})}const i={type:"offer",sdp:this._remoteSdp.getSdp()};oe.debug("receive() | calling pc.setRemoteDescription() [offer:%o]",i),await this._pc.setRemoteDescription(i);let s=await this._pc.createAnswer();const o=st.parse(s.sdp);for(const a of e){const{kind:c,rtpParameters:d}=a,l=c,u=o.media.find(p=>String(p.mid)===l);Pn.applyCodecParameters({offerRtpParameters:d,answerMediaObject:u})}s={type:"answer",sdp:st.write(o)},this._transportReady||await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:o}),oe.debug("receive() | calling pc.setLocalDescription() [answer:%o]",s),await this._pc.setLocalDescription(s);for(const a of e){const{kind:c,trackId:d,rtpParameters:l}=a,u=d,p=c,h=n.get(d),m=this._pc.getRemoteStreams().find(g=>g.id===h).getTrackById(u);if(!m)throw new Error("remote track not found");this._mapRecvLocalIdInfo.set(u,{mid:p,rtpParameters:l}),t.push({localId:u,track:m})}return t}async stopReceiving(e){this.assertRecvDirection();for(const i of e){oe.debug("stopReceiving() [localId:%s]",i);const{mid:s,rtpParameters:o}=this._mapRecvLocalIdInfo.get(i)||{};this._mapRecvLocalIdInfo.delete(i),this._remoteSdp.planBStopReceiving({mid:s,offerRtpParameters:o})}const t={type:"offer",sdp:this._remoteSdp.getSdp()};oe.debug("stopReceiving() | calling pc.setRemoteDescription() [offer:%o]",t),await this._pc.setRemoteDescription(t);const n=await this._pc.createAnswer();oe.debug("stopReceiving() | calling pc.setLocalDescription() [answer:%o]",n),await this._pc.setLocalDescription(n)}async pauseReceiving(e){}async resumeReceiving(e){}async getReceiverStats(e){throw new Or.UnsupportedError("not implemented")}async receiveDataChannel({sctpStreamParameters:e,label:t,protocol:n}){this.assertRecvDirection();const{streamId:i,ordered:s,maxPacketLifeTime:o,maxRetransmits:a}=e,c={negotiated:!0,id:i,ordered:s,maxPacketLifeTime:o,maxRetransmitTime:o,maxRetransmits:a,protocol:n};oe.debug("receiveDataChannel() [options:%o]",c);const d=this._pc.createDataChannel(t,c);if(!this._hasDataChannelMediaSection){this._remoteSdp.receiveSctpAssociation({oldDataChannelSpec:!0});const l={type:"offer",sdp:this._remoteSdp.getSdp()};oe.debug("receiveDataChannel() | calling pc.setRemoteDescription() [offer:%o]",l),await this._pc.setRemoteDescription(l);const u=await this._pc.createAnswer();if(!this._transportReady){const p=st.parse(u.sdp);await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:p})}oe.debug("receiveDataChannel() | calling pc.setRemoteDescription() [answer:%o]",u),await this._pc.setLocalDescription(u),this._hasDataChannelMediaSection=!0}return{dataChannel:d}}async setupTransport({localDtlsRole:e,localSdpObject:t}){t||(t=st.parse(this._pc.localDescription.sdp));const n=Pn.extractDtlsParameters({sdpObject:t});n.role=e,this._remoteSdp.updateDtlsRole(e==="client"?"server":"client"),await new Promise((i,s)=>{this.safeEmit("@connect",{dtlsParameters:n},i,s)}),this._transportReady=!0}assertSendDirection(){if(this._direction!=="send")throw new Error('method can just be called for handlers with "send" direction')}assertRecvDirection(){if(this._direction!=="recv")throw new Error('method can just be called for handlers with "recv" direction')}}vi.ReactNative=Gs;var nh=T&&T.__createBinding||(Object.create?function(r,e,t,n){n===void 0&&(n=t);var i=Object.getOwnPropertyDescriptor(e,t);(!i||("get"in i?!e.__esModule:i.writable||i.configurable))&&(i={enumerable:!0,get:function(){return e[t]}}),Object.defineProperty(r,n,i)}:function(r,e,t,n){n===void 0&&(n=t),r[n]=e[t]}),ih=T&&T.__setModuleDefault||(Object.create?function(r,e){Object.defineProperty(r,"default",{enumerable:!0,value:e})}:function(r,e){r.default=e}),Fc=T&&T.__importStar||function(r){if(r&&r.__esModule)return r;var e={};if(r!=null)for(var t in r)t!=="default"&&Object.prototype.hasOwnProperty.call(r,t)&&nh(e,r,t);return ih(e,r),e};Object.defineProperty(Mt,"__esModule",{value:!0});Mt.Device=Mt.detectDevice=void 0;const sh=Yl,oh=Ce,ah=lt,ir=Ne,ch=Fc(Te),St=Fc(z),dh=Wr,lh=ai,uh=ci,ph=di,fh=li,hh=ui,mh=pi,gh=fi,vh=hi,yh=mi,_h=gi,wh=vi,ke=new oh.Logger("Device");function Uc(){var r,e,t;if(typeof navigator=="object"&&navigator.product==="ReactNative"){if(ke.debug("detectDevice() | React-Native detected"),typeof RTCPeerConnection>"u"){ke.warn("detectDevice() | unsupported react-native-webrtc without RTCPeerConnection, forgot to call registerGlobals()?");return}return typeof RTCRtpTransceiver<"u"?(ke.debug("detectDevice() | ReactNative UnifiedPlan handler chosen"),"ReactNativeUnifiedPlan"):(ke.debug("detectDevice() | ReactNative PlanB handler chosen"),"ReactNative")}else if(typeof navigator=="object"&&typeof navigator.userAgent=="string"){const n=navigator.userAgent,i=new sh.UAParser(n);ke.debug("detectDevice() | browser detected [ua:%s, parsed:%o]",n,i.getResult());const s=i.getBrowser(),o=((r=s.name)==null?void 0:r.toLowerCase())??"",a=parseInt(s.major??"0"),d=((e=i.getEngine().name)==null?void 0:e.toLowerCase())??"",l=i.getOS(),u=((t=l.name)==null?void 0:t.toLowerCase())??"",p=parseFloat(l.version??"0"),h=u==="ios",f=["chrome","chromium","mobile chrome","chrome webview","chrome headless"].includes(o),m=["firefox","mobile firefox","mobile focus"].includes(o),g=["safari","mobile safari"].includes(o),w=["edge"].includes(o);if((f||w)&&!h&&a>=111)return"Chrome111";if(f&&!h&&a>=74||w&&!h&&a>=88)return"Chrome74";if(f&&!h&&a>=70)return"Chrome70";if(f&&!h&&a>=67)return"Chrome67";if(f&&!h&&a>=55)return"Chrome55";if(m&&!h&&a>=60)return"Firefox60";if(m&&h&&p>=14.3)return"Safari12";if(g&&a>=12&&typeof RTCRtpTransceiver<"u"&&RTCRtpTransceiver.prototype.hasOwnProperty("currentDirection"))return"Safari12";if(g&&a>=11)return"Safari11";if(w&&!h&&a>=11&&a<=18)return"Edge11";if(d==="webkit"&&h&&p>=14.3&&typeof RTCRtpTransceiver<"u"&&RTCRtpTransceiver.prototype.hasOwnProperty("currentDirection"))return"Safari12";if(d==="blink"){const C=n.match(/(?:(?:Chrome|Chromium))[ /](\w+)/i);if(C){const b=Number(C[1]);return b>=111?"Chrome111":b>=74?"Chrome74":b>=70?"Chrome70":b>=67?"Chrome67":"Chrome55"}else return"Chrome111"}else{ke.warn("detectDevice() | browser not supported [name:%s, version:%s]",o,a);return}}else{ke.warn("detectDevice() | unknown device");return}}Mt.detectDevice=Uc;class bh{constructor({handlerName:e,handlerFactory:t,Handler:n}={}){if(this._loaded=!1,this._observer=new ah.EnhancedEventEmitter,ke.debug("constructor()"),n)if(ke.warn("constructor() | Handler option is DEPRECATED, use handlerName or handlerFactory instead"),typeof n=="string")e=n;else throw new TypeError("non string Handler option no longer supported, use handlerFactory instead");if(e&&t)throw new TypeError("just one of handlerName or handlerInterface can be given");if(t)this._handlerFactory=t;else{if(e)ke.debug("constructor() | handler given: %s",e);else if(e=Uc(),e)ke.debug("constructor() | detected handler: %s",e);else throw new ir.UnsupportedError("device not supported");switch(e){case"Chrome111":this._handlerFactory=lh.Chrome111.createFactory();break;case"Chrome74":this._handlerFactory=uh.Chrome74.createFactory();break;case"Chrome70":this._handlerFactory=ph.Chrome70.createFactory();break;case"Chrome67":this._handlerFactory=fh.Chrome67.createFactory();break;case"Chrome55":this._handlerFactory=hh.Chrome55.createFactory();break;case"Firefox60":this._handlerFactory=mh.Firefox60.createFactory();break;case"Safari12":this._handlerFactory=gh.Safari12.createFactory();break;case"Safari11":this._handlerFactory=vh.Safari11.createFactory();break;case"Edge11":this._handlerFactory=yh.Edge11.createFactory();break;case"ReactNativeUnifiedPlan":this._handlerFactory=_h.ReactNativeUnifiedPlan.createFactory();break;case"ReactNative":this._handlerFactory=wh.ReactNative.createFactory();break;default:throw new TypeError(`unknown handlerName "${e}"`)}}const i=this._handlerFactory();this._handlerName=i.name,i.close(),this._extendedRtpCapabilities=void 0,this._recvRtpCapabilities=void 0,this._canProduceByKind={audio:!1,video:!1},this._sctpCapabilities=void 0}get handlerName(){return this._handlerName}get loaded(){return this._loaded}get rtpCapabilities(){if(!this._loaded)throw new ir.InvalidStateError("not loaded");return this._recvRtpCapabilities}get sctpCapabilities(){if(!this._loaded)throw new ir.InvalidStateError("not loaded");return this._sctpCapabilities}get observer(){return this._observer}async load({routerRtpCapabilities:e}){ke.debug("load() [routerRtpCapabilities:%o]",e),e=ch.clone(e,void 0);let t;try{if(this._loaded)throw new ir.InvalidStateError("already loaded");St.validateRtpCapabilities(e),t=this._handlerFactory();const n=await t.getNativeRtpCapabilities();ke.debug("load() | got native RTP capabilities:%o",n),St.validateRtpCapabilities(n),this._extendedRtpCapabilities=St.getExtendedRtpCapabilities(n,e),ke.debug("load() | got extended RTP capabilities:%o",this._extendedRtpCapabilities),this._canProduceByKind.audio=St.canSend("audio",this._extendedRtpCapabilities),this._canProduceByKind.video=St.canSend("video",this._extendedRtpCapabilities),this._recvRtpCapabilities=St.getRecvRtpCapabilities(this._extendedRtpCapabilities),St.validateRtpCapabilities(this._recvRtpCapabilities),ke.debug("load() | got receiving RTP capabilities:%o",this._recvRtpCapabilities),this._sctpCapabilities=await t.getNativeSctpCapabilities(),ke.debug("load() | got native SCTP capabilities:%o",this._sctpCapabilities),St.validateSctpCapabilities(this._sctpCapabilities),ke.debug("load() succeeded"),this._loaded=!0,t.close()}catch(n){throw t&&t.close(),n}}canProduce(e){if(this._loaded){if(e!=="audio"&&e!=="video")throw new TypeError(`invalid kind "${e}"`)}else throw new ir.InvalidStateError("not loaded");return this._canProduceByKind[e]}createSendTransport({id:e,iceParameters:t,iceCandidates:n,dtlsParameters:i,sctpParameters:s,iceServers:o,iceTransportPolicy:a,additionalSettings:c,proprietaryConstraints:d,appData:l}){return ke.debug("createSendTransport()"),this.createTransport({direction:"send",id:e,iceParameters:t,iceCandidates:n,dtlsParameters:i,sctpParameters:s,iceServers:o,iceTransportPolicy:a,additionalSettings:c,proprietaryConstraints:d,appData:l})}createRecvTransport({id:e,iceParameters:t,iceCandidates:n,dtlsParameters:i,sctpParameters:s,iceServers:o,iceTransportPolicy:a,additionalSettings:c,proprietaryConstraints:d,appData:l}){return ke.debug("createRecvTransport()"),this.createTransport({direction:"recv",id:e,iceParameters:t,iceCandidates:n,dtlsParameters:i,sctpParameters:s,iceServers:o,iceTransportPolicy:a,additionalSettings:c,proprietaryConstraints:d,appData:l})}createTransport({direction:e,id:t,iceParameters:n,iceCandidates:i,dtlsParameters:s,sctpParameters:o,iceServers:a,iceTransportPolicy:c,additionalSettings:d,proprietaryConstraints:l,appData:u}){if(this._loaded){if(typeof t!="string")throw new TypeError("missing id");if(typeof n!="object")throw new TypeError("missing iceParameters");if(Array.isArray(i)){if(typeof s!="object")throw new TypeError("missing dtlsParameters");if(o&&typeof o!="object")throw new TypeError("wrong sctpParameters");if(u&&typeof u!="object")throw new TypeError("if given, appData must be an object")}else throw new TypeError("missing iceCandidates")}else throw new ir.InvalidStateError("not loaded");const p=new dh.Transport({direction:e,id:t,iceParameters:n,iceCandidates:i,dtlsParameters:s,sctpParameters:o,iceServers:a,iceTransportPolicy:c,additionalSettings:d,proprietaryConstraints:l,appData:u,handlerFactory:this._handlerFactory,extendedRtpCapabilities:this._extendedRtpCapabilities,canProduceByKind:this._canProduceByKind});return this._observer.safeEmit("newtransport",p),p}}Mt.Device=bh;var zc={},Vc={};Object.defineProperty(Vc,"__esModule",{value:!0});var Jc={};Object.defineProperty(Jc,"__esModule",{value:!0});(function(r){var e=T&&T.__createBinding||(Object.create?function(n,i,s,o){o===void 0&&(o=s);var a=Object.getOwnPropertyDescriptor(i,s);(!a||("get"in a?!i.__esModule:a.writable||a.configurable))&&(a={enumerable:!0,get:function(){return i[s]}}),Object.defineProperty(n,o,a)}:function(n,i,s,o){o===void 0&&(o=s),n[o]=i[s]}),t=T&&T.__exportStar||function(n,i){for(var s in n)s!=="default"&&!Object.prototype.hasOwnProperty.call(i,s)&&e(i,n,s)};Object.defineProperty(r,"__esModule",{value:!0}),t(Mt,r),t(Wr,r),t(Kr,r),t(Yr,r),t(Qr,r),t(Xr,r),t(Vc,r),t(Jc,r),t(Be,r),t(Ne,r)})(zc);(function(r){var e=T&&T.__createBinding||(Object.create?function(d,l,u,p){p===void 0&&(p=u);var h=Object.getOwnPropertyDescriptor(l,u);(!h||("get"in h?!l.__esModule:h.writable||h.configurable))&&(h={enumerable:!0,get:function(){return l[u]}}),Object.defineProperty(d,p,h)}:function(d,l,u,p){p===void 0&&(p=u),d[p]=l[u]}),t=T&&T.__setModuleDefault||(Object.create?function(d,l){Object.defineProperty(d,"default",{enumerable:!0,value:l})}:function(d,l){d.default=l}),n=T&&T.__importStar||function(d){if(d&&d.__esModule)return d;var l={};if(d!=null)for(var u in d)u!=="default"&&Object.prototype.hasOwnProperty.call(d,u)&&e(l,d,u);return t(l,d),l},i=T&&T.__importDefault||function(d){return d&&d.__esModule?d:{default:d}};Object.defineProperty(r,"__esModule",{value:!0}),r.debug=r.parseScalabilityMode=r.detectDevice=r.Device=r.version=r.types=void 0;const s=i(ri);r.debug=s.default;const o=Mt;Object.defineProperty(r,"Device",{enumerable:!0,get:function(){return o.Device}}),Object.defineProperty(r,"detectDevice",{enumerable:!0,get:function(){return o.detectDevice}});const a=n(zc);r.types=a,r.version="3.6.98";var c=ut;Object.defineProperty(r,"parseScalabilityMode",{enumerable:!0,get:function(){return c.parse}})})(hc);let pa=(r=21)=>crypto.getRandomValues(new Uint8Array(r)).reduce((e,t)=>(t&=63,t<36?e+=t.toString(36):t<62?e+=(t-26).toString(36).toUpperCase():t>62?e+="-":e+="_",e),"");const dt=Object.create(null);dt.open="0";dt.close="1";dt.ping="2";dt.pong="3";dt.message="4";dt.upgrade="5";dt.noop="6";const An=Object.create(null);Object.keys(dt).forEach(r=>{An[dt[r]]=r});const Sh={type:"error",data:"parser error"},qc=typeof Blob=="function"||typeof Blob<"u"&&Object.prototype.toString.call(Blob)==="[object BlobConstructor]",Gc=typeof ArrayBuffer=="function",Hc=r=>typeof ArrayBuffer.isView=="function"?ArrayBuffer.isView(r):r&&r.buffer instanceof ArrayBuffer,Hs=({type:r,data:e},t,n)=>qc&&e instanceof Blob?t?n(e):fa(e,n):Gc&&(e instanceof ArrayBuffer||Hc(e))?t?n(e):fa(new Blob([e]),n):n(dt[r]+(e||"")),fa=(r,e)=>{const t=new FileReader;return t.onload=function(){const n=t.result.split(",")[1];e("b"+(n||""))},t.readAsDataURL(r)};function ha(r){return r instanceof Uint8Array?r:r instanceof ArrayBuffer?new Uint8Array(r):new Uint8Array(r.buffer,r.byteOffset,r.byteLength)}let Ji;function Rh(r,e){if(qc&&r.data instanceof Blob)return r.data.arrayBuffer().then(ha).then(e);if(Gc&&(r.data instanceof ArrayBuffer||Hc(r.data)))return e(ha(r.data));Hs(r,!1,t=>{Ji||(Ji=new TextEncoder),e(Ji.encode(t))})}const ma="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",Br=typeof Uint8Array>"u"?[]:new Uint8Array(256);for(let r=0;r<ma.length;r++)Br[ma.charCodeAt(r)]=r;const Ch=r=>{let e=r.length*.75,t=r.length,n,i=0,s,o,a,c;r[r.length-1]==="="&&(e--,r[r.length-2]==="="&&e--);const d=new ArrayBuffer(e),l=new Uint8Array(d);for(n=0;n<t;n+=4)s=Br[r.charCodeAt(n)],o=Br[r.charCodeAt(n+1)],a=Br[r.charCodeAt(n+2)],c=Br[r.charCodeAt(n+3)],l[i++]=s<<2|o>>4,l[i++]=(o&15)<<4|a>>2,l[i++]=(a&3)<<6|c&63;return d},Eh=typeof ArrayBuffer=="function",Ws=(r,e)=>{if(typeof r!="string")return{type:"message",data:Wc(r,e)};const t=r.charAt(0);return t==="b"?{type:"message",data:Th(r.substring(1),e)}:An[t]?r.length>1?{type:An[t],data:r.substring(1)}:{type:An[t]}:Sh},Th=(r,e)=>{if(Eh){const t=Ch(r);return Wc(t,e)}else return{base64:!0,data:r}},Wc=(r,e)=>{switch(e){case"blob":return r instanceof Blob?r:new Blob([r]);case"arraybuffer":default:return r instanceof ArrayBuffer?r:r.buffer}},Kc=String.fromCharCode(30),Ph=(r,e)=>{const t=r.length,n=new Array(t);let i=0;r.forEach((s,o)=>{Hs(s,!1,a=>{n[o]=a,++i===t&&e(n.join(Kc))})})},Dh=(r,e)=>{const t=r.split(Kc),n=[];for(let i=0;i<t.length;i++){const s=Ws(t[i],e);if(n.push(s),s.type==="error")break}return n};let qi;function xh(r,e,t){qi||(qi=new TextDecoder);const n=e||r[0]<48||r[0]>54;return Ws(n?r:qi.decode(r),t)}const Yc=4;function Le(r){if(r)return Oh(r)}function Oh(r){for(var e in Le.prototype)r[e]=Le.prototype[e];return r}Le.prototype.on=Le.prototype.addEventListener=function(r,e){return this._callbacks=this._callbacks||{},(this._callbacks["$"+r]=this._callbacks["$"+r]||[]).push(e),this};Le.prototype.once=function(r,e){function t(){this.off(r,t),e.apply(this,arguments)}return t.fn=e,this.on(r,t),this};Le.prototype.off=Le.prototype.removeListener=Le.prototype.removeAllListeners=Le.prototype.removeEventListener=function(r,e){if(this._callbacks=this._callbacks||{},arguments.length==0)return this._callbacks={},this;var t=this._callbacks["$"+r];if(!t)return this;if(arguments.length==1)return delete this._callbacks["$"+r],this;for(var n,i=0;i<t.length;i++)if(n=t[i],n===e||n.fn===e){t.splice(i,1);break}return t.length===0&&delete this._callbacks["$"+r],this};Le.prototype.emit=function(r){this._callbacks=this._callbacks||{};for(var e=new Array(arguments.length-1),t=this._callbacks["$"+r],n=1;n<arguments.length;n++)e[n-1]=arguments[n];if(t){t=t.slice(0);for(var n=0,i=t.length;n<i;++n)t[n].apply(this,e)}return this};Le.prototype.emitReserved=Le.prototype.emit;Le.prototype.listeners=function(r){return this._callbacks=this._callbacks||{},this._callbacks["$"+r]||[]};Le.prototype.hasListeners=function(r){return!!this.listeners(r).length};const Ve=(()=>typeof self<"u"?self:typeof window<"u"?window:Function("return this")())();function Qc(r,...e){return e.reduce((t,n)=>(r.hasOwnProperty(n)&&(t[n]=r[n]),t),{})}const Lh=Ve.setTimeout,Ih=Ve.clearTimeout;function yi(r,e){e.useNativeTimers?(r.setTimeoutFn=Lh.bind(Ve),r.clearTimeoutFn=Ih.bind(Ve)):(r.setTimeoutFn=Ve.setTimeout.bind(Ve),r.clearTimeoutFn=Ve.clearTimeout.bind(Ve))}const kh=1.33;function Mh(r){return typeof r=="string"?Nh(r):Math.ceil((r.byteLength||r.size)*kh)}function Nh(r){let e=0,t=0;for(let n=0,i=r.length;n<i;n++)e=r.charCodeAt(n),e<128?t+=1:e<2048?t+=2:e<55296||e>=57344?t+=3:(n++,t+=4);return t}function Ah(r){let e="";for(let t in r)r.hasOwnProperty(t)&&(e.length&&(e+="&"),e+=encodeURIComponent(t)+"="+encodeURIComponent(r[t]));return e}function jh(r){let e={},t=r.split("&");for(let n=0,i=t.length;n<i;n++){let s=t[n].split("=");e[decodeURIComponent(s[0])]=decodeURIComponent(s[1])}return e}class $h extends Error{constructor(e,t,n){super(e),this.description=t,this.context=n,this.type="TransportError"}}class Ks extends Le{constructor(e){super(),this.writable=!1,yi(this,e),this.opts=e,this.query=e.query,this.socket=e.socket}onError(e,t,n){return super.emitReserved("error",new $h(e,t,n)),this}open(){return this.readyState="opening",this.doOpen(),this}close(){return(this.readyState==="opening"||this.readyState==="open")&&(this.doClose(),this.onClose()),this}send(e){this.readyState==="open"&&this.write(e)}onOpen(){this.readyState="open",this.writable=!0,super.emitReserved("open")}onData(e){const t=Ws(e,this.socket.binaryType);this.onPacket(t)}onPacket(e){super.emitReserved("packet",e)}onClose(e){this.readyState="closed",super.emitReserved("close",e)}pause(e){}createUri(e,t={}){return e+"://"+this._hostname()+this._port()+this.opts.path+this._query(t)}_hostname(){const e=this.opts.hostname;return e.indexOf(":")===-1?e:"["+e+"]"}_port(){return this.opts.port&&(this.opts.secure&&+(this.opts.port!==443)||!this.opts.secure&&Number(this.opts.port)!==80)?":"+this.opts.port:""}_query(e){const t=Ah(e);return t.length?"?"+t:""}}const Xc="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz-_".split(""),ls=64,Bh={};let ga=0,Dn=0,va;function ya(r){let e="";do e=Xc[r%ls]+e,r=Math.floor(r/ls);while(r>0);return e}function Zc(){const r=ya(+new Date);return r!==va?(ga=0,va=r):r+"."+ya(ga++)}for(;Dn<ls;Dn++)Bh[Xc[Dn]]=Dn;let ed=!1;try{ed=typeof XMLHttpRequest<"u"&&"withCredentials"in new XMLHttpRequest}catch{}const Fh=ed;function td(r){const e=r.xdomain;try{if(typeof XMLHttpRequest<"u"&&(!e||Fh))return new XMLHttpRequest}catch{}if(!e)try{return new Ve[["Active"].concat("Object").join("X")]("Microsoft.XMLHTTP")}catch{}}function Uh(){}const zh=function(){return new td({xdomain:!1}).responseType!=null}();class Vh extends Ks{constructor(e){if(super(e),this.polling=!1,typeof location<"u"){const n=location.protocol==="https:";let i=location.port;i||(i=n?"443":"80"),this.xd=typeof location<"u"&&e.hostname!==location.hostname||i!==e.port}const t=e&&e.forceBase64;this.supportsBinary=zh&&!t,this.opts.withCredentials&&(this.cookieJar=void 0)}get name(){return"polling"}doOpen(){this.poll()}pause(e){this.readyState="pausing";const t=()=>{this.readyState="paused",e()};if(this.polling||!this.writable){let n=0;this.polling&&(n++,this.once("pollComplete",function(){--n||t()})),this.writable||(n++,this.once("drain",function(){--n||t()}))}else t()}poll(){this.polling=!0,this.doPoll(),this.emitReserved("poll")}onData(e){const t=n=>{if(this.readyState==="opening"&&n.type==="open"&&this.onOpen(),n.type==="close")return this.onClose({description:"transport closed by the server"}),!1;this.onPacket(n)};Dh(e,this.socket.binaryType).forEach(t),this.readyState!=="closed"&&(this.polling=!1,this.emitReserved("pollComplete"),this.readyState==="open"&&this.poll())}doClose(){const e=()=>{this.write([{type:"close"}])};this.readyState==="open"?e():this.once("open",e)}write(e){this.writable=!1,Ph(e,t=>{this.doWrite(t,()=>{this.writable=!0,this.emitReserved("drain")})})}uri(){const e=this.opts.secure?"https":"http",t=this.query||{};return this.opts.timestampRequests!==!1&&(t[this.opts.timestampParam]=Zc()),!this.supportsBinary&&!t.sid&&(t.b64=1),this.createUri(e,t)}request(e={}){return Object.assign(e,{xd:this.xd,cookieJar:this.cookieJar},this.opts),new ct(this.uri(),e)}doWrite(e,t){const n=this.request({method:"POST",data:e});n.on("success",t),n.on("error",(i,s)=>{this.onError("xhr post error",i,s)})}doPoll(){const e=this.request();e.on("data",this.onData.bind(this)),e.on("error",(t,n)=>{this.onError("xhr poll error",t,n)}),this.pollXhr=e}}class ct extends Le{constructor(e,t){super(),yi(this,t),this.opts=t,this.method=t.method||"GET",this.uri=e,this.data=t.data!==void 0?t.data:null,this.create()}create(){var e;const t=Qc(this.opts,"agent","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","autoUnref");t.xdomain=!!this.opts.xd;const n=this.xhr=new td(t);try{n.open(this.method,this.uri,!0);try{if(this.opts.extraHeaders){n.setDisableHeaderCheck&&n.setDisableHeaderCheck(!0);for(let i in this.opts.extraHeaders)this.opts.extraHeaders.hasOwnProperty(i)&&n.setRequestHeader(i,this.opts.extraHeaders[i])}}catch{}if(this.method==="POST")try{n.setRequestHeader("Content-type","text/plain;charset=UTF-8")}catch{}try{n.setRequestHeader("Accept","*/*")}catch{}(e=this.opts.cookieJar)===null||e===void 0||e.addCookies(n),"withCredentials"in n&&(n.withCredentials=this.opts.withCredentials),this.opts.requestTimeout&&(n.timeout=this.opts.requestTimeout),n.onreadystatechange=()=>{var i;n.readyState===3&&((i=this.opts.cookieJar)===null||i===void 0||i.parseCookies(n)),n.readyState===4&&(n.status===200||n.status===1223?this.onLoad():this.setTimeoutFn(()=>{this.onError(typeof n.status=="number"?n.status:0)},0))},n.send(this.data)}catch(i){this.setTimeoutFn(()=>{this.onError(i)},0);return}typeof document<"u"&&(this.index=ct.requestsCount++,ct.requests[this.index]=this)}onError(e){this.emitReserved("error",e,this.xhr),this.cleanup(!0)}cleanup(e){if(!(typeof this.xhr>"u"||this.xhr===null)){if(this.xhr.onreadystatechange=Uh,e)try{this.xhr.abort()}catch{}typeof document<"u"&&delete ct.requests[this.index],this.xhr=null}}onLoad(){const e=this.xhr.responseText;e!==null&&(this.emitReserved("data",e),this.emitReserved("success"),this.cleanup())}abort(){this.cleanup()}}ct.requestsCount=0;ct.requests={};if(typeof document<"u"){if(typeof attachEvent=="function")attachEvent("onunload",_a);else if(typeof addEventListener=="function"){const r="onpagehide"in Ve?"pagehide":"unload";addEventListener(r,_a,!1)}}function _a(){for(let r in ct.requests)ct.requests.hasOwnProperty(r)&&ct.requests[r].abort()}const Ys=(()=>typeof Promise=="function"&&typeof Promise.resolve=="function"?e=>Promise.resolve().then(e):(e,t)=>t(e,0))(),xn=Ve.WebSocket||Ve.MozWebSocket,wa=!0,Jh="arraybuffer",ba=typeof navigator<"u"&&typeof navigator.product=="string"&&navigator.product.toLowerCase()==="reactnative";class qh extends Ks{constructor(e){super(e),this.supportsBinary=!e.forceBase64}get name(){return"websocket"}doOpen(){if(!this.check())return;const e=this.uri(),t=this.opts.protocols,n=ba?{}:Qc(this.opts,"agent","perMessageDeflate","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","localAddress","protocolVersion","origin","maxPayload","family","checkServerIdentity");this.opts.extraHeaders&&(n.headers=this.opts.extraHeaders);try{this.ws=wa&&!ba?t?new xn(e,t):new xn(e):new xn(e,t,n)}catch(i){return this.emitReserved("error",i)}this.ws.binaryType=this.socket.binaryType||Jh,this.addEventListeners()}addEventListeners(){this.ws.onopen=()=>{this.opts.autoUnref&&this.ws._socket.unref(),this.onOpen()},this.ws.onclose=e=>this.onClose({description:"websocket connection closed",context:e}),this.ws.onmessage=e=>this.onData(e.data),this.ws.onerror=e=>this.onError("websocket error",e)}write(e){this.writable=!1;for(let t=0;t<e.length;t++){const n=e[t],i=t===e.length-1;Hs(n,this.supportsBinary,s=>{const o={};try{wa&&this.ws.send(s)}catch{}i&&Ys(()=>{this.writable=!0,this.emitReserved("drain")},this.setTimeoutFn)})}}doClose(){typeof this.ws<"u"&&(this.ws.close(),this.ws=null)}uri(){const e=this.opts.secure?"wss":"ws",t=this.query||{};return this.opts.timestampRequests&&(t[this.opts.timestampParam]=Zc()),this.supportsBinary||(t.b64=1),this.createUri(e,t)}check(){return!!xn}}function Gh(r,e){return r.type==="message"&&typeof r.data!="string"&&e[0]>=48&&e[0]<=54}class Hh extends Ks{get name(){return"webtransport"}doOpen(){typeof WebTransport=="function"&&(this.transport=new WebTransport(this.createUri("https"),this.opts.transportOptions[this.name]),this.transport.closed.then(()=>{this.onClose()}).catch(e=>{this.onError("webtransport error",e)}),this.transport.ready.then(()=>{this.transport.createBidirectionalStream().then(e=>{const t=e.readable.getReader();this.writer=e.writable.getWriter();let n;const i=()=>{t.read().then(({done:o,value:a})=>{o||(!n&&a.byteLength===1&&a[0]===54?n=!0:(this.onPacket(xh(a,n,"arraybuffer")),n=!1),i())}).catch(o=>{})};i();const s=this.query.sid?`0{"sid":"${this.query.sid}"}`:"0";this.writer.write(new TextEncoder().encode(s)).then(()=>this.onOpen())})}))}write(e){this.writable=!1;for(let t=0;t<e.length;t++){const n=e[t],i=t===e.length-1;Rh(n,s=>{Gh(n,s)&&this.writer.write(Uint8Array.of(54)),this.writer.write(s).then(()=>{i&&Ys(()=>{this.writable=!0,this.emitReserved("drain")},this.setTimeoutFn)})})}}doClose(){var e;(e=this.transport)===null||e===void 0||e.close()}}const Wh={websocket:qh,webtransport:Hh,polling:Vh},Kh=/^(?:(?![^:@\/?#]+:[^:@\/]*@)(http|https|ws|wss):\/\/)?((?:(([^:@\/?#]*)(?::([^:@\/?#]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,Yh=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"];function us(r){const e=r,t=r.indexOf("["),n=r.indexOf("]");t!=-1&&n!=-1&&(r=r.substring(0,t)+r.substring(t,n).replace(/:/g,";")+r.substring(n,r.length));let i=Kh.exec(r||""),s={},o=14;for(;o--;)s[Yh[o]]=i[o]||"";return t!=-1&&n!=-1&&(s.source=e,s.host=s.host.substring(1,s.host.length-1).replace(/;/g,":"),s.authority=s.authority.replace("[","").replace("]","").replace(/;/g,":"),s.ipv6uri=!0),s.pathNames=Qh(s,s.path),s.queryKey=Xh(s,s.query),s}function Qh(r,e){const t=/\/{2,9}/g,n=e.replace(t,"/").split("/");return(e.slice(0,1)=="/"||e.length===0)&&n.splice(0,1),e.slice(-1)=="/"&&n.splice(n.length-1,1),n}function Xh(r,e){const t={};return e.replace(/(?:^|&)([^&=]*)=?([^&]*)/g,function(n,i,s){i&&(t[i]=s)}),t}let rd=class dr extends Le{constructor(e,t={}){super(),this.writeBuffer=[],e&&typeof e=="object"&&(t=e,e=null),e?(e=us(e),t.hostname=e.host,t.secure=e.protocol==="https"||e.protocol==="wss",t.port=e.port,e.query&&(t.query=e.query)):t.host&&(t.hostname=us(t.host).host),yi(this,t),this.secure=t.secure!=null?t.secure:typeof location<"u"&&location.protocol==="https:",t.hostname&&!t.port&&(t.port=this.secure?"443":"80"),this.hostname=t.hostname||(typeof location<"u"?location.hostname:"localhost"),this.port=t.port||(typeof location<"u"&&location.port?location.port:this.secure?"443":"80"),this.transports=t.transports||["polling","websocket","webtransport"],this.writeBuffer=[],this.prevBufferLen=0,this.opts=Object.assign({path:"/engine.io",agent:!1,withCredentials:!1,upgrade:!0,timestampParam:"t",rememberUpgrade:!1,addTrailingSlash:!0,rejectUnauthorized:!0,perMessageDeflate:{threshold:1024},transportOptions:{},closeOnBeforeunload:!1},t),this.opts.path=this.opts.path.replace(/\/$/,"")+(this.opts.addTrailingSlash?"/":""),typeof this.opts.query=="string"&&(this.opts.query=jh(this.opts.query)),this.id=null,this.upgrades=null,this.pingInterval=null,this.pingTimeout=null,this.pingTimeoutTimer=null,typeof addEventListener=="function"&&(this.opts.closeOnBeforeunload&&(this.beforeunloadEventListener=()=>{this.transport&&(this.transport.removeAllListeners(),this.transport.close())},addEventListener("beforeunload",this.beforeunloadEventListener,!1)),this.hostname!=="localhost"&&(this.offlineEventListener=()=>{this.onClose("transport close",{description:"network connection lost"})},addEventListener("offline",this.offlineEventListener,!1))),this.open()}createTransport(e){const t=Object.assign({},this.opts.query);t.EIO=Yc,t.transport=e,this.id&&(t.sid=this.id);const n=Object.assign({},this.opts,{query:t,socket:this,hostname:this.hostname,secure:this.secure,port:this.port},this.opts.transportOptions[e]);return new Wh[e](n)}open(){let e;if(this.opts.rememberUpgrade&&dr.priorWebsocketSuccess&&this.transports.indexOf("websocket")!==-1)e="websocket";else if(this.transports.length===0){this.setTimeoutFn(()=>{this.emitReserved("error","No transports available")},0);return}else e=this.transports[0];this.readyState="opening";try{e=this.createTransport(e)}catch{this.transports.shift(),this.open();return}e.open(),this.setTransport(e)}setTransport(e){this.transport&&this.transport.removeAllListeners(),this.transport=e,e.on("drain",this.onDrain.bind(this)).on("packet",this.onPacket.bind(this)).on("error",this.onError.bind(this)).on("close",t=>this.onClose("transport close",t))}probe(e){let t=this.createTransport(e),n=!1;dr.priorWebsocketSuccess=!1;const i=()=>{n||(t.send([{type:"ping",data:"probe"}]),t.once("packet",u=>{if(!n)if(u.type==="pong"&&u.data==="probe"){if(this.upgrading=!0,this.emitReserved("upgrading",t),!t)return;dr.priorWebsocketSuccess=t.name==="websocket",this.transport.pause(()=>{n||this.readyState!=="closed"&&(l(),this.setTransport(t),t.send([{type:"upgrade"}]),this.emitReserved("upgrade",t),t=null,this.upgrading=!1,this.flush())})}else{const p=new Error("probe error");p.transport=t.name,this.emitReserved("upgradeError",p)}}))};function s(){n||(n=!0,l(),t.close(),t=null)}const o=u=>{const p=new Error("probe error: "+u);p.transport=t.name,s(),this.emitReserved("upgradeError",p)};function a(){o("transport closed")}function c(){o("socket closed")}function d(u){t&&u.name!==t.name&&s()}const l=()=>{t.removeListener("open",i),t.removeListener("error",o),t.removeListener("close",a),this.off("close",c),this.off("upgrading",d)};t.once("open",i),t.once("error",o),t.once("close",a),this.once("close",c),this.once("upgrading",d),this.upgrades.indexOf("webtransport")!==-1&&e!=="webtransport"?this.setTimeoutFn(()=>{n||t.open()},200):t.open()}onOpen(){if(this.readyState="open",dr.priorWebsocketSuccess=this.transport.name==="websocket",this.emitReserved("open"),this.flush(),this.readyState==="open"&&this.opts.upgrade){let e=0;const t=this.upgrades.length;for(;e<t;e++)this.probe(this.upgrades[e])}}onPacket(e){if(this.readyState==="opening"||this.readyState==="open"||this.readyState==="closing")switch(this.emitReserved("packet",e),this.emitReserved("heartbeat"),e.type){case"open":this.onHandshake(JSON.parse(e.data));break;case"ping":this.resetPingTimeout(),this.sendPacket("pong"),this.emitReserved("ping"),this.emitReserved("pong");break;case"error":const t=new Error("server error");t.code=e.data,this.onError(t);break;case"message":this.emitReserved("data",e.data),this.emitReserved("message",e.data);break}}onHandshake(e){this.emitReserved("handshake",e),this.id=e.sid,this.transport.query.sid=e.sid,this.upgrades=this.filterUpgrades(e.upgrades),this.pingInterval=e.pingInterval,this.pingTimeout=e.pingTimeout,this.maxPayload=e.maxPayload,this.onOpen(),this.readyState!=="closed"&&this.resetPingTimeout()}resetPingTimeout(){this.clearTimeoutFn(this.pingTimeoutTimer),this.pingTimeoutTimer=this.setTimeoutFn(()=>{this.onClose("ping timeout")},this.pingInterval+this.pingTimeout),this.opts.autoUnref&&this.pingTimeoutTimer.unref()}onDrain(){this.writeBuffer.splice(0,this.prevBufferLen),this.prevBufferLen=0,this.writeBuffer.length===0?this.emitReserved("drain"):this.flush()}flush(){if(this.readyState!=="closed"&&this.transport.writable&&!this.upgrading&&this.writeBuffer.length){const e=this.getWritablePackets();this.transport.send(e),this.prevBufferLen=e.length,this.emitReserved("flush")}}getWritablePackets(){if(!(this.maxPayload&&this.transport.name==="polling"&&this.writeBuffer.length>1))return this.writeBuffer;let t=1;for(let n=0;n<this.writeBuffer.length;n++){const i=this.writeBuffer[n].data;if(i&&(t+=Mh(i)),n>0&&t>this.maxPayload)return this.writeBuffer.slice(0,n);t+=2}return this.writeBuffer}write(e,t,n){return this.sendPacket("message",e,t,n),this}send(e,t,n){return this.sendPacket("message",e,t,n),this}sendPacket(e,t,n,i){if(typeof t=="function"&&(i=t,t=void 0),typeof n=="function"&&(i=n,n=null),this.readyState==="closing"||this.readyState==="closed")return;n=n||{},n.compress=n.compress!==!1;const s={type:e,data:t,options:n};this.emitReserved("packetCreate",s),this.writeBuffer.push(s),i&&this.once("flush",i),this.flush()}close(){const e=()=>{this.onClose("forced close"),this.transport.close()},t=()=>{this.off("upgrade",t),this.off("upgradeError",t),e()},n=()=>{this.once("upgrade",t),this.once("upgradeError",t)};return(this.readyState==="opening"||this.readyState==="open")&&(this.readyState="closing",this.writeBuffer.length?this.once("drain",()=>{this.upgrading?n():e()}):this.upgrading?n():e()),this}onError(e){dr.priorWebsocketSuccess=!1,this.emitReserved("error",e),this.onClose("transport error",e)}onClose(e,t){(this.readyState==="opening"||this.readyState==="open"||this.readyState==="closing")&&(this.clearTimeoutFn(this.pingTimeoutTimer),this.transport.removeAllListeners("close"),this.transport.close(),this.transport.removeAllListeners(),typeof removeEventListener=="function"&&(removeEventListener("beforeunload",this.beforeunloadEventListener,!1),removeEventListener("offline",this.offlineEventListener,!1)),this.readyState="closed",this.id=null,this.emitReserved("close",e,t),this.writeBuffer=[],this.prevBufferLen=0)}filterUpgrades(e){const t=[];let n=0;const i=e.length;for(;n<i;n++)~this.transports.indexOf(e[n])&&t.push(e[n]);return t}};rd.protocol=Yc;function Zh(r,e="",t){let n=r;t=t||typeof location<"u"&&location,r==null&&(r=t.protocol+"//"+t.host),typeof r=="string"&&(r.charAt(0)==="/"&&(r.charAt(1)==="/"?r=t.protocol+r:r=t.host+r),/^(https?|wss?):\/\//.test(r)||(typeof t<"u"?r=t.protocol+"//"+r:r="https://"+r),n=us(r)),n.port||(/^(http|ws)$/.test(n.protocol)?n.port="80":/^(http|ws)s$/.test(n.protocol)&&(n.port="443")),n.path=n.path||"/";const s=n.host.indexOf(":")!==-1?"["+n.host+"]":n.host;return n.id=n.protocol+"://"+s+":"+n.port+e,n.href=n.protocol+"://"+s+(t&&t.port===n.port?"":":"+n.port),n}const em=typeof ArrayBuffer=="function",tm=r=>typeof ArrayBuffer.isView=="function"?ArrayBuffer.isView(r):r.buffer instanceof ArrayBuffer,nd=Object.prototype.toString,rm=typeof Blob=="function"||typeof Blob<"u"&&nd.call(Blob)==="[object BlobConstructor]",nm=typeof File=="function"||typeof File<"u"&&nd.call(File)==="[object FileConstructor]";function Qs(r){return em&&(r instanceof ArrayBuffer||tm(r))||rm&&r instanceof Blob||nm&&r instanceof File}function jn(r,e){if(!r||typeof r!="object")return!1;if(Array.isArray(r)){for(let t=0,n=r.length;t<n;t++)if(jn(r[t]))return!0;return!1}if(Qs(r))return!0;if(r.toJSON&&typeof r.toJSON=="function"&&arguments.length===1)return jn(r.toJSON(),!0);for(const t in r)if(Object.prototype.hasOwnProperty.call(r,t)&&jn(r[t]))return!0;return!1}function im(r){const e=[],t=r.data,n=r;return n.data=ps(t,e),n.attachments=e.length,{packet:n,buffers:e}}function ps(r,e){if(!r)return r;if(Qs(r)){const t={_placeholder:!0,num:e.length};return e.push(r),t}else if(Array.isArray(r)){const t=new Array(r.length);for(let n=0;n<r.length;n++)t[n]=ps(r[n],e);return t}else if(typeof r=="object"&&!(r instanceof Date)){const t={};for(const n in r)Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=ps(r[n],e));return t}return r}function sm(r,e){return r.data=fs(r.data,e),delete r.attachments,r}function fs(r,e){if(!r)return r;if(r&&r._placeholder===!0){if(typeof r.num=="number"&&r.num>=0&&r.num<e.length)return e[r.num];throw new Error("illegal attachments")}else if(Array.isArray(r))for(let t=0;t<r.length;t++)r[t]=fs(r[t],e);else if(typeof r=="object")for(const t in r)Object.prototype.hasOwnProperty.call(r,t)&&(r[t]=fs(r[t],e));return r}const om=["connect","connect_error","disconnect","disconnecting","newListener","removeListener"],am=5;var ne;(function(r){r[r.CONNECT=0]="CONNECT",r[r.DISCONNECT=1]="DISCONNECT",r[r.EVENT=2]="EVENT",r[r.ACK=3]="ACK",r[r.CONNECT_ERROR=4]="CONNECT_ERROR",r[r.BINARY_EVENT=5]="BINARY_EVENT",r[r.BINARY_ACK=6]="BINARY_ACK"})(ne||(ne={}));class cm{constructor(e){this.replacer=e}encode(e){return(e.type===ne.EVENT||e.type===ne.ACK)&&jn(e)?this.encodeAsBinary({type:e.type===ne.EVENT?ne.BINARY_EVENT:ne.BINARY_ACK,nsp:e.nsp,data:e.data,id:e.id}):[this.encodeAsString(e)]}encodeAsString(e){let t=""+e.type;return(e.type===ne.BINARY_EVENT||e.type===ne.BINARY_ACK)&&(t+=e.attachments+"-"),e.nsp&&e.nsp!=="/"&&(t+=e.nsp+","),e.id!=null&&(t+=e.id),e.data!=null&&(t+=JSON.stringify(e.data,this.replacer)),t}encodeAsBinary(e){const t=im(e),n=this.encodeAsString(t.packet),i=t.buffers;return i.unshift(n),i}}function Sa(r){return Object.prototype.toString.call(r)==="[object Object]"}class Xs extends Le{constructor(e){super(),this.reviver=e}add(e){let t;if(typeof e=="string"){if(this.reconstructor)throw new Error("got plaintext data when reconstructing a packet");t=this.decodeString(e);const n=t.type===ne.BINARY_EVENT;n||t.type===ne.BINARY_ACK?(t.type=n?ne.EVENT:ne.ACK,this.reconstructor=new dm(t),t.attachments===0&&super.emitReserved("decoded",t)):super.emitReserved("decoded",t)}else if(Qs(e)||e.base64)if(this.reconstructor)t=this.reconstructor.takeBinaryData(e),t&&(this.reconstructor=null,super.emitReserved("decoded",t));else throw new Error("got binary data when not reconstructing a packet");else throw new Error("Unknown type: "+e)}decodeString(e){let t=0;const n={type:Number(e.charAt(0))};if(ne[n.type]===void 0)throw new Error("unknown packet type "+n.type);if(n.type===ne.BINARY_EVENT||n.type===ne.BINARY_ACK){const s=t+1;for(;e.charAt(++t)!=="-"&&t!=e.length;);const o=e.substring(s,t);if(o!=Number(o)||e.charAt(t)!=="-")throw new Error("Illegal attachments");n.attachments=Number(o)}if(e.charAt(t+1)==="/"){const s=t+1;for(;++t&&!(e.charAt(t)===","||t===e.length););n.nsp=e.substring(s,t)}else n.nsp="/";const i=e.charAt(t+1);if(i!==""&&Number(i)==i){const s=t+1;for(;++t;){const o=e.charAt(t);if(o==null||Number(o)!=o){--t;break}if(t===e.length)break}n.id=Number(e.substring(s,t+1))}if(e.charAt(++t)){const s=this.tryParse(e.substr(t));if(Xs.isPayloadValid(n.type,s))n.data=s;else throw new Error("invalid payload")}return n}tryParse(e){try{return JSON.parse(e,this.reviver)}catch{return!1}}static isPayloadValid(e,t){switch(e){case ne.CONNECT:return Sa(t);case ne.DISCONNECT:return t===void 0;case ne.CONNECT_ERROR:return typeof t=="string"||Sa(t);case ne.EVENT:case ne.BINARY_EVENT:return Array.isArray(t)&&(typeof t[0]=="number"||typeof t[0]=="string"&&om.indexOf(t[0])===-1);case ne.ACK:case ne.BINARY_ACK:return Array.isArray(t)}}destroy(){this.reconstructor&&(this.reconstructor.finishedReconstruction(),this.reconstructor=null)}}class dm{constructor(e){this.packet=e,this.buffers=[],this.reconPack=e}takeBinaryData(e){if(this.buffers.push(e),this.buffers.length===this.reconPack.attachments){const t=sm(this.reconPack,this.buffers);return this.finishedReconstruction(),t}return null}finishedReconstruction(){this.reconPack=null,this.buffers=[]}}const lm=Object.freeze(Object.defineProperty({__proto__:null,Decoder:Xs,Encoder:cm,get PacketType(){return ne},protocol:am},Symbol.toStringTag,{value:"Module"}));function He(r,e,t){return r.on(e,t),function(){r.off(e,t)}}const um=Object.freeze({connect:1,connect_error:1,disconnect:1,disconnecting:1,newListener:1,removeListener:1});class id extends Le{constructor(e,t,n){super(),this.connected=!1,this.recovered=!1,this.receiveBuffer=[],this.sendBuffer=[],this._queue=[],this._queueSeq=0,this.ids=0,this.acks={},this.flags={},this.io=e,this.nsp=t,n&&n.auth&&(this.auth=n.auth),this._opts=Object.assign({},n),this.io._autoConnect&&this.open()}get disconnected(){return!this.connected}subEvents(){if(this.subs)return;const e=this.io;this.subs=[He(e,"open",this.onopen.bind(this)),He(e,"packet",this.onpacket.bind(this)),He(e,"error",this.onerror.bind(this)),He(e,"close",this.onclose.bind(this))]}get active(){return!!this.subs}connect(){return this.connected?this:(this.subEvents(),this.io._reconnecting||this.io.open(),this.io._readyState==="open"&&this.onopen(),this)}open(){return this.connect()}send(...e){return e.unshift("message"),this.emit.apply(this,e),this}emit(e,...t){if(um.hasOwnProperty(e))throw new Error('"'+e.toString()+'" is a reserved event name');if(t.unshift(e),this._opts.retries&&!this.flags.fromQueue&&!this.flags.volatile)return this._addToQueue(t),this;const n={type:ne.EVENT,data:t};if(n.options={},n.options.compress=this.flags.compress!==!1,typeof t[t.length-1]=="function"){const o=this.ids++,a=t.pop();this._registerAckCallback(o,a),n.id=o}const i=this.io.engine&&this.io.engine.transport&&this.io.engine.transport.writable;return this.flags.volatile&&(!i||!this.connected)||(this.connected?(this.notifyOutgoingListeners(n),this.packet(n)):this.sendBuffer.push(n)),this.flags={},this}_registerAckCallback(e,t){var n;const i=(n=this.flags.timeout)!==null&&n!==void 0?n:this._opts.ackTimeout;if(i===void 0){this.acks[e]=t;return}const s=this.io.setTimeoutFn(()=>{delete this.acks[e];for(let o=0;o<this.sendBuffer.length;o++)this.sendBuffer[o].id===e&&this.sendBuffer.splice(o,1);t.call(this,new Error("operation has timed out"))},i);this.acks[e]=(...o)=>{this.io.clearTimeoutFn(s),t.apply(this,[null,...o])}}emitWithAck(e,...t){const n=this.flags.timeout!==void 0||this._opts.ackTimeout!==void 0;return new Promise((i,s)=>{t.push((o,a)=>n?o?s(o):i(a):i(o)),this.emit(e,...t)})}_addToQueue(e){let t;typeof e[e.length-1]=="function"&&(t=e.pop());const n={id:this._queueSeq++,tryCount:0,pending:!1,args:e,flags:Object.assign({fromQueue:!0},this.flags)};e.push((i,...s)=>n!==this._queue[0]?void 0:(i!==null?n.tryCount>this._opts.retries&&(this._queue.shift(),t&&t(i)):(this._queue.shift(),t&&t(null,...s)),n.pending=!1,this._drainQueue())),this._queue.push(n),this._drainQueue()}_drainQueue(e=!1){if(!this.connected||this._queue.length===0)return;const t=this._queue[0];t.pending&&!e||(t.pending=!0,t.tryCount++,this.flags=t.flags,this.emit.apply(this,t.args))}packet(e){e.nsp=this.nsp,this.io._packet(e)}onopen(){typeof this.auth=="function"?this.auth(e=>{this._sendConnectPacket(e)}):this._sendConnectPacket(this.auth)}_sendConnectPacket(e){this.packet({type:ne.CONNECT,data:this._pid?Object.assign({pid:this._pid,offset:this._lastOffset},e):e})}onerror(e){this.connected||this.emitReserved("connect_error",e)}onclose(e,t){this.connected=!1,delete this.id,this.emitReserved("disconnect",e,t)}onpacket(e){if(e.nsp===this.nsp)switch(e.type){case ne.CONNECT:e.data&&e.data.sid?this.onconnect(e.data.sid,e.data.pid):this.emitReserved("connect_error",new Error("It seems you are trying to reach a Socket.IO server in v2.x with a v3.x client, but they are not compatible (more information here: https://socket.io/docs/v3/migrating-from-2-x-to-3-0/)"));break;case ne.EVENT:case ne.BINARY_EVENT:this.onevent(e);break;case ne.ACK:case ne.BINARY_ACK:this.onack(e);break;case ne.DISCONNECT:this.ondisconnect();break;case ne.CONNECT_ERROR:this.destroy();const n=new Error(e.data.message);n.data=e.data.data,this.emitReserved("connect_error",n);break}}onevent(e){const t=e.data||[];e.id!=null&&t.push(this.ack(e.id)),this.connected?this.emitEvent(t):this.receiveBuffer.push(Object.freeze(t))}emitEvent(e){if(this._anyListeners&&this._anyListeners.length){const t=this._anyListeners.slice();for(const n of t)n.apply(this,e)}super.emit.apply(this,e),this._pid&&e.length&&typeof e[e.length-1]=="string"&&(this._lastOffset=e[e.length-1])}ack(e){const t=this;let n=!1;return function(...i){n||(n=!0,t.packet({type:ne.ACK,id:e,data:i}))}}onack(e){const t=this.acks[e.id];typeof t=="function"&&(t.apply(this,e.data),delete this.acks[e.id])}onconnect(e,t){this.id=e,this.recovered=t&&this._pid===t,this._pid=t,this.connected=!0,this.emitBuffered(),this.emitReserved("connect"),this._drainQueue(!0)}emitBuffered(){this.receiveBuffer.forEach(e=>this.emitEvent(e)),this.receiveBuffer=[],this.sendBuffer.forEach(e=>{this.notifyOutgoingListeners(e),this.packet(e)}),this.sendBuffer=[]}ondisconnect(){this.destroy(),this.onclose("io server disconnect")}destroy(){this.subs&&(this.subs.forEach(e=>e()),this.subs=void 0),this.io._destroy(this)}disconnect(){return this.connected&&this.packet({type:ne.DISCONNECT}),this.destroy(),this.connected&&this.onclose("io client disconnect"),this}close(){return this.disconnect()}compress(e){return this.flags.compress=e,this}get volatile(){return this.flags.volatile=!0,this}timeout(e){return this.flags.timeout=e,this}onAny(e){return this._anyListeners=this._anyListeners||[],this._anyListeners.push(e),this}prependAny(e){return this._anyListeners=this._anyListeners||[],this._anyListeners.unshift(e),this}offAny(e){if(!this._anyListeners)return this;if(e){const t=this._anyListeners;for(let n=0;n<t.length;n++)if(e===t[n])return t.splice(n,1),this}else this._anyListeners=[];return this}listenersAny(){return this._anyListeners||[]}onAnyOutgoing(e){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.push(e),this}prependAnyOutgoing(e){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.unshift(e),this}offAnyOutgoing(e){if(!this._anyOutgoingListeners)return this;if(e){const t=this._anyOutgoingListeners;for(let n=0;n<t.length;n++)if(e===t[n])return t.splice(n,1),this}else this._anyOutgoingListeners=[];return this}listenersAnyOutgoing(){return this._anyOutgoingListeners||[]}notifyOutgoingListeners(e){if(this._anyOutgoingListeners&&this._anyOutgoingListeners.length){const t=this._anyOutgoingListeners.slice();for(const n of t)n.apply(this,e.data)}}}function Sr(r){r=r||{},this.ms=r.min||100,this.max=r.max||1e4,this.factor=r.factor||2,this.jitter=r.jitter>0&&r.jitter<=1?r.jitter:0,this.attempts=0}Sr.prototype.duration=function(){var r=this.ms*Math.pow(this.factor,this.attempts++);if(this.jitter){var e=Math.random(),t=Math.floor(e*this.jitter*r);r=Math.floor(e*10)&1?r+t:r-t}return Math.min(r,this.max)|0};Sr.prototype.reset=function(){this.attempts=0};Sr.prototype.setMin=function(r){this.ms=r};Sr.prototype.setMax=function(r){this.max=r};Sr.prototype.setJitter=function(r){this.jitter=r};class hs extends Le{constructor(e,t){var n;super(),this.nsps={},this.subs=[],e&&typeof e=="object"&&(t=e,e=void 0),t=t||{},t.path=t.path||"/socket.io",this.opts=t,yi(this,t),this.reconnection(t.reconnection!==!1),this.reconnectionAttempts(t.reconnectionAttempts||1/0),this.reconnectionDelay(t.reconnectionDelay||1e3),this.reconnectionDelayMax(t.reconnectionDelayMax||5e3),this.randomizationFactor((n=t.randomizationFactor)!==null&&n!==void 0?n:.5),this.backoff=new Sr({min:this.reconnectionDelay(),max:this.reconnectionDelayMax(),jitter:this.randomizationFactor()}),this.timeout(t.timeout==null?2e4:t.timeout),this._readyState="closed",this.uri=e;const i=t.parser||lm;this.encoder=new i.Encoder,this.decoder=new i.Decoder,this._autoConnect=t.autoConnect!==!1,this._autoConnect&&this.open()}reconnection(e){return arguments.length?(this._reconnection=!!e,this):this._reconnection}reconnectionAttempts(e){return e===void 0?this._reconnectionAttempts:(this._reconnectionAttempts=e,this)}reconnectionDelay(e){var t;return e===void 0?this._reconnectionDelay:(this._reconnectionDelay=e,(t=this.backoff)===null||t===void 0||t.setMin(e),this)}randomizationFactor(e){var t;return e===void 0?this._randomizationFactor:(this._randomizationFactor=e,(t=this.backoff)===null||t===void 0||t.setJitter(e),this)}reconnectionDelayMax(e){var t;return e===void 0?this._reconnectionDelayMax:(this._reconnectionDelayMax=e,(t=this.backoff)===null||t===void 0||t.setMax(e),this)}timeout(e){return arguments.length?(this._timeout=e,this):this._timeout}maybeReconnectOnOpen(){!this._reconnecting&&this._reconnection&&this.backoff.attempts===0&&this.reconnect()}open(e){if(~this._readyState.indexOf("open"))return this;this.engine=new rd(this.uri,this.opts);const t=this.engine,n=this;this._readyState="opening",this.skipReconnect=!1;const i=He(t,"open",function(){n.onopen(),e&&e()}),s=a=>{this.cleanup(),this._readyState="closed",this.emitReserved("error",a),e?e(a):this.maybeReconnectOnOpen()},o=He(t,"error",s);if(this._timeout!==!1){const a=this._timeout,c=this.setTimeoutFn(()=>{i(),s(new Error("timeout")),t.close()},a);this.opts.autoUnref&&c.unref(),this.subs.push(()=>{this.clearTimeoutFn(c)})}return this.subs.push(i),this.subs.push(o),this}connect(e){return this.open(e)}onopen(){this.cleanup(),this._readyState="open",this.emitReserved("open");const e=this.engine;this.subs.push(He(e,"ping",this.onping.bind(this)),He(e,"data",this.ondata.bind(this)),He(e,"error",this.onerror.bind(this)),He(e,"close",this.onclose.bind(this)),He(this.decoder,"decoded",this.ondecoded.bind(this)))}onping(){this.emitReserved("ping")}ondata(e){try{this.decoder.add(e)}catch(t){this.onclose("parse error",t)}}ondecoded(e){Ys(()=>{this.emitReserved("packet",e)},this.setTimeoutFn)}onerror(e){this.emitReserved("error",e)}socket(e,t){let n=this.nsps[e];return n?this._autoConnect&&!n.active&&n.connect():(n=new id(this,e,t),this.nsps[e]=n),n}_destroy(e){const t=Object.keys(this.nsps);for(const n of t)if(this.nsps[n].active)return;this._close()}_packet(e){const t=this.encoder.encode(e);for(let n=0;n<t.length;n++)this.engine.write(t[n],e.options)}cleanup(){this.subs.forEach(e=>e()),this.subs.length=0,this.decoder.destroy()}_close(){this.skipReconnect=!0,this._reconnecting=!1,this.onclose("forced close"),this.engine&&this.engine.close()}disconnect(){return this._close()}onclose(e,t){this.cleanup(),this.backoff.reset(),this._readyState="closed",this.emitReserved("close",e,t),this._reconnection&&!this.skipReconnect&&this.reconnect()}reconnect(){if(this._reconnecting||this.skipReconnect)return this;const e=this;if(this.backoff.attempts>=this._reconnectionAttempts)this.backoff.reset(),this.emitReserved("reconnect_failed"),this._reconnecting=!1;else{const t=this.backoff.duration();this._reconnecting=!0;const n=this.setTimeoutFn(()=>{e.skipReconnect||(this.emitReserved("reconnect_attempt",e.backoff.attempts),!e.skipReconnect&&e.open(i=>{i?(e._reconnecting=!1,e.reconnect(),this.emitReserved("reconnect_error",i)):e.onreconnect()}))},t);this.opts.autoUnref&&n.unref(),this.subs.push(()=>{this.clearTimeoutFn(n)})}}onreconnect(){const e=this.backoff.attempts;this._reconnecting=!1,this.backoff.reset(),this.emitReserved("reconnect",e)}}const Lr={};function $n(r,e){typeof r=="object"&&(e=r,r=void 0),e=e||{};const t=Zh(r,e.path||"/socket.io"),n=t.source,i=t.id,s=t.path,o=Lr[i]&&s in Lr[i].nsps,a=e.forceNew||e["force new connection"]||e.multiplex===!1||o;let c;return a?c=new hs(n,e):(Lr[i]||(Lr[i]=new hs(n,e)),c=Lr[i]),t.query&&!e.query&&(e.query=t.queryKey),c.socket(t.path,e)}Object.assign($n,{Manager:hs,Socket:id,io:$n,connect:$n});function sd(r,e){return function(){return r.apply(e,arguments)}}const{toString:pm}=Object.prototype,{getPrototypeOf:Zs}=Object,_i=(r=>e=>{const t=pm.call(e);return r[t]||(r[t]=t.slice(8,-1).toLowerCase())})(Object.create(null)),pt=r=>(r=r.toLowerCase(),e=>_i(e)===r),wi=r=>e=>typeof e===r,{isArray:Rr}=Array,qr=wi("undefined");function fm(r){return r!==null&&!qr(r)&&r.constructor!==null&&!qr(r.constructor)&&Je(r.constructor.isBuffer)&&r.constructor.isBuffer(r)}const od=pt("ArrayBuffer");function hm(r){let e;return typeof ArrayBuffer<"u"&&ArrayBuffer.isView?e=ArrayBuffer.isView(r):e=r&&r.buffer&&od(r.buffer),e}const mm=wi("string"),Je=wi("function"),ad=wi("number"),bi=r=>r!==null&&typeof r=="object",gm=r=>r===!0||r===!1,Bn=r=>{if(_i(r)!=="object")return!1;const e=Zs(r);return(e===null||e===Object.prototype||Object.getPrototypeOf(e)===null)&&!(Symbol.toStringTag in r)&&!(Symbol.iterator in r)},vm=pt("Date"),ym=pt("File"),_m=pt("Blob"),wm=pt("FileList"),bm=r=>bi(r)&&Je(r.pipe),Sm=r=>{let e;return r&&(typeof FormData=="function"&&r instanceof FormData||Je(r.append)&&((e=_i(r))==="formdata"||e==="object"&&Je(r.toString)&&r.toString()==="[object FormData]"))},Rm=pt("URLSearchParams"),Cm=r=>r.trim?r.trim():r.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"");function on(r,e,{allOwnKeys:t=!1}={}){if(r===null||typeof r>"u")return;let n,i;if(typeof r!="object"&&(r=[r]),Rr(r))for(n=0,i=r.length;n<i;n++)e.call(null,r[n],n,r);else{const s=t?Object.getOwnPropertyNames(r):Object.keys(r),o=s.length;let a;for(n=0;n<o;n++)a=s[n],e.call(null,r[a],a,r)}}function cd(r,e){e=e.toLowerCase();const t=Object.keys(r);let n=t.length,i;for(;n-- >0;)if(i=t[n],e===i.toLowerCase())return i;return null}const dd=(()=>typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:global)(),ld=r=>!qr(r)&&r!==dd;function ms(){const{caseless:r}=ld(this)&&this||{},e={},t=(n,i)=>{const s=r&&cd(e,i)||i;Bn(e[s])&&Bn(n)?e[s]=ms(e[s],n):Bn(n)?e[s]=ms({},n):Rr(n)?e[s]=n.slice():e[s]=n};for(let n=0,i=arguments.length;n<i;n++)arguments[n]&&on(arguments[n],t);return e}const Em=(r,e,t,{allOwnKeys:n}={})=>(on(e,(i,s)=>{t&&Je(i)?r[s]=sd(i,t):r[s]=i},{allOwnKeys:n}),r),Tm=r=>(r.charCodeAt(0)===65279&&(r=r.slice(1)),r),Pm=(r,e,t,n)=>{r.prototype=Object.create(e.prototype,n),r.prototype.constructor=r,Object.defineProperty(r,"super",{value:e.prototype}),t&&Object.assign(r.prototype,t)},Dm=(r,e,t,n)=>{let i,s,o;const a={};if(e=e||{},r==null)return e;do{for(i=Object.getOwnPropertyNames(r),s=i.length;s-- >0;)o=i[s],(!n||n(o,r,e))&&!a[o]&&(e[o]=r[o],a[o]=!0);r=t!==!1&&Zs(r)}while(r&&(!t||t(r,e))&&r!==Object.prototype);return e},xm=(r,e,t)=>{r=String(r),(t===void 0||t>r.length)&&(t=r.length),t-=e.length;const n=r.indexOf(e,t);return n!==-1&&n===t},Om=r=>{if(!r)return null;if(Rr(r))return r;let e=r.length;if(!ad(e))return null;const t=new Array(e);for(;e-- >0;)t[e]=r[e];return t},Lm=(r=>e=>r&&e instanceof r)(typeof Uint8Array<"u"&&Zs(Uint8Array)),Im=(r,e)=>{const n=(r&&r[Symbol.iterator]).call(r);let i;for(;(i=n.next())&&!i.done;){const s=i.value;e.call(r,s[0],s[1])}},km=(r,e)=>{let t;const n=[];for(;(t=r.exec(e))!==null;)n.push(t);return n},Mm=pt("HTMLFormElement"),Nm=r=>r.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(t,n,i){return n.toUpperCase()+i}),Ra=(({hasOwnProperty:r})=>(e,t)=>r.call(e,t))(Object.prototype),Am=pt("RegExp"),ud=(r,e)=>{const t=Object.getOwnPropertyDescriptors(r),n={};on(t,(i,s)=>{e(i,s,r)!==!1&&(n[s]=i)}),Object.defineProperties(r,n)},jm=r=>{ud(r,(e,t)=>{if(Je(r)&&["arguments","caller","callee"].indexOf(t)!==-1)return!1;const n=r[t];if(Je(n)){if(e.enumerable=!1,"writable"in e){e.writable=!1;return}e.set||(e.set=()=>{throw Error("Can not rewrite read-only method '"+t+"'")})}})},$m=(r,e)=>{const t={},n=i=>{i.forEach(s=>{t[s]=!0})};return Rr(r)?n(r):n(String(r).split(e)),t},Bm=()=>{},Fm=(r,e)=>(r=+r,Number.isFinite(r)?r:e),Gi="abcdefghijklmnopqrstuvwxyz",Ca="0123456789",pd={DIGIT:Ca,ALPHA:Gi,ALPHA_DIGIT:Gi+Gi.toUpperCase()+Ca},Um=(r=16,e=pd.ALPHA_DIGIT)=>{let t="";const{length:n}=e;for(;r--;)t+=e[Math.random()*n|0];return t};function zm(r){return!!(r&&Je(r.append)&&r[Symbol.toStringTag]==="FormData"&&r[Symbol.iterator])}const Vm=r=>{const e=new Array(10),t=(n,i)=>{if(bi(n)){if(e.indexOf(n)>=0)return;if(!("toJSON"in n)){e[i]=n;const s=Rr(n)?[]:{};return on(n,(o,a)=>{const c=t(o,i+1);!qr(c)&&(s[a]=c)}),e[i]=void 0,s}}return n};return t(r,0)},Jm=pt("AsyncFunction"),qm=r=>r&&(bi(r)||Je(r))&&Je(r.then)&&Je(r.catch),L={isArray:Rr,isArrayBuffer:od,isBuffer:fm,isFormData:Sm,isArrayBufferView:hm,isString:mm,isNumber:ad,isBoolean:gm,isObject:bi,isPlainObject:Bn,isUndefined:qr,isDate:vm,isFile:ym,isBlob:_m,isRegExp:Am,isFunction:Je,isStream:bm,isURLSearchParams:Rm,isTypedArray:Lm,isFileList:wm,forEach:on,merge:ms,extend:Em,trim:Cm,stripBOM:Tm,inherits:Pm,toFlatObject:Dm,kindOf:_i,kindOfTest:pt,endsWith:xm,toArray:Om,forEachEntry:Im,matchAll:km,isHTMLForm:Mm,hasOwnProperty:Ra,hasOwnProp:Ra,reduceDescriptors:ud,freezeMethods:jm,toObjectSet:$m,toCamelCase:Nm,noop:Bm,toFiniteNumber:Fm,findKey:cd,global:dd,isContextDefined:ld,ALPHABET:pd,generateString:Um,isSpecCompliantForm:zm,toJSONObject:Vm,isAsyncFn:Jm,isThenable:qm};function ae(r,e,t,n,i){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack,this.message=r,this.name="AxiosError",e&&(this.code=e),t&&(this.config=t),n&&(this.request=n),i&&(this.response=i)}L.inherits(ae,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:L.toJSONObject(this.config),code:this.code,status:this.response&&this.response.status?this.response.status:null}}});const fd=ae.prototype,hd={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(r=>{hd[r]={value:r}});Object.defineProperties(ae,hd);Object.defineProperty(fd,"isAxiosError",{value:!0});ae.from=(r,e,t,n,i,s)=>{const o=Object.create(fd);return L.toFlatObject(r,o,function(c){return c!==Error.prototype},a=>a!=="isAxiosError"),ae.call(o,r.message,e,t,n,i),o.cause=r,o.name=r.name,s&&Object.assign(o,s),o};const Gm=null;function gs(r){return L.isPlainObject(r)||L.isArray(r)}function md(r){return L.endsWith(r,"[]")?r.slice(0,-2):r}function Ea(r,e,t){return r?r.concat(e).map(function(i,s){return i=md(i),!t&&s?"["+i+"]":i}).join(t?".":""):e}function Hm(r){return L.isArray(r)&&!r.some(gs)}const Wm=L.toFlatObject(L,{},null,function(e){return/^is[A-Z]/.test(e)});function Si(r,e,t){if(!L.isObject(r))throw new TypeError("target must be an object");e=e||new FormData,t=L.toFlatObject(t,{metaTokens:!0,dots:!1,indexes:!1},!1,function(m,g){return!L.isUndefined(g[m])});const n=t.metaTokens,i=t.visitor||l,s=t.dots,o=t.indexes,c=(t.Blob||typeof Blob<"u"&&Blob)&&L.isSpecCompliantForm(e);if(!L.isFunction(i))throw new TypeError("visitor must be a function");function d(f){if(f===null)return"";if(L.isDate(f))return f.toISOString();if(!c&&L.isBlob(f))throw new ae("Blob is not supported. Use a Buffer instead.");return L.isArrayBuffer(f)||L.isTypedArray(f)?c&&typeof Blob=="function"?new Blob([f]):Buffer.from(f):f}function l(f,m,g){let w=f;if(f&&!g&&typeof f=="object"){if(L.endsWith(m,"{}"))m=n?m:m.slice(0,-2),f=JSON.stringify(f);else if(L.isArray(f)&&Hm(f)||(L.isFileList(f)||L.endsWith(m,"[]"))&&(w=L.toArray(f)))return m=md(m),w.forEach(function(b,P){!(L.isUndefined(b)||b===null)&&e.append(o===!0?Ea([m],P,s):o===null?m:m+"[]",d(b))}),!1}return gs(f)?!0:(e.append(Ea(g,m,s),d(f)),!1)}const u=[],p=Object.assign(Wm,{defaultVisitor:l,convertValue:d,isVisitable:gs});function h(f,m){if(!L.isUndefined(f)){if(u.indexOf(f)!==-1)throw Error("Circular reference detected in "+m.join("."));u.push(f),L.forEach(f,function(w,C){(!(L.isUndefined(w)||w===null)&&i.call(e,w,L.isString(C)?C.trim():C,m,p))===!0&&h(w,m?m.concat(C):[C])}),u.pop()}}if(!L.isObject(r))throw new TypeError("data must be an object");return h(r),e}function Ta(r){const e={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(r).replace(/[!'()~]|%20|%00/g,function(n){return e[n]})}function eo(r,e){this._pairs=[],r&&Si(r,this,e)}const gd=eo.prototype;gd.append=function(e,t){this._pairs.push([e,t])};gd.toString=function(e){const t=e?function(n){return e.call(this,n,Ta)}:Ta;return this._pairs.map(function(i){return t(i[0])+"="+t(i[1])},"").join("&")};function Km(r){return encodeURIComponent(r).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function vd(r,e,t){if(!e)return r;const n=t&&t.encode||Km,i=t&&t.serialize;let s;if(i?s=i(e,t):s=L.isURLSearchParams(e)?e.toString():new eo(e,t).toString(n),s){const o=r.indexOf("#");o!==-1&&(r=r.slice(0,o)),r+=(r.indexOf("?")===-1?"?":"&")+s}return r}class Ym{constructor(){this.handlers=[]}use(e,t,n){return this.handlers.push({fulfilled:e,rejected:t,synchronous:n?n.synchronous:!1,runWhen:n?n.runWhen:null}),this.handlers.length-1}eject(e){this.handlers[e]&&(this.handlers[e]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(e){L.forEach(this.handlers,function(n){n!==null&&e(n)})}}const Pa=Ym,yd={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},Qm=typeof URLSearchParams<"u"?URLSearchParams:eo,Xm=typeof FormData<"u"?FormData:null,Zm=typeof Blob<"u"?Blob:null,eg=(()=>{let r;return typeof navigator<"u"&&((r=navigator.product)==="ReactNative"||r==="NativeScript"||r==="NS")?!1:typeof window<"u"&&typeof document<"u"})(),tg=(()=>typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&typeof self.importScripts=="function")(),at={isBrowser:!0,classes:{URLSearchParams:Qm,FormData:Xm,Blob:Zm},isStandardBrowserEnv:eg,isStandardBrowserWebWorkerEnv:tg,protocols:["http","https","file","blob","url","data"]};function rg(r,e){return Si(r,new at.classes.URLSearchParams,Object.assign({visitor:function(t,n,i,s){return at.isNode&&L.isBuffer(t)?(this.append(n,t.toString("base64")),!1):s.defaultVisitor.apply(this,arguments)}},e))}function ng(r){return L.matchAll(/\w+|\[(\w*)]/g,r).map(e=>e[0]==="[]"?"":e[1]||e[0])}function ig(r){const e={},t=Object.keys(r);let n;const i=t.length;let s;for(n=0;n<i;n++)s=t[n],e[s]=r[s];return e}function _d(r){function e(t,n,i,s){let o=t[s++];const a=Number.isFinite(+o),c=s>=t.length;return o=!o&&L.isArray(i)?i.length:o,c?(L.hasOwnProp(i,o)?i[o]=[i[o],n]:i[o]=n,!a):((!i[o]||!L.isObject(i[o]))&&(i[o]=[]),e(t,n,i[o],s)&&L.isArray(i[o])&&(i[o]=ig(i[o])),!a)}if(L.isFormData(r)&&L.isFunction(r.entries)){const t={};return L.forEachEntry(r,(n,i)=>{e(ng(n),i,t,0)}),t}return null}const sg={"Content-Type":void 0};function og(r,e,t){if(L.isString(r))try{return(e||JSON.parse)(r),L.trim(r)}catch(n){if(n.name!=="SyntaxError")throw n}return(t||JSON.stringify)(r)}const Ri={transitional:yd,adapter:["xhr","http"],transformRequest:[function(e,t){const n=t.getContentType()||"",i=n.indexOf("application/json")>-1,s=L.isObject(e);if(s&&L.isHTMLForm(e)&&(e=new FormData(e)),L.isFormData(e))return i&&i?JSON.stringify(_d(e)):e;if(L.isArrayBuffer(e)||L.isBuffer(e)||L.isStream(e)||L.isFile(e)||L.isBlob(e))return e;if(L.isArrayBufferView(e))return e.buffer;if(L.isURLSearchParams(e))return t.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),e.toString();let a;if(s){if(n.indexOf("application/x-www-form-urlencoded")>-1)return rg(e,this.formSerializer).toString();if((a=L.isFileList(e))||n.indexOf("multipart/form-data")>-1){const c=this.env&&this.env.FormData;return Si(a?{"files[]":e}:e,c&&new c,this.formSerializer)}}return s||i?(t.setContentType("application/json",!1),og(e)):e}],transformResponse:[function(e){const t=this.transitional||Ri.transitional,n=t&&t.forcedJSONParsing,i=this.responseType==="json";if(e&&L.isString(e)&&(n&&!this.responseType||i)){const o=!(t&&t.silentJSONParsing)&&i;try{return JSON.parse(e)}catch(a){if(o)throw a.name==="SyntaxError"?ae.from(a,ae.ERR_BAD_RESPONSE,this,null,this.response):a}}return e}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:at.classes.FormData,Blob:at.classes.Blob},validateStatus:function(e){return e>=200&&e<300},headers:{common:{Accept:"application/json, text/plain, */*"}}};L.forEach(["delete","get","head"],function(e){Ri.headers[e]={}});L.forEach(["post","put","patch"],function(e){Ri.headers[e]=L.merge(sg)});const to=Ri,ag=L.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),cg=r=>{const e={};let t,n,i;return r&&r.split(`
`).forEach(function(o){i=o.indexOf(":"),t=o.substring(0,i).trim().toLowerCase(),n=o.substring(i+1).trim(),!(!t||e[t]&&ag[t])&&(t==="set-cookie"?e[t]?e[t].push(n):e[t]=[n]:e[t]=e[t]?e[t]+", "+n:n)}),e},Da=Symbol("internals");function Ir(r){return r&&String(r).trim().toLowerCase()}function Fn(r){return r===!1||r==null?r:L.isArray(r)?r.map(Fn):String(r)}function dg(r){const e=Object.create(null),t=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let n;for(;n=t.exec(r);)e[n[1]]=n[2];return e}const lg=r=>/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(r.trim());function Hi(r,e,t,n,i){if(L.isFunction(n))return n.call(this,e,t);if(i&&(e=t),!!L.isString(e)){if(L.isString(n))return e.indexOf(n)!==-1;if(L.isRegExp(n))return n.test(e)}}function ug(r){return r.trim().toLowerCase().replace(/([a-z\d])(\w*)/g,(e,t,n)=>t.toUpperCase()+n)}function pg(r,e){const t=L.toCamelCase(" "+e);["get","set","has"].forEach(n=>{Object.defineProperty(r,n+t,{value:function(i,s,o){return this[n].call(this,e,i,s,o)},configurable:!0})})}class Ci{constructor(e){e&&this.set(e)}set(e,t,n){const i=this;function s(a,c,d){const l=Ir(c);if(!l)throw new Error("header name must be a non-empty string");const u=L.findKey(i,l);(!u||i[u]===void 0||d===!0||d===void 0&&i[u]!==!1)&&(i[u||c]=Fn(a))}const o=(a,c)=>L.forEach(a,(d,l)=>s(d,l,c));return L.isPlainObject(e)||e instanceof this.constructor?o(e,t):L.isString(e)&&(e=e.trim())&&!lg(e)?o(cg(e),t):e!=null&&s(t,e,n),this}get(e,t){if(e=Ir(e),e){const n=L.findKey(this,e);if(n){const i=this[n];if(!t)return i;if(t===!0)return dg(i);if(L.isFunction(t))return t.call(this,i,n);if(L.isRegExp(t))return t.exec(i);throw new TypeError("parser must be boolean|regexp|function")}}}has(e,t){if(e=Ir(e),e){const n=L.findKey(this,e);return!!(n&&this[n]!==void 0&&(!t||Hi(this,this[n],n,t)))}return!1}delete(e,t){const n=this;let i=!1;function s(o){if(o=Ir(o),o){const a=L.findKey(n,o);a&&(!t||Hi(n,n[a],a,t))&&(delete n[a],i=!0)}}return L.isArray(e)?e.forEach(s):s(e),i}clear(e){const t=Object.keys(this);let n=t.length,i=!1;for(;n--;){const s=t[n];(!e||Hi(this,this[s],s,e,!0))&&(delete this[s],i=!0)}return i}normalize(e){const t=this,n={};return L.forEach(this,(i,s)=>{const o=L.findKey(n,s);if(o){t[o]=Fn(i),delete t[s];return}const a=e?ug(s):String(s).trim();a!==s&&delete t[s],t[a]=Fn(i),n[a]=!0}),this}concat(...e){return this.constructor.concat(this,...e)}toJSON(e){const t=Object.create(null);return L.forEach(this,(n,i)=>{n!=null&&n!==!1&&(t[i]=e&&L.isArray(n)?n.join(", "):n)}),t}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(([e,t])=>e+": "+t).join(`
`)}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(e){return e instanceof this?e:new this(e)}static concat(e,...t){const n=new this(e);return t.forEach(i=>n.set(i)),n}static accessor(e){const n=(this[Da]=this[Da]={accessors:{}}).accessors,i=this.prototype;function s(o){const a=Ir(o);n[a]||(pg(i,o),n[a]=!0)}return L.isArray(e)?e.forEach(s):s(e),this}}Ci.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]);L.freezeMethods(Ci.prototype);L.freezeMethods(Ci);const mt=Ci;function Wi(r,e){const t=this||to,n=e||t,i=mt.from(n.headers);let s=n.data;return L.forEach(r,function(a){s=a.call(t,s,i.normalize(),e?e.status:void 0)}),i.normalize(),s}function wd(r){return!!(r&&r.__CANCEL__)}function an(r,e,t){ae.call(this,r??"canceled",ae.ERR_CANCELED,e,t),this.name="CanceledError"}L.inherits(an,ae,{__CANCEL__:!0});function fg(r,e,t){const n=t.config.validateStatus;!t.status||!n||n(t.status)?r(t):e(new ae("Request failed with status code "+t.status,[ae.ERR_BAD_REQUEST,ae.ERR_BAD_RESPONSE][Math.floor(t.status/100)-4],t.config,t.request,t))}const hg=at.isStandardBrowserEnv?function(){return{write:function(t,n,i,s,o,a){const c=[];c.push(t+"="+encodeURIComponent(n)),L.isNumber(i)&&c.push("expires="+new Date(i).toGMTString()),L.isString(s)&&c.push("path="+s),L.isString(o)&&c.push("domain="+o),a===!0&&c.push("secure"),document.cookie=c.join("; ")},read:function(t){const n=document.cookie.match(new RegExp("(^|;\\s*)("+t+")=([^;]*)"));return n?decodeURIComponent(n[3]):null},remove:function(t){this.write(t,"",Date.now()-864e5)}}}():function(){return{write:function(){},read:function(){return null},remove:function(){}}}();function mg(r){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(r)}function gg(r,e){return e?r.replace(/\/+$/,"")+"/"+e.replace(/^\/+/,""):r}function bd(r,e){return r&&!mg(e)?gg(r,e):e}const vg=at.isStandardBrowserEnv?function(){const e=/(msie|trident)/i.test(navigator.userAgent),t=document.createElement("a");let n;function i(s){let o=s;return e&&(t.setAttribute("href",o),o=t.href),t.setAttribute("href",o),{href:t.href,protocol:t.protocol?t.protocol.replace(/:$/,""):"",host:t.host,search:t.search?t.search.replace(/^\?/,""):"",hash:t.hash?t.hash.replace(/^#/,""):"",hostname:t.hostname,port:t.port,pathname:t.pathname.charAt(0)==="/"?t.pathname:"/"+t.pathname}}return n=i(window.location.href),function(o){const a=L.isString(o)?i(o):o;return a.protocol===n.protocol&&a.host===n.host}}():function(){return function(){return!0}}();function yg(r){const e=/^([-+\w]{1,25})(:?\/\/|:)/.exec(r);return e&&e[1]||""}function _g(r,e){r=r||10;const t=new Array(r),n=new Array(r);let i=0,s=0,o;return e=e!==void 0?e:1e3,function(c){const d=Date.now(),l=n[s];o||(o=d),t[i]=c,n[i]=d;let u=s,p=0;for(;u!==i;)p+=t[u++],u=u%r;if(i=(i+1)%r,i===s&&(s=(s+1)%r),d-o<e)return;const h=l&&d-l;return h?Math.round(p*1e3/h):void 0}}function xa(r,e){let t=0;const n=_g(50,250);return i=>{const s=i.loaded,o=i.lengthComputable?i.total:void 0,a=s-t,c=n(a),d=s<=o;t=s;const l={loaded:s,total:o,progress:o?s/o:void 0,bytes:a,rate:c||void 0,estimated:c&&o&&d?(o-s)/c:void 0,event:i};l[e?"download":"upload"]=!0,r(l)}}const wg=typeof XMLHttpRequest<"u",bg=wg&&function(r){return new Promise(function(t,n){let i=r.data;const s=mt.from(r.headers).normalize(),o=r.responseType;let a;function c(){r.cancelToken&&r.cancelToken.unsubscribe(a),r.signal&&r.signal.removeEventListener("abort",a)}L.isFormData(i)&&(at.isStandardBrowserEnv||at.isStandardBrowserWebWorkerEnv?s.setContentType(!1):s.setContentType("multipart/form-data;",!1));let d=new XMLHttpRequest;if(r.auth){const h=r.auth.username||"",f=r.auth.password?unescape(encodeURIComponent(r.auth.password)):"";s.set("Authorization","Basic "+btoa(h+":"+f))}const l=bd(r.baseURL,r.url);d.open(r.method.toUpperCase(),vd(l,r.params,r.paramsSerializer),!0),d.timeout=r.timeout;function u(){if(!d)return;const h=mt.from("getAllResponseHeaders"in d&&d.getAllResponseHeaders()),m={data:!o||o==="text"||o==="json"?d.responseText:d.response,status:d.status,statusText:d.statusText,headers:h,config:r,request:d};fg(function(w){t(w),c()},function(w){n(w),c()},m),d=null}if("onloadend"in d?d.onloadend=u:d.onreadystatechange=function(){!d||d.readyState!==4||d.status===0&&!(d.responseURL&&d.responseURL.indexOf("file:")===0)||setTimeout(u)},d.onabort=function(){d&&(n(new ae("Request aborted",ae.ECONNABORTED,r,d)),d=null)},d.onerror=function(){n(new ae("Network Error",ae.ERR_NETWORK,r,d)),d=null},d.ontimeout=function(){let f=r.timeout?"timeout of "+r.timeout+"ms exceeded":"timeout exceeded";const m=r.transitional||yd;r.timeoutErrorMessage&&(f=r.timeoutErrorMessage),n(new ae(f,m.clarifyTimeoutError?ae.ETIMEDOUT:ae.ECONNABORTED,r,d)),d=null},at.isStandardBrowserEnv){const h=(r.withCredentials||vg(l))&&r.xsrfCookieName&&hg.read(r.xsrfCookieName);h&&s.set(r.xsrfHeaderName,h)}i===void 0&&s.setContentType(null),"setRequestHeader"in d&&L.forEach(s.toJSON(),function(f,m){d.setRequestHeader(m,f)}),L.isUndefined(r.withCredentials)||(d.withCredentials=!!r.withCredentials),o&&o!=="json"&&(d.responseType=r.responseType),typeof r.onDownloadProgress=="function"&&d.addEventListener("progress",xa(r.onDownloadProgress,!0)),typeof r.onUploadProgress=="function"&&d.upload&&d.upload.addEventListener("progress",xa(r.onUploadProgress)),(r.cancelToken||r.signal)&&(a=h=>{d&&(n(!h||h.type?new an(null,r,d):h),d.abort(),d=null)},r.cancelToken&&r.cancelToken.subscribe(a),r.signal&&(r.signal.aborted?a():r.signal.addEventListener("abort",a)));const p=yg(l);if(p&&at.protocols.indexOf(p)===-1){n(new ae("Unsupported protocol "+p+":",ae.ERR_BAD_REQUEST,r));return}d.send(i||null)})},Un={http:Gm,xhr:bg};L.forEach(Un,(r,e)=>{if(r){try{Object.defineProperty(r,"name",{value:e})}catch{}Object.defineProperty(r,"adapterName",{value:e})}});const Sg={getAdapter:r=>{r=L.isArray(r)?r:[r];const{length:e}=r;let t,n;for(let i=0;i<e&&(t=r[i],!(n=L.isString(t)?Un[t.toLowerCase()]:t));i++);if(!n)throw n===!1?new ae(`Adapter ${t} is not supported by the environment`,"ERR_NOT_SUPPORT"):new Error(L.hasOwnProp(Un,t)?`Adapter '${t}' is not available in the build`:`Unknown adapter '${t}'`);if(!L.isFunction(n))throw new TypeError("adapter is not a function");return n},adapters:Un};function Ki(r){if(r.cancelToken&&r.cancelToken.throwIfRequested(),r.signal&&r.signal.aborted)throw new an(null,r)}function Oa(r){return Ki(r),r.headers=mt.from(r.headers),r.data=Wi.call(r,r.transformRequest),["post","put","patch"].indexOf(r.method)!==-1&&r.headers.setContentType("application/x-www-form-urlencoded",!1),Sg.getAdapter(r.adapter||to.adapter)(r).then(function(n){return Ki(r),n.data=Wi.call(r,r.transformResponse,n),n.headers=mt.from(n.headers),n},function(n){return wd(n)||(Ki(r),n&&n.response&&(n.response.data=Wi.call(r,r.transformResponse,n.response),n.response.headers=mt.from(n.response.headers))),Promise.reject(n)})}const La=r=>r instanceof mt?r.toJSON():r;function gr(r,e){e=e||{};const t={};function n(d,l,u){return L.isPlainObject(d)&&L.isPlainObject(l)?L.merge.call({caseless:u},d,l):L.isPlainObject(l)?L.merge({},l):L.isArray(l)?l.slice():l}function i(d,l,u){if(L.isUndefined(l)){if(!L.isUndefined(d))return n(void 0,d,u)}else return n(d,l,u)}function s(d,l){if(!L.isUndefined(l))return n(void 0,l)}function o(d,l){if(L.isUndefined(l)){if(!L.isUndefined(d))return n(void 0,d)}else return n(void 0,l)}function a(d,l,u){if(u in e)return n(d,l);if(u in r)return n(void 0,d)}const c={url:s,method:s,data:s,baseURL:o,transformRequest:o,transformResponse:o,paramsSerializer:o,timeout:o,timeoutMessage:o,withCredentials:o,adapter:o,responseType:o,xsrfCookieName:o,xsrfHeaderName:o,onUploadProgress:o,onDownloadProgress:o,decompress:o,maxContentLength:o,maxBodyLength:o,beforeRedirect:o,transport:o,httpAgent:o,httpsAgent:o,cancelToken:o,socketPath:o,responseEncoding:o,validateStatus:a,headers:(d,l)=>i(La(d),La(l),!0)};return L.forEach(Object.keys(Object.assign({},r,e)),function(l){const u=c[l]||i,p=u(r[l],e[l],l);L.isUndefined(p)&&u!==a||(t[l]=p)}),t}const Sd="1.4.0",ro={};["object","boolean","number","function","string","symbol"].forEach((r,e)=>{ro[r]=function(n){return typeof n===r||"a"+(e<1?"n ":" ")+r}});const Ia={};ro.transitional=function(e,t,n){function i(s,o){return"[Axios v"+Sd+"] Transitional option '"+s+"'"+o+(n?". "+n:"")}return(s,o,a)=>{if(e===!1)throw new ae(i(o," has been removed"+(t?" in "+t:"")),ae.ERR_DEPRECATED);return t&&!Ia[o]&&(Ia[o]=!0,console.warn(i(o," has been deprecated since v"+t+" and will be removed in the near future"))),e?e(s,o,a):!0}};function Rg(r,e,t){if(typeof r!="object")throw new ae("options must be an object",ae.ERR_BAD_OPTION_VALUE);const n=Object.keys(r);let i=n.length;for(;i-- >0;){const s=n[i],o=e[s];if(o){const a=r[s],c=a===void 0||o(a,s,r);if(c!==!0)throw new ae("option "+s+" must be "+c,ae.ERR_BAD_OPTION_VALUE);continue}if(t!==!0)throw new ae("Unknown option "+s,ae.ERR_BAD_OPTION)}}const vs={assertOptions:Rg,validators:ro},Rt=vs.validators;class Wn{constructor(e){this.defaults=e,this.interceptors={request:new Pa,response:new Pa}}request(e,t){typeof e=="string"?(t=t||{},t.url=e):t=e||{},t=gr(this.defaults,t);const{transitional:n,paramsSerializer:i,headers:s}=t;n!==void 0&&vs.assertOptions(n,{silentJSONParsing:Rt.transitional(Rt.boolean),forcedJSONParsing:Rt.transitional(Rt.boolean),clarifyTimeoutError:Rt.transitional(Rt.boolean)},!1),i!=null&&(L.isFunction(i)?t.paramsSerializer={serialize:i}:vs.assertOptions(i,{encode:Rt.function,serialize:Rt.function},!0)),t.method=(t.method||this.defaults.method||"get").toLowerCase();let o;o=s&&L.merge(s.common,s[t.method]),o&&L.forEach(["delete","get","head","post","put","patch","common"],f=>{delete s[f]}),t.headers=mt.concat(o,s);const a=[];let c=!0;this.interceptors.request.forEach(function(m){typeof m.runWhen=="function"&&m.runWhen(t)===!1||(c=c&&m.synchronous,a.unshift(m.fulfilled,m.rejected))});const d=[];this.interceptors.response.forEach(function(m){d.push(m.fulfilled,m.rejected)});let l,u=0,p;if(!c){const f=[Oa.bind(this),void 0];for(f.unshift.apply(f,a),f.push.apply(f,d),p=f.length,l=Promise.resolve(t);u<p;)l=l.then(f[u++],f[u++]);return l}p=a.length;let h=t;for(u=0;u<p;){const f=a[u++],m=a[u++];try{h=f(h)}catch(g){m.call(this,g);break}}try{l=Oa.call(this,h)}catch(f){return Promise.reject(f)}for(u=0,p=d.length;u<p;)l=l.then(d[u++],d[u++]);return l}getUri(e){e=gr(this.defaults,e);const t=bd(e.baseURL,e.url);return vd(t,e.params,e.paramsSerializer)}}L.forEach(["delete","get","head","options"],function(e){Wn.prototype[e]=function(t,n){return this.request(gr(n||{},{method:e,url:t,data:(n||{}).data}))}});L.forEach(["post","put","patch"],function(e){function t(n){return function(s,o,a){return this.request(gr(a||{},{method:e,headers:n?{"Content-Type":"multipart/form-data"}:{},url:s,data:o}))}}Wn.prototype[e]=t(),Wn.prototype[e+"Form"]=t(!0)});const zn=Wn;class no{constructor(e){if(typeof e!="function")throw new TypeError("executor must be a function.");let t;this.promise=new Promise(function(s){t=s});const n=this;this.promise.then(i=>{if(!n._listeners)return;let s=n._listeners.length;for(;s-- >0;)n._listeners[s](i);n._listeners=null}),this.promise.then=i=>{let s;const o=new Promise(a=>{n.subscribe(a),s=a}).then(i);return o.cancel=function(){n.unsubscribe(s)},o},e(function(s,o,a){n.reason||(n.reason=new an(s,o,a),t(n.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(e){if(this.reason){e(this.reason);return}this._listeners?this._listeners.push(e):this._listeners=[e]}unsubscribe(e){if(!this._listeners)return;const t=this._listeners.indexOf(e);t!==-1&&this._listeners.splice(t,1)}static source(){let e;return{token:new no(function(i){e=i}),cancel:e}}}const Cg=no;function Eg(r){return function(t){return r.apply(null,t)}}function Tg(r){return L.isObject(r)&&r.isAxiosError===!0}const ys={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511};Object.entries(ys).forEach(([r,e])=>{ys[e]=r});const Pg=ys;function Rd(r){const e=new zn(r),t=sd(zn.prototype.request,e);return L.extend(t,zn.prototype,e,{allOwnKeys:!0}),L.extend(t,e,null,{allOwnKeys:!0}),t.create=function(i){return Rd(gr(r,i))},t}const Ae=Rd(to);Ae.Axios=zn;Ae.CanceledError=an;Ae.CancelToken=Cg;Ae.isCancel=wd;Ae.VERSION=Sd;Ae.toFormData=Si;Ae.AxiosError=ae;Ae.Cancel=Ae.CanceledError;Ae.all=function(e){return Promise.all(e)};Ae.spread=Eg;Ae.isAxiosError=Tg;Ae.mergeConfig=gr;Ae.AxiosHeaders=mt;Ae.formToJSON=r=>_d(L.isHTMLForm(r)?new FormData(r):r);Ae.HttpStatusCode=Pg;Ae.default=Ae;const Dg=Ae;function Q(){Q=function(){return r};var r={},e=Object.prototype,t=e.hasOwnProperty,n=Object.defineProperty||function(v,y,_){v[y]=_.value},i=typeof Symbol=="function"?Symbol:{},s=i.iterator||"@@iterator",o=i.asyncIterator||"@@asyncIterator",a=i.toStringTag||"@@toStringTag";function c(v,y,_){return Object.defineProperty(v,y,{value:_,enumerable:!0,configurable:!0,writable:!0}),v[y]}try{c({},"")}catch{c=function(y,_,E){return y[_]=E}}function d(v,y,_,E){var R=y&&y.prototype instanceof p?y:p,I=Object.create(R.prototype),O=new S(E||[]);return n(I,"_invoke",{value:N(v,_,O)}),I}function l(v,y,_){try{return{type:"normal",arg:v.call(y,_)}}catch(E){return{type:"throw",arg:E}}}r.wrap=d;var u={};function p(){}function h(){}function f(){}var m={};c(m,s,function(){return this});var g=Object.getPrototypeOf,w=g&&g(g(k([])));w&&w!==e&&t.call(w,s)&&(m=w);var C=f.prototype=p.prototype=Object.create(m);function b(v){["next","throw","return"].forEach(function(y){c(v,y,function(_){return this._invoke(y,_)})})}function P(v,y){function _(R,I,O,x){var j=l(v[R],v,I);if(j.type!=="throw"){var K=j.arg,Se=K.value;return Se&&typeof Se=="object"&&t.call(Se,"__await")?y.resolve(Se.__await).then(function(me){_("next",me,O,x)},function(me){_("throw",me,O,x)}):y.resolve(Se).then(function(me){K.value=me,O(K)},function(me){return _("throw",me,O,x)})}x(j.arg)}var E;n(this,"_invoke",{value:function(R,I){function O(){return new y(function(x,j){_(R,I,x,j)})}return E=E?E.then(O,O):O()}})}function N(v,y,_){var E="suspendedStart";return function(R,I){if(E==="executing")throw new Error("Generator is already running");if(E==="completed"){if(R==="throw")throw I;return D()}for(_.method=R,_.arg=I;;){var O=_.delegate;if(O){var x=$(O,_);if(x){if(x===u)continue;return x}}if(_.method==="next")_.sent=_._sent=_.arg;else if(_.method==="throw"){if(E==="suspendedStart")throw E="completed",_.arg;_.dispatchException(_.arg)}else _.method==="return"&&_.abrupt("return",_.arg);E="executing";var j=l(v,y,_);if(j.type==="normal"){if(E=_.done?"completed":"suspendedYield",j.arg===u)continue;return{value:j.arg,done:_.done}}j.type==="throw"&&(E="completed",_.method="throw",_.arg=j.arg)}}}function $(v,y){var _=y.method,E=v.iterator[_];if(E===void 0)return y.delegate=null,_==="throw"&&v.iterator.return&&(y.method="return",y.arg=void 0,$(v,y),y.method==="throw")||_!=="return"&&(y.method="throw",y.arg=new TypeError("The iterator does not provide a '"+_+"' method")),u;var R=l(E,v.iterator,y.arg);if(R.type==="throw")return y.method="throw",y.arg=R.arg,y.delegate=null,u;var I=R.arg;return I?I.done?(y[v.resultName]=I.value,y.next=v.nextLoc,y.method!=="return"&&(y.method="next",y.arg=void 0),y.delegate=null,u):I:(y.method="throw",y.arg=new TypeError("iterator result is not an object"),y.delegate=null,u)}function B(v){var y={tryLoc:v[0]};1 in v&&(y.catchLoc=v[1]),2 in v&&(y.finallyLoc=v[2],y.afterLoc=v[3]),this.tryEntries.push(y)}function F(v){var y=v.completion||{};y.type="normal",delete y.arg,v.completion=y}function S(v){this.tryEntries=[{tryLoc:"root"}],v.forEach(B,this),this.reset(!0)}function k(v){if(v){var y=v[s];if(y)return y.call(v);if(typeof v.next=="function")return v;if(!isNaN(v.length)){var _=-1,E=function R(){for(;++_<v.length;)if(t.call(v,_))return R.value=v[_],R.done=!1,R;return R.value=void 0,R.done=!0,R};return E.next=E}}return{next:D}}function D(){return{value:void 0,done:!0}}return h.prototype=f,n(C,"constructor",{value:f,configurable:!0}),n(f,"constructor",{value:h,configurable:!0}),h.displayName=c(f,a,"GeneratorFunction"),r.isGeneratorFunction=function(v){var y=typeof v=="function"&&v.constructor;return!!y&&(y===h||(y.displayName||y.name)==="GeneratorFunction")},r.mark=function(v){return Object.setPrototypeOf?Object.setPrototypeOf(v,f):(v.__proto__=f,c(v,a,"GeneratorFunction")),v.prototype=Object.create(C),v},r.awrap=function(v){return{__await:v}},b(P.prototype),c(P.prototype,o,function(){return this}),r.AsyncIterator=P,r.async=function(v,y,_,E,R){R===void 0&&(R=Promise);var I=new P(d(v,y,_,E),R);return r.isGeneratorFunction(y)?I:I.next().then(function(O){return O.done?O.value:I.next()})},b(C),c(C,a,"Generator"),c(C,s,function(){return this}),c(C,"toString",function(){return"[object Generator]"}),r.keys=function(v){var y=Object(v),_=[];for(var E in y)_.push(E);return _.reverse(),function R(){for(;_.length;){var I=_.pop();if(I in y)return R.value=I,R.done=!1,R}return R.done=!0,R}},r.values=k,S.prototype={constructor:S,reset:function(v){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(F),!v)for(var y in this)y.charAt(0)==="t"&&t.call(this,y)&&!isNaN(+y.slice(1))&&(this[y]=void 0)},stop:function(){this.done=!0;var v=this.tryEntries[0].completion;if(v.type==="throw")throw v.arg;return this.rval},dispatchException:function(v){if(this.done)throw v;var y=this;function _(j,K){return I.type="throw",I.arg=v,y.next=j,K&&(y.method="next",y.arg=void 0),!!K}for(var E=this.tryEntries.length-1;E>=0;--E){var R=this.tryEntries[E],I=R.completion;if(R.tryLoc==="root")return _("end");if(R.tryLoc<=this.prev){var O=t.call(R,"catchLoc"),x=t.call(R,"finallyLoc");if(O&&x){if(this.prev<R.catchLoc)return _(R.catchLoc,!0);if(this.prev<R.finallyLoc)return _(R.finallyLoc)}else if(O){if(this.prev<R.catchLoc)return _(R.catchLoc,!0)}else{if(!x)throw new Error("try statement without catch or finally");if(this.prev<R.finallyLoc)return _(R.finallyLoc)}}}},abrupt:function(v,y){for(var _=this.tryEntries.length-1;_>=0;--_){var E=this.tryEntries[_];if(E.tryLoc<=this.prev&&t.call(E,"finallyLoc")&&this.prev<E.finallyLoc){var R=E;break}}R&&(v==="break"||v==="continue")&&R.tryLoc<=y&&y<=R.finallyLoc&&(R=null);var I=R?R.completion:{};return I.type=v,I.arg=y,R?(this.method="next",this.next=R.finallyLoc,u):this.complete(I)},complete:function(v,y){if(v.type==="throw")throw v.arg;return v.type==="break"||v.type==="continue"?this.next=v.arg:v.type==="return"?(this.rval=this.arg=v.arg,this.method="return",this.next="end"):v.type==="normal"&&y&&(this.next=y),u},finish:function(v){for(var y=this.tryEntries.length-1;y>=0;--y){var _=this.tryEntries[y];if(_.finallyLoc===v)return this.complete(_.completion,_.afterLoc),F(_),u}},catch:function(v){for(var y=this.tryEntries.length-1;y>=0;--y){var _=this.tryEntries[y];if(_.tryLoc===v){var E=_.completion;if(E.type==="throw"){var R=E.arg;F(_)}return R}}throw new Error("illegal catch attempt")},delegateYield:function(v,y,_){return this.delegate={iterator:k(v),resultName:y,nextLoc:_},this.method==="next"&&(this.arg=void 0),u}},r}function ka(r,e,t,n,i,s,o){try{var a=r[s](o),c=a.value}catch(d){t(d);return}a.done?e(c):Promise.resolve(c).then(n,i)}function Oe(r){return function(){var e=this,t=arguments;return new Promise(function(n,i){var s=r.apply(e,t);function o(c){ka(s,n,i,o,a,"next",c)}function a(c){ka(s,n,i,o,a,"throw",c)}o(void 0)})}}function xg(r,e){if(r==null)return{};var t={},n=Object.keys(r),i,s;for(s=0;s<n.length;s++)i=n[s],!(e.indexOf(i)>=0)&&(t[i]=r[i]);return t}function sr(r,e){if(r==null)return{};var t=xg(r,e),n,i;if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(r);for(i=0;i<s.length;i++)n=s[i],!(e.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(r,n)&&(t[n]=r[n])}return t}function Og(r,e){if(typeof r!="object"||r===null)return r;var t=r[Symbol.toPrimitive];if(t!==void 0){var n=t.call(r,e||"default");if(typeof n!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(r)}function Ct(r){var e=Og(r,"string");return typeof e=="symbol"?e:String(e)}function X(r,e,t){return e=Ct(e),e in r?Object.defineProperty(r,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):r[e]=t,r}function Ma(r,e){var t=Object.keys(r);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(r);e&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(r,i).enumerable})),t.push.apply(t,n)}return t}function se(r){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?Ma(Object(t),!0).forEach(function(n){X(r,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(t)):Ma(Object(t)).forEach(function(n){Object.defineProperty(r,n,Object.getOwnPropertyDescriptor(t,n))})}return r}function we(r){if(r===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return r}function _s(r,e){return _s=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,i){return n.__proto__=i,n},_s(r,e)}function Cd(r,e){if(typeof e!="function"&&e!==null)throw new TypeError("Super expression must either be null or a function");r.prototype=Object.create(e&&e.prototype,{constructor:{value:r,writable:!0,configurable:!0}}),Object.defineProperty(r,"prototype",{writable:!1}),e&&_s(r,e)}function Kn(r){return Kn=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},Kn(r)}function Lg(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function Ig(r,e){if(e&&(typeof e=="object"||typeof e=="function"))return e;if(e!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return we(r)}function Ed(r){var e=Lg();return function(){var n=Kn(r),i;if(e){var s=Kn(this).constructor;i=Reflect.construct(n,arguments,s)}else i=n.apply(this,arguments);return Ig(this,i)}}function io(r,e){if(!(r instanceof e))throw new TypeError("Cannot call a class as a function")}function Na(r,e){for(var t=0;t<e.length;t++){var n=e[t];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(r,Ct(n.key),n)}}function so(r,e,t){return e&&Na(r.prototype,e),t&&Na(r,t),Object.defineProperty(r,"prototype",{writable:!1}),r}var kg="https://sdk-sushi.huddle01.com",Mg="https://sdk-iriko.huddle01.com",Ng=function(){var r=Oe(Q().mark(function e(){var t,n;return Q().wrap(function(s){for(;;)switch(s.prev=s.next){case 0:return s.prev=0,s.next=3,Dg.post("".concat(Mg,"/trpc/auth.guest"));case 3:return t=s.sent,n=t.data.result.data.json.accessToken,console.log({accessToken:n}),s.abrupt("return",n);case 9:s.prev=9,s.t0=s.catch(0),console.log({error:s.t0});case 12:case"end":return s.stop()}},e,null,[[0,9]])}));return function(){return r.apply(this,arguments)}}(),Ag=[{scaleResolutionDownBy:4,maxBitrate:3e5,rid:"r0",scalabilityMode:"S1T3",maxFramerate:15},{scaleResolutionDownBy:2,maxBitrate:6e5,rid:"r1",scalabilityMode:"S1T3",maxFramerate:30},{scaleResolutionDownBy:1,maxBitrate:9e6,rid:"r2",scalabilityMode:"S1T3",maxFramerate:30}],jg=[{maxBitrate:1e6,networkPriority:"high",maxFramerate:30,dtx:!0}],$g={cam:Ag,"share-video":jg,mic:void 0,"share-audio":void 0},Bg={audio:{opusStereo:!0,opusFec:!0,opusDtx:!0},video:{videoGoogleStartBitrate:1e3}},Fg=function(){function r(){io(this,r),X(this,"_isRecorder",!1),X(this,"_handleConnectError",function(e,t){console.info("Connection Error"),console.error({error:e}),t({type:"CLIENT_LOBBY_FAILED"})})}return so(r,[{key:"_handleConnect",value:function(t){this._machineCB=t,console.log("EventHandler.handleConnect() | EventHandler.ts",this.socket),console.log({this:this,func:"_handleConnect",roomId:this.roomId,meId:this.meId,socket:this.socket}),this._machineCB({type:"CLIENT_LOBBY_JOINED",peerId:this.meId})}},{key:"_handleDisconnect",value:function(t){t({type:"CLIENT_LOBBY_FAILED"}),console.log("EventHandler.handleDisconnect() | EventHandler.ts",this.socket)}}]),r}(),Ug=function(r){Cd(t,r);var e=Ed(t);function t(){var n;return io(this,t),n=e.call(this),X(we(n),"_consumers",new Map),X(we(n),"_peersConsumers",new Map),X(we(n),"_turn",[{username:"test-turn",urls:"turn:turn.huddle01.com:443?transport=udp",credential:"test-turn"},{username:"test-turn",urls:"turn:turn.huddle01.com:443?transport=tcp",credential:"test-turn"}]),X(we(n),"_produce",function(){var i=Oe(Q().mark(function s(o,a){var c,d;return Q().wrap(function(u){for(;;)switch(u.prev=u.next){case 0:if(n._sendTransport){u.next=3;break}return console.warn("produce() | sendTransport is undefined"),u.abrupt("return");case 3:if(n._device&&n._device.rtpCapabilities.codecs){u.next=5;break}return u.abrupt("return");case 5:return c={cam:n._device.rtpCapabilities.codecs.find(function(p){return p.mimeType.toLowerCase()==="video/h264"&&p.parameters["profile-level-id"]==="42e034"}),"share-video":n._device.rtpCapabilities.codecs.find(function(p){return p.mimeType.toLowerCase()==="video/h264"&&p.parameters["profile-level-id"]==="42e034"}),mic:void 0,"share-audio":void 0},u.next=8,n._sendTransport.produce({track:o,encodings:$g[a],codecOptions:Bg[o.kind],codec:c[a],stopTracks:!1,zeroRtpOnPause:!0,disableTrackOnPause:!0,appData:{type:a,share:a==="share-audio"||a==="share-video"}});case 8:return d=u.sent,u.abrupt("return",d);case 10:case"end":return u.stop()}},s)}));return function(s,o){return i.apply(this,arguments)}}()),X(we(n),"_produceAudioStream",function(){var i=Oe(Q().mark(function s(o,a){var c,d;return Q().wrap(function(u){for(;;)switch(u.prev=u.next){case 0:if(n._machineCB=a,console.log("produceAudioStream() | Producing Audio Stream"),u.prev=2,o){u.next=6;break}return console.log("produceAudioStream() | stream is undefined"),u.abrupt("return");case 6:if(!n._audioProducer){u.next=9;break}return console.log("handleCreateWebRTC() | Audio Producer already exists"),u.abrupt("return");case 9:if(c=o.getAudioTracks()[0],c){u.next=13;break}return console.log("enableMic() | Track is undefined"),u.abrupt("return");case 13:return u.next=15,n._produce(c,"mic");case 15:if(d=u.sent,d){u.next=19;break}return console.log("enableMic() | Producer create error"),u.abrupt("return");case 19:if(d.track){u.next=22;break}return console.log("enableMic() | Producer track is undefined"),u.abrupt("return");case 22:n._audioProducer=d,n._audioProducer.on("trackended",function(){console.log("produceAudioStream() | trackended for mic"),n._stopAudioProducer(a).catch(console.error)}),n._audioProducer.on("transportclose",function(){console.log("produceAudioStream() | transportclose for mic"),n._stopAudioProducer(a).catch(console.error)}),n._audioProducer.on("@replacetrack",function(){console.log("produceAudioStream() | @replacetrack for mic")}),n._audioProducer.on("@close",function(){console.log("produceAudioStream() | @close for mic"),n._stopAudioProducer(a).catch(console.error)}),u.next=33;break;case 29:throw u.prev=29,u.t0=u.catch(2),console.error("Error enabling mic",{error:u.t0}),new Error("Error enabling mic");case 33:case"end":return u.stop()}},s,null,[[2,29]])}));return function(s,o){return i.apply(this,arguments)}}()),X(we(n),"_produceVideoStream",function(){var i=Oe(Q().mark(function s(o,a){var c,d;return Q().wrap(function(u){for(;;)switch(u.prev=u.next){case 0:if(n._machineCB=a,console.log("produceVideoStream() | Producing Video Stream"),u.prev=2,o){u.next=6;break}return console.log("produceVideoStream() | stream is undefined"),u.abrupt("return",Promise.reject());case 6:if(!n._videoProducer){u.next=9;break}return console.log("handleCreateWebRTC() | Video Producer already exists"),u.abrupt("return");case 9:if(c=o.getVideoTracks()[0],c){u.next=13;break}return console.log("produceVideoStream() | Track is undefined"),u.abrupt("return");case 13:return u.next=15,n._produce(c,"cam");case 15:if(d=u.sent,d){u.next=19;break}return console.log("produceVideoStream() | Producer create error"),u.abrupt("return");case 19:if(d.track){u.next=22;break}return console.log("produceVideoStream() | Producer track is undefined"),u.abrupt("return");case 22:n._videoProducer=d,n._videoProducer.on("trackended",function(){console.log("enabelCam() | trackended for cam"),n._stopVideoProducer(a).catch(console.error)}),n._videoProducer.on("transportclose",function(){console.log("produceVideoStream() | transportclose for cam"),n._stopVideoProducer(a).catch(console.error)}),n._videoProducer.on("@replacetrack",function(p,h,f){console.log("produceVideoStream() | @replacetrack for cam")}),n._videoProducer.on("@close",function(){console.log("produceVideoStream() | @close for cam"),n._stopVideoProducer(a).catch(console.error)}),u.next=32;break;case 29:u.prev=29,u.t0=u.catch(2),console.error("Error enabling cam",{error:u.t0});case 32:case"end":return u.stop()}},s,null,[[2,29]])}));return function(s,o){return i.apply(this,arguments)}}()),X(we(n),"requestStopAudioProducer",Oe(Q().mark(function i(){return Q().wrap(function(o){for(;;)switch(o.prev=o.next){case 0:if(console.warn("requestStopAudioProducer()"),o.prev=1,n._audioProducer){o.next=5;break}return console.warn("requestStopAudioProducer() | audioProducer is undefined"),o.abrupt("return");case 5:n.socket.emit("close-producer",{peerId:n.meId,producerId:n._audioProducer.appData.momoProducerId,roomId:n.roomId,appData:{type:"mic"}}),n._audioProducer.close(),o.next=11;break;case 9:o.prev=9,o.t0=o.catch(1);case 11:case"end":return o.stop()}},i,null,[[1,9]])}))),X(we(n),"_stopAudioProducer",function(){var i=Oe(Q().mark(function s(o){return Q().wrap(function(c){for(;;)switch(c.prev=c.next){case 0:if(n._machineCB=o,console.log("stopAudioProducer() | Stopping audio producer"),c.prev=2,n._audioProducer){c.next=6;break}return console.warn("stopAudioProducer() | audioProducer is undefined"),c.abrupt("return");case 6:if(n._audioProducer=void 0,n._machineCB("CLIENT_MIC_PRODUCER_STOPPED"),n._audioProducer.appData.momoProducerId){c.next=11;break}return console.warn("stopAudioProducer() | momoProducerId is undefined"),c.abrupt("return");case 11:c.next=17;break;case 13:c.prev=13,c.t0=c.catch(2),console.error("Error stopping audio producer"),console.error({error:c.t0});case 17:case"end":return c.stop()}},s,null,[[2,13]])}));return function(s){return i.apply(this,arguments)}}()),X(we(n),"requestStopVideoProducer",Oe(Q().mark(function i(){return Q().wrap(function(o){for(;;)switch(o.prev=o.next){case 0:if(console.warn("requestStopVideoProducer()"),o.prev=1,n._videoProducer){o.next=5;break}return console.warn("requestStopVideoProducer() | videoProducer is undefined"),o.abrupt("return");case 5:n.socket.emit("close-producer",{peerId:n.meId,producerId:n._videoProducer.appData.momoProducerId,roomId:n.roomId,appData:{type:"cam"}}),n._videoProducer.close(),o.next=11;break;case 9:o.prev=9,o.t0=o.catch(1);case 11:case"end":return o.stop()}},i,null,[[1,9]])}))),X(we(n),"_stopVideoProducer",function(){var i=Oe(Q().mark(function s(o){return Q().wrap(function(c){for(;;)switch(c.prev=c.next){case 0:if(n._machineCB=o,console.log("stopVideoProducer() | Stopping video producer"),c.prev=2,n._videoProducer){c.next=6;break}return console.warn("stopVideoProducer() | videoProducer is undefined"),c.abrupt("return");case 6:if(n._videoProducer=void 0,n._machineCB("CLIENT_CAM_PRODUCER_STOPPED"),n._videoProducer.appData.momoProducerId){c.next=11;break}return console.warn("stopVideoProducer() | momoProducerId is undefined"),c.abrupt("return");case 11:c.next=17;break;case 13:c.prev=13,c.t0=c.catch(2),console.error("Error stopping video producer"),console.error({error:c.t0});case 17:case"end":return c.stop()}},s,null,[[2,13]])}));return function(s){return i.apply(this,arguments)}}()),X(we(n),"_handleJoinSuccess",function(){var i=Oe(Q().mark(function s(o,a){var c,d,l,u;return Q().wrap(function(h){for(;;)switch(h.prev=h.next){case 0:return n._machineCB=a,h.prev=1,console.log("join-success",o),n._device=new hc.Device,h.next=6,n._device.load({routerRtpCapabilities:o.routerRTPCapabilities});case 6:n.socket.emit("create-webrtc-transport",{peerId:o.peerId,roomId:o.roomId,sctpCapabilities:n._device.sctpCapabilities}),c=o.roomMetadata,d=c.peerIds,l=c.peerMetaData,u=o.role,console.log({role:u}),n._machineCB({type:"CLIENT_ME_JOINED",role:u}),console.log("handleJoinSuccess() | peerIds",d),d.map(function(f){var m=l[f];m||console.error("handleJoinSuccess() | No Peer Data Found");var g={peerId:f,role:m.role,displayName:(m==null?void 0:m.displayName)||"No Name Found",avatarUrl:(m==null?void 0:m.avatarUrl)||"/avatars/0.png",joinStatus:"joined:webrtc-creating",isHandRaised:(m==null?void 0:m.isHandRaised)||!1};console.log("handleJoinSuccess",{newPeer:g}),n._machineCB({type:"CLIENT_PEER_JOINED",peer:g})}),h.next=17;break;case 14:h.prev=14,h.t0=h.catch(1),console.debug({err:h.t0});case 17:case"end":return h.stop()}},s,null,[[1,14]])}));return function(s,o){return i.apply(this,arguments)}}()),X(we(n),"_handleProduceSuccess",function(i){console.info("handleProduceSuccess() | Produce Success");var s=i.peerId,o=i.producerId,a=i.roomId,c=i.appData;c.type==="cam"?(n._videoProducer.appData.momoProducerId=o,n._machineCB("CLIENT_CAM_PRODUCER_SUCCESS"),console.log("CLIENT_CAM_PRODUCER_SUCCESS")):(n._audioProducer.appData.momoProducerId=o,n._machineCB("CLIENT_MIC_PRODUCER_SUCCESS"),console.log("CLIENT_MIC_PRODUCER_SUCCESS")),console.log({data:i,type:"PRODUCER_SUCCESS",meta:{peerId:s,producerId:o,roomId:a,audProd:n._audioProducer,vidProd:n._videoProducer}})}),X(we(n),"_handleClientConsumer",function(){var i=Oe(Q().mark(function s(o,a){var c,d,l,u,p;return Q().wrap(function(f){for(;;)switch(f.prev=f.next){case 0:if(n._machineCB=a,console.info("handleClientConsumer() | Client Consumer"),f.prev=2,n._recvTransport){f.next=5;break}throw new Error("No Recv Transport");case 5:return c=o.appData.type,d="".concat(o.producerId,"-").concat(o.appData.type==="cam"||o.appData.type==="mic"?"audio-video":"screenAudio-screenVideo"),f.next=9,n._recvTransport.consume({id:o.id,producerId:o.producerId,kind:o.kind,rtpParameters:o.rtpParameters,appData:se(se({},o.appData),{},{peerId:o.producerPeerId}),streamId:d});case 9:l=f.sent,n._consumers.set(l.id,l),u=n._peersConsumers.get(o.producerPeerId),n._peersConsumers.set(o.producerPeerId,se(se({},u),{},X({},o.appData.type,l.id))),p={id:l.id,track:l.track,peerId:o.producerPeerId,appData:{type:c,producerPeerId:o.producerPeerId,momoProducerId:o.producerId},connectionState:{stage:"connected",paused:l.paused}},c==="share-video"&&console.log("create-consumer() | Share Video"),c==="cam"&&console.log("create-consumer() | Cam Video"),n._machineCB({type:"CLIENT_CONSUMER_CREATED",consumer:p}),console.log({consumerToAdd:p}),l.on("transportclose",function(){n._consumers.delete(l.id),console.log("client-consumer() | Transport Close"),l.close()}),l.on("trackended",function(){console.log("client-consumer() | Tracked Ended")}),l.on("@pause",function(){console.log("client-consumer() | @pause")}),l.on("@resume",function(){console.log("client-consumer() | @resume")}),l.on("@close",function(){console.log("client-consumer() | @close"),n._consumers.delete(l.id)}),f.next=28;break;case 25:f.prev=25,f.t0=f.catch(2),console.error("Error creating client consumer: ",{error:f.t0,data:o});case 28:case"end":return f.stop()}},s,null,[[2,25]])}));return function(s,o){return i.apply(this,arguments)}}()),X(we(n),"_handleConsumerClosed",function(i,s){var o;n._machineCB=s,console.log("handleConsumerClosed() | Consumer Closed");var a=i.producerPeerId,c=i.appData;if(!i.appData||!i.appData.type){console.error("Need appData and appData.type to close consumer");return}var d=(o=n._peersConsumers.get(a))===null||o===void 0?void 0:o[c.type],l=n._consumers.get(d);if(console.log({appData:c,_peersConsumers:n._peersConsumers,_consumers:n._consumers}),l)l.close(),n._machineCB({type:"CLIENT_CONSUMER_CLOSED",consumerId:d});else{console.error("handleConsumerClosed() | No consumer data of type ".concat(c.type," for peer ").concat(a));return}}),X(we(n),"_handleCreateWebRTC",function(){var i=Oe(Q().mark(function s(o,a){return Q().wrap(function(d){for(;;)switch(d.prev=d.next){case 0:if(console.info("handleCreateWebRTC() | Creating WebRTC Transport for ".concat(o.peerId)),n._device){d.next=4;break}return console.error("Device not initialized"),d.abrupt("return");case 4:try{n._sendTransport=n._createDeviceTransport(o,"send"),n._recvTransport=n._createDeviceTransport(o,"recv"),console.log(n._sendTransport,n._recvTransport),n._videoStream&&n._produceVideoStream(n._videoStream,a),n._audioStream&&n._produceAudioStream(n._audioStream,a)}catch(l){console.debug({err:l})}n.socket.emit("create-consumers-for-newpeer",{peerId:o.peerId,roomId:o.roomId});case 6:case"end":return d.stop()}},s)}));return function(s,o){return i.apply(this,arguments)}}()),X(we(n),"_createDeviceTransport",function(i,s){var o;if(n._device===void 0){console.warn("createDeviceTransport() | mediasoup device is undefined");return}if(s==="send"?(console.debug("createDeviceTransport() | creating send transport"),o=n._device.createSendTransport({id:i.sendTransportSDPInfo.id,iceParameters:i.sendTransportSDPInfo.iceParameters,iceCandidates:i.sendTransportSDPInfo.iceCandidates,dtlsParameters:i.sendTransportSDPInfo.dtlsParameters,sctpParameters:i.sendTransportSDPInfo.sctpParameters,iceServers:n._turn,proprietaryConstraints:{},appData:{}})):s==="recv"&&(console.debug("createDeviceTransport() | creating recv transport"),o=n._device.createRecvTransport({id:i.recvTransportSDPInfo.id,iceParameters:i.recvTransportSDPInfo.iceParameters,iceCandidates:i.recvTransportSDPInfo.iceCandidates,dtlsParameters:i.recvTransportSDPInfo.dtlsParameters,sctpParameters:i.recvTransportSDPInfo.sctpParameters,iceServers:n._turn,proprietaryConstraints:{},appData:{}})),o===void 0){console.warn("createDeviceTransport() | transport is undefined , transportType is incorrect");return}return o.on("connect",function(a,c,d){var l=a.dtlsParameters;console.info("".concat(s," Transport connect"));try{n.socket.emit("connect-webrtc-transport",{dtlsParameters:l,transportType:s,peerId:i.peerId,roomId:i.roomId}),c()}catch(u){d(u)}}),o.on("produce",function(){var a=Oe(Q().mark(function c(d,l,u){var p,h,f,m,g,w;return Q().wrap(function(b){for(;;)switch(b.prev=b.next){case 0:p=d.kind,h=d.rtpParameters,f=d.appData;try{g=n.socket.emit("transport-produce",{peerId:i.peerId,roomId:i.roomId,producerData:{kind:p,paused:!1,transportId:(m=o)===null||m===void 0?void 0:m.id,rtpParameters:h},appData:{type:f.type,producerPeerId:i.peerId}}),w=g.id,l({id:w})}catch(P){console.debug({err:P}),u(P)}case 2:case"end":return b.stop()}},c)}));return function(c,d,l){return a.apply(this,arguments)}}()),o.on("producedata",function(){var a=Oe(Q().mark(function c(d,l,u){var p,h,f,m,g,w,C;return Q().wrap(function(P){for(;;)switch(P.prev=P.next){case 0:p=d.sctpStreamParameters,h=d.label,f=d.protocol,m=d.appData;try{w=n.socket.emit("transport-produce-data",{peerId:i.peerId,roomId:i.roomId,producerData:{transportId:(g=o)===null||g===void 0?void 0:g.id,sctpStreamParameters:{streamId:p.streamId,maxPacketLifeTime:p.maxPacketLifeTime,maxRetransmits:p.maxRetransmits,ordered:p.ordered},label:h,protocol:f,appData:m}}),C=w.id,l({id:C})}catch(N){console.debug({error:N}),u(N)}case 2:case"end":return P.stop()}},c)}));return function(c,d,l){return a.apply(this,arguments)}}()),console.info("".concat(s," Transport created")),o}),n}return so(t)}(Fg),zg=function(r){Cd(t,r);var e=Ed(t);function t(){var n;return io(this,t),n=e.call(this),X(we(n),"_handlePeerLeft",function(i,s){var o=i.peerId;n._machineCB=s,n._machineCB({type:"CLIENT_PEER_LEFT",peerId:o}),n.peers.delete(o),console.info("_handlePeerLeft() | Peer Left",{peerId:o})}),X(we(n),"_handleNewPeer",function(i,s){if(n._machineCB=s,console.info("handleNewPeer() | New Peer Joined",i,{peerId:i.peerId,meId:n.meId,isMe:i.peerId===n.meId}),i.peerId===n.meId){s({type:"CLIENT_ROOM_JOINED"});return}var o={peerId:i.peerId,displayName:i.displayName,avatarUrl:i.avatarUrl||"",joinStatus:"joined:webrtc-creating",isHandRaised:i.isHandRaised||!1,role:i.role};n._machineCB({type:"CLIENT_PEER_JOINED",peer:o}),n.peers.set(i.peerId,o),i.peerId.includes("botId")&&n._machineCB({type:"CLIENT_STARTED_RECORDING"}),console.log(i.peerId,{newPeer:o,peers:n.peers})}),X(we(n),"startRecording",function(){var i=Oe(Q().mark(function s(o){return Q().wrap(function(c){for(;;)switch(c.prev=c.next){case 0:if(o){c.next=2;break}throw new Error("startRecording() | No sourceUrl provided.");case 2:if(!o.includes("localhost")){c.next=4;break}throw new Error("startRecording() | Recording cannot be started on localhost.");case 4:return console.log("HuddleWebClient | startRecording() | Starting recording",{sourceUrl:o}),c.abrupt("return",new Promise(function(d,l){n.socket.emit("start-recording",{sourceUrl:o},function(u){u.success?d(u):(console.error("startRecording() | Error starting recording",u.error),l(u))})}));case 6:case"end":return c.stop()}},s)}));return function(s){return i.apply(this,arguments)}}()),X(we(n),"stopRecording",Oe(Q().mark(function i(){return Q().wrap(function(o){for(;;)switch(o.prev=o.next){case 0:return o.abrupt("return",new Promise(function(a,c){n.socket.emit("stop-recording",{ipfs:!1},function(d){d.success?a(d):(console.error("stopRecording() | Error in stopping recording",d.data),c(d))})}));case 1:case"end":return o.stop()}},i)}))),X(we(n),"startStreaming",function(){var i=Oe(Q().mark(function s(o){return Q().wrap(function(c){for(;;)switch(c.prev=c.next){case 0:if(o.sourceUrl){c.next=2;break}throw new Error("startStreaming() | No sourceUrl provided.");case 2:if(!o.sourceUrl.includes("localhost")){c.next=4;break}throw new Error("startStreaming() | Streaming cannot be started on localhost.");case 4:return c.abrupt("return",new Promise(function(d,l){n.socket.emit("start-livestream",o,function(u){u.success?d(u):(console.error("startStreaming() | Error in starting streaming",u.data),l(u))})}));case 5:case"end":return c.stop()}},s)}));return function(s){return i.apply(this,arguments)}}()),X(we(n),"stopStreaming",Oe(Q().mark(function i(){return Q().wrap(function(o){for(;;)switch(o.prev=o.next){case 0:return o.abrupt("return",new Promise(function(a,c){n.socket.emit("stop-livestream",null,function(d){d.success?a(d):(console.error("stopStreaming() | Error in stopping streaming",d.data),c(d))})}));case 1:case"end":return o.stop()}},i)}))),X(we(n),"setDisplayName",function(i){var s={data:{displayName:{name:i}},peerId:n.meId};return console.log({displayName:i,namePayload:s}),new Promise(function(o,a){n.socket.emit("peer-set-displayName",s,function(c){c.success?o(i):a(c)})})}),X(we(n),"handlePeerUpdatedHandleName",function(i){console.log("handlePeerUpdatedHandleName",i.data.displayName.name,i.peerId),n._machineCB({type:"CLIENT_DISPLAY_NAME_CHANGED",displayName:i.data.displayName.name,peerId:i.peerId})}),n.meId="peerId-".concat(pa()),n.peers=new Map,n}return so(t,[{key:"joinLobby",value:function(){var n=Oe(Q().mark(function s(o,a,c,d){var l=this,u,p,h=arguments;return Q().wrap(function(m){for(;;)switch(m.prev=m.next){case 0:if(u=h.length>4&&h[4]!==void 0?h[4]:"user",a){m.next=3;break}throw new Error("Error: joinLobby() | No roomId passed");case 3:if(u==="recorder"&&(this.meId="botId-".concat(pa())),this.roomId=a,m.t0=c,m.t0){m.next=10;break}return m.next=9,Ng();case 9:m.t0=m.sent;case 10:if(p=m.t0,p){m.next=13;break}throw new Error("joinLobby() | HuddleWebClient.ts | No token found");case 13:this.socket=$n("".concat(kg,"/").concat(a),{reconnectionAttempts:10,auth:function(w){return w({peerId:l.meId,token:p,projectId:o})}}),this.socket.on("connect",function(){return l._handleConnect(d)}),this.socket.on("join-success",function(g){return l._handleJoinSuccess(g,d)}),this.socket.on("disconnect",function(){return l._handleDisconnect(d)}),this.socket.on("connect_error",function(g){l._handleConnectError(g,d)}),this.socket.io.on("reconnect",function(g){console.warn("reconnecting",g)}),this.socket.io.on("reconnect_attempt",function(g){console.log("reconnect_attempt",g)}),this.socket.io.on("reconnect_error",function(g){console.log("reconnect_error",g),console.error({error:g})}),this.socket.io.on("reconnect_failed",function(){console.log("reconnect_failed")}),this.socket.on("create-webrtc-success",function(g){return l._handleCreateWebRTC(g,d)}),this.socket.on("transport-produce-success",function(g){return l._handleProduceSuccess(g)}),this.socket.on("create-client-consumer",function(g){return l._handleClientConsumer(g,d)}),this.socket.on("consumer-closed",function(g){return l._handleConsumerClosed(g,d)}),this.socket.on("new-peer",function(g){return l._handleNewPeer(g,d)}),this.socket.on("peer-left",function(g){return l._handlePeerLeft(g,d)}),this.socket.on("meeting-ended",function(){l._close(d)}),this.socket.on("kicked",function(){l._close(d)}),this.socket.on("recording-started",function(){console.log("HuddleWebClient | recording-started"),l._machineCB=d,l._machineCB("CLIENT_STARTED_RECORDING")}),this.socket.on("recording-stopped",function(){console.log("HuddleWebClient | recording-stopped"),console.log("CLIENT_STOPPED_RECORDING"),l._machineCB=d,l._machineCB("CLIENT_STOPPED_RECORDING")}),this.socket.on("recording-data",function(g){l._machineCB=d,console.log("RECORDING DATA",{data:g}),l._machineCB({type:"CLIENT_RECORDING_DATA",recordingData:g})}),this.socket.on("livestream-started",function(g){l._machineCB=d,console.log("LIVESTREAM STARTED",{data:g}),l._machineCB({type:"CLIENT_STARTED_STREAMING",livestreamData:{livestreamingPlatform:g.platform,playbackId:g.playbackId}})}),this.socket.on("livestream-stopped",function(){l._machineCB=d,l._machineCB("CLIENT_STOPPED_STREAMING")}),this.socket.on("peer-updated-displayName",this.handlePeerUpdatedHandleName),console.log({func:"joinLobby",roomId:this.roomId,meId:this.meId,socket:this.socket});case 37:case"end":return m.stop()}},s,this)}));function i(s,o,a,c){return n.apply(this,arguments)}return i}()},{key:"joinRoom",value:function(){var n=Oe(Q().mark(function s(){var o=this;return Q().wrap(function(c){for(;;)switch(c.prev=c.next){case 0:return console.info("roomJoinRequest() | Joining room ".concat(this.roomId)),c.abrupt("return",new Promise(function(d,l){o.socket.emit("join-request",function(u){u.success?d(u):(console.error("roomJoinRequest() | Error starting recording",u.data),l(u))})}));case 2:case"end":return c.stop()}},s,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"leaveRoom",value:function(i){this.socket.emit("endMeeting"),this._close(i)}},{key:"_close",value:function(i){var s,o,a,c,d,l;this._machineCB=i,this.socket&&((s=this._videoProducer)===null||s===void 0||(o=s.track)===null||o===void 0||o.stop(),(a=this._audioProducer)===null||a===void 0||(c=a.track)===null||c===void 0||c.stop(),this._stopVideoProducer(i),this._stopAudioProducer(i),(d=this._recvTransport)===null||d===void 0||d.close(),(l=this._sendTransport)===null||l===void 0||l.close(),this.socket.disconnect(),this._machineCB("CLIENT_ROOM_LEFT"))}}]),t}(Ug),Vg=function(r){return r.host="host",r.moderator="moderator",r.speaker="speaker",r.listener="listener",r.peer="peer",r}({}),Td=Gl({predictableActionArguments:!0,id:"Meeting Machine",tsTypes:{},initial:"Idle",context:{projectId:"",displayName:"Guest",peerId:"",roomId:"",error:"",role:Vg.peer,huddleClient:new zg,micEnabled:!1,camEnabled:!1,micStream:null,camStream:null,peers:{},peersToConsumers:{},consumers:{},recordingData:{},livestreamData:{}},schema:{context:{},events:{},services:{}},states:{Idle:{on:{INIT:{target:"Initialized",actions:"assignProjectIdToContext"}}},Initialized:{initial:"NotJoined",states:{NotJoined:{on:{JOIN_LOBBY:{target:"JoiningLobby"}}},JoiningLobby:{on:{CLIENT_LOBBY_FAILED:{target:"JoinLobbyFailed"},CLIENT_LOBBY_JOINED:{target:"JoinedLobby"}},invoke:{src:function(e,t){return function(n){if(t.type==="JOIN_LOBBY")return e.huddleClient.joinLobby(e.projectId,t.roomId,t.accessToken,n,t.userType)}},onError:{target:"JoinLobbyFailed",actions:"assignErrorToContext"}}},JoinLobbyFailed:{on:{JOIN_LOBBY:{target:"JoiningLobby"}}},JoinedLobby:{entry:"assignPeerIdToContext",on:{JOIN_ROOM:"JoiningRoom",LEAVE_LOBBY:"NotJoined"},type:"parallel",states:{Emitted:{initial:"NotEmitted",states:{NotEmitted:{after:{100:"Emitted"}},Emitted:{type:"final"}}},DisplayName:{initial:"NotSet",states:{NotSet:{on:{SET_DISPLAY_NAME:"Loading"}},Loading:{invoke:{src:function(e,t){return function(n){if(t.type==="SET_DISPLAY_NAME")return e.huddleClient.setDisplayName(t.displayName)}},onDone:{target:"DisplayNameSet",actions:"assignDisplayNameToContext"}}},DisplayNameSet:{on:{SET_DISPLAY_NAME:"Loading"}}}},Mic:{initial:"Muted",states:{Muted:{on:{ENABLE_MIC:{target:"Loading"}}},Loading:{invoke:{src:"loadMicStream",onDone:{target:"Unmuted",actions:"assignMicStreamToContext"},onError:{target:"Muted",actions:"assignErrorToContext"}}},Unmuted:{on:{DISABLE_MIC:{target:"Muted",actions:"stopMicStream"}}}}},Cam:{initial:"Off",states:{Off:{on:{ENABLE_CAM:{target:"Loading"}}},Loading:{invoke:{src:"loadCamStream",onDone:{target:"On",actions:"assignCamStreamToContext"},onError:{target:"Off",actions:"assignErrorToContext"}}},On:{on:{DISABLE_CAM:{target:"Off",actions:"stopCamStream"}}}}}}},JoiningRoom:{on:{CLIENT_ROOM_JOINED:"JoinedRoom",CLIENT_ME_JOINED:{actions:Re(function(r,e){return{role:e.role}})},CLIENT_PEER_JOINED:{actions:Re(function(r,e){return{peers:se(se({},r.peers),{},X({},e.peer.peerId,e.peer)),peersToConsumers:se(se({},r.peersToConsumers),{},X({},e.peer.peerId,{mic:null,cam:null,"share-audio":null,"share-video":null}))}})},CLIENT_PEER_LEFT:{actions:Re(function(r,e){var t=r.peers,n=e.peerId;t[n];var i=sr(t,[n].map(Ct)),s=Object.values(r.consumers).filter(function(a){return a.peerId===e.peerId}),o=r.consumers;return s.forEach(function(a){delete o[a.id]}),{peers:i,consumers:o}})},CLIENT_CONSUMER_CREATED:{actions:Re(function(r,e){return{consumers:se(se({},r.consumers),{},X({},e.consumer.id,e.consumer)),peersToConsumers:se(se({},r.peersToConsumers),{},X({},e.consumer.peerId,se(se({},r.peersToConsumers[e.consumer.peerId]),{},X({},e.consumer.appData.type,e.consumer.id))))}})},CLIENT_CONSUMER_CLOSED:{actions:Re(function(r,e){var t=r.consumers,n=e.consumerId,i=t[n],s=sr(t,[n].map(Ct)),o=r.peersToConsumers[i.peerId],a=i.appData.type;o[a];var c=sr(o,[a].map(Ct));return{consumers:s,peersToConsumers:se(se({},r.peersToConsumers),{},X({},i.peerId,se({mic:null,cam:null,"share-audio":null,"share-video":null},c)))}})}},invoke:{onError:{target:"JoinRoomFailed",actions:"assignErrorToContext"},src:function(e){return e.huddleClient.joinRoom()}}},JoinRoomFailed:{on:{JOIN_ROOM:"JoiningRoom"}},JoinedRoom:{on:{LEAVE_ROOM:"LeavingRoom"},type:"parallel",states:{Emitted:{initial:"NotEmitted",states:{NotEmitted:{after:{100:"Emitted"}},Emitted:{type:"final"}}},DisplayName:{initial:"DisplayNameSet",on:{CLIENT_DISPLAY_NAME_CHANGED:{target:"DisplayName",actions:Re(function(r,e){return{peers:se(se({},r.peers),{},X({},e.peerId,se(se({},r.peers[e.peerId]),{},{displayName:e.displayName})))}})}},states:{Loading:{invoke:{src:function(){var r=Oe(Q().mark(function t(n,i){return Q().wrap(function(o){for(;;)switch(o.prev=o.next){case 0:if(i.type!=="SET_DISPLAY_NAME"){o.next=4;break}return o.next=3,n.huddleClient.setDisplayName(i.displayName);case 3:return o.abrupt("return",o.sent);case 4:case"end":return o.stop()}},t)}));function e(t,n){return r.apply(this,arguments)}return e}(),onDone:{target:"DisplayNameSet",actions:"assignDisplayNameToContext"}}},DisplayNameSet:{on:{SET_DISPLAY_NAME:"Loading"}}}},Peers:{initial:"Peers",states:{Peers:{on:{CLIENT_ME_JOINED:{actions:Re(function(r,e){return{role:e.role}})},CLIENT_PEER_JOINED:{target:"Peers",actions:Re(function(r,e){return{peers:se(se({},r.peers),{},X({},e.peer.peerId,e.peer)),peersToConsumers:se(se({},r.peersToConsumers),{},X({},e.peer.peerId,{mic:null,cam:null,"share-audio":null,"share-video":null}))}})},CLIENT_PEER_LEFT:{actions:Re(function(r,e){var t=r.peers,n=e.peerId;t[n];var i=sr(t,[n].map(Ct)),s=Object.values(r.consumers).filter(function(a){return a.peerId===e.peerId}),o=r.consumers;return s.forEach(function(a){delete o[a.id]}),{peers:i,consumers:o}})},CLIENT_CONSUMER_CREATED:{actions:Re(function(r,e){return{consumers:se(se({},r.consumers),{},X({},e.consumer.id,e.consumer)),peersToConsumers:se(se({},r.peersToConsumers),{},X({},e.consumer.peerId,se(se({},r.peersToConsumers[e.consumer.peerId]),{},X({},e.consumer.appData.type,e.consumer.id))))}})},CLIENT_CONSUMER_CLOSED:{actions:Re(function(r,e){var t=r.consumers,n=e.consumerId,i=t[n],s=sr(t,[n].map(Ct)),o=r.peersToConsumers[i.peerId],a=i.appData.type;o[a];var c=sr(o,[a].map(Ct));return{consumers:s,peersToConsumers:se(se({},r.peersToConsumers),{},X({},i.peerId,se({mic:null,cam:null,"share-audio":null,"share-video":null},c)))}})}}}}},Mic:{initial:"Idle",states:{Idle:{invoke:{src:function(e){return e.micStream?Promise.resolve(e.micStream):Promise.reject()},onDone:{target:"Unmuted"},onError:{target:"Muted"}}},Muted:{entry:"checkMicStream",on:{ENABLE_MIC:{target:"Loading"},UNMUTE:{target:"Unmuted"}}},Loading:{invoke:{src:"loadMicStream",onDone:{target:"Unmuted",actions:"assignMicStreamToContext"},onError:{target:"Muted",actions:"assignErrorToContext"}}},Unmuted:{on:{DISABLE_MIC:{target:"Muted",actions:"stopMicStream"},PRODUCE_MIC:"ProducingMicLoading"}},ProducingMicLoading:{invoke:{src:function(e,t){return function(n){if(t.type==="PRODUCE_MIC")return e.huddleClient._produceAudioStream(t.stream,n)}},onError:{target:"Unmuted",actions:"assignErrorToContext"}},on:{CLIENT_MIC_PRODUCER_SUCCESS:"ProducingMic"}},ProducingMic:{on:{STOP_PRODUCING_MIC:"StoppingProducingMic"}},StoppingProducingMic:{invoke:{src:function(e){return function(t){return e.huddleClient.requestStopAudioProducer()}},onError:{target:"Unmuted",actions:"assignErrorToContext"}},on:{CLIENT_MIC_PRODUCER_STOPPED:"Unmuted"}}}},Cam:{initial:"Idle",states:{Idle:{invoke:{src:function(e){return e.camStream?Promise.resolve(e.camStream):Promise.reject()},onDone:{target:"On"},onError:{target:"Off"}}},Off:{entry:"checkCamStream",on:{ENABLE_CAM:{target:"Loading"},ON:{target:"On"}}},Loading:{invoke:{src:"loadCamStream",onDone:{target:"On",actions:"assignCamStreamToContext"},onError:{target:"Off",actions:"assignErrorToContext"}}},On:{on:{DISABLE_CAM:{target:"Off",actions:"stopCamStream"},PRODUCE_CAM:"ProducingCamLoading"}},ProducingCamLoading:{invoke:{src:function(e,t){return function(n){if(t.type==="PRODUCE_CAM")return e.huddleClient._produceVideoStream(t.stream,n)}},onError:{target:"On",actions:"assignErrorToContext"}},on:{CLIENT_CAM_PRODUCER_SUCCESS:{target:"ProducingCam"}}},ProducingCam:{on:{STOP_PRODUCING_CAM:"StoppingProducingCam"}},StoppingProducingCam:{invoke:{src:function(e){return function(t){return e.huddleClient.requestStopVideoProducer()}},onError:{target:"On",actions:"assignErrorToContext"}},on:{CLIENT_CAM_PRODUCER_STOPPED:"On"}}}},Recording:{initial:"Idle",states:{Idle:{on:{START_RECORDING:"Starting"}},Starting:{invoke:{src:function(e,t){if(t.type==="START_RECORDING")return e.huddleClient.startRecording(t.sourceUrl)},onError:{target:"Idle",actions:"assignErrorToContext"},onDone:{target:"RecorderJoining"}}},RecorderJoining:{on:{CLIENT_STARTED_RECORDING:"Recording"}},Recording:{on:{STOP_RECORDING:"Stopping"}},Stopping:{invoke:{src:function(e){return e.huddleClient.stopRecording()},onError:{target:"Idle",actions:"assignErrorToContext"},onDone:{target:"RecorderLeaving"}}},RecorderLeaving:{on:{CLIENT_RECORDING_DATA:{actions:Re(function(r,e){return{recordingData:e.recordingData}}),target:"Stopped"}}},Stopped:{on:{START_RECORDING:"Starting"}}}},Streaming:{initial:"Idle",states:{Idle:{on:{START_STREAMING:"Starting"}},Starting:{invoke:{src:function(e,t){if(t.type==="START_STREAMING")return e.huddleClient.startStreaming(t.streamingData)},onError:{target:"Idle",actions:"assignErrorToContext"},onDone:{target:"RecorderJoining"}}},RecorderJoining:{on:{CLIENT_STARTED_STREAMING:{target:"Streaming",actions:Re(function(r,e){return{livestreamData:e.livestreamData}})}}},Streaming:{on:{STOP_STREAMING:"Stopping"}},Stopping:{invoke:{src:function(e){return e.huddleClient.stopRecording()},onError:{target:"Idle",actions:"assignErrorToContext"},onDone:{target:"RecorderLeaving"}}},RecorderLeaving:{on:{CLIENT_STOPPED_STREAMING:{target:"Stopped"}}},Stopped:{on:{START_STREAMING:"Starting"}}}}}},LeavingRoom:{on:{CLIENT_ROOM_LEFT:"NotJoined"},invoke:{src:function(e){return function(t){return e.huddleClient.leaveRoom(t)}},onDone:{actions:Re(function(r,e){var t,n;return(t=r.micStream)===null||t===void 0||t.getTracks().forEach(function(i){return i.stop()}),(n=r.camStream)===null||n===void 0||n.getTracks().forEach(function(i){return i.stop()}),{micStream:null,camStream:null}})},onError:{target:"JoinedRoom",actions:"assignErrorToContext"}}}}}}},{actions:{assignMicStreamToContext:Re(function(r,e){return{micStream:e.data}}),assignDisplayNameToContext:Re(function(r,e){return{displayName:e.data}}),assignCamStreamToContext:Re(function(r,e){return{camStream:e.data}}),assignErrorToContext:Re(function(r,e){return{error:e.data.message}}),assignProjectIdToContext:Re(function(r,e){if(e.type==="INIT")return{projectId:e.projectId}}),assignPeerIdToContext:Re(function(r,e){if(e.type==="CLIENT_LOBBY_JOINED")return{peerId:e.peerId}}),stopMicStream:Re(function(r){return r.micStream.getTracks().forEach(function(e){return e.stop()}),{micStream:null}}),stopCamStream:Re(function(r){return r.camStream.getTracks().forEach(function(e){return e.stop()}),{micStream:null}}),checkMicStream:function(e,t){e.micStream&&(console.log({type:"UNMUTE"}),Po({type:"UNMUTE"}))},checkCamStream:function(e,t){e.camStream&&(console.log({type:"ON"}),Po({type:"ON"}))}}}),Jg=Td.withConfig({services:{loadCamStream:function(){return navigator.mediaDevices.getUserMedia({video:!0,audio:!1})},loadMicStream:function(){return navigator.mediaDevices.getUserMedia({audio:!0,video:!1})}}}),qg=Ds(Jg).onTransition(function(r){return console.log(r.value)});qg.start();let Gg=0;function kr(r,e){const t=`atom${++Gg}`,n={toString:()=>t};return typeof r=="function"?n.read=r:(n.init=r,n.read=i=>i(n),n.write=(i,s,o)=>s(n,typeof o=="function"?o(i(n)):o)),e&&(n.write=e),n}const Aa=r=>"init"in r,ja=r=>!!r.write,Yn=new WeakMap,Hg=(r,e)=>{Yn.set(r,e),r.catch(()=>{}).finally(()=>Yn.delete(r))},$a=(r,e)=>{const t=Yn.get(r);t&&(Yn.delete(r),t(e))},Ba=(r,e)=>{r.status="fulfilled",r.value=e},Fa=(r,e)=>{r.status="rejected",r.reason=e},Wg=r=>typeof(r==null?void 0:r.then)=="function",Mr=(r,e)=>"v"in r&&"v"in e&&Object.is(r.v,e.v),Ua=(r,e)=>"e"in r&&"e"in e&&Object.is(r.e,e.e),or=r=>"v"in r&&r.v instanceof Promise,Kg=(r,e)=>"v"in r&&"v"in e&&r.v.orig&&r.v.orig===e.v.orig,On=r=>{if("e"in r)throw r.e;return r.v},Yg=()=>{const r=new WeakMap,e=new WeakMap,t=new Map;let n,i,s;const o=S=>r.get(S),a=(S,k)=>{const D=r.get(S);if(r.set(S,k),t.has(S)||t.set(S,D),D&&or(D)){const v="v"in k?k.v instanceof Promise?k.v:Promise.resolve(k.v):Promise.reject(k.e);$a(D.v,v)}},c=(S,k,D)=>{const v=new Map;let y=!1;D.forEach((_,E)=>{!_&&E===S&&(_=k),_&&(v.set(E,_),k.d.get(E)!==_&&(y=!0))}),(y||k.d.size!==v.size)&&(k.d=v)},d=(S,k,D)=>{const v=o(S),y={d:(v==null?void 0:v.d)||new Map,v:k};if(D&&c(S,y,D),v&&Mr(v,y)&&v.d===y.d)return v;if(v&&or(v)&&or(y)&&Kg(v,y)){if(v.d===y.d)return v;y.v=v.v}return a(S,y),y},l=(S,k,D,v)=>{if(Wg(k)){let y;const _=new Promise((E,R)=>{let I=!1;k.then(O=>{if(!I){I=!0;const x=o(S),j=d(S,_,D);Ba(_,O),E(O),(x==null?void 0:x.d)!==j.d&&$(S,j,x==null?void 0:x.d)}},O=>{if(!I){I=!0;const x=o(S),j=d(S,_,D);Fa(_,O),R(O),(x==null?void 0:x.d)!==j.d&&$(S,j,x==null?void 0:x.d)}}),y=O=>{I||(I=!0,O.then(x=>Ba(_,x),x=>Fa(_,x)),E(O))}});return _.orig=k,_.status="pending",Hg(_,E=>{E&&y(E),v==null||v()}),d(S,_,D)}return d(S,k,D)},u=(S,k,D)=>{const v=o(S),y={d:(v==null?void 0:v.d)||new Map,e:k};return D&&c(S,y,D),v&&Ua(v,y)&&v.d===y.d?v:(a(S,y),y)},p=S=>{const k=o(S);if(k&&(k.d.forEach((I,O)=>{O!==S&&!e.has(O)&&p(O)}),Array.from(k.d).every(([I,O])=>{const x=o(I);return I===S||x===O||x&&!or(x)&&Mr(x,O)})))return k;const D=new Map;let v=!0;const y=I=>{if(I===S){const x=o(I);if(x)return D.set(I,x),On(x);if(Aa(I))return D.set(I,void 0),I.init;throw new Error("no atom init")}const O=p(I);return D.set(I,O),On(O)};let _,E;const R={get signal(){return _||(_=new AbortController),_.signal},get setSelf(){return!E&&ja(S)&&(E=(...I)=>{if(!v)return b(S,...I)}),E}};try{const I=S.read(y,R);return l(S,I,D,()=>_==null?void 0:_.abort())}catch(I){return u(S,I,D)}finally{v=!1}},h=S=>On(p(S)),f=S=>{let k=e.get(S);return k||(k=P(S)),k},m=(S,k)=>!k.l.size&&(!k.t.size||k.t.size===1&&k.t.has(S)),g=S=>{const k=e.get(S);k&&m(S,k)&&N(S)},w=S=>{const k=new Map,D=new WeakMap,v=_=>{const E=e.get(_);E==null||E.t.forEach(R=>{R!==_&&(k.set(R,(k.get(R)||new Set).add(_)),D.set(R,(D.get(R)||0)+1),v(R))})};v(S);const y=_=>{const E=e.get(_);E==null||E.t.forEach(R=>{var I;if(R!==_){let O=D.get(R);if(O&&D.set(R,--O),!O){let x=!!((I=k.get(R))!=null&&I.size);if(x){const j=o(R),K=p(R);x=!j||!Mr(j,K)}x||k.forEach(j=>j.delete(R))}y(R)}})};y(S)},C=(S,...k)=>{let D=!0;const v=E=>On(p(E)),y=(E,...R)=>{let I;if(E===S){if(!Aa(E))throw new Error("atom not writable");const O=o(E),x=l(E,R[0]);(!O||!Mr(O,x))&&w(E)}else I=C(E,...R);if(!D){const O=B()}return I},_=S.write(v,y,...k);return D=!1,_},b=(S,...k)=>{const D=C(S,...k),v=B();return D},P=(S,k)=>{const D={t:new Set(k&&[k]),l:new Set};if(e.set(S,D),p(S).d.forEach((v,y)=>{const _=e.get(y);_?_.t.add(S):y!==S&&P(y,S)}),p(S),ja(S)&&S.onMount){const v=S.onMount((...y)=>b(S,...y));v&&(D.u=v)}return D},N=S=>{var k;const D=(k=e.get(S))==null?void 0:k.u;D&&D(),e.delete(S);const v=o(S);v&&(or(v)&&$a(v.v),v.d.forEach((y,_)=>{if(_!==S){const E=e.get(_);E&&(E.t.delete(S),m(_,E)&&N(_))}}))},$=(S,k,D)=>{const v=new Set(k.d.keys());D==null||D.forEach((y,_)=>{if(v.has(_)){v.delete(_);return}const E=e.get(_);E&&(E.t.delete(S),m(_,E)&&N(_))}),v.forEach(y=>{const _=e.get(y);_?_.t.add(S):e.has(S)&&P(y,S)})},B=()=>{let S;for(;t.size;){const k=Array.from(t);t.clear(),k.forEach(([D,v])=>{const y=o(D);if(y){y.d!==(v==null?void 0:v.d)&&$(D,y,v==null?void 0:v.d);const _=e.get(D);_&&!(v&&!or(v)&&(Mr(v,y)||Ua(v,y)))&&_.l.forEach(E=>E())}})}};return{get:h,set:b,sub:(S,k)=>{const D=f(S),v=B(),y=D.l;return y.add(k),()=>{y.delete(k),g(S)}}}};let Yi;const Qg=()=>(Yi||(Yi=Yg()),Yi);function Qn(){return Qn=Object.assign?Object.assign.bind():function(r){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(r[n]=t[n])}return r},Qn.apply(this,arguments)}const Xg=["guards","actions","services","delays","context"],Zg=Symbol();function ev(r,e){const t=kr(null),n=kr(o=>{const a=o(t);if(a)return a;let c=!0;const d=(...N)=>{if(c)return o(...N);throw new Error("get not allowed after initialization")},l=za(r)?r(d):r,u=za(e)?e(d):e;c=!1;const p=u||{},{guards:h,actions:f,services:m,delays:g,context:w}=p,C=function(N,$){if(N==null)return{};var B,F,S={},k=Object.keys(N);for(F=0;F<k.length;F++)$.indexOf(B=k[F])>=0||(S[B]=N[B]);return S}(p,Xg),b=Qn({},h&&{guards:h},f&&{actions:f},m&&{services:m},g&&{delays:g}),P=l.withConfig(b,()=>Qn({},l.context,w));return{machine:P,service:Ds(P,C)}},(o,a)=>{a(t,o(n))});n.onMount=o=>{o()};const i=kr(null),s=kr(o=>{var a;return(a=o(i))!=null?a:o(n).machine.initialState},(o,a,c)=>{const{service:d}=o(n);d.onTransition(l=>{a(i,l)}),d.start(),c(()=>{const{service:l}=o(n);l.stop()})});return s.onMount=o=>{let a;return o(c=>{a===!1?c():a=c}),()=>{a&&a(),a=!1}},kr(o=>o(s),(o,a,c)=>{const{service:d}=o(n);if(c===Zg){d.stop(),a(t,null),a(n);const{service:l}=o(n);l.onTransition(u=>{a(i,u)}),l.start()}else d.send(c)})}const za=r=>typeof r=="function",tv=A.createContext(void 0),Pd=r=>{const e=A.useContext(tv);return(r==null?void 0:r.store)||e||Qg()},rv=r=>typeof(r==null?void 0:r.then)=="function",nv=Ee.use||(r=>{if(r.status==="pending")throw r;if(r.status==="fulfilled")return r.value;throw r.status==="rejected"?r.reason:(r.status="pending",r.then(e=>{r.status="fulfilled",r.value=e},e=>{r.status="rejected",r.reason=e}),r)});function iv(r,e){const t=Pd(e),[[n,i,s],o]=A.useReducer(d=>{const l=t.get(r);return Object.is(d[0],l)&&d[1]===t&&d[2]===r?d:[l,t,r]},void 0,()=>[t.get(r),t,r]);let a=n;(i!==t||s!==r)&&(o(),a=t.get(r));const c=e==null?void 0:e.delay;return A.useEffect(()=>{const d=t.sub(r,()=>{if(typeof c=="number"){setTimeout(o,c);return}o()});return o(),d},[t,r,c]),A.useDebugValue(a),rv(a)?nv(a):a}function sv(r,e){const t=Pd(e);return A.useCallback((...i)=>t.set(r,...i),[t,r])}function ov(r,e){return[iv(r,e),sv(r,e)]}function av(r){if(Array.isArray(r))return r}function cv(r,e){var t=r==null?null:typeof Symbol<"u"&&r[Symbol.iterator]||r["@@iterator"];if(t!=null){var n,i,s,o,a=[],c=!0,d=!1;try{if(s=(t=t.call(r)).next,e===0){if(Object(t)!==t)return;c=!1}else for(;!(c=(n=s.call(t)).done)&&(a.push(n.value),a.length!==e);c=!0);}catch(l){d=!0,i=l}finally{try{if(!c&&t.return!=null&&(o=t.return(),Object(o)!==o))return}finally{if(d)throw i}}return a}}function Va(r,e){(e==null||e>r.length)&&(e=r.length);for(var t=0,n=new Array(e);t<e;t++)n[t]=r[t];return n}function dv(r,e){if(r){if(typeof r=="string")return Va(r,e);var t=Object.prototype.toString.call(r).slice(8,-1);if(t==="Object"&&r.constructor&&(t=r.constructor.name),t==="Map"||t==="Set")return Array.from(r);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return Va(r,e)}}function lv(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function jt(r,e){return av(r)||cv(r,e)||dv(r,e)||lv()}var uv=function(){return navigator.mediaDevices.getUserMedia({audio:!1,video:!0})},pv=function(){return navigator.mediaDevices.getUserMedia({audio:!0,video:!1})},fv=ev(Td,{devTools:!0,services:{loadCamStream:uv,loadMicStream:pv}});function ft(){var r=ov(fv),e=jt(r,2),t=e[0],n=e[1];return{state:t,send:n}}function Xn(){return Xn=Object.assign?Object.assign.bind():function(r){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(r[n]=t[n])}return r},Xn.apply(this,arguments)}function Gr(){Gr=function(){return r};var r={},e=Object.prototype,t=e.hasOwnProperty,n=Object.defineProperty||function(v,y,_){v[y]=_.value},i=typeof Symbol=="function"?Symbol:{},s=i.iterator||"@@iterator",o=i.asyncIterator||"@@asyncIterator",a=i.toStringTag||"@@toStringTag";function c(v,y,_){return Object.defineProperty(v,y,{value:_,enumerable:!0,configurable:!0,writable:!0}),v[y]}try{c({},"")}catch{c=function(y,_,E){return y[_]=E}}function d(v,y,_,E){var R=y&&y.prototype instanceof p?y:p,I=Object.create(R.prototype),O=new S(E||[]);return n(I,"_invoke",{value:N(v,_,O)}),I}function l(v,y,_){try{return{type:"normal",arg:v.call(y,_)}}catch(E){return{type:"throw",arg:E}}}r.wrap=d;var u={};function p(){}function h(){}function f(){}var m={};c(m,s,function(){return this});var g=Object.getPrototypeOf,w=g&&g(g(k([])));w&&w!==e&&t.call(w,s)&&(m=w);var C=f.prototype=p.prototype=Object.create(m);function b(v){["next","throw","return"].forEach(function(y){c(v,y,function(_){return this._invoke(y,_)})})}function P(v,y){function _(R,I,O,x){var j=l(v[R],v,I);if(j.type!=="throw"){var K=j.arg,Se=K.value;return Se&&typeof Se=="object"&&t.call(Se,"__await")?y.resolve(Se.__await).then(function(me){_("next",me,O,x)},function(me){_("throw",me,O,x)}):y.resolve(Se).then(function(me){K.value=me,O(K)},function(me){return _("throw",me,O,x)})}x(j.arg)}var E;n(this,"_invoke",{value:function(R,I){function O(){return new y(function(x,j){_(R,I,x,j)})}return E=E?E.then(O,O):O()}})}function N(v,y,_){var E="suspendedStart";return function(R,I){if(E==="executing")throw new Error("Generator is already running");if(E==="completed"){if(R==="throw")throw I;return D()}for(_.method=R,_.arg=I;;){var O=_.delegate;if(O){var x=$(O,_);if(x){if(x===u)continue;return x}}if(_.method==="next")_.sent=_._sent=_.arg;else if(_.method==="throw"){if(E==="suspendedStart")throw E="completed",_.arg;_.dispatchException(_.arg)}else _.method==="return"&&_.abrupt("return",_.arg);E="executing";var j=l(v,y,_);if(j.type==="normal"){if(E=_.done?"completed":"suspendedYield",j.arg===u)continue;return{value:j.arg,done:_.done}}j.type==="throw"&&(E="completed",_.method="throw",_.arg=j.arg)}}}function $(v,y){var _=y.method,E=v.iterator[_];if(E===void 0)return y.delegate=null,_==="throw"&&v.iterator.return&&(y.method="return",y.arg=void 0,$(v,y),y.method==="throw")||_!=="return"&&(y.method="throw",y.arg=new TypeError("The iterator does not provide a '"+_+"' method")),u;var R=l(E,v.iterator,y.arg);if(R.type==="throw")return y.method="throw",y.arg=R.arg,y.delegate=null,u;var I=R.arg;return I?I.done?(y[v.resultName]=I.value,y.next=v.nextLoc,y.method!=="return"&&(y.method="next",y.arg=void 0),y.delegate=null,u):I:(y.method="throw",y.arg=new TypeError("iterator result is not an object"),y.delegate=null,u)}function B(v){var y={tryLoc:v[0]};1 in v&&(y.catchLoc=v[1]),2 in v&&(y.finallyLoc=v[2],y.afterLoc=v[3]),this.tryEntries.push(y)}function F(v){var y=v.completion||{};y.type="normal",delete y.arg,v.completion=y}function S(v){this.tryEntries=[{tryLoc:"root"}],v.forEach(B,this),this.reset(!0)}function k(v){if(v){var y=v[s];if(y)return y.call(v);if(typeof v.next=="function")return v;if(!isNaN(v.length)){var _=-1,E=function R(){for(;++_<v.length;)if(t.call(v,_))return R.value=v[_],R.done=!1,R;return R.value=void 0,R.done=!0,R};return E.next=E}}return{next:D}}function D(){return{value:void 0,done:!0}}return h.prototype=f,n(C,"constructor",{value:f,configurable:!0}),n(f,"constructor",{value:h,configurable:!0}),h.displayName=c(f,a,"GeneratorFunction"),r.isGeneratorFunction=function(v){var y=typeof v=="function"&&v.constructor;return!!y&&(y===h||(y.displayName||y.name)==="GeneratorFunction")},r.mark=function(v){return Object.setPrototypeOf?Object.setPrototypeOf(v,f):(v.__proto__=f,c(v,a,"GeneratorFunction")),v.prototype=Object.create(C),v},r.awrap=function(v){return{__await:v}},b(P.prototype),c(P.prototype,o,function(){return this}),r.AsyncIterator=P,r.async=function(v,y,_,E,R){R===void 0&&(R=Promise);var I=new P(d(v,y,_,E),R);return r.isGeneratorFunction(y)?I:I.next().then(function(O){return O.done?O.value:I.next()})},b(C),c(C,a,"Generator"),c(C,s,function(){return this}),c(C,"toString",function(){return"[object Generator]"}),r.keys=function(v){var y=Object(v),_=[];for(var E in y)_.push(E);return _.reverse(),function R(){for(;_.length;){var I=_.pop();if(I in y)return R.value=I,R.done=!1,R}return R.done=!0,R}},r.values=k,S.prototype={constructor:S,reset:function(v){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(F),!v)for(var y in this)y.charAt(0)==="t"&&t.call(this,y)&&!isNaN(+y.slice(1))&&(this[y]=void 0)},stop:function(){this.done=!0;var v=this.tryEntries[0].completion;if(v.type==="throw")throw v.arg;return this.rval},dispatchException:function(v){if(this.done)throw v;var y=this;function _(j,K){return I.type="throw",I.arg=v,y.next=j,K&&(y.method="next",y.arg=void 0),!!K}for(var E=this.tryEntries.length-1;E>=0;--E){var R=this.tryEntries[E],I=R.completion;if(R.tryLoc==="root")return _("end");if(R.tryLoc<=this.prev){var O=t.call(R,"catchLoc"),x=t.call(R,"finallyLoc");if(O&&x){if(this.prev<R.catchLoc)return _(R.catchLoc,!0);if(this.prev<R.finallyLoc)return _(R.finallyLoc)}else if(O){if(this.prev<R.catchLoc)return _(R.catchLoc,!0)}else{if(!x)throw new Error("try statement without catch or finally");if(this.prev<R.finallyLoc)return _(R.finallyLoc)}}}},abrupt:function(v,y){for(var _=this.tryEntries.length-1;_>=0;--_){var E=this.tryEntries[_];if(E.tryLoc<=this.prev&&t.call(E,"finallyLoc")&&this.prev<E.finallyLoc){var R=E;break}}R&&(v==="break"||v==="continue")&&R.tryLoc<=y&&y<=R.finallyLoc&&(R=null);var I=R?R.completion:{};return I.type=v,I.arg=y,R?(this.method="next",this.next=R.finallyLoc,u):this.complete(I)},complete:function(v,y){if(v.type==="throw")throw v.arg;return v.type==="break"||v.type==="continue"?this.next=v.arg:v.type==="return"?(this.rval=this.arg=v.arg,this.method="return",this.next="end"):v.type==="normal"&&y&&(this.next=y),u},finish:function(v){for(var y=this.tryEntries.length-1;y>=0;--y){var _=this.tryEntries[y];if(_.finallyLoc===v)return this.complete(_.completion,_.afterLoc),F(_),u}},catch:function(v){for(var y=this.tryEntries.length-1;y>=0;--y){var _=this.tryEntries[y];if(_.tryLoc===v){var E=_.completion;if(E.type==="throw"){var R=E.arg;F(_)}return R}}throw new Error("illegal catch attempt")},delegateYield:function(v,y,_){return this.delegate={iterator:k(v),resultName:y,nextLoc:_},this.method==="next"&&(this.arg=void 0),u}},r}function Ja(r,e,t,n,i,s,o){try{var a=r[s](o),c=a.value}catch(d){t(d);return}a.done?e(c):Promise.resolve(c).then(n,i)}function Dd(r){return function(){var e=this,t=arguments;return new Promise(function(n,i){var s=r.apply(e,t);function o(c){Ja(s,n,i,o,a,"next",c)}function a(c){Ja(s,n,i,o,a,"throw",c)}o(void 0)})}}function hv(r,e){if(r==null)return{};var t={},n=Object.keys(r),i,s;for(s=0;s<n.length;s++)i=n[s],!(e.indexOf(i)>=0)&&(t[i]=r[i]);return t}function xd(r,e){if(r==null)return{};var t=hv(r,e),n,i;if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(r);for(i=0;i<s.length;i++)n=s[i],!(e.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(r,n)&&(t[n]=r[n])}return t}var Od=function(e){var t,n,i=ft(),s=i.state,o=s.context.peers,a=s.context.consumers,c=s.context.peersToConsumers;if(!o[e])return{peer:null,error:"Peer not found"};var d=c[e],l={peerId:e,role:o[e].role,mic:((t=a[d==null?void 0:d.mic])===null||t===void 0?void 0:t.track)||null,cam:((n=a[d==null?void 0:d.cam])===null||n===void 0?void 0:n.track)||null,displayName:o[e].displayName};return{peer:l,error:null}},mv=["peerId","track","debug"],Ld=function(e){var t=e.peerId,n=e.track,i=e.debug,s=xd(e,mv),o=A.useRef(null),a=Od(t),c=a.peer,d=function(u){var p=new MediaStream;return p.addTrack(u),p};return A.useEffect(function(){var l=n||(c==null?void 0:c.mic),u=o.current;u&&l&&(u.srcObject=d(l),u.onloadedmetadata=Dd(Gr().mark(function p(){return Gr().wrap(function(f){for(;;)switch(f.prev=f.next){case 0:return console.warn("audioCard() | Metadata loaded..."),f.prev=1,f.next=4,u.play();case 4:f.next=9;break;case 6:f.prev=6,f.t0=f.catch(1),console.error(f.t0);case 9:case"end":return f.stop()}},p,null,[[1,6]])})),u.onerror=function(){console.error("audioCard() | Error is hapenning...")})},[]),Ee.createElement(Ee.Fragment,null,i&&Ee.createElement("div",null,t),Ee.createElement("audio",Xn({},s,{ref:o}),"Audio"))},gv=["peerId","track","debug"],Id=function(e){var t=e.peerId,n=e.track,i=e.debug,s=xd(e,gv),o=A.useRef(null),a=Od(t),c=a.peer,d=function(u){var p=new MediaStream;return p.addTrack(u),p};return A.useEffect(function(){var l=n||(c==null?void 0:c.cam),u=o.current;u&&l&&(u.srcObject=d(l),u.onloadedmetadata=Dd(Gr().mark(function p(){return Gr().wrap(function(f){for(;;)switch(f.prev=f.next){case 0:return console.warn("videoCard() | Metadata loaded..."),f.prev=1,u.muted=!0,f.next=5,u.play();case 5:f.next=10;break;case 7:f.prev=7,f.t0=f.catch(1),console.error(f.t0);case 10:case"end":return f.stop()}},p,null,[[1,7]])})),u.onerror=function(){console.error("videoCard() | Error is hapenning...")})},[]),Ee.createElement(Ee.Fragment,null,i&&Ee.createElement(Ee.Fragment,null,c==null?void 0:c.displayName,": ",t),Ee.createElement("video",Xn({},s,{ref:o}),"Video"))};function vv(){var r=ft(),e=r.state,t=r.send,n=function(o){return t({type:"INIT",projectId:o})},i=e.matches("Initialized");return n.isCallable=!i,{initialize:n,isInitialized:i}}var yv=function(){var e=ft(),t=e.state,n=e.send,i=A.useState(""),s=jt(i,2),o=s[0],a=s[1],c=["Initialized.JoinedLobby.Mic.Loading","Initialized.JoinedRoom.Mic.ProducingMicLoading","Initialized.JoinedRoom.Mic.StoppingProducingMic"].some(t.matches),d=t.context.micStream,l=t.matches("Initialized.JoinedLobby.Mic.Muted")&&!c,u=t.matches("Initialized.JoinedRoom.Mic.Unmuted")&&!c&&t.context.micStream,p=t.matches("Initialized.JoinedRoom.Mic.ProducingMic"),h=p&&!c,f=["Initialized.JoinedRoom.Mic.Unmuted","Initialized.JoinedLobby.Mic.Unmuted"].some(t.matches)&&!c,m=function(){if(!t.matches("Initialized.JoinedLobby"))return a("You are not in the lobby");if(t.matches("Initialized.JoinedLobby.Mic.Unmuted"))return a("Already Fetched Audio Stream");n("ENABLE_MIC")},g=function(P){if(!t.context.micStream)return a("No Mic Stream");if(!t.matches("Initialized.JoinedRoom"))return a("You are not in the room");if(t.matches("Initialized.JoinedRoom.Mic.ProducingMic"))return a("Already Producing Audio Stream");n({type:"PRODUCE_MIC",stream:P})},w=function(){if(!t.matches("Initialized.JoinedRoom"))return a("You are not in the room");if(!t.matches("Initialized.JoinedRoom.Mic.ProducingMic"))return a("Already Stopped Producing Audio Stream");n("STOP_PRODUCING_MIC")},C=function(){if(!t.matches("Initialized.JoinedLobby"))return a("You are not in the lobby");if(!t.matches("Initialized.JoinedLobby.Mic.Unmuted"))return a("Already Stopped Audio Stream");n("DISABLE_MIC")};return m.isCallable=l,g.isCallable=u,w.isCallable=h,C.isCallable=f,{stream:d,isLoading:c,isProducing:p,fetchAudioStream:m,produceAudio:g,stopProducingAudio:w,stopAudioStream:C,error:o}},_v=function(){var e=ft(),t=e.state,n=e.send,i=A.useState(""),s=jt(i,2),o=s[0],a=s[1],c=["Initialized.JoinLobbyFailed","Initialized.NotJoined"].some(t.matches),d=t.matches("Initialized.JoinedLobby"),l=t.matches("Initialized.JoiningLobby"),u=function(f,m){if(!f)return a("No room id provided");if(!c)return a("You are not in initialized state");n({type:"JOIN_LOBBY",roomId:f,accessToken:m})},p=function(){if(!d)return a("You are not in the lobby");n("LEAVE_LOBBY")};return u.isCallable=c,p.isCallable=d,{isLoading:l,isLobbyJoined:d,joinLobby:u,leaveLobby:p,error:o}},kd=function(){var e=ft(),t=e.state,n=t.context.peers,i=t.context.consumers,s=t.context.peersToConsumers,o=Object.keys(n),a={};return o.forEach(function(c){var d,l,u=s[c];a[c]={peerId:c,role:n[c].role,mic:((d=i[u==null?void 0:u.mic])===null||d===void 0?void 0:d.track)||null,cam:((l=i[u==null?void 0:u.cam])===null||l===void 0?void 0:l.track)||null,displayName:n[c].displayName}}),{peerIds:o,peers:a}},wv=function(){var e=ft(),t=e.state,n=e.send,i=A.useState(""),s=jt(i,2),o=s[0],a=s[1],c=t.context.recordingData,d=t.matches("Initialized.JoinedRoom"),l=["Initialized.JoinedRoom.Recording.RecorderJoining","Initialized.JoinedRoom.Recording.Starting"].some(t.matches),u=t.matches("Initialized.JoinedRoom.Recording.Recording"),p=["Initialized.JoinedRoom.Recording.RecorderLeaving","Initialized.JoinedRoom.Recording.Stopping"].some(t.matches),h=function(g){if(g.includes("localhost"))return a("recording is not allowed on localhost");if(l)return a("Please wait.. recording is already starting");if(u)return a("Recording is already in progress");if(p)return a("Please wait.. recording is about to stop");if(!d)return a("Please join a room first");console.log("useRecording() | startRecording() | sourceUrl",{sourceUrl:g}),n({type:"START_RECORDING",sourceUrl:g})},f=function(){if(l)return a("Please wait.. recording is about to start");if(p)return a("Please wait.. recording is already stopping");if(!u)return a("Recording is not in progress");if(!d)return a("Please join a room first");n({type:"STOP_RECORDING"})};return h.isCallable=!l&&!u&&!p&&d,f.isCallable=u&&d,{isStarting:l,inProgress:u,isStopping:p,data:c,startRecording:h,stopRecording:f,error:o}},bv=function(){var e=ft(),t=e.state,n=e.send,i=A.useState(""),s=jt(i,2),o=s[0],a=s[1],c=t.matches("Initialized.JoinedLobby"),d=t.matches("Initialized.JoinedRoom"),l=t.matches("Initialized.JoiningRoom"),u=function(){if(!c)return a("Cannot join room when not in lobby");n("JOIN_ROOM")},p=function(){if(!d)return a("Cannot leave room when not in a room");n("LEAVE_ROOM")};return u.isCallable=c,p.isCallable=d,{roomId:t.context.roomId,isLoading:l,isRoomJoined:d,joinRoom:u,leaveRoom:p,error:o}},Sv=function(){var e=ft(),t=e.state,n=e.send,i=A.useState(""),s=jt(i,2),o=s[0],a=s[1],c=["Initialized.JoinedLobby.Cam.Loading","Initialized.JoinedRoom.Cam.ProducingCamLoading","Initialized.JoinedRoom.Cam.StoppingProducingCam"].some(t.matches),d=t.context.camStream,l=["Initialized.JoinedRoom.Cam.On","Initialized.JoinedLobby.Cam.On"].some(t.matches),u=["Initialized.JoinedRoom.Cam.Off","Initialized.JoinedLobby.Cam.Off"].some(t.matches),p=["Initialized.JoinedRoom","Initialized.JoinedLobby"].some(t.matches),h=u&&!c,f=t.matches("Initialized.JoinedRoom.Cam.On")&&!c&&t.context.camStream,m=t.matches("Initialized.JoinedRoom.Cam.ProducingCam"),g=m&&!c,w=l&&!c,C=function(){if(!p)return a("You are not in the lobby or room");if(l||t.matches("Initialized.JoinedRoom.Cam.ProducingCam"))return a("Already Fetched Video Stream");n("ENABLE_CAM")},b=function(B){if(!t.context.camStream)return a("No Video Stream");if(!t.matches("Initialized.JoinedRoom"))return a("You are not in the room");if(t.matches("Initialized.JoinedRoom.Cam.ProducingCam"))return a("Already Producing Video Stream");n({type:"PRODUCE_CAM",stream:B})},P=function(){if(!t.matches("Initialized.JoinedRoom"))return a("You are not in the room");if(!t.matches("Initialized.JoinedRoom.Cam.ProducingCam"))return a("Already Stopped Producing Video Stream");n("STOP_PRODUCING_CAM")},N=function(){if(!["Initialized.JoinedLobby","Initialized.JoinedRoom"].some(t.matches))return a("You are not in the lobby or room");if(!l)return a("Already Stopped Video Stream");n("DISABLE_CAM")};return C.isCallable=h,b.isCallable=f,P.isCallable=g,N.isCallable=w,{stream:d,isLoading:c,isProducing:m,fetchVideoStream:C,produceVideo:b,stopProducingVideo:P,stopVideoStream:N,error:o}};function oo(r,e){if(r==null)return{};var t={},n=Object.keys(r),i,s;for(s=0;s<n.length;s++)i=n[s],!(e.indexOf(i)>=0)&&(t[i]=r[i]);return t}function ws(r,e){return ws=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,i){return n.__proto__=i,n},ws(r,e)}function ao(r,e){r.prototype=Object.create(e.prototype),r.prototype.constructor=r,ws(r,e)}function Rv(r,e){return r.classList?!!e&&r.classList.contains(e):(" "+(r.className.baseVal||r.className)+" ").indexOf(" "+e+" ")!==-1}function Cv(r,e){r.classList?r.classList.add(e):Rv(r,e)||(typeof r.className=="string"?r.className=r.className+" "+e:r.setAttribute("class",(r.className&&r.className.baseVal||"")+" "+e))}function qa(r,e){return r.replace(new RegExp("(^|\\s)"+e+"(?:\\s|$)","g"),"$1").replace(/\s+/g," ").replace(/^\s*|\s*$/g,"")}function Ev(r,e){r.classList?r.classList.remove(e):typeof r.className=="string"?r.className=qa(r.className,e):r.setAttribute("class",qa(r.className&&r.className.baseVal||"",e))}const Ga={disabled:!1},Zn=Ee.createContext(null);var Md=function(e){return e.scrollTop},Fr="unmounted",Lt="exited",It="entering",lr="entered",bs="exiting",vt=function(r){ao(e,r);function e(n,i){var s;s=r.call(this,n,i)||this;var o=i,a=o&&!o.isMounting?n.enter:n.appear,c;return s.appearStatus=null,n.in?a?(c=Lt,s.appearStatus=It):c=lr:n.unmountOnExit||n.mountOnEnter?c=Fr:c=Lt,s.state={status:c},s.nextCallback=null,s}e.getDerivedStateFromProps=function(i,s){var o=i.in;return o&&s.status===Fr?{status:Lt}:null};var t=e.prototype;return t.componentDidMount=function(){this.updateStatus(!0,this.appearStatus)},t.componentDidUpdate=function(i){var s=null;if(i!==this.props){var o=this.state.status;this.props.in?o!==It&&o!==lr&&(s=It):(o===It||o===lr)&&(s=bs)}this.updateStatus(!1,s)},t.componentWillUnmount=function(){this.cancelNextCallback()},t.getTimeouts=function(){var i=this.props.timeout,s,o,a;return s=o=a=i,i!=null&&typeof i!="number"&&(s=i.exit,o=i.enter,a=i.appear!==void 0?i.appear:o),{exit:s,enter:o,appear:a}},t.updateStatus=function(i,s){if(i===void 0&&(i=!1),s!==null)if(this.cancelNextCallback(),s===It){if(this.props.unmountOnExit||this.props.mountOnEnter){var o=this.props.nodeRef?this.props.nodeRef.current:ln.findDOMNode(this);o&&Md(o)}this.performEnter(i)}else this.performExit();else this.props.unmountOnExit&&this.state.status===Lt&&this.setState({status:Fr})},t.performEnter=function(i){var s=this,o=this.props.enter,a=this.context?this.context.isMounting:i,c=this.props.nodeRef?[a]:[ln.findDOMNode(this),a],d=c[0],l=c[1],u=this.getTimeouts(),p=a?u.appear:u.enter;if(!i&&!o||Ga.disabled){this.safeSetState({status:lr},function(){s.props.onEntered(d)});return}this.props.onEnter(d,l),this.safeSetState({status:It},function(){s.props.onEntering(d,l),s.onTransitionEnd(p,function(){s.safeSetState({status:lr},function(){s.props.onEntered(d,l)})})})},t.performExit=function(){var i=this,s=this.props.exit,o=this.getTimeouts(),a=this.props.nodeRef?void 0:ln.findDOMNode(this);if(!s||Ga.disabled){this.safeSetState({status:Lt},function(){i.props.onExited(a)});return}this.props.onExit(a),this.safeSetState({status:bs},function(){i.props.onExiting(a),i.onTransitionEnd(o.exit,function(){i.safeSetState({status:Lt},function(){i.props.onExited(a)})})})},t.cancelNextCallback=function(){this.nextCallback!==null&&(this.nextCallback.cancel(),this.nextCallback=null)},t.safeSetState=function(i,s){s=this.setNextCallback(s),this.setState(i,s)},t.setNextCallback=function(i){var s=this,o=!0;return this.nextCallback=function(a){o&&(o=!1,s.nextCallback=null,i(a))},this.nextCallback.cancel=function(){o=!1},this.nextCallback},t.onTransitionEnd=function(i,s){this.setNextCallback(s);var o=this.props.nodeRef?this.props.nodeRef.current:ln.findDOMNode(this),a=i==null&&!this.props.addEndListener;if(!o||a){setTimeout(this.nextCallback,0);return}if(this.props.addEndListener){var c=this.props.nodeRef?[this.nextCallback]:[o,this.nextCallback],d=c[0],l=c[1];this.props.addEndListener(d,l)}i!=null&&setTimeout(this.nextCallback,i)},t.render=function(){var i=this.state.status;if(i===Fr)return null;var s=this.props,o=s.children;s.in,s.mountOnEnter,s.unmountOnExit,s.appear,s.enter,s.exit,s.timeout,s.addEndListener,s.onEnter,s.onEntering,s.onEntered,s.onExit,s.onExiting,s.onExited,s.nodeRef;var a=oo(s,["children","in","mountOnEnter","unmountOnExit","appear","enter","exit","timeout","addEndListener","onEnter","onEntering","onEntered","onExit","onExiting","onExited","nodeRef"]);return Ee.createElement(Zn.Provider,{value:null},typeof o=="function"?o(i,a):Ee.cloneElement(Ee.Children.only(o),a))},e}(Ee.Component);vt.contextType=Zn;vt.propTypes={};function ar(){}vt.defaultProps={in:!1,mountOnEnter:!1,unmountOnExit:!1,appear:!1,enter:!0,exit:!0,onEnter:ar,onEntering:ar,onEntered:ar,onExit:ar,onExiting:ar,onExited:ar};vt.UNMOUNTED=Fr;vt.EXITED=Lt;vt.ENTERING=It;vt.ENTERED=lr;vt.EXITING=bs;const Tv=vt;var Pv=function(e,t){return e&&t&&t.split(" ").forEach(function(n){return Cv(e,n)})},Qi=function(e,t){return e&&t&&t.split(" ").forEach(function(n){return Ev(e,n)})},co=function(r){ao(e,r);function e(){for(var n,i=arguments.length,s=new Array(i),o=0;o<i;o++)s[o]=arguments[o];return n=r.call.apply(r,[this].concat(s))||this,n.appliedClasses={appear:{},enter:{},exit:{}},n.onEnter=function(a,c){var d=n.resolveArguments(a,c),l=d[0],u=d[1];n.removeClasses(l,"exit"),n.addClass(l,u?"appear":"enter","base"),n.props.onEnter&&n.props.onEnter(a,c)},n.onEntering=function(a,c){var d=n.resolveArguments(a,c),l=d[0],u=d[1],p=u?"appear":"enter";n.addClass(l,p,"active"),n.props.onEntering&&n.props.onEntering(a,c)},n.onEntered=function(a,c){var d=n.resolveArguments(a,c),l=d[0],u=d[1],p=u?"appear":"enter";n.removeClasses(l,p),n.addClass(l,p,"done"),n.props.onEntered&&n.props.onEntered(a,c)},n.onExit=function(a){var c=n.resolveArguments(a),d=c[0];n.removeClasses(d,"appear"),n.removeClasses(d,"enter"),n.addClass(d,"exit","base"),n.props.onExit&&n.props.onExit(a)},n.onExiting=function(a){var c=n.resolveArguments(a),d=c[0];n.addClass(d,"exit","active"),n.props.onExiting&&n.props.onExiting(a)},n.onExited=function(a){var c=n.resolveArguments(a),d=c[0];n.removeClasses(d,"exit"),n.addClass(d,"exit","done"),n.props.onExited&&n.props.onExited(a)},n.resolveArguments=function(a,c){return n.props.nodeRef?[n.props.nodeRef.current,a]:[a,c]},n.getClassNames=function(a){var c=n.props.classNames,d=typeof c=="string",l=d&&c?c+"-":"",u=d?""+l+a:c[a],p=d?u+"-active":c[a+"Active"],h=d?u+"-done":c[a+"Done"];return{baseClassName:u,activeClassName:p,doneClassName:h}},n}var t=e.prototype;return t.addClass=function(i,s,o){var a=this.getClassNames(s)[o+"ClassName"],c=this.getClassNames("enter"),d=c.doneClassName;s==="appear"&&o==="done"&&d&&(a+=" "+d),o==="active"&&i&&Md(i),a&&(this.appliedClasses[s][o]=a,Pv(i,a))},t.removeClasses=function(i,s){var o=this.appliedClasses[s],a=o.base,c=o.active,d=o.done;this.appliedClasses[s]={},a&&Qi(i,a),c&&Qi(i,c),d&&Qi(i,d)},t.render=function(){var i=this.props;i.classNames;var s=oo(i,["classNames"]);return Ee.createElement(Tv,xt({},s,{onEnter:this.onEnter,onEntered:this.onEntered,onEntering:this.onEntering,onExit:this.onExit,onExiting:this.onExiting,onExited:this.onExited}))},e}(Ee.Component);co.defaultProps={classNames:""};co.propTypes={};const Ha=co;function Dv(r){if(r===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return r}function lo(r,e){var t=function(s){return e&&A.isValidElement(s)?e(s):s},n=Object.create(null);return r&&A.Children.map(r,function(i){return i}).forEach(function(i){n[i.key]=t(i)}),n}function xv(r,e){r=r||{},e=e||{};function t(l){return l in e?e[l]:r[l]}var n=Object.create(null),i=[];for(var s in r)s in e?i.length&&(n[s]=i,i=[]):i.push(s);var o,a={};for(var c in e){if(n[c])for(o=0;o<n[c].length;o++){var d=n[c][o];a[n[c][o]]=t(d)}a[c]=t(c)}for(o=0;o<i.length;o++)a[i[o]]=t(i[o]);return a}function kt(r,e,t){return t[e]!=null?t[e]:r.props[e]}function Ov(r,e){return lo(r.children,function(t){return A.cloneElement(t,{onExited:e.bind(null,t),in:!0,appear:kt(t,"appear",r),enter:kt(t,"enter",r),exit:kt(t,"exit",r)})})}function Lv(r,e,t){var n=lo(r.children),i=xv(e,n);return Object.keys(i).forEach(function(s){var o=i[s];if(A.isValidElement(o)){var a=s in e,c=s in n,d=e[s],l=A.isValidElement(d)&&!d.props.in;c&&(!a||l)?i[s]=A.cloneElement(o,{onExited:t.bind(null,o),in:!0,exit:kt(o,"exit",r),enter:kt(o,"enter",r)}):!c&&a&&!l?i[s]=A.cloneElement(o,{in:!1}):c&&a&&A.isValidElement(d)&&(i[s]=A.cloneElement(o,{onExited:t.bind(null,o),in:d.props.in,exit:kt(o,"exit",r),enter:kt(o,"enter",r)}))}}),i}var Iv=Object.values||function(r){return Object.keys(r).map(function(e){return r[e]})},kv={component:"div",childFactory:function(e){return e}},uo=function(r){ao(e,r);function e(n,i){var s;s=r.call(this,n,i)||this;var o=s.handleExited.bind(Dv(s));return s.state={contextValue:{isMounting:!0},handleExited:o,firstRender:!0},s}var t=e.prototype;return t.componentDidMount=function(){this.mounted=!0,this.setState({contextValue:{isMounting:!1}})},t.componentWillUnmount=function(){this.mounted=!1},e.getDerivedStateFromProps=function(i,s){var o=s.children,a=s.handleExited,c=s.firstRender;return{children:c?Ov(i,a):Lv(i,o,a),firstRender:!1}},t.handleExited=function(i,s){var o=lo(this.props.children);i.key in o||(i.props.onExited&&i.props.onExited(s),this.mounted&&this.setState(function(a){var c=xt({},a.children);return delete c[i.key],{children:c}}))},t.render=function(){var i=this.props,s=i.component,o=i.childFactory,a=oo(i,["component","childFactory"]),c=this.state.contextValue,d=Iv(this.state.children).map(o);return delete a.appear,delete a.enter,delete a.exit,s===null?Ee.createElement(Zn.Provider,{value:c},d):Ee.createElement(Zn.Provider,{value:c},Ee.createElement(s,a,d))},e}(Ee.Component);uo.propTypes={};uo.defaultProps=kv;const Mv=uo,Nv=({vc:r})=>U.jsx("div",{className:"justify-start items-center gap-[30px] inline-flex",children:U.jsxs("div",{className:"self-stretch justify-start items-start gap-6 flex",children:[U.jsx(Vn,{"aria-label":"Toggle video stream",className:"group rounded-full m-0 p-4 border-[none] justify-center items-center gap-2.5 flex bg-zinc-800 shadow-[0_0px_1px_hsla(0,0%,0%,0.2),0_1px_2px_hsla(0,0%,0%,0.2)] hover:shadow-[0_0px_1px_hsla(0,0%,0%,0.6),0_1px_2px_hsla(0,0%,0%,0.2)] active:shadow-[0_0px_1px_hsla(0,0%,0%,0.4)] active:translate-y-px",pressed:r.state.produceVideo,onPressedChange:e=>{e?r.produceCamera():r.stopProducingCamera()},children:U.jsx("div",{className:"w-9 h-9 grid place-items-center",children:U.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"30",height:"24",fill:"none",viewBox:"0 0 30 24",children:U.jsx("path",{className:"group-radix-state-on:text-white fill-current text-[#F95A39]",d:"M6.17.75h8.688c3.633 0 6.17 2.504 6.17 6.091V17.16c0 3.587-2.537 6.091-6.17 6.091H6.17C2.537 23.25 0 20.746 0 17.159V6.84C0 3.254 2.537.75 6.17.75Zm20.767 3.568a2.074 2.074 0 0 1 2.06.096A2.145 2.145 0 0 1 30 6.244v11.513c0 .751-.375 1.435-1.003 1.83a2.098 2.098 0 0 1-1.115.324 2.09 2.09 0 0 1-.947-.23l-2.221-1.121a2.435 2.435 0 0 1-1.332-2.185v-8.75c0-.933.51-1.77 1.332-2.184l2.223-1.123Z","clip-rule":"evenodd"})})})}),U.jsx(Vn,{"aria-label":"Toggle audio stream",className:"group rounded-full m-0 p-4 border-[none] justify-center items-center gap-2.5 flex bg-zinc-800 shadow-[0_0px_1px_hsla(0,0%,0%,0.2),0_1px_2px_hsla(0,0%,0%,0.2)] hover:shadow-[0_0px_1px_hsla(0,0%,0%,0.6),0_1px_2px_hsla(0,0%,0%,0.2)] active:shadow-[0_0px_1px_hsla(0,0%,0%,0.4)] active:translate-y-px",pressed:r.state.produceAudio,onPressedChange:e=>{e?r.produceAudio():r.stopProducingAudio()},children:U.jsx("div",{className:"w-9 h-9 grid place-items-center",children:U.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"26",height:"30",fill:"none",viewBox:"0 0 26 30",children:U.jsx("path",{className:"group-radix-state-on:text-white fill-current text-[#F95A39]",d:"M13.262 19.826h-.524c-3.606 0-6.528-2.887-6.528-6.446V6.446C6.21 2.886 9.132 0 12.738 0h.524c3.605 0 6.529 2.886 6.529 6.446v6.934c0 3.56-2.924 6.446-6.529 6.446Zm9.582-6.652c0-.793.65-1.435 1.453-1.435.802 0 1.453.642 1.453 1.435 0 6.456-4.95 11.787-11.296 12.503v2.888c0 .792-.651 1.435-1.453 1.435a1.444 1.444 0 0 1-1.453-1.435v-2.889C5.199 24.962.25 19.63.25 13.175c0-.793.651-1.435 1.453-1.435s1.453.642 1.453 1.435c0 5.36 4.416 9.72 9.845 9.72 5.427 0 9.843-4.36 9.843-9.72Z","clip-rule":"evenodd"})})})}),U.jsx("button",{onClick:()=>r.leaveRoom(),className:"group rounded-full m-0 p-4 border-[none] justify-center items-center gap-2.5 flex bg-red-500 shadow-[0_0px_1px_hsla(0,0%,0%,0.2),0_1px_2px_hsla(0,0%,0%,0.2)] hover:shadow-[0_0px_1px_hsla(0,0%,0%,0.6),0_1px_2px_hsla(0,0%,0%,0.2)] active:shadow-[0_0px_1px_hsla(0,0%,0%,0.4)] active:translate-y-px",children:U.jsx("div",{className:"w-9 h-9 grid place-items-center",children:U.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"33",height:"12",fill:"none",viewBox:"0 0 33 12",children:U.jsx("path",{fill:"#fff",d:"M8.838 10.94c.76-.497.964-1.292 1.149-1.992.187-.72.348-2.284 1.014-2.6 3.534-1.491 8.08-1.657 11.612-.143.68.323.85 1.89 1.044 2.613.187.7.402 1.493 1.162 2 .684.454 4.128.873 5.192.864.702-.005 1.255-.178 1.658-.523 1.458-1.355 1.154-4.824.981-5.553-.265-1.658-1.535-2.936-3.763-3.788C23.092-.665 10.549-.564 4.676 1.87c-1.121.412-1.998.937-2.626 1.573-.613.621-.989 1.348-1.119 2.168-.15.566-.453 4.191 1.033 5.593.397.34.954.516 1.652.527 1.064.017 4.542-.342 5.222-.792Z"})})})})]})}),Av=16/9,jv=({vc:r,loaderData:e})=>{const{peers:t}=kd(),[n,i]=A.useReducer((d,l)=>({...d,...l}),{gridWidth:0,gridHeight:0}),s=A.useRef(null);A.useEffect(()=>{function d(){s.current&&i({gridWidth:s.current.offsetWidth,gridHeight:s.current.offsetHeight})}return window.addEventListener("resize",d),d(),()=>window.removeEventListener("resize",d)},[]);const o=d=>{const p=n.gridWidth-16,h=n.gridHeight-8*2,f=Math.ceil(Math.sqrt(d)),m=Math.ceil(d/f),g=(f-1)*8,w=(m-1)*8,C=Math.floor((p-g)/f),b=Math.floor((h-w)/m),P=Av,N=Math.floor(C/P),$=Math.floor(b*P);return $>C?{width:C,height:N}:{width:$,height:b}},a=()=>{const{width:d,height:l}=o(Object.values(r.peers).length+1),u=A.createRef();return U.jsx(Ha,{nodeRef:u,timeout:300,classNames:"stream",children:U.jsxs("div",{ref:u,className:"relative rounded-[20px] bg-black overflow-hidden video-stream",style:{width:d,height:l,border:"1px solid black"},children:[U.jsx("div",{className:"absolute z-10 bottom-4 left-4 flex items-center justify-center text-neutral-50 text-xl font-normal h-[39px] p-2 bg-black bg-opacity-30 rounded-[50px] border border-white border-opacity-10 backdrop-blur-[30px] gap-2.5",children:e.name}),U.jsx("img",{className:"absolute inset-0 m-auto w-16 h-16 rounded-full",src:e.photoUrl,alt:""}),U.jsx("video",{className:"w-full relative z-1",ref:r.videoRefLive,autoPlay:!0,muted:!0})]},"me")},"me")},c=Object.values(t).map(d=>{const{width:l,height:u}=o(Object.values(r.peers).length+1);let p="Guest",h="";try{const m=JSON.parse(d.displayName);p=m.name,h=m.photoUrl}catch(m){console.error(m)}const f=A.createRef();return U.jsx(Ha,{nodeRef:f,timeout:300,classNames:"stream",children:U.jsxs("div",{ref:f,className:"relative rounded-[20px] bg-black overflow-hidden video-stream",style:{width:l,height:u,border:"1px solid black"},children:[U.jsx("div",{className:"absolute z-10 bottom-4 left-4 flex items-center justify-center text-neutral-50 text-xl font-normal h-[39px] p-2 bg-black bg-opacity-30 rounded-[50px] border border-white border-opacity-10 backdrop-blur-[30px] gap-2.5",children:p}),h&&U.jsx("img",{className:"absolute inset-0 m-auto w-16 h-16 rounded-full",src:h,alt:""}),U.jsxs("div",{className:"relative z-1 inset-0",children:[d.cam&&U.jsx(Id,{className:"w-full h-full",peerId:d.peerId,track:d.cam}),d.mic&&U.jsx(Ld,{className:"absolute invisible -z-10",peerId:d.peerId,track:d.mic})]})]},d.peerId)},d.peerId)});return U.jsxs("div",{className:"flex flex-col w-screen h-screen bg-[#ffffff]",children:[U.jsx("div",{className:"flex justify-between items-center"}),U.jsx("div",{className:"w-full h-full",ref:s,children:U.jsxs(Mv,{className:"w-full h-full p-2 gap-2 flex flex-wrap items-center justify-center",children:[a(),c]})}),U.jsx("div",{className:" absolute right-0 left-0 bottom-1 flex justify-center",children:U.jsx(Nv,{vc:r})})]})};var $v={"lobby:joined":"Initialized.JoinedLobby.Emitted.NotEmitted","lobby:cam-on":"Initialized.JoinedLobby.Cam.On","lobby:cam-off":"Initialized.JoinedLobby.Cam.Off","lobby:mic-on":"Initialized.JoinedLobby.Mic.Unmuted","lobby:mic-off":"Initialized.JoinedLobby.Mic.Muted","lobby:failed":"Initialized.JoinLobbyFailed","room:joined":"Initialized.JoinedRoom.Emitted.NotEmitted","room:failed":"Initialized.JoinLobbyFailed","room:new-peer":"Initialized.JoinedRoom.Peers.Peers","room:peer-left":"Initialized.JoinedRoom.Peers.Peers","room:audio-producing":"Initialized.JoinedRoom.Mic.ProducingMic","room:video-producing":"Initialized.JoinedRoom.Cam.ProducingCam","room:recording-started":"Initialized.JoinedRoom.Recording.Recording","room:recording-stopped":"Initialized.JoinedRoom.Recording.Stopped","room:livestream-started":"Initialized.JoinedRoom.Streaming.Streaming","room:livestream-stopped":"Initialized.JoinedRoom.Streaming.Stopped"},Wa=function(e,t){var n=ft(),i=n.state;A.useEffect(function(){i.matches($v[e])&&t()},[i])},Bv=function(){var e=ft(),t=e.state,n=e.send,i=A.useState(""),s=jt(i,2),o=s[0],a=s[1],c=t.matches("Initialized.JoinedLobby.DisplayName.Loading"),d=t.matches("Initialized.JoinedLobby")||t.matches("Initialized.JoinedRoom"),l=function(p){if(!d)return a("You are not in the lobby or room yet");n({type:"SET_DISPLAY_NAME",displayName:p})};return l.isCallable=d,{setDisplayName:l,error:o,isLoading:c,displayName:t.context.displayName}};const Fv=()=>{const[r,e]=A.useState(""),[t,n]=A.useState("Kelvin"),i="TxG-OolMwGeCoZPzX660e65wwuU2MP83",[s,o]=A.useState(""),{initialize:a}=vv(),{setDisplayName:c,error:d}=Bv(),{joinLobby:l}=_v(),{joinRoom:u,leaveRoom:p}=bv(),{peers:h}=kd(),{fetchAudioStream:f,produceAudio:m,stopAudioStream:g,stopProducingAudio:w,stream:C}=yv(),{fetchVideoStream:b,produceVideo:P,stopVideoStream:N,stopProducingVideo:$,stream:B}=Sv(),{startRecording:F,stopRecording:S,error:k,data:D}=wv();return{roomId:r,setRoomId:e,displayNameText:t,setDisplayNameText:n,projectId:i,accessToken:s,setAccessToken:o,initialize:a,setDisplayName:c,displayNameError:d,joinLobby:l,joinRoom:u,leaveRoom:p,peers:h,fetchAudioStream:f,produceAudio:m,stopAudioStream:g,stopProducingAudio:w,micStream:C,fetchVideoStream:b,produceVideo:P,stopVideoStream:N,stopProducingVideo:$,camStream:B,startRecording:F,stopRecording:S,error:k,recordingData:D,Audio:Ld,Video:Id}},Uv=r=>{const e=Fv(),[t,n]=A.useReducer((f,m)=>({...f,...m}),{initializeLoading:!0,showDialog:!1,blurMain:!0,joinedLobby:!1,joinedRoom:!1,recording:!1,showUpload:!1,produceVideo:!1,produceAudio:!1}),i=A.useRef(t),s=A.useRef(null),o=A.useRef(null);A.useEffect(()=>{i.current=t},[t]),A.useEffect(()=>{const f=setTimeout(()=>{n({showDialog:!0})},200);return()=>clearTimeout(f)},[]),A.useEffect(()=>{e.initialize(e.projectId),e.setDisplayNameText(r.name)},[r.name,e.projectId]),A.useEffect(()=>{e.joinLobby.isCallable&&e.joinLobby(r.roomId)},[r.roomId,e.joinLobby.isCallable]),A.useEffect(()=>{[e.setDisplayName.isCallable,e.fetchVideoStream.isCallable,e.fetchAudioStream.isCallable,e.joinRoom.isCallable].every(Boolean)&&(n({joinedLobby:!0}),n({initializeLoading:!1}))},[e.displayNameText,e.setDisplayName.isCallable,e.fetchVideoStream.isCallable,e.fetchAudioStream.isCallable,e.joinRoom.isCallable]),Wa("lobby:cam-on",()=>{console.log(e.camStream),e.camStream&&s.current&&(console.log("works"),s.current.srcObject=e.camStream),console.log(i.current.joinedRoom),e.camStream&&o.current&&i.current.joinedRoom&&(console.log("works"),o.current.srcObject=e.camStream,e.produceVideo(e.camStream))}),Wa("room:joined",()=>{h()}),A.useEffect(()=>{e.camStream&&o.current&&i.current.joinedRoom&&t.produceVideo?(o.current.srcObject=e.camStream,e.produceVideo(e.camStream)):!t.produceVideo&&o.current&&(o.current.srcObject=null,e.stopVideoStream())},[e.camStream,t.produceVideo]),A.useEffect(()=>{e.micStream&&t.produceAudio&&e.produceAudio(e.micStream)},[e.micStream,t.produceAudio]);const a=()=>{l(),e.joinRoom(),n({showDialog:!1}),n({joinedRoom:!0}),n({blurMain:!1})},c=()=>{l(),p(),e.leaveRoom(),n({showDialog:!0}),n({joinedRoom:!1}),n({blurMain:!0})},d=()=>{n({produceVideo:!0}),e.fetchVideoStream()},l=()=>{n({produceVideo:!1}),e.stopVideoStream(),e.stopProducingVideo()},u=()=>{n({produceAudio:!0}),e.fetchAudioStream()},p=()=>{n({produceAudio:!1}),e.stopAudioStream(),e.stopProducingAudio()},h=()=>{const f={name:r.name,photoUrl:r.photoUrl};e.setDisplayName(JSON.stringify(f))};return{state:t,updateState:n,peers:e.peers,videoRefPreview:s,videoRefLive:o,fetchVideoStream:e.fetchVideoStream,stopVideoStream:e.stopVideoStream,fetchAudioStream:e.fetchAudioStream,stopAudioStream:e.stopAudioStream,setUserInfo:h,produceCamera:d,stopProducingCamera:l,produceAudio:u,stopProducingAudio:p,joinRoom:a,leaveRoom:c}},Gv=()=>{const r=$d(),e=Uv(r);return U.jsxs(U.Fragment,{children:[U.jsxs("div",{"data-show":e.state.showDialog,className:"m-4 group absolute z-[9999 w-[calc(100vw_-_32px)] h-[calc(100vh_-_32px)] overflow-hidden left-0 top-0 [transition:visibility_0s_linear_0.5s,opacity_0.5s_linear] opacity-0 invisible data-[show=true]:delay-[0s] data-[show=true]:opacity-100 data-[show=true]:visible",children:[U.jsx("div",{className:"absolute w-screen h-screen left-0 top-0"}),U.jsxs("div",{className:"relative z-[1] block box-border -translate-y-2/4 max-w-[720px] w-full rounded-lg shadow-[1px_1px_6px_rgba(0,0,0,0.3)]  transition-all duration-[0.5s] mx-auto my-0 py-0 top-2/4 bg-white max-h-0 opacity-0 group-data-[show=true]:max-h-96 group-data-[show=true]:opacity-100",children:[e.state.showUpload&&U.jsx(Xd,{vc:e}),!e.state.joinedRoom&&U.jsx(Qd,{loaderData:r,vc:e})]})]}),U.jsx("main",{"data-blur":e.state.blurMain,className:"data-[blur=true]:blur-[6px] transition-all duration-[0.5s] ease-[ease-out] w-full",children:U.jsx(jv,{loaderData:r,vc:e})})]})},Hv=Bd(({request:r})=>{const e=new URL(r.url),t=e.searchParams.get("name")||"",n=e.searchParams.get("photoUrl")||"",i=e.searchParams.get("roomId")||"ges-pbhp-pjo";return{name:t,photoUrl:n,roomId:i}});async function Wv(){}export{Gv as Component,Wv as action,Hv as loader};
